<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CFI ACS Study Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300&family=Barlow+Condensed:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  @media(hover:hover){
  /* On touch devices, suppress sticky :hover effects by making hover states match normal state */
  @media(hover:none) and (pointer:coarse){
    *, *::before, *::after {
      -webkit-tap-highlight-color:transparent;
    }
  }
  }
  :root {
    --bg: #f4f4f2;
    --white: #ffffff;
    --ink: #111111;
    --muted: #999999;
    --border: #e0e0e0;
    --accent: #d95f1a;
    --accent-dark: #b34d10;
    --header-bg: #3d5166;
    --task-header: #2f3f50;
    --reveal-bg: #efefed;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: 'DM Sans', system-ui, sans-serif;
    min-height: 100vh;
    font-weight: 300;
  }

  header {
    background: var(--header-bg);
    padding: 2.2rem 2.5rem 1.8rem;
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    flex-direction: column;
  }

  .header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .notes-icon-btn {
    background: var(--header-bg);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    width: 2.8rem;
    height: 2.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.35);
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    flex-shrink: 0;
    padding: 0;
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 200;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }

  @media(hover:hover){
  .notes-icon-btn:hover { transform: scale(1.08); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .notes-icon-btn:active { transform: scale(0.94); }
  .notes-icon-btn.active { border-color: rgba(255,255,255,0.6); color: #fff; }

  .manual-save-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .manual-save-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .manual-save-btn:active { transform: scale(0.95); }

  body:not(.modern-mode) .oral-sim-header-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    color: rgba(255,255,255,0.7);
    display: flex;
    align-items: center;
    gap: 0;
    cursor: pointer;
    transition: transform 0.2s ease, color 0.15s, filter 0.2s ease;
    flex-shrink: 0;
    padding: 0;
    overflow: visible;
  }
  @media(hover:hover){
  body:not(.modern-mode) .oral-sim-header-btn:hover {
    color: #ffffff;
    filter: drop-shadow(0 0 6px rgba(255,255,255,0.5));
    transform: scale(1.2);
    transform-origin: left center;
  }
  }
  body:not(.modern-mode) .oral-sim-header-btn:active { transform: scale(0.95); transform-origin: left center; }

  .oral-sim-slide-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    white-space: nowrap;
    display: inline-block;
    overflow: hidden;
    max-width: 0;
    opacity: 0;
    margin-left: 0;
    transition: max-width 0.35s cubic-bezier(0.4,0,0.2,1),
                opacity 0.25s ease,
                margin-left 0.35s cubic-bezier(0.4,0,0.2,1);
  }
  @media(hover:hover){
  .oral-sim-header-btn:hover .oral-sim-slide-label,
  .oral-sim-slide-label.preview {
    max-width: 130px;
    opacity: 1;
    margin-left: 0.55rem;
  }
  }

  .oral-sim-icon-ring { transition: stroke 0.6s ease; }
  .oral-sim-icon-play { transition: fill 0.6s ease, stroke 0.6s ease; }

  @keyframes oral-ring-draw {
    0%   { stroke-dashoffset: 41; }
    60%  { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: 0; }
  }
  @keyframes oral-play-bounce {
    0%   { transform: translate(0, 0) scale(1); }
    30%  { transform: translate(0, -1.5px) scale(1.18); }
    55%  { transform: translate(0, 1px) scale(0.92); }
    75%  { transform: translate(0, -0.5px) scale(1.05); }
    100% { transform: translate(0, 0) scale(1); }
  }

  .oral-sim-header-btn.idle-animate .oral-sim-icon-ring {
    stroke-dasharray: 41;
    stroke-dashoffset: 41;
    animation: oral-ring-draw 1.1s cubic-bezier(0.4,0,0.2,1) forwards;
  }
  .oral-sim-header-btn.idle-animate .oral-sim-icon-play {
    animation: oral-play-bounce 0.7s cubic-bezier(0.34,1.56,0.64,1) 0.4s forwards;
  }

  @keyframes oral-sim-pulse {
    0%   { filter: drop-shadow(0 0 0px rgba(217,95,26,0)); }
    50%  { filter: drop-shadow(0 0 7px rgba(217,95,26,0.85)); }
    100% { filter: drop-shadow(0 0 0px rgba(217,95,26,0)); }
  }
  .oral-sim-pulsing {
    animation: oral-sim-pulse 1.4s ease-in-out 5;
  }

  .edit-mode-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .edit-mode-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .edit-mode-btn:active { transform: scale(0.95); }
  .edit-mode-btn.active { color: #ffffff; }
  @media(hover:hover){
  .edit-mode-btn.active:hover { color: var(--accent); }
  }

  header h1 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    color: #fff;
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    letter-spacing: -0.01em;
    text-transform: uppercase;
  }

  header p {
    color: #e8f0f8;
    font-size: 0.75rem;
    margin-top: 0.3rem;
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 400;
  }

  .controls {
    display: flex;
    gap: 0.6rem;
    margin-top: 1.1rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.4rem 1rem;
    border: 1px solid;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, color 0.2s, background 0.2s;
    border-radius: 6px;
    font-weight: 600;
  }

  .btn-reveal { background: transparent; border-color: rgba(46,139,87,0.6); color: rgba(46,139,87,0.85); }
  @media(hover:hover){
  .btn-reveal:hover { transform: scale(1.05); border-color: #2e8b57; color: #2e8b57; }
  }

  .btn-hide-all, .btn-expand, .btn-collapse, .btn-export, .btn-import, .btn-hide, .btn-lock {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  .btn-hide-all { background: transparent; border-color: rgba(255,255,255,0.35); color: rgba(255,255,255,0.7); }
  @media(hover:hover){
  .btn-hide-all:hover,
  .btn-expand:hover, .btn-collapse:hover,
  .btn-export:hover, .btn-import:hover,
  .btn-hide:hover, .btn-lock:hover {
    transform: scale(1.05);
    border-color: rgba(255,255,255,0.75);
    color: #fff;
  }
  }

  .btn:active { transform: scale(0.96) !important; }

  .main {
    max-width: 980px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 5rem;
  }

  .area {
    background: var(--white);
    border-radius: 4px;
    margin-bottom: 0.75rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.07), 0 6px 24px rgba(0,0,0,0.05);
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .area-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
    padding: 0;
  }
  .area-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.25s ease-in, visibility 0s 0.25s;
  }
  .area-body-inner {
    overflow: visible;
    padding: 1.5rem;
  }

  .area-header {
    background: var(--header-bg);
    color: #fff;
    padding: 1rem 1.5rem 1rem 1.1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    user-select: none;
    border-radius: 3px 3px 0 0;
  }

  .area-header.collapsed {
    border-radius: 3px;
  }

  .area-header.expanded {
    border-radius: 3px;
  }

  .area-header h2 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: inherit;
  }

  .area-header .chevron {
    color: inherit;
    font-size: 1.4rem;
    font-weight: 300;
    line-height: 1;
    flex-shrink: 0;
    margin-left: 1rem;
  }

  .area-header.collapsed .chevron { }

  .area-header { transition: transform 0.2s, background 0.2s, color 0.2s; color: rgba(255,255,255,0.65); }
  @media(hover:hover){
  .area-header:hover { transform: scale(1.008); color: #fff; background: #465e75; }
  }
  .area-header:active { transform: scale(0.997); background: #3a5068; }

  /* area-body animated via max-height */

  /* area-body animated via grid-template-rows */

  .task {
    margin-bottom: 1.5rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .task-header {
    background: #eaeaea;
    color: #888;
    padding: 0.6rem 1rem 0.6rem 0.75rem;
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
    transition: transform 0.2s, background 0.2s, color 0.2s;
  }
  @media(hover:hover){
  .task-header:hover { transform: scale(1.01); background: #e0e0e0; color: #111; }
  }
  .task-header:active { transform: scale(0.998); background: #d6d6d6; }

  .task-header.expanded {
    border-radius: 4px 4px 0 0;
  }

  .task-header .task-ref {
    display: inline;
    color: var(--accent);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
  }

  .task-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
  }
  .task-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.2s ease-in, visibility 0s 0.2s;
  }
  .task-body-inner {
    overflow: visible;
    padding: 1.2rem;
    background: var(--white);
    border-radius: 4px;
  }

  .section-wrapper {
    margin-bottom: 0.6rem;
    border: 1px solid #ddd;
    border-radius: 3px;
    overflow: hidden;
  }

  .section-label {
    background: #eaeaea;
    padding: 0.55rem 1rem;
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: #999;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.2s, transform 0.2s, color 0.2s;
    border-radius: 3px 3px 3px 3px;
  }

  .section-label.expanded {
    border-radius: 3px 3px 0 0;
  }

  .section-wrapper.open .section-label { background: #e0e0e0; color: #111; }
  @media(hover:hover){
  .section-label:hover { transform: scale(1.01); background: #e0e0e0; color: #111; }
  }
  .section-label:active { transform: scale(0.998); background: #d6d6d6; }

  /* section-body animated via max-height */

  .task-chevron, .section-chevron {
    color: #666;
    font-size: 0.9rem;
    flex-shrink: 0;
    margin-left: 1rem;
    display: inline-block;
    transition: transform 0.25s;
    transform: rotate(-90deg);
  }

  .section-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
  }
  .section-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.18s ease-in, visibility 0s 0.18s;
  }
  .section-body-inner {
    overflow: visible;
    padding: 0.75rem 1rem;
    background: #f9f9f9;
    border-radius: 6px;
  }

  .item {
    margin: 0.7rem 0;
    display: grid;
    grid-template-columns: 145px 1fr;
    gap: 0.75rem;
    align-items: start;
    padding: 0.25rem 0.35rem;
    border-radius: 4px;
    transition: background 0.15s, outline 0.15s;
  }

  .item-code {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.67rem;
    color: var(--accent);
    font-weight: 500;
    padding: 0.25rem 0.4rem;
    word-break: break-all;
    letter-spacing: 0.02em;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }

  @media(hover:hover){
  .item:has(.item-code:hover) {
    background: #fff8f4;
    outline: 2px solid var(--accent);
    outline-offset: 0px;
  }

  @media(hover:hover){
  .item.no-hover:has(.item-code:hover) {
    background: transparent;
    outline: none;
  }
  }

  }
  .item-code.bookmarked {
    background: transparent;
    outline: none;
  }

  .item.is-bookmarked {
    background: #fff0e6;
    border-radius: 4px;
    outline: 3px solid var(--accent);
    outline-offset: 2px;
  }

  .item.is-bookmarked > .item-code {
    background: transparent;
    outline: none;
  }

  @keyframes pulse-border {
    0%   { outline: 3px solid rgba(217, 95, 26, 1); outline-offset: -3px; }
    50%  { outline: 3px solid rgba(217, 95, 26, 0.3); outline-offset: -3px; }
    100% { outline: 3px solid rgba(217, 95, 26, 1); outline-offset: -3px; }
  }

  .area-header.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  .task-header.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  .section-label.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  @media(hover:hover){
  .area-header.bookmark-highlight:hover,
  .task-header.bookmark-highlight:hover,
  .section-label.bookmark-highlight:hover {
    transform: none !important;
    animation: pulse-border 1.5s ease-in-out infinite !important;
    outline: 3px solid var(--accent) !important;
    outline-offset: -3px !important;
  }
  }

  @keyframes pulse-orange-btn {
    0%   { border-color: rgba(0,0,0,0.15); color: rgba(0,0,0,0.35); }
    50%  { border-color: var(--accent); color: var(--accent); }
    100% { border-color: rgba(0,0,0,0.15); color: rgba(0,0,0,0.35); }
  }

  .bookmark-banner {
    display: none;
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 200;
    background: #eaeaea;
    color: rgba(0,0,0,0.35);
    border: 1px solid rgba(0,0,0,0.15);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.4rem 1.2rem;
    text-align: center;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    white-space: nowrap;
    animation: pulse-orange-btn 2s ease-in-out infinite;
  }

  @media(hover:hover){
  .bookmark-banner:hover { animation: none; transform: translateX(-50%) scale(1.05); border-color: var(--accent); color: var(--accent); transition: border-color 0.2s, color 0.2s, transform 0.2s; }
  }
  .bookmark-banner:active { transform: translateX(-50%) scale(0.96); }
  .bookmark-banner.visible { display: block; }

  .item-fields { display: flex; flex-direction: column; gap: 0.4rem; }

  .item-title-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.75rem;
    padding: 0.2rem 0;
  }

  .item-title {
    font-size: 0.87rem;
    color: var(--ink);
    line-height: 1.45;
    font-weight: 400;
    flex: 1;
    transition: background 0.2s, color 0.2s;
    border-radius: 3px;
    padding: 0.1rem 0.3rem;
    margin: -0.1rem -0.3rem;
  }

  .item-title.conf-green  { background: #d4f0dc; color: #1a5c30; }
  .item-title.conf-yellow { background: #fef3c7; color: #7c5c00; }
  .item-title.conf-red    { background: #fde8e8; color: #7c1d1d; }

  .conf-dots-row {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    flex-shrink: 0;
    padding-top: 0.15rem;
  }

  .conf-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 1.5px solid;
    cursor: pointer;
    transition: transform 0.15s, opacity 0.15s;
    opacity: 0.35;
    background: transparent;
    padding: 0;
  }

  @media(hover:hover){
  .conf-dot:hover { transform: scale(1.3); opacity: 0.7; }
  }

  .conf-dot.green  { border-color: #2e8b57; }
  .conf-dot.yellow { border-color: #d4a017; }
  .conf-dot.red    { border-color: #c0392b; }

  .conf-dot.active { opacity: 1; }
  .conf-dot.active.green  { background: #2e8b57; }
  .conf-dot.active.yellow { background: #d4a017; }
  .conf-dot.active.red    { background: #c0392b; }

  /* section-body animation handled via grid-template-rows above */

  .section-chevron {
    font-size: 0.75rem;
    margin-left: 0.4rem;
    transition: transform 0.2s;
  }

  .field-label-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.2rem;
  }

  .field-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    transition: color 0.25s;
  }

  .field-label.populated { color: #2e8b57; }

  .field-edit-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #bbb;
    padding: 0;
    font-size: 0.85rem;
    line-height: 1;
    letter-spacing: 0.15em;
    transition: color 0.15s;
    flex-shrink: 0;
    margin-left: auto;
  }
  @media(hover:hover){
  .field-edit-btn:hover { color: #444; }
  }

  .field-with-toggle {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  .side-toggle-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.55rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.35rem 0.55rem;
    border: 1.5px solid #2e8b57;
    border-radius: 4px;
    background: transparent;
    color: #2e8b57;
    cursor: pointer;
    transition: all 0.18s;
    white-space: nowrap;
    align-self: center;
  }

  @media(hover:hover){
  .side-toggle-btn:hover { transform: scale(1.08); }
  }

  .side-toggle-btn.is-hidden {
    border-color: #aaa;
    color: #aaa;
  }

  @media(hover:hover){
  .side-toggle-btn.is-hidden:hover { transform: scale(1.08); }
  }

  .editor-outer {
    flex: 1;
    position: relative;
    border-radius: 4px;
    overflow: visible;
    display: flex;
    flex-direction: column;
  }

  .editor-toolbar {
    display: flex;
    gap: 0.25rem;
    padding: 0.25rem 0.4rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: #e8e8e8;
    margin-bottom: 3px;
  }

  .editor-outer.summary-type .editor-toolbar,
  .editor-outer.task-summary-type .editor-toolbar {
    background: #e4e4e4;
    border-color: #ddd;
  }

  .editor-toolbar button {
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    padding: 0.12rem 0.5rem;
    border: none;
    border-radius: 3px;
    background: transparent;
    color: #666;
    cursor: pointer;
    transition: transform 0.15s, color 0.15s;
    line-height: 1.5;
  }

  @media(hover:hover){
  .editor-toolbar button:hover { background: transparent; color: var(--accent); transform: scale(1.15); }
  }
  .editor-toolbar .tb-bold { font-weight: 700; }
  .editor-toolbar .tb-italic { font-style: italic; }
  .editor-toolbar .tb-underline { text-decoration: underline; }
  .editor-toolbar .tb-bold.fmt-active,
  .editor-toolbar .tb-italic.fmt-active,
  .editor-toolbar .tb-underline.fmt-active {
    outline: 1.5px solid #111;
    border-radius: 3px;
    color: #111;
  }
  .editor-toolbar .tb-done {
    color: #333;
    border-color: transparent;
    background: transparent;
    font-weight: 400;
    opacity: 0.5;
  }
  @media(hover:hover){
  .editor-toolbar .tb-done:hover { background: transparent !important; border-color: transparent !important; color: #333 !important; opacity: 1; }
  }

  .info-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.2rem;
    height: 1.2rem;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,0.7);
    color: rgba(255,255,255,0.85);
    font-size: 0.62rem;
    font-weight: 700;
    font-family: 'Barlow', sans-serif;
    cursor: pointer;
    flex-shrink: 0;
    background: transparent;
    transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.15s;
    margin-left: 0.5rem;
    line-height: 1;
    vertical-align: middle;
    position: relative;
  }
  @media(hover:hover){
  .info-btn:hover { background: transparent; border-color: rgba(255,255,255,0.7); color: rgba(255,255,255,0.85); transform: scale(1.2); }
  }
  .info-btn.obj-btn {
    border-color: rgba(255,255,255,0.6);
    color: rgba(255,255,255,0.8);
  }
  @media(hover:hover){
  .info-btn.obj-btn:hover {
    background: transparent !important;
    border-color: rgba(0,0,0,0.25) !important;
    color: #555 !important;
    transform: scale(1.2);
  }
  }

  .task-note-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 3px;
    border: 1.5px solid rgba(0,0,0,0.25);
    color: #555;
    font-size: 0.5rem;
    font-weight: 700;
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    flex-shrink: 0;
    background: transparent;
    transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.15s;
    margin-left: 0.5rem;
    line-height: 1;
    vertical-align: middle;
    position: relative;
    padding: 0.2rem 0.4rem;
  }
  @media(hover:hover){
  .task-note-btn:hover {
    background: transparent;
    border-color: rgba(0,0,0,0.45);
    color: #333;
    transform: scale(1.08);
  }
  }

  .info-popup {
    display: none;
    position: fixed;
    z-index: 1000;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0.85rem 1rem;
    box-shadow: 0 6px 24px rgba(0,0,0,0.15);
    font-family: 'Barlow', sans-serif;
    font-size: 0.78rem;
    line-height: 1.6;
    color: #222;
    max-width: 420px;
    min-width: 260px;
  }
  .info-popup.open { display: block; }
  .info-popup strong {
    display: block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #888;
    margin-bottom: 0.4rem;
  }

  .refs-toggle {
    display: inline-block;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.32rem;
    font-style: italic;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.25);
    margin-top: 0.1rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.15s;
  }
  @media(hover:hover){
  .refs-toggle:hover { color: rgba(255,255,255,0.6); transform: scale(1.15); }
  }
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #aaa;
    text-transform: uppercase;
    letter-spacing: 0.14em;
  }

  .reveal-overlay.hidden-overlay { display: none; }

  .editor-outer.is-hidden-state {
    min-height: 0;
  }

  .editor-outer.is-hidden-state .rich-editor {
    height: 0 !important;
    min-height: 0 !important;
    padding: 0 !important;
    border: none !important;
    overflow: hidden;
  }

  .editor-outer.is-hidden-state .editor-toolbar {
    display: none;
  }

  .reveal-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 36px;
    background: #e8e8e8;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
    cursor: pointer;
    transition: transform 0.15s, color 0.15s;
  }
  @media(hover:hover){
  .reveal-placeholder:hover {
    transform: scale(1.012);
    color: #888;
  }
  }
  .editor-outer:not(.is-hidden-state) .reveal-placeholder {
    display: none;
  }

  .editor-toolbar {
    display: none;
  }

  .editor-outer.toolbar-active .editor-toolbar {
    display: flex;
  }

  .editor-outer.toolbar-active .rich-editor {
    border-radius: 4px;
  }

  .rich-editor {
    width: 100%;
    min-height: 54px;
    max-height: 40vh;
    overflow-y: auto;
    padding: 0.5rem 0.65rem 0.5rem 0.8rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow', sans-serif;
    font-size: 0.83rem;
    font-weight: 300;
    line-height: 1.55;
    color: var(--ink);
    background: #f2f2f2;
    outline: none;
    overflow-wrap: break-word;
  }
  .rich-editor ol, .rich-editor ul {
    padding-left: 1.4rem;
    margin: 0.2rem 0;
  }

  @keyframes pulse-green-border {
    0%   { border-color: #2e8b57; box-shadow: 0 0 0 2px rgba(46,139,87,0.55); }
    50%  { border-color: #52c48a; box-shadow: 0 0 0 4px rgba(46,139,87,0.18); }
    100% { border-color: #2e8b57; box-shadow: 0 0 0 2px rgba(46,139,87,0.55); }
  }

  .rich-editor:focus { background: #ebebeb; border-color: #2e8b57; }
  .editor-outer.toolbar-active .rich-editor:focus {
    border-radius: 4px;
  }

  /* No hover effects on revealed editor - it just clicks to hide */
  .editor-outer:not(.is-hidden-state) .rich-editor {
    cursor: default;
    transform: none !important;
  }

  /* Hover scale on revealed editor when not in edit mode — indicates clickable */
  .editor-outer:not(.is-hidden-state):not(.toolbar-active) .rich-editor {
    cursor: pointer !important;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .editor-outer:not(.is-hidden-state):not(.toolbar-active) .rich-editor:hover {
    transform: scale(1.012) !important;
  }
  }

  .rich-editor.summary-editor {
    background: #f2f2f2;
    border-color: #ddd;
    min-height: 54px;
    max-height: 40vh;
  }

  .rich-editor.summary-editor:focus { background: #ebebeb; border-color: #2e8b57; }

  .rich-editor.task-summary-editor {
    background: #f2f2f2;
    border: 1px solid #e0e0e0;
    min-height: 54px;
    max-height: 30vh;
  }

  .rich-editor.task-summary-editor:focus { background: #ebebeb; border-color: #2e8b57; }

  .rich-editor:empty:before {
    content: attr(data-placeholder);
    color: #ccc;
    pointer-events: none;
    display: block;
  }

  .task-summary-section {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #f0f0ee;
    border-radius: 4px;
    border: 1px solid var(--border);
  }

  .task-summary-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 0.5rem;
  }

  .more-options-wrap { position: relative; }

  .more-options-menu {
    display: block;
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    z-index: 200;
    width: 320px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
    transform: scale(0);
    transform-origin: top left;
    opacity: 0;
    pointer-events: none;
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.15s ease;
  }

  .more-options-menu.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  .more-options-menu button,
  .more-options-menu a {
    display: block;
    width: 100%;
    padding: 0.65rem 1rem;
    background: transparent;
    border: none;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    cursor: pointer;
    text-align: left;
    transition: transform 0.15s;
    text-decoration: none;
    box-sizing: border-box;
  }

  .more-options-menu button { color: #c0392b; }
  .more-options-menu button.link-btn-save { color: #2e8b57 !important; }
  .more-options-menu button.link-btn-add { color: #2e8b57 !important; }
  .more-options-menu .links-add-row button[title="Paste from clipboard"] { color: #888 !important; }
  @media(hover:hover){
  .more-options-menu button:hover { transform: scale(1.03); }
  }
  .more-options-menu a { color: #222; }
  @media(hover:hover){
  .more-options-menu a:hover { transform: scale(1.03); }
  }

  @media(hover:hover){
  .link-btn-edit:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-add:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-save:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-cancel:hover { transform: scale(1.04) !important; }
  }

  @media(hover:hover){
  .notes-btn:hover { transform: scale(1.06) !important; }
  }
  .notes-btn.active { background: #236b43 !important; border-color: #236b43 !important; }

  .notes-panel {
    position: fixed;
    bottom: 1.5rem;
    right: 5.2rem;
    width: 400px;
    height: calc(100vh - 195px);
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 8px rgba(0,0,0,0.08);
    z-index: 300;
    display: flex;
    flex-direction: column;
    transform: scale(0);
    transform-origin: bottom right;
    opacity: 0;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
    overflow: hidden;
    pointer-events: none;
  }

  .notes-panel.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  /* ── Search Panel ─────────────────────────────────────────────── */
  .search-icon-btn {
    background: var(--header-bg);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    width: 2.8rem;
    height: 2.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.35);
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    flex-shrink: 0;
    padding: 0;
    position: fixed;
    bottom: 1.5rem;
    left: 1.5rem;
    z-index: 200;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }
  @media(hover:hover){
  .search-icon-btn:hover { transform: scale(1.08); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .search-icon-btn:active { transform: scale(0.94); }
  .search-icon-btn.active { border-color: rgba(255,255,255,0.6); color: #fff; }

  .search-panel {
    position: fixed;
    bottom: 1.5rem;
    left: 5.2rem;
    width: 400px;
    height: calc(100vh - 195px);
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 8px rgba(0,0,0,0.08);
    z-index: 300;
    display: flex;
    flex-direction: column;
    transform: scale(0);
    transform-origin: bottom left;
    opacity: 0;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
    overflow: hidden;
    pointer-events: none;
  }
  .search-panel.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  .search-panel-header {
    background: var(--header-bg);
    padding: 1rem 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-radius: 0;
    margin-bottom: 0;
  }
  .search-panel-header h3 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }
  .search-panel-close {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.15s, transform 0.15s;
    padding: 0;
    line-height: 1;
  }
  @media(hover:hover){
  .search-panel-close:hover { transform: scale(1.2); opacity: 1; }
  }

  .search-panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 0.6rem;
    overflow: hidden;
  }

  .search-input-row {
    display: flex;
    align-items: center;
    background: #f2f2f2;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0 0.6rem;
    gap: 0.4rem;
    flex-shrink: 0;
  }
  .search-input-row:focus-within {
    background: #ebebeb;
    border-color: #2e8b57;
    
  }
  .search-panel-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-family: 'Barlow', sans-serif;
    font-size: 0.85rem;
    font-weight: 300;
    color: var(--ink);
    padding: 0.6rem 0;
  }
  .search-panel-input::placeholder { color: #bbb; }
  .search-panel-clear {
    background: none;
    border: none;
    color: #aaa;
    cursor: pointer;
    font-size: 1.1rem;
    padding: 0;
    line-height: 1;
    display: none;
  }
  @media(hover:hover){
  .search-panel-clear:hover { color: #555; }
  }

  .search-panel-results {
    flex: 1;
    overflow-y: auto;
    border-radius: 4px;
  }
  .search-result-row {
    padding: 0.65rem 0.8rem;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.12s, transform 0.12s;
    border-radius: 4px;
  }
  @media(hover:hover){
  .search-result-row:hover, .search-result-row.active { background: #f4f0ed; transform: scale(1.01); }
  }

  .notes-panel-header {
    background: var(--header-bg);
    padding: 1rem 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-radius: 0;
    margin-bottom: 0;
  }

  .notes-panel-header h3 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }

  .notes-panel-close {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.15s, transform 0.15s;
    padding: 0;
    line-height: 1;
  }

  @media(hover:hover){
  .notes-panel-close:hover { transform: scale(1.2); opacity: 1; }
  }

  .notes-panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 0.5rem;
    overflow: hidden;
  }

  .notes-editor {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow', sans-serif;
    font-size: 0.85rem;
    font-weight: 300;
    line-height: 1.6;
    color: var(--ink);
    background: #f2f2f2;
    outline: none;
    overflow-y: auto;
    resize: none;
  }

  .notes-editor:focus { background: #ebebeb; border-color: #2e8b57; }
  .notes-panel-body:focus-within .notes-editor { border-color: #2e8b57; }

  .notes-editor:empty:before {
    content: attr(data-placeholder);
    color: #ccc;
    pointer-events: none;
    display: block;
  }

  .notes-save-indicator {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #2e8b57;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    opacity: 0;
    transition: opacity 0.4s;
    text-align: right;
    height: 1rem;
  }

  @media (max-width: 600px) {

    /* Header */
    header {
      padding: 1.2rem 1rem 1rem;
      position: relative;
    }

    .header-top {
      flex-direction: column;
      gap: 0.8rem;
    }

    .header-top > div:first-child { width: 100%; }

    header h1 { font-size: 1rem; }
    header p { font-size: 0.6rem; }

    .header-top > div:last-child {
      flex-direction: row;
      align-items: center;
      width: 100%;
      justify-content: flex-end;
    }

    .edit-mode-btn,
    .manual-save-btn,
    .lock-icon-btn {
      margin-left: 0.5rem;
    }

    /* Controls — single scrollable row with dynamic fade hint */
    .controls {
      margin-top: 0.75rem;
      gap: 0.4rem;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: visible;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: 2px;
    }

    .controls::-webkit-scrollbar { display: none; }

    /* Remove flex-shrink so buttons don't squish */
    .controls .btn,
    .controls .more-options-wrap,
    .controls label.btn {
      flex-shrink: 0;
    }

    .btn {
      font-size: 0.55rem;
      padding: 0.35rem 0.7rem;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }

    /* Notes panel — same partial-screen style as search on mobile */
    .notes-panel {
      top: auto;
      bottom: 5.5rem;
      right: 1rem;
      left: 1rem;
      width: calc(100vw - 2rem);
      height: 65vh;
      border-radius: 4px;
      border: 1px solid var(--border);
      opacity: 0;
      pointer-events: none;
      transform: scale(0);
      transform-origin: bottom right;
      transition: opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .notes-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: scale(1);
    }
    .notes-panel-header { border-radius: 0; margin-bottom: 0; }

    /* Main content */
    .main {
      padding: 1.2rem 0.75rem 4rem;
    }

    .area-body-inner { padding: 0.75rem; }
    .task-body-inner { padding: 0.75rem; }


    .task-header {
      font-size: 0.78rem;
      padding: 0.7rem 0.9rem;
    }

    /* Item grid — stack code above content */
    .item {
      grid-template-columns: 1fr;
      gap: 0.3rem;
      padding: 0.35rem 0.25rem;
    }

    .item-code {
      font-size: 0.62rem;
      padding: 0.15rem 0.3rem;
    }

    /* Title row and confidence dots */
    .item-title { font-size: 0.83rem; }

    .conf-dot {
      width: 12px;
      height: 12px;
    }

    /* Field labels and reveal buttons */
    .field-label-row { gap: 0.3rem; }

    .side-toggle-btn {
      font-size: 0.5rem;
      padding: 0.28rem 0.45rem;
    }

    /* Rich text toolbar */
    .editor-toolbar {
      flex-wrap: wrap;
      gap: 0.2rem;
      padding: 0.2rem 0.3rem;
    }

    .editor-toolbar button {
      font-size: 0.68rem;
      padding: 0.1rem 0.4rem;
    }

    /* Rich editor max heights */
    .rich-editor { max-height: 35vh; }
    .rich-editor.summary-editor { max-height: 35vh; }
    .rich-editor.task-summary-editor { max-height: 35vh; }

    /* Task summary section */
    .task-summary-section { padding: 0.75rem; }
    .search-panel {
      top: auto;
      bottom: 5.5rem;
      left: 1rem;
      width: calc(100vw - 2rem);
      height: 65vh;
      border-radius: 4px;
      border: 1px solid var(--border);
      opacity: 0;
      pointer-events: none;
      transform: scale(0);
      transform-origin: bottom left;
      transition: opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .search-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: scale(1);
    }
    .search-panel-header { border-radius: 0; margin-bottom: 0; }

    /* More options menu */
    .more-options-menu {
      font-size: 0.6rem;
      min-width: 160px;
    }

    /* Links menu */

    /* Section label */
    .section-label { font-size: 0.8rem; }

    /* Floating buttons — slightly smaller on mobile */
    .notes-icon-btn,
    .search-icon-btn {
      width: 2.4rem;
      height: 2.4rem;
      border-radius: 4px;
    }

  }

  .lock-icon-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .lock-icon-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .lock-icon-btn:active { transform: scale(0.95); }

  /* Lock Confirm Dialog */
  .lock-confirm-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .lock-confirm-overlay.open { opacity: 1; pointer-events: all; }

  /* Study Exit Confirm */
  .study-exit-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .study-exit-overlay.open { opacity: 1; pointer-events: all; }

  .study-exit-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 300px;
    max-width: 480px;
    width: 90%;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .study-exit-overlay.open .study-exit-card { transform: scale(1); }

  .study-exit-title {
    font-family: 'Barlow', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .study-exit-list {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    max-height: 280px;
    overflow-y: auto;
  }

  .study-exit-item {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.72rem;
    color: var(--ink);
    padding: 0.35rem 0.5rem;
    border-radius: 4px;
    background: #f5f5f5;
    border: 1px solid var(--border);
  }
  .study-exit-item-code { color: var(--accent); font-weight: 600; flex-shrink: 0; }
  .study-exit-item-action { color: #555; font-weight: 600; flex-shrink: 0; font-size: 0.65rem; letter-spacing: 0.06em; text-transform: uppercase; }
  .study-exit-item-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #888; }

  .study-exit-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
    padding-top: 0.3rem;
  }

  .study-exit-btn {
    flex: 1;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.6rem;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-exit-btn:hover { transform: scale(1.05); }
  }
  .study-exit-btn:active { transform: scale(0.96); }

  .study-exit-btn.cancel-btn {
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    color: #666;
  }
  .study-exit-btn.confirm-btn {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }

  .lock-confirm-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 260px;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .lock-confirm-overlay.open .lock-confirm-card { transform: scale(1); }

  .lock-confirm-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .lock-confirm-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
  }

  .lock-confirm-yes {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
  }
  @media(hover:hover){
  .lock-confirm-yes:hover { transform: scale(1.05); }
  }
  .lock-confirm-yes:active { transform: scale(0.96); }

  .lock-confirm-no {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
  }
  @media(hover:hover){
  .lock-confirm-no:hover { transform: scale(1.05); }
  }
  .lock-confirm-no:active { transform: scale(0.96); }

  .btn-study-highlight {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  @media(hover:hover){
  .btn-study-highlight:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.75); color: #fff; }
  }

  .btn-oral-sim {
    background: transparent;
    border-color: rgba(180,150,255,0.5);
    color: rgba(180,150,255,0.85);
  }
  @media(hover:hover){
  .btn-oral-sim:hover { transform: scale(1.05); border-color: rgba(180,150,255,0.9); color: #c8b0ff; }
  }

  .btn-hide-empty {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  @media(hover:hover){
  .btn-hide-empty:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .btn-hide-empty.active { border-color: rgba(255,255,255,0.55); color: rgba(255,255,255,0.7); }

  .hide-empty-mode .field-row.is-empty {
    display: none;
  }

  /* ── Oral Simulator ───────────────────────────────────────────── */
  .oral-launcher-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .oral-launcher-overlay.open { opacity: 1; pointer-events: all; }

  .oral-launcher-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    width: min(460px, 92vw);
    display: flex;
    flex-direction: column;
    gap: 1.4rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
  }

  .oral-launcher-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
  }

  .oral-launcher-sub {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 0.3rem;
  }

  .oral-section-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.5rem;
  }

  .oral-option-group { display: flex; gap: 0.5rem; }

  .oral-option-btn {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s, border-color 0.15s, color 0.15s;
    text-align: center;
  }
  @media(hover:hover){
  .oral-option-btn:hover { transform: scale(1.03); border-color: #3d5166; color: #3d5166; }
  }
  .oral-option-btn.selected { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.07); }

  .oral-area-select {
    width: 100%;
    padding: 0.5rem 0.7rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: #ffffff;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 0.04em;
    cursor: pointer;
    outline: none;
    display: none;
  }
  .oral-area-select.visible { display: block; }
  .oral-area-select:focus { border-color: #3d5166; }

  .oral-api-row { display: none; flex-direction: column; gap: 0.45rem; }
  .oral-api-row.visible { display: flex; }

  .oral-api-input {
    width: 100%;
    padding: 0.5rem 0.7rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: #ffffff;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    outline: none;
    letter-spacing: 0.03em;
  }
  .oral-api-input:focus { border-color: #3d5166; }

  .oral-api-status {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .oral-api-status.ready { color: #2e8b57; }
  .oral-api-status.missing { color: var(--muted); }

  .oral-resume-banner {
    background: var(--reveal-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.8rem 1rem;
    display: none;
    flex-direction: column;
    gap: 0.5rem;
  }
  .oral-resume-banner.visible { display: flex; }
  .oral-resume-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink);
    font-weight: 600;
  }
  .oral-resume-detail {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.03em;
  }
  .oral-resume-btns { display: flex; gap: 0.5rem; margin-top: 0.2rem; }
  .oral-resume-btn {
    flex: 1;
    padding: 0.5rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
    background: #ffffff;
    color: var(--ink);
  }
  @media(hover:hover){
  .oral-resume-btn:hover { transform: scale(1.04); border-color: #3d5166; color: #3d5166; }
  }
  .oral-resume-btn.fresh { background: #e0e0e0; border-color: #ccc; color: #666; }
  @media(hover:hover){
  .oral-resume-btn.fresh:hover { transform: scale(1.04); border-color: #999; color: #444; }
  }

  .oral-launcher-btns { display: flex; gap: 0.75rem; width: 100%; }

  .oral-launcher-go {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .oral-launcher-go:hover { transform: scale(1.05); }
  }

  .oral-launcher-cancel {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .oral-launcher-cancel:hover { transform: scale(1.05); }
  }

  /* Oral Sim Main */
  .oral-sim-overlay {
    position: fixed; inset: 0; background: var(--bg);
    z-index: 700; display: none; flex-direction: column; overflow: hidden;
  }
  .oral-sim-overlay.open { display: flex; }
  .oral-sim-header {
    background: var(--header-bg); padding: 1rem 1.5rem;
    display: flex; align-items: center; justify-content: space-between;
    flex-shrink: 0; gap: 1rem;
  }
  .oral-sim-title {
    font-family: 'Barlow', sans-serif; font-weight: 700;
    font-size: 0.78rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: #fff; display: flex; align-items: center; gap: 0.8rem;
  }
  .oral-sim-mode-badge {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.55rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 0.2rem 0.5rem; border-radius: 3px; font-weight: 600;
  }
  .oral-sim-mode-badge.direct { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.7); }
  .oral-sim-mode-badge.rephrased { background: rgba(217,95,26,0.25); color: var(--accent); border-color: rgba(217,95,26,0.4); }
  .oral-sim-progress {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.58rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: rgba(255,255,255,0.4);
  }
  .oral-sim-exit-btn {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.6rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 0.35rem 0.9rem; border: 1px solid rgba(192,57,43,0.5);
    color: rgba(192,57,43,0.7); background: transparent;
    cursor: pointer; border-radius: 6px; font-weight: 600; transition: all 0.2s;
  }
  @media(hover:hover){
  .oral-sim-exit-btn:hover { border-color: #c0392b; color: #c0392b; }
  }
  .oral-sim-body {
    flex: 1; overflow-y: auto; display: flex; flex-direction: column;
    align-items: center; padding: 2rem 1.5rem; gap: 1rem;
  }

  /* Question Card */
  .oral-q-card { width: 100%; max-width: 700px; display: flex; flex-direction: column; gap: 1rem; }
  .oral-q-task-header {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.6rem;
    letter-spacing: 0.12em; text-transform: uppercase;
    color: var(--ink); font-weight: 600;
    padding: 0.4rem 0; border-bottom: 1px solid var(--border);
    display: flex; flex-direction: column; gap: 0.15rem;
  }
  .oral-q-question {
    background: var(--white); border: 1px solid var(--border);
    border-radius: 6px; padding: 1.4rem 1.5rem;
    font-size: 0.95rem; color: var(--ink); line-height: 1.55;
    font-weight: 400; min-height: 80px;
  }
  .oral-q-thinking {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.7rem;
    color: var(--muted); letter-spacing: 0.06em; font-style: italic;
    min-height: 1.4rem;
  }
  .oral-q-sources {
    display: none; padding: 0.55rem 0.8rem; margin-top: -0.4rem;
    border: 1px solid var(--border); border-top: none;
    border-radius: 0 0 6px 6px; background: var(--reveal-bg);
  }
  .oral-q-sources.visible { display: block; }
  .oral-q-sources-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.5rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
    font-weight: 600; margin-bottom: 0.3rem;
  }
  .oral-q-sources-list {
    display: flex; flex-wrap: wrap; gap: 0.3rem;
  }
  .oral-q-source-tag {
    font-family: 'Barlow', sans-serif; font-size: 0.65rem;
    color: var(--ink); background: var(--white);
    border: 1px solid var(--border); border-radius: 3px;
    padding: 0.15rem 0.5rem; font-weight: 400;
    line-height: 1.4; opacity: 0.8;
  }
  .oral-q-reveal-row { display: flex; gap: 0.6rem; flex-direction: row-reverse; }
  .oral-q-reveal-btn {
    flex: 1; padding: 0.6rem; background: transparent;
    border: 1.5px solid var(--border); border-radius: 4px; color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.65rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 600; transition: all 0.15s;
  }
  @media(hover:hover){
  .oral-q-reveal-btn:hover { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.05); }
  }
  .oral-q-reveal-btn.revealed { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.07); }
  .oral-q-answer-box {
    background: var(--white); border: 1px solid var(--border); border-radius: 6px;
    overflow: hidden; display: none;
  }
  .oral-q-answer-box.visible { display: block; }
  .oral-q-answer-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.55rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
    padding: 0.5rem 1rem 0.2rem; font-weight: 600;
  }
  .oral-q-answer-content {
    padding: 0.4rem 1rem 1rem; font-size: 0.85rem;
    color: var(--ink); line-height: 1.55;
  }
  .oral-q-answer-content.empty { color: var(--muted); font-style: italic; font-size: 0.78rem; }
  .oral-grade-row {
    display: flex; gap: 1.5rem; justify-content: center;
    margin-top: 0.5rem;
  }
  .oral-grade-row.visible { display: flex; }
  .oral-grade-btn {
    width: 68px; height: 68px; border-radius: 50%; border: 2.5px solid;
    background: transparent; cursor: pointer; display: flex;
    align-items: center; justify-content: center;
    transition: all 0.15s; flex-shrink: 0;
  }
  @media(hover:hover){
  .oral-grade-btn:hover { transform: scale(1.12); }
  }
  .oral-grade-btn:active { transform: scale(0.95); }
  .oral-grade-btn.correct { border-color: #2e8b57; color: #2e8b57; }
  .oral-grade-btn.wrong { border-color: #c0392b; color: #c0392b; }
  .oral-grade-hint {
    text-align: center; font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--muted); display: none;
  }
  .oral-grade-hint.visible { display: block; }

  /* Fail Screen */
  .oral-fail-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.55);
    z-index: 900; display: none; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.2s;
  }
  .oral-fail-overlay.open { display: flex; opacity: 1; pointer-events: all; }
  .oral-fail-card {
    background: #ffffff; border: 1px solid var(--border); border-radius: 4px;
    padding: 2rem 2.5rem; width: min(480px, 93vw); display: flex; flex-direction: column;
    gap: 1.1rem; box-shadow: 0 8px 40px rgba(0,0,0,0.25); text-align: center;
  }
  .oral-fail-title {
    font-family: 'Barlow', sans-serif; font-weight: 700; font-size: 0.82rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--ink);
  }
  .oral-fail-area {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.68rem;
    letter-spacing: 0.06em; text-transform: uppercase; color: #3d5166;
    background: rgba(61,81,102,0.06); border: 1px solid rgba(61,81,102,0.2);
    border-radius: 4px; padding: 0.65rem 1rem;
  }
  .oral-fail-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.58rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted);
    text-align: left;
  }
  .oral-fail-items {
    text-align: left; display: flex; flex-direction: column; gap: 0.3rem;
    max-height: 180px; overflow-y: auto;
  }
  .oral-fail-item {
    font-size: 0.78rem; color: var(--ink); padding: 0.3rem 0;
    border-bottom: 1px solid var(--border); display: flex; gap: 0.6rem; align-items: flex-start;
  }
  .oral-fail-item-code {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.63rem;
    color: var(--accent); font-weight: 600; flex-shrink: 0; white-space: nowrap; padding-top: 0.1rem;
  }
  .oral-fail-btns { display: flex; gap: 0.75rem; width: 100%; }
  .oral-fail-btn {
    flex: 1; padding: 0.6rem; border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.65rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 600; transition: transform 0.15s; border: 1.5px solid;
  }
  @media(hover:hover){
  .oral-fail-btn:hover { transform: scale(1.05); }
  }
  .oral-fail-btn.restart { background: #ffffff; border-color: var(--border); color: var(--ink); }
  .oral-fail-btn.exit-fail { background: #e0e0e0; border-color: #ccc; color: #666; }

  /* Pass Screen */
  .oral-pass-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.72);
    z-index: 900; display: none; align-items: center; justify-content: center;
  }
  .oral-pass-overlay.open { display: flex; }
  .oral-pass-card {
    background: var(--white); border-radius: 8px; padding: 2.5rem;
    width: min(420px, 93vw); display: flex; flex-direction: column;
    gap: 1.2rem; box-shadow: 0 16px 48px rgba(0,0,0,0.3);
    text-align: center; align-items: center;
  }
  .oral-pass-check {
    width: 84px; height: 84px; border-radius: 50%; border: 3px solid #2e8b57;
    display: flex; align-items: center; justify-content: center;
    animation: oral-check-pop 0.4s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  @keyframes oral-check-pop { 0%{transform:scale(0);opacity:0;} 100%{transform:scale(1);opacity:1;} }
  .oral-pass-check svg { animation: oral-check-draw 0.5s ease 0.3s forwards; stroke-dasharray: 50; stroke-dashoffset: 50; }
  @keyframes oral-check-draw { to { stroke-dashoffset: 0; } }
  .oral-pass-title {
    font-family: 'Barlow', sans-serif; font-weight: 700; font-size: 1.7rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: #2e8b57;
    animation: oral-fade-up 0.5s ease 0.6s both;
  }
  @keyframes oral-fade-up { from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);} }
  .oral-pass-stats {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.7rem;
    letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);
    animation: oral-fade-up 0.5s ease 0.8s both;
  }
  .oral-pass-btn {
    padding: 0.7rem 2rem; background: #2e8b57; border: none; border-radius: 6px;
    color: #fff; font-family: 'Barlow Condensed', sans-serif; font-size: 0.72rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 700; transition: transform 0.15s; animation: oral-fade-up 0.5s ease 1s both;
  }
  @media(hover:hover){
  .oral-pass-btn:hover { transform: scale(1.05); }
  }

  /* ── Study Highlight Picker ───────────────────────────────────── */
  .study-picker-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .study-picker-overlay.open { opacity: 1; pointer-events: all; }

  .study-picker-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 300px;
  }

  .study-picker-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .study-picker-dots {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    justify-content: center;
  }

  .study-picker-dot {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 2.5px solid;
    cursor: pointer;
    background: transparent;
    transition: transform 0.15s, opacity 0.15s;
    opacity: 0.45;
    padding: 0;
    flex-shrink: 0;
  }
  @media(hover:hover){
  .study-picker-dot:hover { transform: scale(1.15); opacity: 0.8; }
  }
  .study-picker-dot.selected { opacity: 1; }
  .study-picker-dot.green  { border-color: #2e8b57; }
  .study-picker-dot.yellow { border-color: #d4a017; }
  .study-picker-dot.red    { border-color: #c0392b; }
  .study-picker-dot.selected.green  { background: #2e8b57; }
  .study-picker-dot.selected.yellow { background: #d4a017; }
  .study-picker-dot.selected.red    { background: #c0392b; }

  .study-picker-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
  }

  .study-picker-go {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-picker-go:hover { transform: scale(1.05); }
  }

  .study-picker-cancel {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-picker-cancel:hover { transform: scale(1.05); }
  }

  /* ── Study Mode Overlay ───────────────────────────────────────── */
  .study-mode-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 700;
    display: none;
    flex-direction: column;
    overflow: hidden;
  }
  .study-mode-overlay.open { display: flex; }

  .study-mode-header {
    background: var(--header-bg);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    gap: 1rem;
  }

  .study-mode-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .study-mode-dot-indicators {
    display: flex;
    gap: 0.4rem;
    align-items: center;
  }

  .study-mode-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .study-mode-indicator.green  { background: #2e8b57; }
  .study-mode-indicator.yellow { background: #d4a017; }
  .study-mode-indicator.red    { background: #c0392b; }

  .study-mode-controls {
    display: flex;
    gap: 0.6rem;
    align-items: center;
  }

  .study-mode-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.35rem 0.9rem;
    border: 1px solid;
    background: transparent;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    transition: transform 0.2s, border-color 0.2s, color 0.2s, background 0.2s;
  }
  @media(hover:hover){
  .study-mode-btn:hover { transform: scale(1.05); }
  }
  .study-mode-btn:active { transform: scale(0.96); }

  .study-mode-btn.reveal-btn {
    border-color: rgba(46,139,87,0.5);
    color: rgba(46,139,87,0.7);
  }
  @media(hover:hover){
  .study-mode-btn.reveal-btn:hover {
    border-color: #2e8b57;
    color: #2e8b57;
  }
  }

  .study-mode-btn.exit-btn {
    border-color: rgba(192,57,43,0.5);
    color: rgba(192,57,43,0.7);
  }
  @media(hover:hover){
  .study-mode-btn.exit-btn:hover {
    border-color: #c0392b;
    color: #c0392b;
  }
  }

  .study-mode-close {
    background: none;
    border: none;
    color: rgba(255,255,255,0.7);
    font-size: 1.1rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-mode-close:hover { transform: scale(1.2); color: #fff; }
  }

  .study-mode-count {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.35);
  }

  .study-mode-body {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    max-width: 980px;
    width: 100%;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .study-item {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 0.75rem;
    padding: 1rem 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .study-item-header {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    flex-wrap: nowrap;
  }

  .study-item-left {
    display: none; /* no longer used */
  }

  .study-item-code {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.67rem;
    color: var(--accent);
    font-weight: 500;
    letter-spacing: 0.02em;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .study-conf-dots {
    display: flex;
    gap: 0.35rem;
    flex-shrink: 0;
    align-items: center;
  }

  .study-item-fields {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .study-field-with-dots { display: none; }
  .study-field-dots { display: none; }

  .study-conf-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 1.5px solid;
    cursor: pointer;
    background: transparent;
    padding: 0;
    transition: transform 0.12s, opacity 0.12s;
    opacity: 0.4;
  }
  @media(hover:hover){
  .study-conf-dot:hover { transform: scale(1.3); opacity: 0.75; }
  }
  .study-conf-dot.active { opacity: 1; }
  .study-conf-dot.green  { border-color: #2e8b57; }
  .study-conf-dot.yellow { border-color: #d4a017; }
  .study-conf-dot.red    { border-color: #c0392b; }
  .study-conf-dot.active.green  { background: #2e8b57; }
  .study-conf-dot.active.yellow { background: #d4a017; }
  .study-conf-dot.active.red    { background: #c0392b; }

  .study-item-right { display: contents; }

  .study-item-title {
    font-size: 0.87rem;
    color: var(--ink);
    line-height: 1.45;
    font-weight: 400;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    flex: 1;
    min-width: 0;
  }
  .study-item-title.conf-green  { background: #d4f0dc; color: #1a5c30; }
  .study-item-title.conf-yellow { background: #fef3c7; color: #7c5c00; }
  .study-item-title.conf-red    { background: #fde8e8; color: #7c1d1d; }

  .study-item-field { display: flex; flex-direction: column; gap: 0.2rem; }

  .study-item-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
  }

  .study-item-content {
    font-family: 'Barlow', sans-serif;
    font-size: 0.83rem;
    font-weight: 300;
    line-height: 1.55;
    color: var(--ink);
    background: #f2f2f2;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.5rem 0.65rem;
    position: relative;
    outline: none;
    transition: transform 0.15s, border-color 0.15s;
    cursor: pointer;
    min-height: 54px;
    overflow: hidden;
  }
  @media(hover:hover){
  .study-item-content:hover {
    transform: scale(1.012);
  }
  }
  .study-item-content:focus {
    border-color: #2e8b57;
    background: #ebebeb;
    outline: none;
    cursor: text;
  }
  .study-item-content.is-editing {
    cursor: text;
  }
  /* Revealed — expand naturally up to a max, then scroll */
  .study-item-content:not(.hidden-content) {
    height: auto;
    max-height: 40vh;
    overflow-y: auto;
  }
  .study-item-content.is-editing {
    max-height: 40vh;
    overflow-y: auto;
  }
  .study-item-content.hidden-content {
    background: #e8e8e8;
    color: transparent;
    user-select: none;
    cursor: pointer;
    height: 54px !important;
    min-height: 54px !important;
    max-height: 54px !important;
    overflow: hidden !important;
  }
  .study-item-content.hidden-content * { opacity: 0; }
  .study-item-content.hidden-content::after {
    content: '';
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
    transition: color 0.15s;
  }
  .study-item-content.hidden-content.has-content::after {
    content: 'Click to reveal';
  }
  @media(hover:hover){
  .study-item-content.hidden-content:hover::after {
    color: #888;
  }
  }

  /* Edit dots button */
  .study-field-wrap {
    position: relative;
  }
  .study-edit-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #bbb;
    padding: 0;
    font-size: 0.85rem;
    line-height: 1;
    letter-spacing: 0.15em;
    transition: color 0.15s;
    flex-shrink: 0;
    margin-left: auto;
  }
  @media(hover:hover){
  .study-edit-btn:hover { color: #444; }
  }

  .study-empty {
    text-align: center;
    padding: 4rem 2rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.78rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .lock-screen {
    position: fixed;
    inset: 0;
    background: var(--header-bg);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
  }
  .lock-screen.hidden { display: none; }

  .lock-title-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.4rem;
  }

  .lock-icon {
    color: var(--accent);
    animation: prop-spin 2.8s linear infinite;
    transform-origin: center;
    display: block;
  }
  @keyframes prop-spin {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  .lock-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #fff;
    text-align: center;
  }

  .lock-subtitle {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.45);
    text-align: center;
  }

  /* ── Runway graphic + threshold inputs ── */
  .runway-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    width: min(440px, 92vw);
    position: relative;
    padding: 0 15px;
  }

  .runway-wrap::before,
  .runway-wrap::after {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 10px;
    background: rgba(255,255,255,0.75);
    border-radius: 2px;
  }
  .runway-wrap::before { left: 0; }
  .runway-wrap::after  { right: 0; }

  .runway-centerline {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 18px 0 18px;
    width: 100%;
  }

  .cl-dash {
    width: 10px;
    height: 28px;
    background: rgba(255,255,255,0.75);
    border-radius: 2px;
    flex-shrink: 0;
  }

  .threshold-strip {
    display: flex;
    align-items: stretch;
    gap: 5px;
    width: 100%;
    height: 120px;
  }

  .thresh-group {
    display: flex;
    gap: 5px;
    flex: 1;
  }

  .thresh-gap {
    width: 18px;
    flex-shrink: 0;
  }

  .thresh-stripe {
    flex: 1;
    background: rgba(255,255,255,0.82);
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: transform 0.15s ease, background 0.15s;
  }

  @media(hover:hover){
  .thresh-stripe:hover {
    transform: scale(1.03);
  }
  }

  .thresh-stripe:focus-within {
    transform: scale(1.05);
  }

  .thresh-stripe.error {
    background: rgba(231,76,60,0.65);
    animation: stripe-shake 0.35s ease;
  }
  @keyframes stripe-shake {
    0%,100% { transform: translateX(0); }
    25%      { transform: translateX(-4px); }
    75%      { transform: translateX(4px); }
  }

  .digit-box {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: #1a1a1a;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    text-align: center;
    caret-color: #333;
    -webkit-text-security: disc;
    text-security: disc;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }

  .lock-error {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    color: #e74c3c;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    min-height: 0.9rem;
    text-align: center;
    margin-top: -1rem;
  }

  .lock-btn {
    padding: 0.55rem 2.8rem;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    color: rgba(255,255,255,0.75);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    font-weight: 600;
    margin-top: -1rem;
  }
  @media(hover:hover){
  .lock-btn:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.65); color: #fff; }
  }

  /* ── Change Password Modal ───────────────────────────────────── */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }

  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .modal-card {
    background: #1e2d3d;
    border: 1px solid #2e4560;
    border-radius: 6px;
    padding: 2rem;
    width: 300px;
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.4);
  }

  .modal-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }

  .modal-input {
    width: 100%;
    padding: 0.65rem 0.9rem;
    background: #162232;
    border: 1.5px solid #2e4560;
    border-radius: 6px;
    color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.82rem;
    outline: none;
    box-sizing: border-box;
    transition: border-color 0.2s;
  }

  .modal-input:focus { border-color: var(--accent); }
  .modal-input::placeholder { color: #4a6a85; }

  .modal-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: #7a9bb5;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: -0.5rem;
  }

  .modal-error {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #e74c3c;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    min-height: 0.9rem;
  }

  .modal-btns {
    display: flex;
    gap: 0.6rem;
    margin-top: 0.3rem;
  }

  .modal-btn-save {
    flex: 1;
    padding: 0.6rem;
    background: var(--accent);
    border: none;
    border-radius: 6px;
    color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s;
    font-weight: 600;
  }

  @media(hover:hover){
  .modal-btn-save:hover { transform: scale(1.04); }
  }

  .modal-btn-cancel {
    flex: 1;
    padding: 0.6rem;
    background: transparent;
    border: 1.5px solid #2e4560;
    border-radius: 6px;
    color: #7a9bb5;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s;
  }

  @media(hover:hover){
  .modal-btn-cancel:hover { transform: scale(1.04); }
  }

    /* ── Export / Import Modal ── */
  .xfer-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .xfer-modal-overlay.open { opacity: 1; pointer-events: all; }

  .xfer-modal-card {
    position: relative;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 260px;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .xfer-modal-overlay.open .xfer-modal-card { transform: scale(1); }

  .xfer-modal-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .xfer-modal-subtitle {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-align: center;
    margin-top: -0.8rem;
  }

  .xfer-modal-btns {
    display: flex;
    flex-direction: row;
    gap: 0.6rem;
    width: 100%;
  }

  .xfer-btn {
    width: 100%;
    padding: 0.6rem;
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  @media(hover:hover){
  .xfer-btn:hover { transform: scale(1.05); }
  }
  .xfer-btn:active { transform: scale(0.96); }

  .xfer-btn-primary {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }
  .xfer-btn-secondary {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }

  .xfer-modal-close {
    position: absolute;
    top: 0.7rem;
    right: 0.9rem;
    background: none;
    border: none;
    color: var(--muted);
    font-size: 0.9rem;
    cursor: pointer;
    line-height: 1;
    padding: 0.2rem;
  }
  @media(hover:hover){
  .xfer-modal-close:hover { color: var(--ink); }
  }

  .xfer-divider {
    border: none;
    border-top: 1px solid var(--border);
    width: 100%;
    margin: 0;
  }

  /* ── Paste Modal ── */
  .paste-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .paste-modal-overlay.open { opacity: 1; pointer-events: all; }
  .paste-modal-card {
    position: relative;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    width: 420px;
    max-width: 90vw;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .paste-modal-overlay.open .paste-modal-card { transform: scale(1); }
  .paste-modal-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }
  .paste-modal-subtitle {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-align: center;
    margin-top: -0.5rem;
  }
  .paste-modal-textarea {
    width: 100%;
    height: 120px;
    padding: 0.7rem 0.9rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    color: var(--ink);
    background: #f9f9f9;
    resize: none;
    outline: none;
    box-sizing: border-box;
    transition: border-color 0.2s;
    border-color: #2e8b57;
  }
  .paste-modal-textarea:focus { border-color: #2e8b57; }
  .paste-modal-textarea::placeholder { color: var(--muted); }
  .paste-modal-btns {
    display: flex;
    gap: 0.6rem;
    width: 100%;
  }
  .paste-modal-close {
    position: absolute;
    top: 0.7rem;
    right: 0.9rem;
    background: none;
    border: none;
    color: var(--muted);
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.2rem;
  }
  @media(hover:hover){
  .paste-modal-close:hover { color: var(--ink); }
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: 'DM Sans', system-ui, sans-serif;
    min-height: 100vh;
    font-weight: 300;
  }

  header {
    background: var(--header-bg);
    padding: 2.2rem 2.5rem 1.8rem;
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    flex-direction: column;
  }

  .header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .notes-icon-btn {
    background: var(--header-bg);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    width: 2.8rem;
    height: 2.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.35);
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    flex-shrink: 0;
    padding: 0;
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 200;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }

  @media(hover:hover){
  .notes-icon-btn:hover { transform: scale(1.08); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .notes-icon-btn:active { transform: scale(0.94); }
  .notes-icon-btn.active { border-color: rgba(255,255,255,0.6); color: #fff; }

  .manual-save-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .manual-save-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .manual-save-btn:active { transform: scale(0.95); }

  body:not(.modern-mode) .oral-sim-header-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    color: rgba(255,255,255,0.7);
    display: flex;
    align-items: center;
    gap: 0;
    cursor: pointer;
    transition: transform 0.2s ease, color 0.15s, filter 0.2s ease;
    flex-shrink: 0;
    padding: 0;
    overflow: visible;
  }
  @media(hover:hover){
  body:not(.modern-mode) .oral-sim-header-btn:hover {
    color: #ffffff;
    filter: drop-shadow(0 0 6px rgba(255,255,255,0.5));
    transform: scale(1.2);
    transform-origin: left center;
  }
  }
  body:not(.modern-mode) .oral-sim-header-btn:active { transform: scale(0.95); transform-origin: left center; }

  .oral-sim-slide-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    white-space: nowrap;
    display: inline-block;
    overflow: hidden;
    max-width: 0;
    opacity: 0;
    margin-left: 0;
    transition: max-width 0.35s cubic-bezier(0.4,0,0.2,1),
                opacity 0.25s ease,
                margin-left 0.35s cubic-bezier(0.4,0,0.2,1);
  }
  @media(hover:hover){
  .oral-sim-header-btn:hover .oral-sim-slide-label,
  .oral-sim-slide-label.preview {
    max-width: 130px;
    opacity: 1;
    margin-left: 0.55rem;
  }
  }

  .oral-sim-icon-ring { transition: stroke 0.6s ease; }
  .oral-sim-icon-play { transition: fill 0.6s ease, stroke 0.6s ease; }

  @keyframes oral-ring-draw {
    0%   { stroke-dashoffset: 41; }
    60%  { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: 0; }
  }
  @keyframes oral-play-bounce {
    0%   { transform: translate(0, 0) scale(1); }
    30%  { transform: translate(0, -1.5px) scale(1.18); }
    55%  { transform: translate(0, 1px) scale(0.92); }
    75%  { transform: translate(0, -0.5px) scale(1.05); }
    100% { transform: translate(0, 0) scale(1); }
  }

  .oral-sim-header-btn.idle-animate .oral-sim-icon-ring {
    stroke-dasharray: 41;
    stroke-dashoffset: 41;
    animation: oral-ring-draw 1.1s cubic-bezier(0.4,0,0.2,1) forwards;
  }
  .oral-sim-header-btn.idle-animate .oral-sim-icon-play {
    animation: oral-play-bounce 0.7s cubic-bezier(0.34,1.56,0.64,1) 0.4s forwards;
  }

  @keyframes oral-sim-pulse {
    0%   { filter: drop-shadow(0 0 0px rgba(217,95,26,0)); }
    50%  { filter: drop-shadow(0 0 7px rgba(217,95,26,0.85)); }
    100% { filter: drop-shadow(0 0 0px rgba(217,95,26,0)); }
  }
  .oral-sim-pulsing {
    animation: oral-sim-pulse 1.4s ease-in-out 5;
  }

  .edit-mode-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .edit-mode-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .edit-mode-btn:active { transform: scale(0.95); }
  .edit-mode-btn.active { color: #ffffff; }
  @media(hover:hover){
  .edit-mode-btn.active:hover { color: var(--accent); }
  }

  header h1 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    color: #fff;
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    letter-spacing: -0.01em;
    text-transform: uppercase;
  }

  header p {
    color: #e8f0f8;
    font-size: 0.75rem;
    margin-top: 0.3rem;
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 400;
  }

  .controls {
    display: flex;
    gap: 0.6rem;
    margin-top: 1.1rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.4rem 1rem;
    border: 1px solid;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, color 0.2s, background 0.2s;
    border-radius: 6px;
    font-weight: 600;
  }

  .btn-reveal { background: transparent; border-color: rgba(46,139,87,0.6); color: rgba(46,139,87,0.85); }
  @media(hover:hover){
  .btn-reveal:hover { transform: scale(1.05); border-color: #2e8b57; color: #2e8b57; }
  }

  .btn-hide-all, .btn-expand, .btn-collapse, .btn-export, .btn-import, .btn-hide, .btn-lock {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  .btn-hide-all { background: transparent; border-color: rgba(255,255,255,0.35); color: rgba(255,255,255,0.7); }
  @media(hover:hover){
  .btn-hide-all:hover,
  .btn-expand:hover, .btn-collapse:hover,
  .btn-export:hover, .btn-import:hover,
  .btn-hide:hover, .btn-lock:hover {
    transform: scale(1.05);
    border-color: rgba(255,255,255,0.75);
    color: #fff;
  }
  }

  .btn:active { transform: scale(0.96) !important; }

  .main {
    max-width: 980px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 5rem;
  }

  .area {
    background: var(--white);
    border-radius: 4px;
    margin-bottom: 0.75rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.07), 0 6px 24px rgba(0,0,0,0.05);
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .area-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
    padding: 0;
  }
  .area-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.25s ease-in, visibility 0s 0.25s;
  }
  .area-body-inner {
    overflow: visible;
    padding: 1.5rem;
  }

  .area-header {
    background: var(--header-bg);
    color: #fff;
    padding: 1rem 1.5rem 1rem 1.1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    user-select: none;
    border-radius: 3px 3px 0 0;
  }

  .area-header.collapsed {
    border-radius: 3px;
  }

  .area-header.expanded {
    border-radius: 3px;
  }

  .area-header h2 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: inherit;
  }

  .area-header .chevron {
    color: inherit;
    font-size: 1.4rem;
    font-weight: 300;
    line-height: 1;
    flex-shrink: 0;
    margin-left: 1rem;
  }

  .area-header.collapsed .chevron { }

  .area-header { transition: transform 0.2s, background 0.2s, color 0.2s; color: rgba(255,255,255,0.65); }
  @media(hover:hover){
  .area-header:hover { transform: scale(1.008); color: #fff; background: #465e75; }
  }
  .area-header:active { transform: scale(0.997); background: #3a5068; }

  /* area-body animated via max-height */

  /* area-body animated via grid-template-rows */

  .task {
    margin-bottom: 1.5rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .task-header {
    background: #eaeaea;
    color: #888;
    padding: 0.6rem 1rem 0.6rem 0.75rem;
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
    transition: transform 0.2s, background 0.2s, color 0.2s;
  }
  @media(hover:hover){
  .task-header:hover { transform: scale(1.01); background: #e0e0e0; color: #111; }
  }
  .task-header:active { transform: scale(0.998); background: #d6d6d6; }

  .task-header.expanded {
    border-radius: 4px 4px 0 0;
  }

  .task-header .task-ref {
    display: inline;
    color: var(--accent);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
  }

  .task-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
  }
  .task-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.2s ease-in, visibility 0s 0.2s;
  }
  .task-body-inner {
    overflow: visible;
    padding: 1.2rem;
    background: var(--white);
    border-radius: 4px;
  }

  .section-wrapper {
    margin-bottom: 0.6rem;
    border: 1px solid #ddd;
    border-radius: 3px;
    overflow: hidden;
  }

  .section-label {
    background: #eaeaea;
    padding: 0.55rem 1rem;
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: #999;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.2s, transform 0.2s, color 0.2s;
    border-radius: 3px 3px 3px 3px;
  }

  .section-label.expanded {
    border-radius: 3px 3px 0 0;
  }

  .section-wrapper.open .section-label { background: #e0e0e0; color: #111; }
  @media(hover:hover){
  .section-label:hover { transform: scale(1.01); background: #e0e0e0; color: #111; }
  }
  .section-label:active { transform: scale(0.998); background: #d6d6d6; }

  /* section-body animated via max-height */

  .task-chevron, .section-chevron {
    color: #666;
    font-size: 0.9rem;
    flex-shrink: 0;
    margin-left: 1rem;
    display: inline-block;
    transition: transform 0.25s;
    transform: rotate(-90deg);
  }

  .section-body {
    max-height: none;
    overflow: visible;
    transition: visibility 0s 0s;
    visibility: visible;
  }
  .section-body.hidden {
    max-height: 0;
    overflow: hidden;
    visibility: hidden;
    transition: max-height 0.18s ease-in, visibility 0s 0.18s;
  }
  .section-body-inner {
    overflow: visible;
    padding: 0.75rem 1rem;
    background: #f9f9f9;
    border-radius: 6px;
  }

  .item {
    margin: 0.7rem 0;
    display: grid;
    grid-template-columns: 145px 1fr;
    gap: 0.75rem;
    align-items: start;
    padding: 0.25rem 0.35rem;
    border-radius: 4px;
    transition: background 0.15s, outline 0.15s;
  }

  .item-code {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.67rem;
    color: var(--accent);
    font-weight: 500;
    padding: 0.25rem 0.4rem;
    word-break: break-all;
    letter-spacing: 0.02em;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }

  @media(hover:hover){
  .item:has(.item-code:hover) {
    background: #fff8f4;
    outline: 2px solid var(--accent);
    outline-offset: 0px;
  }

  @media(hover:hover){
  .item.no-hover:has(.item-code:hover) {
    background: transparent;
    outline: none;
  }
  }

  }
  .item-code.bookmarked {
    background: transparent;
    outline: none;
  }

  .item.is-bookmarked {
    background: #fff0e6;
    border-radius: 4px;
    outline: 3px solid var(--accent);
    outline-offset: 2px;
  }

  .item.is-bookmarked > .item-code {
    background: transparent;
    outline: none;
  }


  @keyframes pulse-border {
    0%   { outline: 3px solid rgba(217, 95, 26, 1); outline-offset: -3px; }
    50%  { outline: 3px solid rgba(217, 95, 26, 0.3); outline-offset: -3px; }
    100% { outline: 3px solid rgba(217, 95, 26, 1); outline-offset: -3px; }
  }

  .area-header.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  .task-header.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  .section-label.bookmark-highlight {
    animation: pulse-border 1.5s ease-in-out infinite;
    outline: 3px solid var(--accent);
    outline-offset: -3px;
  }

  @media(hover:hover){
  .area-header.bookmark-highlight:hover,
  .task-header.bookmark-highlight:hover,
  .section-label.bookmark-highlight:hover {
    transform: none !important;
    animation: pulse-border 1.5s ease-in-out infinite !important;
    outline: 3px solid var(--accent) !important;
    outline-offset: -3px !important;
  }
  }

  @keyframes pulse-orange-btn {
    0%   { border-color: rgba(0,0,0,0.15); color: rgba(0,0,0,0.35); }
    50%  { border-color: var(--accent); color: var(--accent); }
    100% { border-color: rgba(0,0,0,0.15); color: rgba(0,0,0,0.35); }
  }

  .bookmark-banner {
    display: none;
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 200;
    background: #eaeaea;
    color: rgba(0,0,0,0.35);
    border: 1px solid rgba(0,0,0,0.15);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.4rem 1.2rem;
    text-align: center;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    white-space: nowrap;
    animation: pulse-orange-btn 2s ease-in-out infinite;
  }

  @media(hover:hover){
  .bookmark-banner:hover { animation: none; transform: translateX(-50%) scale(1.05); border-color: var(--accent); color: var(--accent); transition: border-color 0.2s, color 0.2s, transform 0.2s; }
  }
  .bookmark-banner:active { transform: translateX(-50%) scale(0.96); }
  .bookmark-banner.visible { display: block; }

  .item-fields { display: flex; flex-direction: column; gap: 0.4rem; }

  .item-title-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.75rem;
    padding: 0.2rem 0;
  }

  .item-title {
    font-size: 0.87rem;
    color: var(--ink);
    line-height: 1.45;
    font-weight: 400;
    flex: 1;
    transition: background 0.2s, color 0.2s;
    border-radius: 3px;
    padding: 0.1rem 0.3rem;
    margin: -0.1rem -0.3rem;
  }

  .item-title.conf-green  { background: #d4f0dc; color: #1a5c30; }
  .item-title.conf-yellow { background: #fef3c7; color: #7c5c00; }
  .item-title.conf-red    { background: #fde8e8; color: #7c1d1d; }

  .conf-dots-row {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    flex-shrink: 0;
    padding-top: 0.15rem;
  }

  .conf-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 1.5px solid;
    cursor: pointer;
    transition: transform 0.15s, opacity 0.15s;
    opacity: 0.35;
    background: transparent;
    padding: 0;
  }

  @media(hover:hover){
  .conf-dot:hover { transform: scale(1.3); opacity: 0.7; }
  }

  .conf-dot.green  { border-color: #2e8b57; }
  .conf-dot.yellow { border-color: #d4a017; }
  .conf-dot.red    { border-color: #c0392b; }

  .conf-dot.active { opacity: 1; }
  .conf-dot.active.green  { background: #2e8b57; }
  .conf-dot.active.yellow { background: #d4a017; }
  .conf-dot.active.red    { background: #c0392b; }

  /* section-body animation handled via grid-template-rows above */

  .section-chevron {
    font-size: 0.75rem;
    margin-left: 0.4rem;
    transition: transform 0.2s;
  }

  .field-label-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.2rem;
  }

  .field-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    transition: color 0.25s;
  }

  .field-label.populated { color: #2e8b57; }

  .field-edit-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #bbb;
    padding: 0;
    font-size: 0.85rem;
    line-height: 1;
    letter-spacing: 0.15em;
    transition: color 0.15s;
    flex-shrink: 0;
    margin-left: auto;
  }
  @media(hover:hover){
  .field-edit-btn:hover { color: #444; }
  }

  .field-with-toggle {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  .side-toggle-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.55rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.35rem 0.55rem;
    border: 1.5px solid #2e8b57;
    border-radius: 4px;
    background: transparent;
    color: #2e8b57;
    cursor: pointer;
    transition: all 0.18s;
    white-space: nowrap;
    align-self: center;
  }

  @media(hover:hover){
  .side-toggle-btn:hover { transform: scale(1.08); }
  }

  .side-toggle-btn.is-hidden {
    border-color: #aaa;
    color: #aaa;
  }

  @media(hover:hover){
  .side-toggle-btn.is-hidden:hover { transform: scale(1.08); }
  }

  .editor-outer {
    flex: 1;
    position: relative;
    border-radius: 4px;
    overflow: visible;
    display: flex;
    flex-direction: column;
  }

  .editor-toolbar {
    display: flex;
    gap: 0.25rem;
    padding: 0.25rem 0.4rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: #e8e8e8;
    margin-bottom: 3px;
  }

  .editor-outer.summary-type .editor-toolbar,
  .editor-outer.task-summary-type .editor-toolbar {
    background: #e4e4e4;
    border-color: #ddd;
  }

  .editor-toolbar button {
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    padding: 0.12rem 0.5rem;
    border: none;
    border-radius: 3px;
    background: transparent;
    color: #666;
    cursor: pointer;
    transition: transform 0.15s, color 0.15s;
    line-height: 1.5;
  }

  .editor-toolbar .tb-img {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.12rem 0.4rem;
    line-height: 1;
  }
  @media(hover:hover){
  .editor-toolbar button:hover { background: transparent; color: var(--accent); transform: scale(1.15); }
  }
  .editor-toolbar .tb-bold { font-weight: 700; }
  .editor-toolbar .tb-italic { font-style: italic; }
  .editor-toolbar .tb-underline { text-decoration: underline; }
  .editor-toolbar .tb-bold.fmt-active,
  .editor-toolbar .tb-italic.fmt-active,
  .editor-toolbar .tb-underline.fmt-active {
    outline: 1.5px solid #111;
    border-radius: 3px;
    color: #111;
  }
  .editor-toolbar .tb-done {
    color: #333;
    border-color: transparent;
    background: transparent;
    font-weight: 400;
    opacity: 0.5;
  }
  @media(hover:hover){
  .editor-toolbar .tb-done:hover { background: transparent !important; border-color: transparent !important; color: #333 !important; opacity: 1; }
  }

  .info-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.2rem;
    height: 1.2rem;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,0.7);
    color: rgba(255,255,255,0.85);
    font-size: 0.62rem;
    font-weight: 700;
    font-family: 'Barlow', sans-serif;
    cursor: pointer;
    flex-shrink: 0;
    background: transparent;
    transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.15s;
    margin-left: 0.5rem;
    line-height: 1;
    vertical-align: middle;
    position: relative;
  }
  @media(hover:hover){
  .info-btn:hover { background: transparent; border-color: rgba(255,255,255,0.7); color: rgba(255,255,255,0.85); transform: scale(1.2); }
  }
  .info-btn.obj-btn {
    border-color: rgba(0,0,0,0.25);
    color: #555;
  }
  @media(hover:hover){
  .info-btn.obj-btn:hover {
    background: transparent !important;
    border-color: rgba(0,0,0,0.45) !important;
    color: #333 !important;
    transform: scale(1.2);
  }
  }

  .task-note-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 3px;
    border: 1.5px solid rgba(0,0,0,0.25);
    color: #555;
    font-size: 0.5rem;
    font-weight: 700;
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    flex-shrink: 0;
    background: transparent;
    transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.15s;
    margin-left: 0.5rem;
    line-height: 1;
    vertical-align: middle;
    position: relative;
    padding: 0.2rem 0.4rem;
  }
  @media(hover:hover){
  .task-note-btn:hover {
    background: transparent;
    border-color: rgba(0,0,0,0.45);
    color: #333;
    transform: scale(1.08);
  }
  }

  .info-popup {
    display: none;
    position: fixed;
    z-index: 1000;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0.85rem 1rem;
    box-shadow: 0 6px 24px rgba(0,0,0,0.15);
    font-family: 'Barlow', sans-serif;
    font-size: 0.78rem;
    line-height: 1.6;
    color: #222;
    max-width: 420px;
    min-width: 260px;
  }
  .info-popup.open { display: block; }
  .info-popup strong {
    display: block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #888;
    margin-bottom: 0.4rem;
  }

  .refs-toggle {
    display: inline-block;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.32rem;
    font-style: italic;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.25);
    margin-top: 0.1rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.15s;
  }
  @media(hover:hover){
  .refs-toggle:hover { color: rgba(255,255,255,0.6); transform: scale(1.15); }
  }
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #aaa;
    text-transform: uppercase;
    letter-spacing: 0.14em;
  }

  .reveal-overlay.hidden-overlay { display: none; }

  .editor-outer.is-hidden-state {
    min-height: 0;
  }

  .editor-outer.is-hidden-state .rich-editor {
    height: 0 !important;
    min-height: 0 !important;
    padding: 0 !important;
    border: none !important;
    overflow: hidden;
  }

  .editor-outer.is-hidden-state .editor-toolbar {
    display: none;
  }

  .reveal-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 36px;
    background: #e8e8e8;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
    cursor: pointer;
    transition: transform 0.15s, color 0.15s;
  }
  @media(hover:hover){
  .reveal-placeholder:hover {
    transform: scale(1.012);
    color: #888;
  }
  }
  .editor-outer:not(.is-hidden-state) .reveal-placeholder {
    display: none;
  }

  .editor-toolbar {
    display: none;
  }

  .editor-outer.toolbar-active .editor-toolbar {
    display: flex;
  }

  .editor-outer.toolbar-active .rich-editor {
    border-radius: 4px;
  }

  .rich-editor {
    width: 100%;
    min-height: 54px;
    max-height: 40vh;
    overflow-y: auto;
    padding: 0.5rem 0.65rem 0.5rem 0.8rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow', sans-serif;
    font-size: 0.83rem;
    font-weight: 300;
    line-height: 1.55;
    color: var(--ink);
    background: #f2f2f2;
    outline: none;
    overflow-wrap: break-word;
  }
  .rich-editor ol, .rich-editor ul {
    padding-left: 1.4rem;
    margin: 0.2rem 0;
  }

  @keyframes pulse-green-border {
    0%   { border-color: #2e8b57; box-shadow: 0 0 0 2px rgba(46,139,87,0.55); }
    50%  { border-color: #52c48a; box-shadow: 0 0 0 4px rgba(46,139,87,0.18); }
    100% { border-color: #2e8b57; box-shadow: 0 0 0 2px rgba(46,139,87,0.55); }
  }

  .rich-editor:focus { background: #ebebeb; border-color: #2e8b57; }
  .editor-outer.toolbar-active .rich-editor:focus {
    border-radius: 4px;
  }

  /* No hover effects on revealed editor - it just clicks to hide */
  .editor-outer:not(.is-hidden-state) .rich-editor {
    cursor: default;
    transform: none !important;
  }

  /* Hover scale on revealed editor when not in edit mode — indicates clickable */
  .editor-outer:not(.is-hidden-state):not(.toolbar-active) .rich-editor {
    cursor: pointer !important;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .editor-outer:not(.is-hidden-state):not(.toolbar-active) .rich-editor:hover {
    transform: scale(1.012) !important;
  }
  }

  .rich-editor.summary-editor {
    background: #f2f2f2;
    border-color: #ddd;
    min-height: 54px;
    max-height: 40vh;
  }

  .rich-editor.summary-editor:focus { background: #ebebeb; border-color: #2e8b57; }

  .rich-editor.task-summary-editor {
    background: #f2f2f2;
    border: 1px solid #e0e0e0;
    min-height: 54px;
    max-height: 30vh;
  }

  .rich-editor.task-summary-editor:focus { background: #ebebeb; border-color: #2e8b57; }

  .rich-editor:empty:before {
    content: attr(data-placeholder);
    color: #ccc;
    pointer-events: none;
    display: block;
  }

  .task-summary-section {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #f0f0ee;
    border-radius: 4px;
    border: 1px solid var(--border);
  }

  .task-summary-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 0.5rem;
  }

  .more-options-wrap { position: relative; }

  .more-options-menu {
    display: block;
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    z-index: 200;
    width: 320px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
    transform: scale(0);
    transform-origin: top left;
    opacity: 0;
    pointer-events: none;
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.15s ease;
  }

  .more-options-menu.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  .more-options-menu button,
  .more-options-menu a {
    display: block;
    width: 100%;
    padding: 0.65rem 1rem;
    background: transparent;
    border: none;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.63rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    cursor: pointer;
    text-align: left;
    transition: transform 0.15s;
    text-decoration: none;
    box-sizing: border-box;
  }

  .more-options-menu button { color: #c0392b; }
  .more-options-menu button.link-btn-save { color: #2e8b57 !important; }
  .more-options-menu button.link-btn-add { color: #2e8b57 !important; }
  .more-options-menu .links-add-row button[title="Paste from clipboard"] { color: #888 !important; }
  @media(hover:hover){
  .more-options-menu button:hover { transform: scale(1.03); }
  }
  .more-options-menu a { color: #222; }
  @media(hover:hover){
  .more-options-menu a:hover { transform: scale(1.03); }
  }

  @media(hover:hover){
  .link-btn-edit:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-add:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-save:hover { transform: scale(1.04) !important; }
  }
  @media(hover:hover){
  .link-btn-cancel:hover { transform: scale(1.04) !important; }
  }

  @media(hover:hover){
  .notes-btn:hover { transform: scale(1.06) !important; }
  }
  .notes-btn.active { background: #236b43 !important; border-color: #236b43 !important; }

  .notes-panel {
    position: fixed;
    bottom: 1.5rem;
    right: 5.2rem;
    width: 400px;
    height: calc(100vh - 195px);
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 8px rgba(0,0,0,0.08);
    z-index: 300;
    display: flex;
    flex-direction: column;
    transform: scale(0);
    transform-origin: bottom right;
    opacity: 0;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
    overflow: hidden;
    pointer-events: none;
  }

  .notes-panel.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  /* ── Search Panel ─────────────────────────────────────────────── */
  .search-icon-btn {
    background: var(--header-bg);
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    width: 2.8rem;
    height: 2.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.35);
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    flex-shrink: 0;
    padding: 0;
    position: fixed;
    bottom: 1.5rem;
    left: 1.5rem;
    z-index: 200;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }
  @media(hover:hover){
  .search-icon-btn:hover { transform: scale(1.08); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .search-icon-btn:active { transform: scale(0.94); }
  .search-icon-btn.active { border-color: rgba(255,255,255,0.6); color: #fff; }

  .search-panel {
    position: fixed;
    bottom: 1.5rem;
    left: 5.2rem;
    width: 400px;
    height: calc(100vh - 195px);
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 8px rgba(0,0,0,0.08);
    z-index: 300;
    display: flex;
    flex-direction: column;
    transform: scale(0);
    transform-origin: bottom left;
    opacity: 0;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
    overflow: hidden;
    pointer-events: none;
  }
  .search-panel.open {
    transform: scale(1);
    opacity: 1;
    pointer-events: all;
  }

  .search-panel-header {
    background: var(--header-bg);
    padding: 1rem 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-radius: 0;
    margin-bottom: 0;
  }
  .search-panel-header h3 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }
  .search-panel-close {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.15s, transform 0.15s;
    padding: 0;
    line-height: 1;
  }
  @media(hover:hover){
  .search-panel-close:hover { transform: scale(1.2); opacity: 1; }
  }

  .search-panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 0.6rem;
    overflow: hidden;
  }

  .search-input-row {
    display: flex;
    align-items: center;
    background: #f2f2f2;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0 0.6rem;
    gap: 0.4rem;
    flex-shrink: 0;
  }
  .search-input-row:focus-within {
    background: #ebebeb;
    border-color: #2e8b57;
    
  }
  .search-panel-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-family: 'Barlow', sans-serif;
    font-size: 0.85rem;
    font-weight: 300;
    color: var(--ink);
    padding: 0.6rem 0;
  }
  .search-panel-input::placeholder { color: #bbb; }
  .search-panel-clear {
    background: none;
    border: none;
    color: #aaa;
    cursor: pointer;
    font-size: 1.1rem;
    padding: 0;
    line-height: 1;
    display: none;
  }
  @media(hover:hover){
  .search-panel-clear:hover { color: #555; }
  }

  .search-panel-results {
    flex: 1;
    overflow-y: auto;
    border-radius: 4px;
  }
  .search-result-row {
    padding: 0.65rem 0.8rem;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.12s, transform 0.12s;
    border-radius: 4px;
  }
  @media(hover:hover){
  .search-result-row:hover, .search-result-row.active { background: #f4f0ed; transform: scale(1.01); }
  }

  .notes-panel-header {
    background: var(--header-bg);
    padding: 1rem 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-radius: 0;
    margin-bottom: 0;
  }

  .notes-panel-header h3 {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }

  .notes-panel-close {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.15s, transform 0.15s;
    padding: 0;
    line-height: 1;
  }

  @media(hover:hover){
  .notes-panel-close:hover { transform: scale(1.2); opacity: 1; }
  }

  .notes-panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 0.5rem;
    overflow: hidden;
  }

  .notes-editor {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow', sans-serif;
    font-size: 0.85rem;
    font-weight: 300;
    line-height: 1.6;
    color: var(--ink);
    background: #f2f2f2;
    outline: none;
    overflow-y: auto;
    resize: none;
  }

  .notes-editor:focus { background: #ebebeb; border-color: #2e8b57; }
  .notes-panel-body:focus-within .notes-editor { border-color: #2e8b57; }

  .notes-editor:empty:before {
    content: attr(data-placeholder);
    color: #ccc;
    pointer-events: none;
    display: block;
  }

  .notes-save-indicator {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #2e8b57;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    opacity: 0;
    transition: opacity 0.4s;
    text-align: right;
    height: 1rem;
  }

  @media (max-width: 600px) {

    /* Header */
    header {
      padding: 1.2rem 1rem 1rem;
      position: relative;
    }

    .header-top {
      flex-direction: column;
      gap: 0.8rem;
    }

    .header-top > div:first-child { width: 100%; }

    header h1 { font-size: 1rem; }
    header p { font-size: 0.6rem; }

    .header-top > div:last-child {
      flex-direction: row;
      align-items: center;
      width: 100%;
      justify-content: flex-end;
    }

    .edit-mode-btn,
    .manual-save-btn,
    .lock-icon-btn {
      margin-left: 0.5rem;
    }

    /* Controls — single scrollable row with dynamic fade hint */
    .controls {
      margin-top: 0.75rem;
      gap: 0.4rem;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow-y: visible;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: 2px;
    }

    .controls::-webkit-scrollbar { display: none; }

    /* Remove flex-shrink so buttons don't squish */
    .controls .btn,
    .controls .more-options-wrap,
    .controls label.btn {
      flex-shrink: 0;
    }

    .btn {
      font-size: 0.55rem;
      padding: 0.35rem 0.7rem;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }

    /* Notes panel — same partial-screen style as search on mobile */
    .notes-panel {
      top: auto;
      bottom: 5.5rem;
      right: 1rem;
      left: 1rem;
      width: calc(100vw - 2rem);
      height: 65vh;
      border-radius: 4px;
      border: 1px solid var(--border);
      opacity: 0;
      pointer-events: none;
      transform: scale(0);
      transform-origin: bottom right;
      transition: opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .notes-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: scale(1);
    }
    .notes-panel-header { border-radius: 0; margin-bottom: 0; }

    /* Main content */
    .main {
      padding: 1.2rem 0.75rem 4rem;
    }

    .area-body-inner { padding: 0.75rem; }
    .task-body-inner { padding: 0.75rem; }


    .task-header {
      font-size: 0.78rem;
      padding: 0.7rem 0.9rem;
    }

    /* Item grid — stack code above content */
    .item {
      grid-template-columns: 1fr;
      gap: 0.3rem;
      padding: 0.35rem 0.25rem;
    }

    .item-code {
      font-size: 0.62rem;
      padding: 0.15rem 0.3rem;
    }

    /* Title row and confidence dots */
    .item-title { font-size: 0.83rem; }

    .conf-dot {
      width: 12px;
      height: 12px;
    }

    /* Field labels and reveal buttons */
    .field-label-row { gap: 0.3rem; }

    .side-toggle-btn {
      font-size: 0.5rem;
      padding: 0.28rem 0.45rem;
    }

    /* Rich text toolbar */
    .editor-toolbar {
      flex-wrap: wrap;
      gap: 0.2rem;
      padding: 0.2rem 0.3rem;
    }

    .editor-toolbar button {
      font-size: 0.68rem;
      padding: 0.1rem 0.4rem;
    }

    /* Rich editor max heights */
    .rich-editor { max-height: 35vh; }
    .rich-editor.summary-editor { max-height: 35vh; }
    .rich-editor.task-summary-editor { max-height: 35vh; }

    /* Task summary section */
    .task-summary-section { padding: 0.75rem; }
    .search-panel {
      top: auto;
      bottom: 5.5rem;
      left: 1rem;
      width: calc(100vw - 2rem);
      height: 65vh;
      border-radius: 4px;
      border: 1px solid var(--border);
      opacity: 0;
      pointer-events: none;
      transform: scale(0);
      transform-origin: bottom left;
      transition: opacity 0.25s ease, transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .search-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: scale(1);
    }
    .search-panel-header { border-radius: 0; margin-bottom: 0; }

    /* More options menu */
    .more-options-menu {
      font-size: 0.6rem;
      min-width: 160px;
    }

    /* Links menu */

    /* Section label */
    .section-label { font-size: 0.8rem; }

    /* Floating buttons — slightly smaller on mobile */
    .notes-icon-btn,
    .search-icon-btn {
      width: 2.4rem;
      height: 2.4rem;
      border-radius: 4px;
    }

  }

  .lock-icon-btn {
    background: transparent;
    border: none;
    border-radius: 0;
    width: auto;
    height: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: transform 0.15s, color 0.15s;
    flex-shrink: 0;
    margin-left: 1rem;
    padding: 0.3rem 0.4rem;
    gap: 0.2rem;
  }

  @media(hover:hover){
  .lock-icon-btn:hover { transform: scale(1.15); color: #ffffff; }
  }
  .lock-icon-btn:active { transform: scale(0.95); }

  /* Lock Confirm Dialog */
  .lock-confirm-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .lock-confirm-overlay.open { opacity: 1; pointer-events: all; }

  /* Study Exit Confirm */
  .study-exit-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .study-exit-overlay.open { opacity: 1; pointer-events: all; }

  .study-exit-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 300px;
    max-width: 480px;
    width: 90%;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .study-exit-overlay.open .study-exit-card { transform: scale(1); }

  .study-exit-title {
    font-family: 'Barlow', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .study-exit-list {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    max-height: 280px;
    overflow-y: auto;
  }

  .study-exit-item {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.72rem;
    color: var(--ink);
    padding: 0.35rem 0.5rem;
    border-radius: 4px;
    background: #f5f5f5;
    border: 1px solid var(--border);
  }
  .study-exit-item-code { color: var(--accent); font-weight: 600; flex-shrink: 0; }
  .study-exit-item-action { color: #555; font-weight: 600; flex-shrink: 0; font-size: 0.65rem; letter-spacing: 0.06em; text-transform: uppercase; }
  .study-exit-item-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #888; }

  .study-exit-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
    padding-top: 0.3rem;
  }

  .study-exit-btn {
    flex: 1;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.6rem;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-exit-btn:hover { transform: scale(1.05); }
  }
  .study-exit-btn:active { transform: scale(0.96); }

  .study-exit-btn.cancel-btn {
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    color: #666;
  }
  .study-exit-btn.confirm-btn {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }

  .lock-confirm-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 260px;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .lock-confirm-overlay.open .lock-confirm-card { transform: scale(1); }

  .lock-confirm-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .lock-confirm-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
  }

  .lock-confirm-yes {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
  }
  @media(hover:hover){
  .lock-confirm-yes:hover { transform: scale(1.05); }
  }
  .lock-confirm-yes:active { transform: scale(0.96); }

  .lock-confirm-no {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
  }
  @media(hover:hover){
  .lock-confirm-no:hover { transform: scale(1.05); }
  }
  .lock-confirm-no:active { transform: scale(0.96); }

  .btn-study-highlight {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  @media(hover:hover){
  .btn-study-highlight:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.75); color: #fff; }
  }

  .btn-oral-sim {
    background: transparent;
    border-color: rgba(180,150,255,0.5);
    color: rgba(180,150,255,0.85);
  }
  @media(hover:hover){
  .btn-oral-sim:hover { transform: scale(1.05); border-color: rgba(180,150,255,0.9); color: #c8b0ff; }
  }

  .btn-hide-empty {
    background: transparent;
    border-color: rgba(255,255,255,0.35);
    color: rgba(255,255,255,0.7);
  }
  @media(hover:hover){
  .btn-hide-empty:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.75); color: #fff; }
  }
  .btn-hide-empty.active { border-color: rgba(255,255,255,0.55); color: rgba(255,255,255,0.7); }

  .hide-empty-mode .field-row.is-empty {
    display: none;
  }

  /* ── Oral Simulator ───────────────────────────────────────────── */
  .oral-launcher-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .oral-launcher-overlay.open { opacity: 1; pointer-events: all; }

  .oral-launcher-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    width: min(460px, 92vw);
    display: flex;
    flex-direction: column;
    gap: 1.4rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
  }

  .oral-launcher-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
  }

  .oral-launcher-sub {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 0.3rem;
  }

  .oral-section-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.5rem;
  }

  .oral-option-group { display: flex; gap: 0.5rem; }

  .oral-option-btn {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s, border-color 0.15s, color 0.15s;
    text-align: center;
  }
  @media(hover:hover){
  .oral-option-btn:hover { transform: scale(1.03); border-color: #3d5166; color: #3d5166; }
  }
  .oral-option-btn.selected { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.07); }

  .oral-area-select {
    width: 100%;
    padding: 0.5rem 0.7rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: #ffffff;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 0.04em;
    cursor: pointer;
    outline: none;
    display: none;
  }
  .oral-area-select.visible { display: block; }
  .oral-area-select:focus { border-color: #3d5166; }

  .oral-api-row { display: none; flex-direction: column; gap: 0.45rem; }
  .oral-api-row.visible { display: flex; }

  .oral-api-input {
    width: 100%;
    padding: 0.5rem 0.7rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: #ffffff;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    outline: none;
    letter-spacing: 0.03em;
  }
  .oral-api-input:focus { border-color: #3d5166; }

  .oral-api-status {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .oral-api-status.ready { color: #2e8b57; }
  .oral-api-status.missing { color: var(--muted); }

  .oral-resume-banner {
    background: var(--reveal-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.8rem 1rem;
    display: none;
    flex-direction: column;
    gap: 0.5rem;
  }
  .oral-resume-banner.visible { display: flex; }
  .oral-resume-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink);
    font-weight: 600;
  }
  .oral-resume-detail {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.03em;
  }
  .oral-resume-btns { display: flex; gap: 0.5rem; margin-top: 0.2rem; }
  .oral-resume-btn {
    flex: 1;
    padding: 0.5rem;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
    background: #ffffff;
    color: var(--ink);
  }
  @media(hover:hover){
  .oral-resume-btn:hover { transform: scale(1.04); border-color: #3d5166; color: #3d5166; }
  }
  .oral-resume-btn.fresh { background: #e0e0e0; border-color: #ccc; color: #666; }
  @media(hover:hover){
  .oral-resume-btn.fresh:hover { transform: scale(1.04); border-color: #999; color: #444; }
  }

  .oral-launcher-btns { display: flex; gap: 0.75rem; width: 100%; }

  .oral-launcher-go {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .oral-launcher-go:hover { transform: scale(1.05); }
  }

  .oral-launcher-cancel {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .oral-launcher-cancel:hover { transform: scale(1.05); }
  }

  /* Oral Sim Main */
  .oral-sim-overlay {
    position: fixed; inset: 0; background: var(--bg);
    z-index: 700; display: none; flex-direction: column; overflow: hidden;
  }
  .oral-sim-overlay.open { display: flex; }
  .oral-sim-header {
    background: var(--header-bg); padding: 1rem 1.5rem;
    display: flex; align-items: center; justify-content: space-between;
    flex-shrink: 0; gap: 1rem;
  }
  .oral-sim-title {
    font-family: 'Barlow', sans-serif; font-weight: 700;
    font-size: 0.78rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: #fff; display: flex; align-items: center; gap: 0.8rem;
  }
  .oral-sim-mode-badge {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.55rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 0.2rem 0.5rem; border-radius: 3px; font-weight: 600;
  }
  .oral-sim-mode-badge.direct { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.7); }
  .oral-sim-mode-badge.rephrased { background: rgba(217,95,26,0.25); color: var(--accent); border-color: rgba(217,95,26,0.4); }
  .oral-sim-progress {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.58rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: rgba(255,255,255,0.4);
  }
  .oral-sim-exit-btn {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.6rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 0.35rem 0.9rem; border: 1px solid rgba(192,57,43,0.5);
    color: rgba(192,57,43,0.7); background: transparent;
    cursor: pointer; border-radius: 6px; font-weight: 600; transition: all 0.2s;
  }
  @media(hover:hover){
  .oral-sim-exit-btn:hover { border-color: #c0392b; color: #c0392b; }
  }
  .oral-sim-body {
    flex: 1; overflow-y: auto; display: flex; flex-direction: column;
    align-items: center; padding: 2rem 1.5rem; gap: 1rem;
  }

  /* Question Card */
  .oral-q-card { width: 100%; max-width: 700px; display: flex; flex-direction: column; gap: 1rem; }
  .oral-q-task-header {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.6rem;
    letter-spacing: 0.12em; text-transform: uppercase;
    color: var(--ink); font-weight: 600;
    padding: 0.4rem 0; border-bottom: 1px solid var(--border);
    display: flex; flex-direction: column; gap: 0.15rem;
  }
  .oral-q-question {
    background: var(--white); border: 1px solid var(--border);
    border-radius: 6px; padding: 1.4rem 1.5rem;
    font-size: 0.95rem; color: var(--ink); line-height: 1.55;
    font-weight: 400; min-height: 80px;
  }
  .oral-q-thinking {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.7rem;
    color: var(--muted); letter-spacing: 0.06em; font-style: italic;
    min-height: 1.4rem;
  }
  .oral-q-sources {
    display: none; padding: 0.55rem 0.8rem; margin-top: -0.4rem;
    border: 1px solid var(--border); border-top: none;
    border-radius: 0 0 6px 6px; background: var(--reveal-bg);
  }
  .oral-q-sources.visible { display: block; }
  .oral-q-sources-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.5rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
    font-weight: 600; margin-bottom: 0.3rem;
  }
  .oral-q-sources-list {
    display: flex; flex-wrap: wrap; gap: 0.3rem;
  }
  .oral-q-source-tag {
    font-family: 'Barlow', sans-serif; font-size: 0.65rem;
    color: var(--ink); background: var(--white);
    border: 1px solid var(--border); border-radius: 3px;
    padding: 0.15rem 0.5rem; font-weight: 400;
    line-height: 1.4; opacity: 0.8;
  }
  .oral-q-reveal-row { display: flex; gap: 0.6rem; flex-direction: row-reverse; }
  .oral-q-reveal-btn {
    flex: 1; padding: 0.6rem; background: transparent;
    border: 1.5px solid var(--border); border-radius: 4px; color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.65rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 600; transition: all 0.15s;
  }
  @media(hover:hover){
  .oral-q-reveal-btn:hover { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.05); }
  }
  .oral-q-reveal-btn.revealed { border-color: #3d5166; color: #3d5166; background: rgba(61,81,102,0.07); }
  .oral-q-answer-box {
    background: var(--white); border: 1px solid var(--border); border-radius: 6px;
    overflow: hidden; display: none;
  }
  .oral-q-answer-box.visible { display: block; }
  .oral-q-answer-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.55rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
    padding: 0.5rem 1rem 0.2rem; font-weight: 600;
  }
  .oral-q-answer-content {
    padding: 0.4rem 1rem 1rem; font-size: 0.85rem;
    color: var(--ink); line-height: 1.55;
  }
  .oral-q-answer-content.empty { color: var(--muted); font-style: italic; font-size: 0.78rem; }
  .oral-grade-row {
    display: flex; gap: 1.5rem; justify-content: center;
    margin-top: 0.5rem;
  }
  .oral-grade-row.visible { display: flex; }
  .oral-grade-btn {
    width: 68px; height: 68px; border-radius: 50%; border: 2.5px solid;
    background: transparent; cursor: pointer; display: flex;
    align-items: center; justify-content: center;
    transition: all 0.15s; flex-shrink: 0;
  }
  @media(hover:hover){
  .oral-grade-btn:hover { transform: scale(1.12); }
  }
  .oral-grade-btn:active { transform: scale(0.95); }
  .oral-grade-btn.correct { border-color: #2e8b57; color: #2e8b57; }
  .oral-grade-btn.wrong { border-color: #c0392b; color: #c0392b; }
  .oral-grade-hint {
    text-align: center; font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--muted); display: none;
  }
  .oral-grade-hint.visible { display: block; }

  /* Fail Screen */
  .oral-fail-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.55);
    z-index: 900; display: none; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.2s;
  }
  .oral-fail-overlay.open { display: flex; opacity: 1; pointer-events: all; }
  .oral-fail-card {
    background: #ffffff; border: 1px solid var(--border); border-radius: 4px;
    padding: 2rem 2.5rem; width: min(480px, 93vw); display: flex; flex-direction: column;
    gap: 1.1rem; box-shadow: 0 8px 40px rgba(0,0,0,0.25); text-align: center;
  }
  .oral-fail-title {
    font-family: 'Barlow', sans-serif; font-weight: 700; font-size: 0.82rem;
    letter-spacing: 0.12em; text-transform: uppercase; color: var(--ink);
  }
  .oral-fail-area {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.68rem;
    letter-spacing: 0.06em; text-transform: uppercase; color: #3d5166;
    background: rgba(61,81,102,0.06); border: 1px solid rgba(61,81,102,0.2);
    border-radius: 4px; padding: 0.65rem 1rem;
  }
  .oral-fail-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.58rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted);
    text-align: left;
  }
  .oral-fail-items {
    text-align: left; display: flex; flex-direction: column; gap: 0.3rem;
    max-height: 180px; overflow-y: auto;
  }
  .oral-fail-item {
    font-size: 0.78rem; color: var(--ink); padding: 0.3rem 0;
    border-bottom: 1px solid var(--border); display: flex; gap: 0.6rem; align-items: flex-start;
  }
  .oral-fail-item-code {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.63rem;
    color: var(--accent); font-weight: 600; flex-shrink: 0; white-space: nowrap; padding-top: 0.1rem;
  }
  .oral-fail-btns { display: flex; gap: 0.75rem; width: 100%; }
  .oral-fail-btn {
    flex: 1; padding: 0.6rem; border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.65rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 600; transition: transform 0.15s; border: 1.5px solid;
  }
  @media(hover:hover){
  .oral-fail-btn:hover { transform: scale(1.05); }
  }
  .oral-fail-btn.restart { background: #ffffff; border-color: var(--border); color: var(--ink); }
  .oral-fail-btn.exit-fail { background: #e0e0e0; border-color: #ccc; color: #666; }

  /* Pass Screen */
  .oral-pass-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.72);
    z-index: 900; display: none; align-items: center; justify-content: center;
  }
  .oral-pass-overlay.open { display: flex; }
  .oral-pass-card {
    background: var(--white); border-radius: 8px; padding: 2.5rem;
    width: min(420px, 93vw); display: flex; flex-direction: column;
    gap: 1.2rem; box-shadow: 0 16px 48px rgba(0,0,0,0.3);
    text-align: center; align-items: center;
  }
  .oral-pass-check {
    width: 84px; height: 84px; border-radius: 50%; border: 3px solid #2e8b57;
    display: flex; align-items: center; justify-content: center;
    animation: oral-check-pop 0.4s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  @keyframes oral-check-pop { 0%{transform:scale(0);opacity:0;} 100%{transform:scale(1);opacity:1;} }
  .oral-pass-check svg { animation: oral-check-draw 0.5s ease 0.3s forwards; stroke-dasharray: 50; stroke-dashoffset: 50; }
  @keyframes oral-check-draw { to { stroke-dashoffset: 0; } }
  .oral-pass-title {
    font-family: 'Barlow', sans-serif; font-weight: 700; font-size: 1.7rem;
    letter-spacing: 0.1em; text-transform: uppercase; color: #2e8b57;
    animation: oral-fade-up 0.5s ease 0.6s both;
  }
  @keyframes oral-fade-up { from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);} }
  .oral-pass-stats {
    font-family: 'Barlow Condensed', sans-serif; font-size: 0.7rem;
    letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted);
    animation: oral-fade-up 0.5s ease 0.8s both;
  }
  .oral-pass-btn {
    padding: 0.7rem 2rem; background: #2e8b57; border: none; border-radius: 6px;
    color: #fff; font-family: 'Barlow Condensed', sans-serif; font-size: 0.72rem;
    letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
    font-weight: 700; transition: transform 0.15s; animation: oral-fade-up 0.5s ease 1s both;
  }
  @media(hover:hover){
  .oral-pass-btn:hover { transform: scale(1.05); }
  }

  /* ── Study Highlight Picker ───────────────────────────────────── */
  .study-picker-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .study-picker-overlay.open { opacity: 1; pointer-events: all; }

  .study-picker-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 300px;
  }

  .study-picker-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .study-picker-dots {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    justify-content: center;
  }

  .study-picker-dot {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 2.5px solid;
    cursor: pointer;
    background: transparent;
    transition: transform 0.15s, opacity 0.15s;
    opacity: 0.45;
    padding: 0;
    flex-shrink: 0;
  }
  @media(hover:hover){
  .study-picker-dot:hover { transform: scale(1.15); opacity: 0.8; }
  }
  .study-picker-dot.selected { opacity: 1; }
  .study-picker-dot.green  { border-color: #2e8b57; }
  .study-picker-dot.yellow { border-color: #d4a017; }
  .study-picker-dot.red    { border-color: #c0392b; }
  .study-picker-dot.selected.green  { background: #2e8b57; }
  .study-picker-dot.selected.yellow { background: #d4a017; }
  .study-picker-dot.selected.red    { background: #c0392b; }

  .study-picker-btns {
    display: flex;
    gap: 0.75rem;
    width: 100%;
  }

  .study-picker-go {
    flex: 1;
    padding: 0.6rem;
    background: #ffffff;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    color: var(--ink);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-picker-go:hover { transform: scale(1.05); }
  }

  .study-picker-cancel {
    flex: 1;
    padding: 0.6rem;
    background: #e0e0e0;
    border: 1.5px solid #ccc;
    border-radius: 4px;
    color: #666;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-picker-cancel:hover { transform: scale(1.05); }
  }

  /* ── Study Mode Overlay ───────────────────────────────────────── */
  .study-mode-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 700;
    display: none;
    flex-direction: column;
    overflow: hidden;
  }
  .study-mode-overlay.open { display: flex; }

  .study-mode-header {
    background: var(--header-bg);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    gap: 1rem;
  }

  .study-mode-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .study-mode-dot-indicators {
    display: flex;
    gap: 0.4rem;
    align-items: center;
  }

  .study-mode-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .study-mode-indicator.green  { background: #2e8b57; }
  .study-mode-indicator.yellow { background: #d4a017; }
  .study-mode-indicator.red    { background: #c0392b; }

  .study-mode-controls {
    display: flex;
    gap: 0.6rem;
    align-items: center;
  }

  .study-mode-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.35rem 0.9rem;
    border: 1px solid;
    background: transparent;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    transition: transform 0.2s, border-color 0.2s, color 0.2s, background 0.2s;
  }
  @media(hover:hover){
  .study-mode-btn:hover { transform: scale(1.05); }
  }
  .study-mode-btn:active { transform: scale(0.96); }

  .study-mode-btn.reveal-btn {
    border-color: rgba(46,139,87,0.5);
    color: rgba(46,139,87,0.7);
  }
  @media(hover:hover){
  .study-mode-btn.reveal-btn:hover {
    border-color: #2e8b57;
    color: #2e8b57;
  }
  }

  .study-mode-btn.exit-btn {
    border-color: rgba(192,57,43,0.5);
    color: rgba(192,57,43,0.7);
  }
  @media(hover:hover){
  .study-mode-btn.exit-btn:hover {
    border-color: #c0392b;
    color: #c0392b;
  }
  }

  .study-mode-close {
    background: none;
    border: none;
    color: rgba(255,255,255,0.7);
    font-size: 1.1rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    transition: transform 0.15s;
  }
  @media(hover:hover){
  .study-mode-close:hover { transform: scale(1.2); color: #fff; }
  }

  .study-mode-count {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.35);
  }

  .study-mode-body {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    max-width: 980px;
    width: 100%;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .study-item {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 0.75rem;
    padding: 1rem 1.2rem;
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .study-item-header {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    flex-wrap: nowrap;
  }

  .study-item-left {
    display: none; /* no longer used */
  }

  .study-item-code {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.67rem;
    color: var(--accent);
    font-weight: 500;
    letter-spacing: 0.02em;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .study-conf-dots {
    display: flex;
    gap: 0.35rem;
    flex-shrink: 0;
    align-items: center;
  }

  .study-item-fields {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .study-field-with-dots { display: none; }
  .study-field-dots { display: none; }

  .study-conf-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 1.5px solid;
    cursor: pointer;
    background: transparent;
    padding: 0;
    transition: transform 0.12s, opacity 0.12s;
    opacity: 0.4;
  }
  @media(hover:hover){
  .study-conf-dot:hover { transform: scale(1.3); opacity: 0.75; }
  }
  .study-conf-dot.active { opacity: 1; }
  .study-conf-dot.green  { border-color: #2e8b57; }
  .study-conf-dot.yellow { border-color: #d4a017; }
  .study-conf-dot.red    { border-color: #c0392b; }
  .study-conf-dot.active.green  { background: #2e8b57; }
  .study-conf-dot.active.yellow { background: #d4a017; }
  .study-conf-dot.active.red    { background: #c0392b; }

  .study-item-right { display: contents; }

  .study-item-title {
    font-size: 0.87rem;
    color: var(--ink);
    line-height: 1.45;
    font-weight: 400;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    flex: 1;
    min-width: 0;
  }
  .study-item-title.conf-green  { background: #d4f0dc; color: #1a5c30; }
  .study-item-title.conf-yellow { background: #fef3c7; color: #7c5c00; }
  .study-item-title.conf-red    { background: #fde8e8; color: #7c1d1d; }

  .study-item-field { display: flex; flex-direction: column; gap: 0.2rem; }

  .study-item-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.12em;
  }

  .study-item-content {
    font-family: 'Barlow', sans-serif;
    font-size: 0.83rem;
    font-weight: 300;
    line-height: 1.55;
    color: var(--ink);
    background: #f2f2f2;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.5rem 0.65rem;
    position: relative;
    outline: none;
    transition: transform 0.15s, border-color 0.15s;
    cursor: pointer;
    min-height: 54px;
    overflow: hidden;
  }
  @media(hover:hover){
  .study-item-content:hover {
    transform: scale(1.012);
  }
  }
  .study-item-content:focus {
    border-color: #2e8b57;
    background: #ebebeb;
    outline: none;
    cursor: text;
  }
  .study-item-content.is-editing {
    cursor: text;
  }
  /* Revealed — expand naturally up to a max, then scroll */
  .study-item-content:not(.hidden-content) {
    height: auto;
    max-height: 40vh;
    overflow-y: auto;
  }
  .study-item-content.is-editing {
    max-height: 40vh;
    overflow-y: auto;
  }
  .study-item-content.hidden-content {
    background: #e8e8e8;
    color: transparent;
    user-select: none;
    cursor: pointer;
    height: 54px !important;
    min-height: 54px !important;
    max-height: 54px !important;
    overflow: hidden !important;
  }
  .study-item-content.hidden-content * { opacity: 0; }
  .study-item-content.hidden-content::after {
    content: '';
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
    transition: color 0.15s;
  }
  .study-item-content.hidden-content.has-content::after {
    content: 'Click to reveal';
  }
  @media(hover:hover){
  .study-item-content.hidden-content:hover::after {
    color: #888;
  }
  }

  /* Edit dots button */
  .study-field-wrap {
    position: relative;
  }
  .study-edit-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #bbb;
    padding: 0;
    font-size: 0.85rem;
    line-height: 1;
    letter-spacing: 0.15em;
    transition: color 0.15s;
    flex-shrink: 0;
    margin-left: auto;
  }
  @media(hover:hover){
  .study-edit-btn:hover { color: #444; }
  }

  .study-empty {
    text-align: center;
    padding: 4rem 2rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.78rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .lock-screen {
    position: fixed;
    inset: 0;
    background: var(--header-bg);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
  }
  .lock-screen.hidden { display: none; }

  .lock-title-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.4rem;
  }

  .lock-icon {
    color: var(--accent);
    animation: prop-spin 2.8s linear infinite;
    transform-origin: center;
    display: block;
  }
  @keyframes prop-spin {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  .lock-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #fff;
    text-align: center;
  }

  .lock-subtitle {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.45);
    text-align: center;
  }

  /* ── Runway graphic + threshold inputs ── */
  .runway-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    width: min(440px, 92vw);
    position: relative;
    padding: 0 15px;
  }

  .runway-wrap::before,
  .runway-wrap::after {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 10px;
    background: rgba(255,255,255,0.75);
    border-radius: 2px;
  }
  .runway-wrap::before { left: 0; }
  .runway-wrap::after  { right: 0; }

  .runway-centerline {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 18px 0 18px;
    width: 100%;
  }

  .cl-dash {
    width: 10px;
    height: 28px;
    background: rgba(255,255,255,0.75);
    border-radius: 2px;
    flex-shrink: 0;
  }

  .threshold-strip {
    display: flex;
    align-items: stretch;
    gap: 5px;
    width: 100%;
    height: 120px;
  }

  .thresh-group {
    display: flex;
    gap: 5px;
    flex: 1;
  }

  .thresh-gap {
    width: 18px;
    flex-shrink: 0;
  }

  .thresh-stripe {
    flex: 1;
    background: rgba(255,255,255,0.82);
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: transform 0.15s ease, background 0.15s;
  }

  @media(hover:hover){
  .thresh-stripe:hover {
    transform: scale(1.03);
  }
  }

  .thresh-stripe:focus-within {
    transform: scale(1.05);
  }

  .thresh-stripe.error {
    background: rgba(231,76,60,0.65);
    animation: stripe-shake 0.35s ease;
  }
  @keyframes stripe-shake {
    0%,100% { transform: translateX(0); }
    25%      { transform: translateX(-4px); }
    75%      { transform: translateX(4px); }
  }

  .digit-box {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: #1a1a1a;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    text-align: center;
    caret-color: #333;
    -webkit-text-security: disc;
    text-security: disc;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }

  .lock-error {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    color: #e74c3c;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    min-height: 0.9rem;
    text-align: center;
    margin-top: -1rem;
  }

  .lock-btn {
    padding: 0.55rem 2.8rem;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 6px;
    color: rgba(255,255,255,0.75);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, color 0.2s;
    font-weight: 600;
    margin-top: -1rem;
  }
  @media(hover:hover){
  .lock-btn:hover { transform: scale(1.05); border-color: rgba(255,255,255,0.65); color: #fff; }
  }

  /* ── Change Password Modal ───────────────────────────────────── */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }

  .modal-overlay.open { opacity: 1; pointer-events: all; }

  .modal-card {
    background: #1e2d3d;
    border: 1px solid #2e4560;
    border-radius: 6px;
    padding: 2rem;
    width: 300px;
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.4);
  }

  .modal-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
  }

  .modal-input {
    width: 100%;
    padding: 0.65rem 0.9rem;
    background: #162232;
    border: 1.5px solid #2e4560;
    border-radius: 6px;
    color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.82rem;
    outline: none;
    box-sizing: border-box;
    transition: border-color 0.2s;
  }

  .modal-input:focus { border-color: var(--accent); }
  .modal-input::placeholder { color: #4a6a85; }

  .modal-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.57rem;
    color: #7a9bb5;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: -0.5rem;
  }

  .modal-error {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: #e74c3c;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    min-height: 0.9rem;
  }

  .modal-btns {
    display: flex;
    gap: 0.6rem;
    margin-top: 0.3rem;
  }

  .modal-btn-save {
    flex: 1;
    padding: 0.6rem;
    background: var(--accent);
    border: none;
    border-radius: 6px;
    color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s;
    font-weight: 600;
  }

  @media(hover:hover){
  .modal-btn-save:hover { transform: scale(1.04); }
  }

  .modal-btn-cancel {
    flex: 1;
    padding: 0.6rem;
    background: transparent;
    border: 1.5px solid #2e4560;
    border-radius: 6px;
    color: #7a9bb5;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.6rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.2s;
  }

  @media(hover:hover){
  .modal-btn-cancel:hover { transform: scale(1.04); }
  }

    /* ── Export / Import Modal ── */
  .xfer-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .xfer-modal-overlay.open { opacity: 1; pointer-events: all; }

  .xfer-modal-card {
    position: relative;
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2rem 2.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    min-width: 260px;
    transform: scale(0.95);
    transition: transform 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .xfer-modal-overlay.open .xfer-modal-card { transform: scale(1); }

  .xfer-modal-title {
    font-family: 'Barlow', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink);
    text-align: center;
  }

  .xfer-modal-subtitle {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.58rem;
    color: var(--muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    text-align: center;
    margin-top: -0.8rem;
  }

  .xfer-modal-btns {
    display: flex;
    flex-direction: row;
    gap: 0.6rem;
    width: 100%;
  }

  .xfer-btn {
    width: 100%;
    padding: 0.6rem;
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  @media(hover:hover){
  .xfer-btn:hover { transform: scale(1.05); }
  }
  .xfer-btn:active { transform: scale(0.96); }

  .xfer-btn-primary {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }
  .xfer-btn-secondary {
    background: #ffffff;
    border: 1.5px solid var(--border);
    color: var(--ink);
  }

  .xfer-modal-close {
    position: absolute;
    top: 0.7rem;
    right: 0.9rem;
    background: none;
    border: none;
    color: var(--muted);
    font-size: 0.9rem;
    cursor: pointer;
    line-height: 1;
    padding: 0.2rem;
  }
  @media(hover:hover){
  .xfer-modal-close:hover { color: var(--ink); }
  }

  .xfer-divider {
    border: none;
    border-top: 1px solid var(--border);
    width: 100%;
    margin: 0;
  }



  /* ═══ MODERN MODE ═══ */
  body.modern-mode { background:#0f0f0f !important; color:rgba(255,255,255,0.8); overflow-x:hidden; overflow-y:hidden; }
  /* Modern scrollbars - thin, subtle */
  body.modern-mode ::-webkit-scrollbar { width:5px; height:5px; }
  body.modern-mode ::-webkit-scrollbar-track { background:transparent; }
  body.modern-mode ::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.08); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode ::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.15); }
  }
  body.modern-mode * { scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.08) transparent; }
  body.modern-mode header { display:none !important; }
  body.modern-mode .bookmark-banner { display:none !important; }
  body.modern-mode .bookmark-banner.visible { display:block !important; background:rgba(20,20,20,0.9); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(217,95,26,0.3); color:rgba(217,95,26,0.5); z-index:250; }
  @media(hover:hover){
  body.modern-mode .bookmark-banner.visible:hover { border-color:rgba(217,95,26,0.7) !important; color:rgba(217,95,26,1) !important; background:rgba(20,20,20,0.95) !important; box-shadow:0 4px 20px rgba(217,95,26,0.15) !important; transform:translateX(-50%) scale(1.1) !important; }
  }
  body.modern-mode .bookmark-banner.visible:active { transform:translateX(-50%) scale(0.96) !important; }
  body.modern-mode .lock-screen.hidden,
  body.modern-mode .main,
  body.modern-mode .search-icon-btn,
  body.modern-mode .notes-icon-btn { display:none !important; }
  body.modern-mode .lock-screen:not(.hidden) { display:flex !important; z-index:9999; }
  body.modern-mode .m-header { display:flex !important; }
  body.modern-mode .m-ghost { display:none !important; }
  body.modern-mode .m-viewport { display:block !important; }
  .m-header { display:none; align-items:center; justify-content:space-between; padding:0.6rem 1.4rem; position:relative; z-index:60; }
  .m-h-left { display:flex; align-items:center; gap:0.5rem; flex:1; }
  .m-wordmark { font-family:'Barlow Condensed',sans-serif; font-weight:600; font-size:0.58rem; letter-spacing:0.14em; text-transform:uppercase; color:rgba(255,255,255,0.35); }
  .m-badge { font-family:'Barlow Condensed',sans-serif; font-size:0.42rem; letter-spacing:0.1em; text-transform:uppercase; color:rgba(255,255,255,0.25); border:1px solid rgba(255,255,255,0.1); padding:0.12rem 0.45rem; border-radius:20px; }
  .m-search { flex:1; max-width:380px; height:32px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1); border-radius:20px; display:flex; align-items:center; padding:0 0.9rem; gap:0.5rem; cursor:text; transition:all 0.3s; margin:0 1rem;  }
  @media(hover:hover){
  .m-search:hover { border-color:rgba(255,255,255,0.2); background:transparent; }
  }
  .m-search-icon { color:rgba(255,255,255,0.25); flex-shrink:0; }
  .m-search-input { flex:1; background:transparent; border:none; outline:none; font-family:'Barlow Condensed',sans-serif; font-size:0.56rem; letter-spacing:0.06em; text-transform:uppercase; color:rgba(255,255,255,0.7); }
  .m-search-input::placeholder { color:rgba(255,255,255,0.18); }
  .m-search-kbd { font-family:'Barlow Condensed',sans-serif; font-size:0.42rem; color:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.08); border-radius:4px; padding:0.1rem 0.4rem; flex-shrink:0; }
  .m-h-right { display:flex; align-items:center; gap:0.2rem; flex:1; justify-content:flex-end; }
  .m-icon { width:30px; height:30px; display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,0.25); cursor:pointer; border-radius:8px; transition:all 0.25s; position:relative; background:none; border:none; }
  .m-lock-icon svg { width:14px; height:14px; }
  @media(hover:hover){
  .m-icon:hover { color:rgba(255,255,255,0.55); background:rgba(255,255,255,0.05); transform:scale(1.1); }
  }
  .m-icon-label { position:absolute; bottom:-14px; left:50%; transform:translateX(-50%); font-family:'Barlow Condensed',sans-serif; font-size:0.38rem; letter-spacing:0.1em; text-transform:uppercase; color:rgba(255,255,255,0.15); white-space:nowrap; opacity:0; transition:opacity 0.2s; pointer-events:none; }
  @media(hover:hover){
  .m-icon:hover .m-icon-label { opacity:1; }
  }
  .m-fab-wrap {}
  .m-fab-menu { position:absolute; top:calc(100% + 6px); right:0; background:rgba(255,255,255,0.05); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.1); border-radius:18px; box-shadow:none; min-width:320px; padding:1.2rem; z-index:100; transform:scale(0); transform-origin:top right; opacity:0; pointer-events:none; transition:transform 0.22s cubic-bezier(0.34,1.56,0.64,1),opacity 0.15s; display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; }
  .m-fab-menu.open { transform:scale(1); opacity:1; pointer-events:all; }
  .m-fab-item { display:flex; align-items:center; justify-content:center; padding:0.7rem 0.8rem; font-family:'Barlow Condensed',sans-serif; font-size:0.58rem; letter-spacing:0.06em; text-transform:uppercase; color:rgba(255,255,255,0.4); cursor:pointer; transition:all 0.25s; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:10px; text-align:center; }
  @media(hover:hover){
  .m-fab-item:hover { background:rgba(255,255,255,0.08); border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.8); transform:scale(1.03); }
  }
  .m-fab-divider { display:none; }
  .m-toolbar { display:none; position:relative; z-index:70; padding:0.3rem 0; overflow:visible; }
  body.modern-mode .m-toolbar { display:block !important; }
  .m-toolbar-track { display:flex; justify-content:center; gap:0.3rem; overflow:visible; scrollbar-width:none; -webkit-overflow-scrolling:touch; padding:0.3rem 1rem; }
  .m-toolbar-track::-webkit-scrollbar { display:none; }
  .m-tool-btn { display:flex; align-items:center; gap:0.35rem; padding:0.4rem 0.8rem; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:20px; color:rgba(255,255,255,0.35); font-family:'Barlow Condensed',sans-serif; font-size:0.48rem; letter-spacing:0.08em; text-transform:uppercase; cursor:pointer; white-space:nowrap; transition:all 0.25s; flex-shrink:0; transform-origin:center bottom; }
  @media(hover:hover){
  .m-tool-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.6); transform:scale(1.04); }
  }
  .m-tool-btn:active { transform:scale(0.96); }
  .m-tool-btn svg { flex-shrink:0; }
  .m-tool-icon { padding:0.4rem 0.8rem; justify-content:center; }
  .m-oral-sim-btn .oral-sim-icon-play { fill:#4ade80; stroke:#4ade80; }
  .m-oral-sim-btn .oral-sim-icon-ring { stroke:rgba(74,222,128,0.4); }
  @media(hover:hover){
  .m-oral-sim-btn:hover .oral-sim-icon-play { fill:#6ee7a0; stroke:#6ee7a0; }
  }
  @media(hover:hover){
  .m-oral-sim-btn:hover .oral-sim-icon-ring { stroke:rgba(74,222,128,0.6); }
  }

  /* Study by Highlight toolbar button - 3 dots */
  .m-tool-study { gap:0.3rem; padding:0.4rem 0.75rem; }
  .m-study-dot { width:7px; height:7px; border-radius:50%; display:block; transition:all 0.25s; opacity:0.7; background:transparent !important; }
  @media(hover:hover){
  .m-tool-study:hover .m-study-dot { opacity:1; transform:scale(1.15); }
  }

  /* Edit Mode toolbar button */
  .m-tool-edit { padding:0.4rem 0.75rem; }
  .m-tool-edit.m-edit-active { border-color:rgba(46,139,87,0.5); color:rgba(46,139,87,0.8); background:rgba(46,139,87,0.08); box-shadow:0 0 12px rgba(46,139,87,0.15); }
  @media(hover:hover){
  .m-tool-edit.m-edit-active:hover { border-color:rgba(46,139,87,0.7); color:rgba(46,139,87,1); box-shadow:0 0 18px rgba(46,139,87,0.25); }
  }
  .m-tool-edit.m-edit-active svg { stroke:rgba(46,139,87,0.9); }

  /* Hide items from main toolbar fab menu (but keep in expanded view pill clone) */
  .m-fab-menu .m-fab-hide-main { display:none; }
  @keyframes oral-sim-pulse-modern {
    0%   { filter: drop-shadow(0 0 0px rgba(74,222,128,0)); }
    50%  { filter: drop-shadow(0 0 8px rgba(74,222,128,0.7)); }
    100% { filter: drop-shadow(0 0 0px rgba(74,222,128,0)); }
  }
  .m-oral-sim-btn.oral-sim-pulsing { animation: oral-sim-pulse-modern 1.4s ease-in-out 5; }
  .m-oral-sim-btn.idle-animate .oral-sim-icon-ring { stroke:rgba(74,222,128,0.5); stroke-dasharray:41; stroke-dashoffset:41; animation:oral-ring-draw 1.1s cubic-bezier(0.4,0,0.2,1) forwards; }
  .m-oral-sim-btn.idle-animate .oral-sim-icon-play { fill:#4ade80; stroke:#4ade80; animation:oral-play-bounce 0.7s cubic-bezier(0.34,1.56,0.64,1) 0.4s forwards; }
  /* Oral Sim overlay in modern mode */
  body.modern-mode .oral-sim-overlay { background:#0f0f0f; }
  body.modern-mode .oral-sim-header { background:rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.05); }
  body.modern-mode .oral-sim-title { color:rgba(255,255,255,0.8); }
  body.modern-mode .oral-sim-progress { color:rgba(255,255,255,0.25); }
  body.modern-mode .oral-sim-exit-btn { border-color:rgba(255,100,100,0.2); color:rgba(255,100,100,0.5); }
  @media(hover:hover){
  body.modern-mode .oral-sim-exit-btn:hover { border-color:rgba(255,100,100,0.4); color:rgba(255,100,100,0.7); }
  }
  body.modern-mode .oral-sim-body { background:#0f0f0f; }
  body.modern-mode .oral-q-task-header { color:rgba(255,255,255,0.4); border-color:rgba(255,255,255,0.05); }
  body.modern-mode .oral-q-question { background:rgba(255,255,255,0.03); border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.7); }
  body.modern-mode .oral-q-thinking { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-q-sources { background:rgba(255,255,255,0.02); border-color:rgba(255,255,255,0.06); }
  body.modern-mode .oral-q-sources-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-q-source-tag { background:rgba(255,255,255,0.04); border-color:rgba(255,255,255,0.08); color:rgba(255,255,255,0.5); }
  body.modern-mode .oral-q-reveal-btn { border-color:rgba(255,255,255,0.08); color:rgba(255,255,255,0.35); }
  @media(hover:hover){
  body.modern-mode .oral-q-reveal-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.6); background:rgba(255,255,255,0.03); }
  }
  body.modern-mode .oral-q-reveal-btn.revealed { border-color:rgba(255,255,255,0.12); color:rgba(255,255,255,0.5); background:rgba(255,255,255,0.04); }
  body.modern-mode .oral-q-answer-box { background:rgba(255,255,255,0.02); border-color:rgba(255,255,255,0.05); }
  body.modern-mode .oral-q-answer-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-q-answer-content { color:rgba(255,255,255,0.6); }
  body.modern-mode .oral-q-answer-content.empty { color:rgba(255,255,255,0.15); }
  body.modern-mode .oral-grade-btn { background:transparent; }
  body.modern-mode .oral-grade-btn.green { border-color:rgba(74,222,128,0.3); color:#4ade80; }
  @media(hover:hover){
  body.modern-mode .oral-grade-btn.green:hover { border-color:#4ade80; background:rgba(74,222,128,0.08); }
  }
  body.modern-mode .oral-grade-btn.yellow { border-color:rgba(251,191,36,0.3); color:#fbbf24; }
  @media(hover:hover){
  body.modern-mode .oral-grade-btn.yellow:hover { border-color:#fbbf24; background:rgba(251,191,36,0.08); }
  }
  body.modern-mode .oral-grade-btn.red { border-color:rgba(248,113,113,0.3); color:#f87171; }
  @media(hover:hover){
  body.modern-mode .oral-grade-btn.red:hover { border-color:#f87171; background:rgba(248,113,113,0.08); }
  }
  body.modern-mode .oral-grade-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-sim-mode-badge.direct { background:rgba(255,255,255,0.05); color:rgba(255,255,255,0.4); }
  body.modern-mode .oral-sim-mode-badge.rephrased { background:rgba(217,95,26,0.15); }
  /* Oral Sim Launcher popup in modern mode */
  body.modern-mode .oral-launcher-overlay { background:rgba(0,0,0,0.6); opacity:0; pointer-events:none; transition:none !important; }
  body.modern-mode .oral-launcher-overlay.open { opacity:1; pointer-events:all; animation:mCenterPop 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .oral-launcher-overlay.m-pop-out { opacity:1; pointer-events:none; animation:mCenterClose 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .oral-launcher-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:16px; box-shadow:none; }
  body.modern-mode .oral-launcher-title { color:rgba(255,255,255,0.8); }
  body.modern-mode .oral-launcher-sub { color:rgba(255,255,255,0.25); }
  body.modern-mode .oral-section-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-option-btn { background:transparent; border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.35); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .oral-option-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.6); transform:scale(1.03); }
  }
  body.modern-mode .oral-option-btn.selected { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.04); }
  body.modern-mode .oral-area-select { background:rgba(255,255,255,0.03); border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.6); border-radius:10px; }
  body.modern-mode .oral-area-select:focus { border-color:rgba(255,255,255,0.15); }
  body.modern-mode .oral-area-select option { background:#1a1a1a; color:rgba(255,255,255,0.7); }
  body.modern-mode .oral-api-input { background:rgba(255,255,255,0.03); border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.6); border-radius:10px; }
  body.modern-mode .oral-api-input:focus { border-color:rgba(255,255,255,0.15); }
  body.modern-mode .oral-api-status.missing { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-resume-banner { background:rgba(255,255,255,0.02); border-color:rgba(255,255,255,0.05); border-radius:10px; }
  body.modern-mode .oral-resume-text { color:rgba(255,255,255,0.6); }
  body.modern-mode .oral-resume-detail { color:rgba(255,255,255,0.25); }
  body.modern-mode .oral-resume-btn { background:transparent; border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.35); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .oral-resume-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.6); }
  }
  body.modern-mode .oral-resume-btn.fresh { background:transparent; border-color:rgba(255,255,255,0.04); color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-launcher-go { background:transparent; border-color:rgba(255,255,255,0.08); color:rgba(255,255,255,0.5); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .oral-launcher-go:hover { border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.8); }
  }
  body.modern-mode .oral-launcher-cancel { background:transparent; border-color:rgba(255,255,255,0.04); color:rgba(255,255,255,0.2); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .oral-launcher-cancel:hover { border-color:rgba(255,255,255,0.1); color:rgba(255,255,255,0.4); }
  }

  /* ── Modern Oral Sim Pass/Fail Popups ── */
  body.modern-mode .oral-fail-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); opacity:0; pointer-events:none; transition:none !important; }
  body.modern-mode .oral-fail-overlay.open { display:flex; opacity:1; pointer-events:all; animation:mCenterPop 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .oral-fail-overlay.m-pop-out { display:flex; opacity:1; pointer-events:none; animation:mCenterClose 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .oral-fail-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(192,57,43,0.15); border-radius:18px; box-shadow:none; }
  body.modern-mode .oral-fail-title { color:rgba(192,57,43,0.8); font-size:0.9rem; }
  body.modern-mode .oral-fail-area { background:rgba(255,255,255,0.03); border-color:rgba(255,255,255,0.06); color:rgba(255,255,255,0.4); border-radius:10px; }
  body.modern-mode .oral-fail-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .oral-fail-items { scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.08) transparent; }
  body.modern-mode .oral-fail-item { color:rgba(255,255,255,0.55); border-bottom-color:rgba(255,255,255,0.04); }
  body.modern-mode .oral-fail-item-code { color:rgba(192,57,43,0.6); }
  body.modern-mode .oral-fail-btn { border-radius:12px; transition:all 0.2s; }
  body.modern-mode .oral-fail-btn.restart { background:transparent; border-color:rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); }
  @media(hover:hover){
  body.modern-mode .oral-fail-btn.restart:hover { border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.7); transform:scale(1.05); }
  }
  body.modern-mode .oral-fail-btn.exit-fail { background:transparent; border-color:rgba(192,57,43,0.25); color:rgba(192,57,43,0.5); }
  @media(hover:hover){
  body.modern-mode .oral-fail-btn.exit-fail:hover { border-color:rgba(192,57,43,0.5); color:rgba(192,57,43,0.8); transform:scale(1.05); }
  }

  body.modern-mode .oral-pass-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); opacity:0; pointer-events:none; transition:none !important; }
  body.modern-mode .oral-pass-overlay.open { display:flex; opacity:1; pointer-events:all; animation:mCenterPop 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .oral-pass-overlay.m-pop-out { display:flex; opacity:1; pointer-events:none; animation:mCenterClose 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .oral-pass-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(46,139,87,0.15); border-radius:18px; box-shadow:none; }
  body.modern-mode .oral-pass-check { border-color:rgba(46,139,87,0.5); }
  body.modern-mode .oral-pass-check svg { stroke:#4ade80; }
  body.modern-mode .oral-pass-title { color:#4ade80; }
  body.modern-mode .oral-pass-stats { color:rgba(255,255,255,0.25); }
  body.modern-mode .oral-pass-btn { background:transparent; border:1px solid rgba(46,139,87,0.3); color:rgba(46,139,87,0.6); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .oral-pass-btn:hover { border-color:rgba(46,139,87,0.6); color:#2e8b57; transform:scale(1.05); box-shadow:0 0 20px rgba(46,139,87,0.1); }
  }

  /* Notes panel modern mode */
  body.modern-mode .notes-panel { top:50%; left:50%; bottom:auto; right:auto; transform:translate(-50%,-50%); transform-origin:center center; width:min(500px,92vw); height:min(600px,80vh); background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; z-index:350; min-width:260px; min-height:180px; opacity:0; pointer-events:none; }
  body.modern-mode .notes-panel.open { opacity:1; pointer-events:all; }
  body.modern-mode .notes-panel.m-pop-in { animation:mPopIn 0.12s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .notes-panel.m-pop-out { animation:mPopOut 0.12s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .notes-panel.np-dragged { transition:none !important; }
  body.modern-mode .notes-panel.np-dragged.open { transform:none !important; }
  body.modern-mode .notes-panel-header { background:rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.06); cursor:grab; user-select:none; }
  body.modern-mode .notes-panel-header:active { cursor:grabbing; }
  body.modern-mode .notes-panel-header h3 { color:rgba(255,255,255,0.6); font-size:0.7rem; pointer-events:none; }
  body.modern-mode .notes-panel-close { color:rgba(255,255,255,0.25); pointer-events:all; }
  @media(hover:hover){
  body.modern-mode .notes-panel-close:hover { color:rgba(255,100,100,0.6); }
  }
  body.modern-mode .notes-panel-body { background:transparent; }
  body.modern-mode .notes-editor { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:12px; color:rgba(255,255,255,0.6); }
  body.modern-mode .notes-editor:focus { background:rgba(255,255,255,0.04); border-color:rgba(255,255,255,0.15); }
  body.modern-mode .notes-panel-body:focus-within .notes-editor { border-color:rgba(255,255,255,0.15); }
  body.modern-mode .notes-editor:empty:before { color:rgba(255,255,255,0.12); }
  body.modern-mode .notes-save-indicator { color:rgba(74,222,128,0.6); }
  body.modern-mode .np-resize-handle { position:absolute; bottom:0; right:0; width:20px; height:20px; cursor:nwse-resize; z-index:5; }
  body.modern-mode .np-resize-handle::after { content:''; position:absolute; bottom:6px; right:6px; width:8px; height:8px; border-right:2px solid rgba(255,255,255,0.1); border-bottom:2px solid rgba(255,255,255,0.1); border-radius:0 0 2px 0; }
  @media(hover:hover){
  body.modern-mode .np-resize-handle:hover::after { border-color:rgba(255,255,255,0.3); }
  }
  /* Lock screen & confirm modern mode */
  body.modern-mode .lock-screen { background:#0f0f0f; }
  body.modern-mode .lock-screen .lock-title { color:rgba(255,255,255,0.55); font-weight:600; letter-spacing:0.18em; font-size:1.4rem; }
  body.modern-mode .lock-screen .lock-subtitle { color:rgba(255,255,255,0.18); letter-spacing:0.14em; }
  body.modern-mode .lock-screen .lock-icon { color:rgba(255,255,255,0.18); }
  body.modern-mode .lock-screen .runway-wrap::before,
  body.modern-mode .lock-screen .runway-wrap::after { background:rgba(255,255,255,0.06); }
  body.modern-mode .lock-screen .cl-dash { background:rgba(255,255,255,0.06); }
  body.modern-mode .lock-screen .thresh-stripe { background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); border-radius:10px; backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); }
  @media(hover:hover){
  body.modern-mode .lock-screen .thresh-stripe:hover { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.1); }
  }
  body.modern-mode .lock-screen .thresh-stripe:focus-within { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.15); box-shadow:0 0 20px rgba(255,255,255,0.03); }
  body.modern-mode .lock-screen .thresh-stripe.error { background:rgba(192,57,43,0.12); border-color:rgba(192,57,43,0.3); }
  body.modern-mode .lock-screen .digit-box { color:rgba(255,255,255,0.6); caret-color:rgba(255,255,255,0.3); -webkit-text-security:disc; text-security:disc; }
  body.modern-mode .lock-screen input { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.6); border-radius:10px; }
  body.modern-mode .lock-screen input:focus { border-color:rgba(255,255,255,0.15); }
  body.modern-mode .lock-screen .lock-error { color:rgba(192,57,43,0.6); }
  body.modern-mode .lock-screen .lock-btn { background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.25); border-radius:10px; backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); }
  @media(hover:hover){
  body.modern-mode .lock-screen .lock-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.55); background:rgba(255,255,255,0.03); transform:scale(1.05); }
  }
  body.modern-mode .lock-screen button { background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.25); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .lock-screen button:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.55); }
  }
  body.modern-mode .lock-screen h2, body.modern-mode .lock-screen label, body.modern-mode .lock-screen p { color:rgba(255,255,255,0.4); }

  /* ── Runway Lights ── */

  /* Edge lights — columns of dots sitting just outside the edge lines */
  .rwy-edge-lights {
    position: absolute;
    top: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
    align-items: center;
    width: 8px;
    z-index: 2;
    pointer-events: none;
  }
  .rwy-edge-left  { left: -12px; }
  .rwy-edge-right { right: -12px; }
  .rwy-elight {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: rgba(255,255,255,0.85);
    box-shadow: 0 0 4px rgba(255,255,255,0.6), 0 0 10px rgba(255,255,255,0.3), 0 0 20px rgba(255,255,255,0.1);
    flex-shrink: 0;
  }

  /* Centerline lights — dots centered on top of the dashes */
  .rwy-cl-lights {
    position: absolute;
    top: 0;
    bottom: calc(120px);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
    align-items: center;
    z-index: 2;
    pointer-events: none;
  }
  .rwy-clight {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 0 4px rgba(255,255,255,0.6), 0 0 10px rgba(255,255,255,0.3), 0 0 20px rgba(255,255,255,0.1);
    flex-shrink: 0;
  }

  /* Green threshold lights — row along the bottom of the threshold strip */
  .rwy-thresh-lights {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    width: calc(100% + 30px);
    margin-left: -15px;
    padding: 20px 0 0;
  }
  .rwy-tlight {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(46,139,87,0.95);
    box-shadow: 0 0 5px rgba(46,139,87,0.7), 0 0 12px rgba(46,139,87,0.4), 0 0 24px rgba(46,139,87,0.15);
    flex-shrink: 0;
  }

  /* Modern mode — dim the lights to match the UI */
  body.modern-mode .rwy-elight {
    background: rgba(255,255,255,0.45);
    box-shadow: 0 0 5px rgba(255,255,255,0.3), 0 0 12px rgba(255,255,255,0.12), 0 0 22px rgba(255,255,255,0.05);
  }
  /* Edge lights fade — subtle dim at top, bright at bottom */
  body.modern-mode .rwy-elight:nth-child(1) { opacity: 0.45; }
  body.modern-mode .rwy-elight:nth-child(2) { opacity: 0.5; }
  body.modern-mode .rwy-elight:nth-child(3) { opacity: 0.58; }
  body.modern-mode .rwy-elight:nth-child(4) { opacity: 0.65; }
  body.modern-mode .rwy-elight:nth-child(5) { opacity: 0.73; }
  body.modern-mode .rwy-elight:nth-child(6) { opacity: 0.82; }
  body.modern-mode .rwy-elight:nth-child(7) { opacity: 0.91; }
  body.modern-mode .rwy-elight:nth-child(8) { opacity: 1; }
  body.modern-mode .rwy-clight {
    background: rgba(255,255,255,0.45);
    box-shadow: 0 0 5px rgba(255,255,255,0.3), 0 0 12px rgba(255,255,255,0.12), 0 0 22px rgba(255,255,255,0.05);
  }
  /* Centerline lights fade — matches edge light brightness at same height */
  body.modern-mode .rwy-clight:nth-child(1) { opacity: 0.45; }
  body.modern-mode .rwy-clight:nth-child(2) { opacity: 0.48; }
  body.modern-mode .rwy-clight:nth-child(3) { opacity: 0.53; }
  body.modern-mode .rwy-clight:nth-child(4) { opacity: 0.58; }
  body.modern-mode .rwy-clight:nth-child(5) { opacity: 0.65; }
  body.modern-mode .rwy-clight:nth-child(6) { opacity: 0.73; }
  body.modern-mode .rwy-tlight {
    background: rgba(74,222,128,0.65);
    box-shadow: 0 0 6px rgba(74,222,128,0.4), 0 0 14px rgba(74,222,128,0.2), 0 0 28px rgba(74,222,128,0.08);
  }

  /* ── Lock Screen Responsive Scaling ── */
  @media(min-width:1200px) {
    body.modern-mode .lock-screen .lock-title { font-size: 1.8rem; }
    body.modern-mode .lock-screen .lock-subtitle { font-size: 0.68rem; }
    body.modern-mode .lock-screen .runway-wrap { width: min(560px, 92vw); padding: 0 18px; }
    body.modern-mode .lock-screen .runway-wrap::before,
    body.modern-mode .lock-screen .runway-wrap::after { width: 12px; }
    body.modern-mode .lock-screen .cl-dash { width: 12px; height: 34px; }
    body.modern-mode .lock-screen .threshold-strip { height: 150px; }
    body.modern-mode .lock-screen .digit-box { font-size: 1.8rem; }
    body.modern-mode .lock-screen .lock-btn { font-size: 0.72rem; padding: 0.6rem 3.2rem; }
    body.modern-mode .lock-screen .lock-error { font-size: 0.65rem; }
    body.modern-mode .rwy-elight { width: 6px; height: 6px; }
    body.modern-mode .rwy-clight { width: 6px; height: 6px; }
    body.modern-mode .rwy-tlight { width: 7px; height: 7px; }
    body.modern-mode .rwy-edge-left { left: -14px; }
    body.modern-mode .rwy-edge-right { right: -14px; }
  }
  @media(min-width:1600px) {
    body.modern-mode .lock-screen .lock-title { font-size: 2.2rem; }
    body.modern-mode .lock-screen .lock-subtitle { font-size: 0.78rem; }
    body.modern-mode .lock-screen .runway-wrap { width: min(680px, 92vw); padding: 0 22px; }
    body.modern-mode .lock-screen .runway-wrap::before,
    body.modern-mode .lock-screen .runway-wrap::after { width: 14px; }
    body.modern-mode .lock-screen .cl-dash { width: 14px; height: 40px; }
    body.modern-mode .lock-screen .runway-centerline { gap: 14px; }
    body.modern-mode .lock-screen .threshold-strip { height: 180px; gap: 7px; }
    body.modern-mode .lock-screen .digit-box { font-size: 2.1rem; }
    body.modern-mode .lock-screen .lock-btn { font-size: 0.78rem; padding: 0.7rem 3.6rem; }
    body.modern-mode .lock-screen .lock-error { font-size: 0.7rem; }
    body.modern-mode .rwy-elight { width: 7px; height: 7px; }
    body.modern-mode .rwy-clight { width: 7px; height: 7px; }
    body.modern-mode .rwy-tlight { width: 8px; height: 8px; }
    body.modern-mode .rwy-edge-left { left: -16px; }
    body.modern-mode .rwy-edge-right { right: -16px; }
    body.modern-mode .rwy-thresh-lights { width: calc(100% + 40px); margin-left: -20px; }
  }
  @media(min-width:2000px) {
    body.modern-mode .lock-screen .lock-title { font-size: 2.6rem; }
    body.modern-mode .lock-screen .lock-subtitle { font-size: 0.88rem; }
    body.modern-mode .lock-screen .runway-wrap { width: min(800px, 92vw); padding: 0 26px; }
    body.modern-mode .lock-screen .runway-wrap::before,
    body.modern-mode .lock-screen .runway-wrap::after { width: 16px; }
    body.modern-mode .lock-screen .cl-dash { width: 16px; height: 46px; }
    body.modern-mode .lock-screen .runway-centerline { gap: 18px; }
    body.modern-mode .lock-screen .threshold-strip { height: 210px; gap: 8px; }
    body.modern-mode .lock-screen .thresh-stripe { border-radius: 12px; }
    body.modern-mode .lock-screen .digit-box { font-size: 2.4rem; }
    body.modern-mode .lock-screen .lock-btn { font-size: 0.85rem; padding: 0.8rem 4rem; border-radius: 12px; }
    body.modern-mode .lock-screen .lock-error { font-size: 0.75rem; }
    body.modern-mode .rwy-elight { width: 8px; height: 8px; }
    body.modern-mode .rwy-clight { width: 8px; height: 8px; }
    body.modern-mode .rwy-tlight { width: 9px; height: 9px; }
    body.modern-mode .rwy-edge-left { left: -18px; }
    body.modern-mode .rwy-edge-right { right: -18px; }
    body.modern-mode .rwy-thresh-lights { width: calc(100% + 50px); margin-left: -25px; }
  }

  body.modern-mode .lock-confirm-overlay { background:rgba(0,0,0,0.6); opacity:0; pointer-events:none; transition:none !important; }
  body.modern-mode .lock-confirm-overlay.open { opacity:1; pointer-events:all; animation:mCenterPop 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .lock-confirm-overlay.m-pop-out { opacity:1; pointer-events:none; animation:mCenterClose 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .lock-confirm-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:16px; box-shadow:none; }
  body.modern-mode .lock-confirm-title { color:rgba(255,255,255,0.7); }
  body.modern-mode .lock-confirm-yes { background:transparent; border:1px solid rgba(192,57,43,0.3); color:rgba(192,57,43,0.6); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .lock-confirm-yes:hover { border-color:rgba(192,57,43,0.6); color:rgba(192,57,43,0.9); }
  }
  body.modern-mode .lock-confirm-no { background:transparent; border:1px solid rgba(255,255,255,0.04); color:rgba(255,255,255,0.2); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .lock-confirm-no:hover { border-color:rgba(255,255,255,0.1); color:rgba(255,255,255,0.4); }
  }
  body.modern-mode .lock-confirm-change-pw { background:transparent; border:1px solid rgba(255,255,255,0.04); color:rgba(255,255,255,0.2); border-radius:10px; font-family:'Barlow Condensed',sans-serif; font-size:0.58rem; letter-spacing:0.1em; text-transform:uppercase; padding:0.45rem 1rem; cursor:pointer; transition:all 0.2s; margin-top:0.3rem; width:100%; font-weight:600; }
  @media(hover:hover){
  body.modern-mode .lock-confirm-change-pw:hover { border-color:rgba(255,255,255,0.12); color:rgba(255,255,255,0.45); transform:scale(1.03); }
  }

  /* ── Modern Export / Import / Paste Modals ── */
  body.modern-mode .xfer-modal-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); }
  body.modern-mode .xfer-modal-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; }
  body.modern-mode .xfer-modal-title { color:rgba(255,255,255,0.7); }
  body.modern-mode .xfer-modal-subtitle { color:rgba(255,255,255,0.25); }
  body.modern-mode .xfer-modal-close { color:rgba(255,255,255,0.2); }
  @media(hover:hover){
  body.modern-mode .xfer-modal-close:hover { color:rgba(255,255,255,0.6); }
  }
  body.modern-mode .xfer-divider { border-color:rgba(255,255,255,0.06); }
  body.modern-mode .xfer-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .xfer-btn:hover { border-color:rgba(255,255,255,0.18); color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.03); }
  }
  body.modern-mode .xfer-btn svg { opacity:0.5; }
  @media(hover:hover){
  body.modern-mode .xfer-btn:hover svg { opacity:0.8; }
  }
  body.modern-mode .xfer-btn-primary { border-color:rgba(255,255,255,0.1); }
  body.modern-mode .xfer-btn-secondary { border-color:rgba(255,255,255,0.06); }
  body.modern-mode .xfer-status { color:rgba(255,255,255,0.3); }

  body.modern-mode .paste-modal-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); }
  body.modern-mode .paste-modal-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; }
  body.modern-mode .paste-modal-title { color:rgba(255,255,255,0.7); }
  body.modern-mode .paste-modal-subtitle { color:rgba(255,255,255,0.25); }
  body.modern-mode .paste-modal-close { color:rgba(255,255,255,0.2); }
  @media(hover:hover){
  body.modern-mode .paste-modal-close:hover { color:rgba(255,255,255,0.6); }
  }
  body.modern-mode .paste-modal-textarea { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.7); border-radius:12px; }
  body.modern-mode .paste-modal-textarea:focus { border-color:rgba(255,255,255,0.18); background:rgba(255,255,255,0.05); }
  body.modern-mode .paste-modal-textarea::placeholder { color:rgba(255,255,255,0.15); }
  body.modern-mode .paste-modal-btns .xfer-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .paste-modal-btns .xfer-btn:hover { border-color:rgba(255,255,255,0.18); color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.03); }
  }

  /* ── Modern Change Passcode Modal ── */
  body.modern-mode .modal-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); }
  body.modern-mode .modal-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; }
  body.modern-mode .modal-title { color:rgba(255,255,255,0.7); }
  body.modern-mode .modal-label { color:rgba(255,255,255,0.25); }
  body.modern-mode .modal-input { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.7); border-radius:10px; }
  body.modern-mode .modal-input:focus { border-color:rgba(255,255,255,0.2); background:rgba(255,255,255,0.05); }
  body.modern-mode .modal-input::placeholder { color:rgba(255,255,255,0.15); }
  body.modern-mode .modal-error { color:rgba(192,57,43,0.7); }
  body.modern-mode .modal-btn-save { background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .modal-btn-save:hover { border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.7); }
  }
  body.modern-mode .modal-btn-cancel { background:transparent; border:1px solid rgba(255,255,255,0.04); color:rgba(255,255,255,0.2); border-radius:10px; }
  @media(hover:hover){
  body.modern-mode .modal-btn-cancel:hover { border-color:rgba(255,255,255,0.1); color:rgba(255,255,255,0.4); }
  }

  /* ── Modern Study Picker Popup ── */
  body.modern-mode .study-picker-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); opacity:0; pointer-events:none; transition:none !important; }
  body.modern-mode .study-picker-overlay.open { opacity:1; pointer-events:all; animation:mCenterPop 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  body.modern-mode .study-picker-overlay.m-pop-out { opacity:1; pointer-events:none; animation:mCenterClose 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  body.modern-mode .study-picker-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; }
  body.modern-mode .study-picker-title { color:rgba(255,255,255,0.6); }
  body.modern-mode .study-picker-dot { opacity:0.3; border-width:2.5px; }
  @media(hover:hover){
  body.modern-mode .study-picker-dot:hover { opacity:0.6; }
  }
  body.modern-mode .study-picker-dot.selected { opacity:1; }
  body.modern-mode .study-picker-dot.green { border-color:#2e8b57; }
  body.modern-mode .study-picker-dot.yellow { border-color:#d4a017; }
  body.modern-mode .study-picker-dot.red { border-color:#c0392b; }
  body.modern-mode .study-picker-dot.selected.green { background:#2e8b57; box-shadow:0 0 12px rgba(46,139,87,0.4); }
  body.modern-mode .study-picker-dot.selected.yellow { background:#d4a017; box-shadow:0 0 12px rgba(212,160,23,0.4); }
  body.modern-mode .study-picker-dot.selected.red { background:#c0392b; box-shadow:0 0 12px rgba(192,57,43,0.4); }
  body.modern-mode .study-picker-go { background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .study-picker-go:hover { border-color:rgba(255,255,255,0.18); color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.03); }
  }
  body.modern-mode .study-picker-cancel { background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.25); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .study-picker-cancel:hover { border-color:rgba(255,255,255,0.12); color:rgba(255,255,255,0.45); background:rgba(255,255,255,0.02); }
  }

  /* ── Modern Study Mode Overlay ── */
  body.modern-mode .study-mode-overlay { background:#0f0f0f; }
  body.modern-mode .study-mode-header { background:rgba(255,255,255,0.03); border-bottom:1px solid rgba(255,255,255,0.06); }
  body.modern-mode .study-mode-title { color:rgba(255,255,255,0.6); }
  body.modern-mode .study-mode-count { color:rgba(255,255,255,0.2); }
  body.modern-mode .study-mode-close { color:rgba(255,255,255,0.2); }
  @media(hover:hover){
  body.modern-mode .study-mode-close:hover { color:rgba(255,255,255,0.6); }
  }
  body.modern-mode .study-mode-btn.reveal-btn { border-color:rgba(46,139,87,0.3); color:rgba(46,139,87,0.5); }
  @media(hover:hover){
  body.modern-mode .study-mode-btn.reveal-btn:hover { border-color:rgba(46,139,87,0.6); color:#2e8b57; }
  }
  body.modern-mode .study-mode-btn.exit-btn { border-color:rgba(192,57,43,0.3); color:rgba(192,57,43,0.5); }
  @media(hover:hover){
  body.modern-mode .study-mode-btn.exit-btn:hover { border-color:rgba(192,57,43,0.6); color:#c0392b; }
  }
  body.modern-mode .study-mode-body { background:transparent; scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.08) transparent; }
  body.modern-mode .study-item { background:transparent; border:1px solid rgba(255,255,255,0.04); border-radius:14px; }
  body.modern-mode .study-item-code { color:rgba(255,255,255,0.25); }
  body.modern-mode .study-item-title { color:rgba(255,255,255,0.6); }
  body.modern-mode .study-item-title.conf-green { background:transparent; color:#2e8b57; }
  body.modern-mode .study-item-title.conf-yellow { background:transparent; color:#d4a017; }
  body.modern-mode .study-item-title.conf-red { background:transparent; color:#c0392b; }
  body.modern-mode .study-item-label { color:rgba(255,255,255,0.2); }
  body.modern-mode .study-item-content { background:transparent !important; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.6); border-radius:10px; }
  body.modern-mode .study-item-content, body.modern-mode .study-item-content * { color:rgba(255,255,255,0.6) !important; }
  @media(hover:hover){
  body.modern-mode .study-item-content:hover { border-color:rgba(255,255,255,0.1); }
  }
  body.modern-mode .study-item-content:focus { border-color:rgba(46,139,87,0.4) !important; background:transparent !important; color:rgba(255,255,255,0.6) !important; box-shadow:0 0 0 1px rgba(46,139,87,0.15) !important; outline:none !important; }
  body.modern-mode .study-item-content.is-editing { background:transparent !important; }
  body.modern-mode .study-item-content.hidden-content { background:transparent !important; border-color:rgba(255,255,255,0.06); color:transparent !important; }
  body.modern-mode .study-item-content.hidden-content * { color:transparent !important; opacity:0; }
  body.modern-mode .study-item-content.hidden-content::after { color:rgba(255,255,255,0.15); }
  @media(hover:hover){
  body.modern-mode .study-item-content.hidden-content:hover::after { color:rgba(255,255,255,0.3); }
  body.modern-mode .study-item-content.hidden-content:hover { border-color:rgba(255,255,255,0.1); }
  }
  body.modern-mode .study-conf-dot { opacity:0.3; }
  @media(hover:hover){
  body.modern-mode .study-conf-dot:hover { opacity:0.6; }
  }
  body.modern-mode .study-conf-dot.active { opacity:1; }
  body.modern-mode .study-conf-dot.active.green { box-shadow:0 0 8px rgba(46,139,87,0.35); }
  body.modern-mode .study-conf-dot.active.yellow { box-shadow:0 0 8px rgba(212,160,23,0.35); }
  body.modern-mode .study-conf-dot.active.red { box-shadow:0 0 8px rgba(192,57,43,0.35); }
  body.modern-mode .study-edit-btn { color:rgba(255,255,255,0.15); }
  @media(hover:hover){
  body.modern-mode .study-edit-btn:hover { color:rgba(255,255,255,0.4); }
  }
  body.modern-mode .study-mode-overlay .editor-toolbar { background:transparent !important; border:1px solid rgba(255,255,255,0.06) !important; border-radius:8px !important; }
  body.modern-mode .study-mode-overlay .editor-toolbar button { color:rgba(255,255,255,0.35) !important; background:transparent !important; border:none !important; }
  body.modern-mode .study-mode-overlay .study-item-content *, body.modern-mode .study-mode-overlay .rich-editor * { color:rgba(255,255,255,0.6) !important; }
  @media(hover:hover){
  body.modern-mode .study-mode-overlay .editor-toolbar button:hover { color:rgba(255,255,255,0.7) !important; }
  }
  body.modern-mode .study-mode-overlay .editor-toolbar .fmt-active { color:rgba(255,255,255,0.8) !important; }
  body.modern-mode .study-empty { color:rgba(255,255,255,0.2); }

  @media(max-width:700px) {
    .study-mode-header { padding:0.8rem 1rem; gap:0.5rem; flex-wrap:nowrap; }
    .study-mode-title { font-size:0.72rem; gap:0.4rem; white-space:nowrap; flex-shrink:0; }
    .study-mode-dot-indicators { gap:0.3rem; }
    .study-mode-indicator { width:11px; height:11px; }
    .study-mode-controls { gap:0.4rem; flex-wrap:nowrap; align-items:center; }
    .study-mode-count { font-size:0.56rem; white-space:nowrap; }
    .study-mode-btn { font-size:0.52rem; padding:0.35rem 0.65rem; white-space:nowrap; }
  }

  /* ── Modern Study Exit Changes Popup ── */
  body.modern-mode .study-exit-overlay { background:rgba(0,0,0,0.6); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); }
  body.modern-mode .study-exit-card { background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; box-shadow:none; }
  body.modern-mode .study-exit-title { color:rgba(255,255,255,0.6); }
  body.modern-mode .study-exit-list { scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.08) transparent; }
  body.modern-mode .study-exit-item { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); border-radius:10px; }
  body.modern-mode .study-exit-item-code { color:rgba(255,255,255,0.3); }
  body.modern-mode .study-exit-item-action { color:rgba(255,255,255,0.4); }
  body.modern-mode .study-exit-item-title { color:rgba(255,255,255,0.2); }
  body.modern-mode .study-exit-btn.confirm-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); color:rgba(255,255,255,0.4); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .study-exit-btn.confirm-btn:hover { border-color:rgba(255,255,255,0.18); color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.03); }
  }
  body.modern-mode .study-exit-btn.cancel-btn { background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.25); border-radius:12px; }
  @media(hover:hover){
  body.modern-mode .study-exit-btn.cancel-btn:hover { border-color:rgba(255,255,255,0.12); color:rgba(255,255,255,0.45); background:rgba(255,255,255,0.02); }
  }

  .m-toolbar .m-fab-menu { position:absolute; top:100%; left:50%; transform:translateX(-50%) scale(0); transform-origin:top center; margin-top:6px; }
  .m-toolbar .m-fab-menu.open { transform:translateX(-50%) scale(1); }
  .m-ghost { display:none; text-align:center; padding:0.6rem 1rem 0; pointer-events:none; user-select:none; overflow:hidden; }
  .m-ghost-main { font-family:'Barlow',sans-serif; font-weight:700; font-size:clamp(1.4rem,3.5vw,2.4rem); color:rgba(255,255,255,0.15); text-transform:uppercase; letter-spacing:0.08em; line-height:1; transition:color 0.4s; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:90vw; margin:0 auto; }
  .m-ghost-sub { font-family:'Barlow Condensed',sans-serif; font-size:0.48rem; letter-spacing:0.18em; text-transform:uppercase; color:rgba(255,255,255,0.25); margin-top:0.25rem; }
  .m-viewport { display:none; position:relative; width:100%; height:calc(100vh - 140px); overflow:visible; }
  .m-track { display:flex; align-items:center; height:100%; cursor:grab; position:relative; z-index:10; }
  .m-track.m-anim { transition:transform 0.22s cubic-bezier(0.25,1,0.5,1); }
  .m-track.m-dragging { cursor:grabbing; }
  .m-card { flex-shrink:0; width:min(400px,82vw); height:min(500px,68vh); margin:0 -60px; background:rgba(255,255,255,0.04); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.12); border-radius:20px; box-shadow:none; display:flex; flex-direction:column; overflow:hidden; transition:transform 0.5s cubic-bezier(0.32,0.72,0,1),border-color 0.5s,box-shadow 0.5s,opacity 0.15s,filter 0.15s; position:relative; cursor:pointer; }
  @media(max-width:700px){ .m-card { margin:0 -30px; } }
  .m-card::after { display:none; }
  .m-card.m-active { transform:scale(1.08); border-color:rgba(255,255,255,0.15); box-shadow:none; z-index:10; opacity:1 !important; background:rgba(18,18,18,0.98); }
  .m-card.m-bookmarked { border-color:rgba(217,95,26,0.4); }
  .m-card.m-bookmarked .m-card-head { border-bottom-color:rgba(217,95,26,0.15); }
  .m-card.m-bookmarked::after { content:''; position:absolute; top:8px; right:8px; width:8px; height:8px; background:#d95f1a; border-radius:50%; }
  .m-task-row.m-task-bookmarked { border-color:rgba(217,95,26,0.4); }
  
  .m-card.m-adj { transform:scale(0.88) translateY(10px); backdrop-filter:none; -webkit-backdrop-filter:none; pointer-events:none; opacity:0.65; z-index:5; background:#0f0f0f; border-color:rgba(255,255,255,0.06); }
  .m-card.m-adj .m-card-title { color:rgba(255,255,255,0.45); }
  .m-card.m-adj .m-card-roman { opacity:0.6; }
  .m-card.m-adj .m-task-title { color:rgba(255,255,255,0.3); }
  .m-card.m-adj .m-task-id { color:rgba(255,255,255,0.08); }
  .m-card.m-adj .m-card-count { color:rgba(255,255,255,0.08); }
  
  .m-card.m-far { transform:scale(0.78) translateY(18px); backdrop-filter:none; -webkit-backdrop-filter:none; pointer-events:none; opacity:0.4; z-index:4; background:#0f0f0f; border-color:rgba(255,255,255,0.04); }
  .m-card.m-far .m-card-title { color:rgba(255,255,255,0.25); }
  .m-card.m-far .m-card-roman { opacity:0.35; }
  .m-card.m-far .m-task-title { color:rgba(255,255,255,0.15); }
  .m-card.m-far .m-task-id { color:rgba(255,255,255,0.05); }
  .m-card.m-far .m-card-count { color:rgba(255,255,255,0.05); }
  .m-card.m-far2 { transform:scale(0.74) translateY(22px); backdrop-filter:none; -webkit-backdrop-filter:none; pointer-events:none; opacity:0.2; z-index:3; background:rgba(15,15,15,1); border-color:rgba(255,255,255,0.02); }
  .m-card.m-far2 .m-card-title { color:rgba(255,255,255,0.12); }
  .m-card.m-far2 .m-card-roman { opacity:0.2; }
  .m-card.m-far2 .m-task-title { color:rgba(255,255,255,0.07); }
  .m-card.m-far2 .m-task-id, .m-card.m-far2 .m-card-count { color:transparent; }
  .m-card.m-far3 { transform:scale(0.70) translateY(26px); backdrop-filter:none; -webkit-backdrop-filter:none; pointer-events:none; opacity:0.08; z-index:2; background:rgba(15,15,15,1); border-color:rgba(255,255,255,0.01); }
  .m-card.m-far3 .m-card-title { color:rgba(255,255,255,0.06); }
  .m-card.m-far3 .m-card-roman { opacity:0.1; }
  .m-card.m-far3 .m-task-title, .m-card.m-far3 .m-task-id, .m-card.m-far3 .m-card-count { color:transparent; }
  
  .m-card-head { padding:1.6rem 1.5rem 1.1rem; flex-shrink:0;}
  .m-card-head::after { content:''; position:absolute; bottom:0; left:1.2rem; right:1.2rem; height:1px; background:linear-gradient(90deg,transparent,rgba(255,255,255,0.08),transparent); }
  .m-card-roman { font-family:'Barlow',sans-serif; font-weight:700; font-size:2rem; color:rgba(255,255,255,0.08); line-height:1; margin-bottom:0.35rem; }
  .m-card-title { font-family:'Barlow',sans-serif; font-weight:600; font-size:0.85rem; color:rgba(255,255,255,0.8); line-height:1.35; }
  .m-card-count { font-family:'Barlow Condensed',sans-serif; font-size:0.52rem; letter-spacing:0.12em; text-transform:uppercase; color:rgba(255,255,255,0.18); margin-top:0.45rem; }
  .m-card-body { flex:1; overflow-y:auto; padding:0.8rem 1.2rem 1rem; scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.04) transparent; }
  .m-card-body::-webkit-scrollbar { width:3px; }
  .m-card-body::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.7); border-radius:2px; }
  .m-task-row { padding:0.55rem 0.7rem; border:1px solid rgba(255,255,255,0.04); border-radius:10px; margin-bottom:0.35rem; background:rgba(255,255,255,0.02); cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.5rem; }
  @media(hover:hover){
  .m-task-row:hover { background:transparent; border-color:rgba(255,255,255,0.12); transform:scale(1.02); box-shadow:0 0 12px rgba(255,255,255,0.03); }
  }
  .m-task-id { font-family:'Barlow Condensed',sans-serif; font-size:0.5rem; font-weight:600; letter-spacing:0.06em; color:rgba(255,255,255,0.15); white-space:nowrap; }
  .m-task-title { font-size:0.72rem; color:rgba(255,255,255,0.55); font-weight:300; line-height:1.35; flex:1; }
  .m-task-arrow { color:rgba(255,255,255,0.06); font-size:0.65rem; flex-shrink:0; transition:all 0.2s; }
  @media(hover:hover){
  .m-task-row:hover .m-task-arrow { color:rgba(255,255,255,0.25); transform:translateX(2px); }
  }
  .m-card-prog { padding:0.7rem 1.3rem; flex-shrink:0; display:flex; flex-direction:column; gap:0.25rem; }
  .m-prog-bar-wrap { display:flex; align-items:center; gap:0.35rem; }
  .m-prog-track { flex:1; height:3px; background:transparent; border-radius:2px; overflow:hidden; }
  .m-prog-fill-green { height:100%; border-radius:2px; background:#2e8b57; transition:width 0.4s; }
  .m-prog-fill-yellow { height:100%; border-radius:2px; background:#d4a017; transition:width 0.4s; }
  .m-prog-fill-red { height:100%; border-radius:2px; background:#c0392b; transition:width 0.4s; }
  .m-prog-count { font-family:'Barlow Condensed',sans-serif; font-size:0.42rem; letter-spacing:0.04em; min-width:12px; text-align:left; order:-1; }
  .m-prog-count-green { color:rgba(46,139,87,0.6); }
  .m-prog-count-yellow { color:rgba(212,160,23,0.6); }
  .m-prog-count-red { color:rgba(192,57,43,0.6); }
  .m-dots { position:absolute; bottom:1.8rem; left:50%; transform:translateX(-50%); display:flex; gap:5px; align-items:center; z-index:60; padding:0.45rem 0.9rem; background:rgba(255,255,255,0.03); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-radius:20px; border:1px solid rgba(255,255,255,0.06); }
  .m-dot { width:5px; height:5px; border-radius:50%; background:rgba(255,255,255,0.06); cursor:pointer; transition:all 0.3s cubic-bezier(0.32,0.72,0,1); }
  @media(hover:hover){
  .m-dot:hover { background:rgba(255,255,255,0.25); transform:scale(1.5); }
  }
  .m-dot.m-dot-on { background:rgba(255,255,255,0.7); width:16px; border-radius:3px; box-shadow:0 0 8px rgba(255,255,255,0.15); }
  .m-nav { position:absolute; top:50%; transform:translateY(-50%); z-index:60; width:auto; height:auto; display:flex; align-items:center; justify-content:center; background:none; border:none; cursor:pointer; color:rgba(255,255,255,0.3); transition:all 0.25s; user-select:none; padding:0; }
  @media(hover:hover){
  .m-nav:hover { color:rgba(255,255,255,0.6); transform:translateY(-50%) scale(1.12); background:none; border:none; }
  }
  .m-nav:active { transform:translateY(-50%) scale(0.9); }
  .m-nav .m-nav-svg { width:36px; height:36px; }
  .m-nav.m-nav-l { left:1.2rem; }
  .m-nav.m-nav-r { right:1.2rem; }
  .m-nav.m-nav-off { opacity:0.15; pointer-events:none; }
  .m-expanded { display:none; position:fixed; inset:0; background:#0f0f0f; backdrop-filter:none; -webkit-backdrop-filter:none; z-index:200; flex-direction:column; }
  .m-expanded.m-exp-open { display:flex; animation:mExpand 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }
  .m-expanded.m-exp-closing { animation:mCollapse 0.25s cubic-bezier(0.55,0,1,0.45) forwards; }
  @keyframes mExpand {
    0% { opacity:0; clip-path:inset(var(--exp-t,40%) var(--exp-r,30%) var(--exp-b,40%) var(--exp-l,30%) round 16px); }
    100% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
  }
  @keyframes mCollapse {
    0% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
    100% { opacity:0; clip-path:inset(var(--exp-t,40%) var(--exp-r,30%) var(--exp-b,40%) var(--exp-l,30%) round 16px); }
  }
  /* Shared popup expand animation for centered modals/dialogs */
  @keyframes mPopIn {
    0% { opacity:0; clip-path:inset(var(--exp-t,35%) var(--exp-r,25%) var(--exp-b,35%) var(--exp-l,25%) round 18px); }
    100% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
  }
  @keyframes mPopOut {
    0% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
    100% { opacity:0; clip-path:inset(var(--exp-t,35%) var(--exp-r,25%) var(--exp-b,35%) var(--exp-l,25%) round 18px); }
  }
  .m-pop-in { animation:mPopIn 0.32s cubic-bezier(0.16,1,0.3,1) forwards; }
  .m-pop-out { animation:mPopOut 0.22s cubic-bezier(0.55,0,1,0.45) forwards; }
  @keyframes mCenterPop {
    0% { opacity:0; clip-path:inset(40% 40% 40% 40% round 18px); }
    100% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
  }
  @keyframes mCenterClose {
    0% { opacity:1; clip-path:inset(0% 0% 0% 0% round 0px); }
    100% { opacity:0; clip-path:inset(40% 40% 40% 40% round 18px); }
  }
  .m-exp-head { padding:0.9rem 1.5rem; display:flex; align-items:center; justify-content:space-between; flex-shrink:0; border-bottom:1px solid rgba(255,255,255,0.06); }
  .m-exp-title-grp { display:flex; align-items:baseline; gap:0.6rem; }
  .m-exp-roman { font-family:'Barlow',sans-serif; font-weight:700; font-size:0.85rem; color:rgba(255,255,255,0.18); }
  .m-exp-title { font-family:'Barlow',sans-serif; font-weight:700; font-size:0.78rem; letter-spacing:0.05em; text-transform:uppercase; color:rgba(255,255,255,0.8); }
  .m-exp-close { background:none; border:1px solid rgba(255,255,255,0.1); color:rgba(255,255,255,0.25); width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:0.85rem; transition:all 0.2s; }
  @media(hover:hover){
  .m-exp-close:hover { border-color:rgba(255,100,100,0.3); color:rgba(255,100,100,0.6); }
  }
  .m-exp-body { flex:1; overflow-y:auto; padding:1rem 1.2rem 2rem; }
  .m-exp-body::-webkit-scrollbar { width:4px; }
  .m-exp-fab { position:absolute; bottom:1.2rem; right:1.2rem; z-index:210; background:rgba(255,255,255,0.04); backdrop-filter:blur(30px); -webkit-backdrop-filter:blur(30px); border:1px solid rgba(255,255,255,0.08); border-radius:20px; padding:0.5rem 0.9rem; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.25s; color:rgba(255,255,255,0.35); }
  @media(hover:hover){
  .m-exp-fab:hover { border-color:rgba(255,255,255,0.18); color:rgba(255,255,255,0.6); transform:scale(1.05); box-shadow:0 4px 20px rgba(0,0,0,0.3); }
  }
  .m-exp-fab svg { width:14px; height:14px; }
  .m-exp-fab-drop { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(20,20,20,0.97); backdrop-filter:blur(40px); -webkit-backdrop-filter:blur(40px); border:1px solid rgba(255,255,255,0.06); border-radius:18px; padding:1.2rem; display:none; min-width:320px; box-shadow:none; z-index:300; }
  .m-exp-fab-drop.open { display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; animation:mCenterPop 0.25s cubic-bezier(0.16,1,0.3,1) forwards; }
  .m-exp-fab-drop.m-pop-out { display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; animation:mCenterClose 0.18s cubic-bezier(0.55,0,1,0.45) forwards; }
  .m-exp-fab-drop .m-fab-item { padding:0.7rem 0.8rem; font-size:0.58rem; }
  .m-exp-fab-scrim { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:299; display:none; }
  .m-exp-fab-scrim.open { display:block; animation:mCenterPop 0.25s cubic-bezier(0.16,1,0.3,1) forwards; }
  .m-exp-fab-scrim.m-pop-out { display:block; animation:mCenterClose 0.18s cubic-bezier(0.55,0,1,0.45) forwards; }
  .m-exp-body::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.06); border-radius:2px; }
  .m-exp-body * { background-color:transparent !important; color:rgba(255,255,255,0.6) !important; border-color:rgba(255,255,255,0.06) !important; }
  .m-exp-body .task, .m-exp-body .area { margin:0 !important; box-shadow:none !important; }
  .m-exp-body .task-header, .m-exp-body .area-header { display:none !important; }
  .m-exp-body .area-body, .m-exp-body .task-body { display:block !important; max-height:none !important; visibility:visible !important; overflow:visible !important; }
  .m-exp-body .section-body { transition:none !important; }
  .m-exp-body .section-body.hidden { max-height:0 !important; overflow:hidden !important; visibility:hidden !important; padding:0 !important; margin:0 !important; display:none !important; }
  .m-exp-body .section-wrapper { border:none !important; margin-bottom:0.3rem !important; }
  .m-exp-body .section-label { background-color:rgba(255,255,255,0.04) !important; color:rgba(255,255,255,0.35) !important; font-size:0.55rem !important; letter-spacing:0.12em !important; border-radius:8px !important; margin-bottom:0 !important; cursor:pointer !important; pointer-events:auto !important; backdrop-filter:blur(20px) !important; -webkit-backdrop-filter:blur(20px) !important; }
  @media(hover:hover){
  .m-exp-body .section-label:hover { background-color:rgba(255,255,255,0.06) !important; color:rgba(255,255,255,0.6) !important; transform:none !important; }
  }
  .m-exp-body .section-chevron { color:rgba(255,255,255,0.15) !important; }
  .m-exp-body .rich-editor, .m-exp-body .rich-editor.task-summary-editor { background-color:transparent !important; border:1px solid rgba(255,255,255,0.06) !important; border-radius:10px !important; color:rgba(255,255,255,0.6) !important; }
  .m-exp-body .rich-editor:focus { background-color:transparent !important; border-color:rgba(46,139,87,0.4) !important; box-shadow:0 0 0 1px rgba(46,139,87,0.15) !important; outline:none !important; }
  .m-exp-body .rich-editor[data-placeholder]:empty:before { color:rgba(255,255,255,0.1) !important; }
  .m-exp-body .editor-toolbar { background:transparent !important; border-color:rgba(255,255,255,0.06) !important; border-radius:8px !important; display:none; }
  .m-exp-body .editor-outer.toolbar-active .editor-toolbar { display:flex !important; }
  .m-exp-body .editor-toolbar button { color:rgba(255,255,255,0.35) !important; }
  @media(hover:hover){
  .m-exp-body .editor-toolbar button:hover { color:rgba(255,255,255,0.7) !important; }
  }
  .m-exp-body .editor-toolbar .fmt-active { color:rgba(255,255,255,0.8) !important; outline-color:rgba(255,255,255,0.2) !important; }
  .m-exp-body .field-edit-btn { color:rgba(255,255,255,0.2) !important; }
  @media(hover:hover){
  .m-exp-body .field-edit-btn:hover { color:rgba(255,255,255,0.5) !important; }
  }
  .m-exp-body .item-code { color:rgba(255,255,255,0.18) !important; }
  .m-exp-body .item.is-bookmarked { outline:1px solid rgba(217,95,26,0.6) !important; outline-offset:2px; background:rgba(217,95,26,0.05) !important; border-radius:6px; }
  .m-exp-body .item.is-bookmarked .item-code { color:#d95f1a !important; }
  .m-exp-body .section-label.bookmark-highlight { outline:1px solid rgba(217,95,26,0.4) !important; outline-offset:-2px; }
  .m-exp-body .task-header.bookmark-highlight { outline:1px solid rgba(217,95,26,0.4) !important; outline-offset:-2px; }
  .m-exp-body .field-label { color:rgba(255,255,255,0.15) !important; font-size:0.48rem !important; }
  .m-exp-body .field-label.populated { color:rgba(255,255,255,0.25) !important; }
  .m-exp-body .item-title.conf-green { color:#4ade80 !important; }
  .m-exp-body .item-title.conf-yellow { color:#fbbf24 !important; }
  .m-exp-body .item-title.conf-red { color:#f87171 !important; }
  .m-exp-body .conf-dot { border-color:rgba(255,255,255,0.15) !important; background-color:transparent !important; }
  .m-exp-body .conf-dot.green { border-color:rgba(74,222,128,0.35) !important; }
  .m-exp-body .conf-dot.yellow { border-color:rgba(251,191,36,0.35) !important; }
  .m-exp-body .conf-dot.red { border-color:rgba(248,113,113,0.35) !important; }
  .m-exp-body .conf-dot.green.active { background-color:#4ade80 !important; border-color:#4ade80 !important; }
  .m-exp-body .conf-dot.yellow.active { background-color:#fbbf24 !important; border-color:#fbbf24 !important; }
  .m-exp-body .conf-dot.red.active { background-color:#f87171 !important; border-color:#f87171 !important; }
  .m-exp-body .task-summary-label { color:rgba(255,255,255,0.25) !important; font-size:0.5rem !important; }
  .m-exp-body .reveal-placeholder { background:transparent !important; border:1px solid rgba(255,255,255,0.06) !important; border-radius:10px !important; color:rgba(255,255,255,0.15) !important; }
  @media(hover:hover){
  .m-exp-body .reveal-placeholder:hover { color:rgba(255,255,255,0.3) !important; border-color:rgba(255,255,255,0.1) !important; }
  }
  .m-exp-body .editor-outer.is-hidden-state { border:none !important; min-height:0 !important; }
  .m-exp-body .editor-outer.is-hidden-state .rich-editor { border:none !important; }
  .m-exp-body .editor-toolbar { background-color:transparent !important; }
  @media(hover:hover){
  .m-exp-body .editor-toolbar button:hover { background-color:rgba(255,255,255,0.04) !important; }
  }
  .m-exp-body .info-popup { background-color:rgba(30,30,50,0.9) !important; backdrop-filter:blur(40px) !important; -webkit-backdrop-filter:blur(40px) !important; border:1px solid rgba(255,255,255,0.1) !important; }
  .m-exp-body .reveal-btn, .m-exp-body .task-reveal-btn { display:none !important; }
  @media(max-width:700px) { .m-exp-body .item { grid-template-columns:1fr !important; gap:0.3rem !important; } .m-exp-body { padding:0.6rem 0.8rem 2rem !important; } }
  body.modern-mode .search-panel { background:rgba(50,50,50,0.85) !important; backdrop-filter:blur(40px) !important; border-color:rgba(255,255,255,0.06) !important; z-index:9999; }
  body.modern-mode .search-panel h3 { color:rgba(255,255,255,0.7) !important; }
  body.modern-mode .search-panel-input { background:rgba(255,255,255,0.7) !important; color:rgba(255,255,255,0.7) !important; }
  body.modern-mode .search-panel-results { color:rgba(255,255,255,0.55) !important; }
  @media(max-width:700px) {
    .m-nav { opacity:0.4; }
    .m-nav .m-nav-svg { width:48px !important; height:48px !important; }
    .m-nav-l { left:2px !important; }
    .m-nav-r { right:2px !important; }
    .m-card { width:73vw !important; height:58vh !important; margin:0 6px !important; }
    .m-card-head { padding:1rem 1rem 0.7rem !important; }
    .m-card-roman { font-size:1.4rem !important; margin-bottom:0.2rem !important; }
    .m-card-title { font-size:0.7rem !important; }
    .m-card-count { font-size:0.44rem !important; margin-top:0.3rem !important; }
    .m-card-body { padding:0.5rem 0.8rem 0.6rem !important; }
    .m-task-row { padding:0.4rem 0.5rem !important; margin-bottom:0.25rem !important; border-radius:8px !important; }
    .m-task-id { font-size:0.42rem !important; }
    .m-task-title { font-size:0.6rem !important; }
    .m-task-arrow { font-size:0.55rem !important; }
    .m-card-prog { padding:0.5rem 0.9rem !important; }
    .m-prog-count { font-size:0.36rem !important; }
    .m-search { max-width:none; flex:1; margin:0 0.4rem; }
    .m-search-input { font-size:16px !important; transform:scale(0.75); transform-origin:left center; width:133%; }
    .rich-editor, .notes-editor, .summary-editor { font-size:16px !important; }
    .m-badge,.m-search-kbd { display:none; }
    .m-icon-label { display:none !important; }
    .m-ghost-main { font-size:1.1rem !important; }
    .m-ghost-sub { font-size:0.4rem !important; }
    .m-ghost { padding:0.3rem 0.5rem 0 !important; }
    .m-header { padding:0.5rem 0.8rem !important; }
    .m-viewport { height:calc(100vh - 95px) !important; }
    .m-h-left { min-width:auto !important; flex:0 0 auto !important; }
    .m-h-right { min-width:auto !important; gap:0 !important; flex:0 0 auto !important; }
    .m-icon { width:28px !important; height:28px !important; }
  }
  @media(max-width:400px) {
    .m-card { width:62vw !important; height:58vh !important; }
    .m-search { max-width:none; flex:1; margin:0 0.3rem; height:28px; }
  }

  /* ── Large screen scaling ── */
  @media(min-width:1200px) {
    .m-card { width:min(520px,42vw); height:min(600px,72vh); }
    .m-card.m-active { transform:scale(1.06); }
    .m-card-head { padding:2rem 2rem 1.4rem; }
    .m-card-roman { font-size:2.6rem; margin-bottom:0.45rem; }
    .m-card-title { font-size:1.05rem; }
    .m-card-count { font-size:0.62rem; margin-top:0.55rem; }
    .m-card-body { padding:1rem 1.6rem 1.2rem; }
    .m-task-row { padding:0.7rem 0.9rem; margin-bottom:0.45rem; border-radius:12px; }
    .m-task-id { font-size:0.6rem; }
    .m-task-title { font-size:0.88rem; }
    .m-task-arrow { font-size:0.8rem; }
    .m-card-prog { padding:0.9rem 1.6rem; }
    .m-prog-count { font-size:0.5rem; }
    .m-prog-track { height:4px; }
    .m-header { padding:0.8rem 2rem; }
    .m-wordmark { font-size:0.72rem; }
    .m-badge { font-size:0.52rem; padding:0.15rem 0.55rem; }
    .m-search { max-width:460px; height:38px; padding:0 1.1rem; }
    .m-search-input { font-size:0.68rem; }
    .m-search-kbd { font-size:0.5rem; }
    .m-icon { width:36px; height:36px; }
    .m-lock-icon svg { width:17px; height:17px; }
    .m-icon-label { font-size:0.44rem; }
    .m-tool-btn { font-size:0.58rem; padding:0.5rem 1rem; }
    .m-study-dot { width:8px; height:8px; }
    .m-tool-edit svg { width:15px; height:15px; }
    .m-ghost-main { font-size:clamp(1.6rem,3.5vw,3rem); }
    .m-ghost-sub { font-size:0.58rem; }
    .m-nav .m-nav-svg { width:42px; height:42px; }
    .m-nav.m-nav-l { left:2rem; }
    .m-nav.m-nav-r { right:2rem; }
    .m-dots { gap:7px; padding:0.55rem 1.1rem; }
    .m-dot { width:6px; height:6px; }
    .m-dot.m-dot-on { width:20px; }
    .m-fab-menu { min-width:380px; padding:1.4rem; gap:0.6rem; border-radius:20px; }
    .m-fab-item { font-size:0.68rem; padding:0.85rem 1rem; border-radius:12px; }
    .m-exp-head { padding:1.1rem 2rem; }
    .m-exp-roman { font-size:1.05rem; }
    .m-exp-title { font-size:0.95rem; }
    .m-exp-close { width:40px; height:40px; font-size:1rem; }
    .m-exp-body { padding:1.2rem 2rem 2.5rem; }
    .m-exp-body .section-label { font-size:0.65rem !important; }
    .m-exp-body .field-label { font-size:0.58rem !important; }
    .m-exp-body .item-code { font-size:0.58rem !important; }
    .m-exp-fab { padding:0.6rem 1.1rem; }
    .m-exp-fab svg { width:17px; height:17px; }
    .m-exp-fab-drop { min-width:380px; }
    .m-exp-fab-drop .m-fab-item { font-size:0.68rem; }
    .m-exp-body .item { grid-template-columns:170px 1fr; gap:0.9rem; margin:0.85rem 0; padding:0.3rem 0.45rem; }
    .m-exp-body .item-code { font-size:0.65rem !important; }
    .m-exp-body .item-title { font-size:0.78rem !important; }
    .m-exp-body .rich-editor { font-size:0.92rem !important; min-height:60px; padding:0.6rem 0.8rem !important; }
    .m-exp-body .conf-dot { width:14px !important; height:14px !important; }
    .m-exp-body .task-summary-label { font-size:0.58rem !important; }
    body.modern-mode .search-panel { width:480px; }
    body.modern-mode .search-panel-header h3 { font-size:0.88rem !important; }
    body.modern-mode .search-panel-input { font-size:0.95rem !important; }
    body.modern-mode .search-result-row { padding:0.8rem 1rem; }
    body.modern-mode .notes-panel { width:480px; }
    body.modern-mode .notes-panel-header h3 { font-size:0.88rem !important; }
    body.modern-mode .notes-editor { font-size:0.95rem !important; }
  }

  @media(min-width:1600px) {
    .m-card { width:min(620px,38vw); height:min(680px,75vh); }
    .m-card-head { padding:2.4rem 2.4rem 1.6rem; }
    .m-card-roman { font-size:3rem; }
    .m-card-title { font-size:1.2rem; }
    .m-card-count { font-size:0.7rem; }
    .m-card-body { padding:1.2rem 1.8rem 1.4rem; }
    .m-task-row { padding:0.8rem 1rem; margin-bottom:0.5rem; }
    .m-task-id { font-size:0.68rem; }
    .m-task-title { font-size:1rem; }
    .m-card-prog { padding:1rem 1.8rem; }
    .m-prog-count { font-size:0.56rem; }
    .m-header { padding:1rem 2.5rem; }
    .m-wordmark { font-size:0.82rem; }
    .m-badge { font-size:0.58rem; }
    .m-search { max-width:540px; height:42px; }
    .m-search-input { font-size:0.76rem; }
    .m-icon { width:42px; height:42px; }
    .m-lock-icon svg { width:20px; height:20px; }
    .m-tool-btn { font-size:0.66rem; padding:0.55rem 1.15rem; }
    .m-study-dot { width:9px; height:9px; }
    .m-tool-edit svg { width:17px; height:17px; }
    .m-ghost-main { font-size:clamp(2rem,3.5vw,3.6rem); }
    .m-ghost-sub { font-size:0.66rem; }
    .m-nav .m-nav-svg { width:48px; height:48px; }
    .m-nav.m-nav-l { left:2.5rem; }
    .m-nav.m-nav-r { right:2.5rem; }
    .m-dots { gap:8px; padding:0.6rem 1.3rem; }
    .m-dot { width:7px; height:7px; }
    .m-dot.m-dot-on { width:24px; }
    .m-fab-menu { min-width:440px; padding:1.6rem; }
    .m-fab-item { font-size:0.76rem; padding:0.95rem 1.1rem; }
    .m-exp-head { padding:1.3rem 2.5rem; }
    .m-exp-roman { font-size:1.2rem; }
    .m-exp-title { font-size:1.1rem; }
    .m-exp-close { width:46px; height:46px; font-size:1.15rem; border-radius:12px; }
    .m-exp-body { padding:1.5rem 2.5rem 3rem; }
    .m-exp-body .section-label { font-size:0.72rem !important; }
    .m-exp-body .field-label { font-size:0.65rem !important; }
    .m-exp-fab-drop { min-width:440px; }
    .m-exp-body .item { grid-template-columns:195px 1fr; gap:1rem; margin:0.95rem 0; padding:0.35rem 0.5rem; }
    .m-exp-body .item-code { font-size:0.72rem !important; }
    .m-exp-body .item-title { font-size:0.88rem !important; }
    .m-exp-body .rich-editor { font-size:1.02rem !important; min-height:68px; padding:0.7rem 0.9rem !important; }
    .m-exp-body .conf-dot { width:16px !important; height:16px !important; }
    .m-exp-body .task-summary-label { font-size:0.62rem !important; }
    body.modern-mode .search-panel { width:540px; }
    body.modern-mode .search-panel-header h3 { font-size:1rem !important; }
    body.modern-mode .search-panel-input { font-size:1.05rem !important; }
    body.modern-mode .search-result-row { padding:0.9rem 1.1rem; }
    body.modern-mode .notes-panel { width:540px; }
    body.modern-mode .notes-panel-header h3 { font-size:1rem !important; }
    body.modern-mode .notes-editor { font-size:1.05rem !important; }
  }

  @media(min-width:2000px) {
    .m-card { width:min(740px,36vw); height:min(760px,78vh); margin:0 -80px; }
    .m-card-head { padding:2.8rem 2.8rem 1.8rem; }
    .m-card-roman { font-size:3.4rem; }
    .m-card-title { font-size:1.4rem; }
    .m-card-count { font-size:0.8rem; }
    .m-card-body { padding:1.4rem 2.2rem 1.6rem; }
    .m-card-body::-webkit-scrollbar { width:4px; }
    .m-task-row { padding:0.9rem 1.2rem; margin-bottom:0.55rem; border-radius:14px; }
    .m-task-id { font-size:0.76rem; }
    .m-task-title { font-size:1.12rem; }
    .m-card-prog { padding:1.1rem 2.2rem; }
    .m-prog-track { height:5px; }
    .m-prog-count { font-size:0.62rem; }
    .m-header { padding:1.1rem 3rem; }
    .m-wordmark { font-size:0.92rem; }
    .m-badge { font-size:0.64rem; padding:0.18rem 0.65rem; }
    .m-search { max-width:620px; height:46px; }
    .m-search-input { font-size:0.84rem; }
    .m-search-kbd { font-size:0.6rem; }
    .m-icon { width:48px; height:48px; }
    .m-lock-icon svg { width:24px; height:24px; }
    .m-icon-label { font-size:0.52rem; }
    .m-tool-btn { font-size:0.74rem; padding:0.6rem 1.3rem; gap:0.45rem; }
    .m-study-dot { width:11px; height:11px; }
    .m-tool-edit svg { width:20px; height:20px; }
    .m-ghost-main { font-size:clamp(2.4rem,3.5vw,4.2rem); }
    .m-ghost-sub { font-size:0.74rem; }
    .m-nav .m-nav-svg { width:56px; height:56px; }
    .m-nav.m-nav-l { left:3rem; }
    .m-nav.m-nav-r { right:3rem; }
    .m-dots { gap:9px; padding:0.7rem 1.5rem; border-radius:24px; }
    .m-dot { width:8px; height:8px; }
    .m-dot.m-dot-on { width:28px; border-radius:4px; }
    .m-fab-menu { min-width:500px; padding:1.8rem; gap:0.7rem; }
    .m-fab-item { font-size:0.84rem; padding:1rem 1.2rem; border-radius:14px; }
    .m-exp-head { padding:1.5rem 3rem; }
    .m-exp-roman { font-size:1.35rem; }
    .m-exp-title { font-size:1.25rem; }
    .m-exp-close { width:52px; height:52px; font-size:1.3rem; }
    .m-exp-body { padding:1.8rem 3rem 3.5rem; }
    .m-exp-body .section-label { font-size:0.8rem !important; padding:0.7rem 1rem !important; }
    .m-exp-body .field-label { font-size:0.72rem !important; }
    .m-exp-body .item-code { font-size:0.68rem !important; }
    .m-exp-fab { padding:0.7rem 1.3rem; border-radius:24px; }
    .m-exp-fab svg { width:20px; height:20px; }
    .m-exp-fab-drop { min-width:500px; padding:1.8rem; }
    .m-exp-fab-drop .m-fab-item { font-size:0.84rem; }
    .m-exp-body .item { grid-template-columns:220px 1fr; gap:1.1rem; margin:1.05rem 0; padding:0.4rem 0.55rem; }
    .m-exp-body .item-code { font-size:0.8rem !important; }
    .m-exp-body .item-title { font-size:1rem !important; }
    .m-exp-body .rich-editor { font-size:1.14rem !important; min-height:76px; padding:0.8rem 1rem !important; line-height:1.6 !important; }
    .m-exp-body .conf-dot { width:18px !important; height:18px !important; }
    .m-exp-body .task-summary-label { font-size:0.68rem !important; }
    .m-exp-body .reveal-placeholder { font-size:0.78rem !important; padding:0.8rem 1rem !important; }
    body.modern-mode .search-panel { width:620px; }
    body.modern-mode .search-panel-header { padding:1.2rem 1.5rem; }
    body.modern-mode .search-panel-header h3 { font-size:1.1rem !important; }
    body.modern-mode .search-panel-input { font-size:1.15rem !important; padding:0.75rem 0 !important; }
    body.modern-mode .search-result-row { padding:1rem 1.2rem; }
    body.modern-mode .notes-panel { width:620px; }
    body.modern-mode .notes-panel-header { padding:1.2rem 1.5rem; }
    body.modern-mode .notes-panel-header h3 { font-size:1.1rem !important; }
    body.modern-mode .notes-editor { font-size:1.15rem !important; padding:1rem !important; }
  }

  /* ── Grid View Overlay ── */
  .m-grid-overlay { display:none; position:fixed; inset:0; background:#0f0f0f; backdrop-filter:none; -webkit-backdrop-filter:none; z-index:250; flex-direction:column; }
  .m-grid-overlay.open { display:flex; animation:mPopIn 0.32s cubic-bezier(0.16,1,0.3,1) forwards; }
  .m-grid-overlay.m-pop-out { display:flex; }
  .m-grid-head { display:flex; align-items:center; justify-content:space-between; padding:0.8rem 1.5rem; flex-shrink:0; border-bottom:1px solid rgba(255,255,255,0.06); }
  .m-grid-title { font-family:'Barlow',sans-serif; font-weight:700; font-size:0.78rem; letter-spacing:0.08em; text-transform:uppercase; color:rgba(255,255,255,0.6); }
  .m-grid-close { background:none; border:1px solid rgba(255,255,255,0.1); color:rgba(255,255,255,0.25); width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:0.85rem; transition:all 0.2s; }
  @media(hover:hover){
  .m-grid-close:hover { border-color:rgba(255,100,100,0.3); color:rgba(255,100,100,0.6); }
  }
  .m-grid-body { flex:1; display:grid; grid-template-columns:repeat(3, 1fr); gap:0.8rem; padding:1rem; overflow-y:auto; align-content:start; }
  .m-grid-card { background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:14px; display:flex; flex-direction:column; cursor:pointer; transition:all 0.25s; overflow:hidden; min-height:420px; }
  @media(hover:hover){
  .m-grid-card:hover { border-color:rgba(255,255,255,0.2); background:rgba(255,255,255,0.06); transform:scale(1.02); }
  }
  .m-grid-card-head { padding:0.8rem 0.9rem 0.5rem; flex-shrink:0; }
  .m-grid-card-roman { font-family:'Barlow',sans-serif; font-weight:700; font-size:1.4rem; color:rgba(255,255,255,0.08); line-height:1; }
  .m-grid-card-title { font-family:'Barlow',sans-serif; font-weight:600; font-size:0.72rem; color:rgba(255,255,255,0.7); line-height:1.3; margin-top:0.25rem; }
  .m-grid-card-count { font-family:'Barlow Condensed',sans-serif; font-size:0.5rem; letter-spacing:0.1em; text-transform:uppercase; color:rgba(255,255,255,0.15); margin-top:0.25rem; }
  .m-grid-card-tasks { flex:1; padding:0.4rem 0.7rem; overflow-y:auto; scrollbar-width:thin; scrollbar-color:rgba(255,255,255,0.06) transparent; }
  .m-grid-card-tasks::-webkit-scrollbar { width:3px; }
  .m-grid-card-tasks::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.08); border-radius:2px; }
  .m-grid-task { padding:0.3rem 0.45rem; font-family:'Barlow',sans-serif; font-size:0.58rem; color:rgba(255,255,255,0.35); line-height:1.45; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; border-radius:5px; cursor:pointer; transition:all 0.15s; }
  @media(hover:hover){
  .m-grid-task:hover { color:rgba(255,255,255,0.7); background:rgba(255,255,255,0.04); }
  }
  .m-grid-card-prog { padding:0.5rem 0.9rem; flex-shrink:0; display:flex; gap:0.25rem; }
  .m-grid-prog-bar { flex:1; height:3px; background:transparent; border-radius:2px; overflow:hidden; }
  .m-grid-prog-fill-green { height:100%; background:#2e8b57; }
  .m-grid-prog-fill-yellow { height:100%; background:#d4a017; }
  .m-grid-prog-fill-red { height:100%; background:#c0392b; }
  @media(max-width:1000px) { .m-grid-body { grid-template-columns:repeat(2, 1fr); } }
  @media(max-width:600px) { .m-grid-body { grid-template-columns:1fr 1fr; gap:0.5rem; padding:0.6rem; overflow-y:auto; } .m-grid-card { min-height:300px; } .m-grid-card-head { padding:0.6rem 0.65rem 0.4rem; } .m-grid-card-roman { font-size:1rem; } .m-grid-card-title { font-size:0.58rem; } .m-grid-card-count { font-size:0.4rem; } .m-grid-task { font-size:0.44rem; padding:0.2rem 0.35rem; } .m-grid-card-tasks { padding:0.3rem 0.45rem; } .m-grid-card-prog { padding:0.35rem 0.6rem; } .m-grid-head { padding:0.6rem 1rem; } .m-grid-title { font-size:0.7rem; } .m-grid-close { width:30px; height:30px; font-size:0.75rem; } }
  @media(min-width:1600px) { .m-grid-body { grid-template-columns:repeat(3, 1fr); gap:1rem; padding:1.2rem; } .m-grid-card { min-height:480px; } .m-grid-card-head { padding:1rem 1.1rem 0.6rem; } .m-grid-card-roman { font-size:1.7rem; } .m-grid-card-title { font-size:0.85rem; } .m-grid-card-count { font-size:0.56rem; } .m-grid-task { font-size:0.66rem; padding:0.35rem 0.5rem; } .m-grid-card-prog { padding:0.55rem 1rem; } .m-grid-prog-bar { height:4px; } .m-grid-head { padding:1rem 2rem; } .m-grid-title { font-size:1rem; } .m-grid-close { width:42px; height:42px; } }
  @media(min-width:2000px) { .m-grid-body { grid-template-columns:repeat(3, 1fr); gap:1.2rem; padding:1.5rem; } .m-grid-card { min-height:560px; } .m-grid-card-head { padding:1.2rem 1.3rem 0.7rem; } .m-grid-card-roman { font-size:2rem; } .m-grid-card-title { font-size:1rem; } .m-grid-card-count { font-size:0.62rem; } .m-grid-task { font-size:0.75rem; padding:0.4rem 0.55rem; } .m-grid-card-prog { padding:0.6rem 1.2rem; } .m-grid-prog-bar { height:5px; } .m-grid-head { padding:1.2rem 2.5rem; } .m-grid-title { font-size:1.15rem; } .m-grid-close { width:48px; height:48px; font-size:1.15rem; } }

</style>
</head>
<body class="modern-mode">

<!-- Lock Screen -->
<div class="lock-screen" id="lockScreen">

  <div class="lock-title-block">
    <div class="lock-title">CFI ACS</div>
    <div class="lock-subtitle">Enter Passcode to Continue</div>
  </div>

  <div class="runway-wrap">
    <!-- Left edge lights -->
    <div class="rwy-edge-lights rwy-edge-left">
      <span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span>
    </div>
    <!-- Right edge lights -->
    <div class="rwy-edge-lights rwy-edge-right">
      <span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span><span class="rwy-elight"></span>
    </div>
    <!-- Centerline lights (on top of dashes) -->
    <div class="rwy-cl-lights">
      <span class="rwy-clight"></span><span class="rwy-clight"></span><span class="rwy-clight"></span><span class="rwy-clight"></span><span class="rwy-clight"></span><span class="rwy-clight"></span>
    </div>
    <div class="runway-centerline">
      <div class="cl-dash"></div>
      <div class="cl-dash"></div>
      <div class="cl-dash"></div>
      <div class="cl-dash"></div>
    </div>
    <div class="threshold-strip">
      <div class="thresh-group">
        <div class="thresh-stripe" id="ts0"><input class="digit-box" id="d0" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts1"><input class="digit-box" id="d1" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts2"><input class="digit-box" id="d2" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts3"><input class="digit-box" id="d3" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
      </div>
      <div class="thresh-gap"></div>
      <div class="thresh-group">
        <div class="thresh-stripe" id="ts4"><input class="digit-box" id="d4" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts5"><input class="digit-box" id="d5" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts6"><input class="digit-box" id="d6" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
        <div class="thresh-stripe" id="ts7"><input class="digit-box" id="d7" type="tel" maxlength="1" inputmode="numeric" autocomplete="off"></div>
      </div>
    </div>
    <!-- Green threshold lights -->
    <div class="rwy-thresh-lights">
      <span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span><span class="rwy-tlight"></span>
    </div>
  </div>

  <div class="lock-error" id="lockError"></div>
  <button class="lock-btn" onclick="unlockApp()">Takeoff</button>



</div>

<!-- Change Passcode Modal -->
<div class="modal-overlay" id="changePwModal">
  <div class="modal-card">
    <div class="modal-title">Change Passcode</div>
    <div class="modal-label">Current Passcode (8 digits)</div>
    <input class="modal-input" id="pwCurrent" type="tel" maxlength="8" pattern="[0-9]*" inputmode="numeric" placeholder="Current 8-digit passcode" autocomplete="off">
    <div class="modal-label">New Passcode (8 digits)</div>
    <input class="modal-input" id="pwNew" type="tel" maxlength="8" pattern="[0-9]*" inputmode="numeric" placeholder="New 8-digit passcode" autocomplete="off">
    <div class="modal-label">Confirm New Passcode</div>
    <input class="modal-input" id="pwConfirm" type="tel" maxlength="8" pattern="[0-9]*" inputmode="numeric" placeholder="Confirm new passcode" autocomplete="off">
    <div class="modal-error" id="pwModalError"></div>
    <div class="modal-btns">
      <button class="modal-btn-cancel" onclick="closeChangePw()">Cancel</button>
      <button class="modal-btn-save" onclick="saveNewPassword()">Save</button>
    </div>
  </div>
</div>

<!-- Study by Highlight Picker -->
<div class="study-picker-overlay" id="studyPickerOverlay">
  <div class="study-picker-card">
    <div class="study-picker-title">Which highlights would you like to review?</div>
    <div class="study-picker-dots">
      <button class="study-picker-dot green"  id="pickerDotGreen"  onclick="togglePickerDot('green')"  title="Know it well"></button>
      <button class="study-picker-dot yellow" id="pickerDotYellow" onclick="togglePickerDot('yellow')" title="Needs more work"></button>
      <button class="study-picker-dot red"    id="pickerDotRed"    onclick="togglePickerDot('red')"    title="Don't know it"></button>
    </div>
    <div class="study-picker-btns">
      <button class="study-picker-cancel" onclick="closeStudyHighlightPicker()">Cancel</button>
      <button class="study-picker-go"     onclick="startStudyMode()">Study</button>
    </div>
  </div>
</div>

<!-- Study Mode Full Screen -->
<div class="study-mode-overlay" id="studyModeOverlay">
  <div class="study-mode-header">
    <div class="study-mode-title">
      Study Mode
      <div class="study-mode-dot-indicators" id="studyModeDotIndicators"></div>
    </div>
    <div class="study-mode-controls">
      <span class="study-mode-count" id="studyModeCount"></span>
      <button class="study-mode-btn reveal-btn" id="studyRevealBtn" onclick="toggleStudyReveal()">Reveal All Answers</button>
      <button class="study-mode-btn exit-btn" onclick="requestExitStudyMode()">Exit Study Mode</button>
    </div>
  </div>
  <div class="study-mode-body" id="studyModeBody"></div>
</div>

<!-- Study Exit Confirm -->
<div class="study-exit-overlay" id="studyExitOverlay">
  <div class="study-exit-card">
    <div class="study-exit-title">Apply these changes?</div>
    <div class="study-exit-list" id="studyExitList"></div>
    <div class="study-exit-btns">
      <button class="study-exit-btn cancel-btn" onclick="cancelExitStudyMode()">Go Back</button>
      <button class="study-exit-btn confirm-btn" onclick="confirmExitStudyMode()">Apply & Exit</button>
    </div>
  </div>
</div>

<!-- Lock Confirm Dialog -->
<div class="lock-confirm-overlay" id="lockConfirmOverlay">
  <div class="lock-confirm-card">
    <div class="lock-confirm-title">Exit to Lock Screen?</div>
    <div class="lock-confirm-btns" style="flex-direction:row;">
      <button class="lock-confirm-no" onclick="hideLockConfirm()" title="Stay">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="11" width="18" height="11" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
          <path d="M7 11V7C7 4.24 9.24 2 12 2C14.76 2 17 4.24 17 7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" fill="none"/>
          <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
        </svg>
        Stay
      </button>
      <button class="lock-confirm-yes" onclick="lockApp()" title="Lock">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="11" width="18" height="11" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
          <path d="M7 11V7C7 4.24 9.24 2 12 2C14.76 2 17 4.24 17 7V11" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" fill="none"/>
          <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
        </svg>
        Lock
      </button>
    </div>
    <button class="lock-confirm-change-pw" onclick="hideLockConfirm();openChangePw()">Change Passcode</button>
  </div>
</div>

<div class="lock-confirm-overlay" id="clearConfirmOverlay">
  <div class="lock-confirm-card">
    <div class="lock-confirm-title" id="clearConfirmTitle">Clear All Saved Answers?</div>
    <div class="lock-confirm-btns">
      <button class="lock-confirm-no" id="clearConfirmCancel" onclick="var _el=document.getElementById('clearConfirmOverlay');mPopClose(_el,function(){_el.classList.remove('open');}); resetClearConfirm()">
        Cancel
      </button>
      <button class="lock-confirm-yes" id="clearConfirmBtn" onclick="clearConfirmStep()">
        Clear All
      </button>
    </div>
  </div>
</div>

<header>
  <div class="header-top">
    <div style="display:flex;align-items:center;gap:0.7rem;">
      <h1>CFI ACS Study Guide</h1>
      <button class="oral-sim-header-btn" id="oralSimHeaderBtn" onclick="openOralSimLauncher()" title="Oral Simulator">
        <svg width="30" height="30" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle class="oral-sim-icon-ring" cx="8" cy="8" r="6.5" stroke="currentColor" stroke-width="1.5"/>
          <path class="oral-sim-icon-play" d="M6 5.5l5 2.5-5 2.5V5.5z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round" fill="currentColor"/>
        </svg>
        <span class="oral-sim-slide-label">ORAL SIMULATOR</span>
      </button>
    </div>
    <div style="display:flex;flex-direction:column;align-items:flex-end;gap:0.5rem;">
      <div style="display:flex;align-items:center;position:relative;">        <button class="edit-mode-btn" id="editModeBtn" onclick="toggleEditMode()" title="Edit Mode">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11.5 2.5L13.5 4.5L5.5 12.5H3.5V10.5L11.5 2.5Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" fill="none"/>
            <path d="M2.5 13.5H13.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span style="font-family:'Barlow Condensed',sans-serif;font-size:0.48rem;letter-spacing:0.1em;text-transform:uppercase;font-weight:600;">EDIT</span>
        </button>
        <button class="manual-save-btn" onclick="manualSave()" title="Save">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><polyline points="2,7 6,11 12,3" stroke="currentColor" stroke-width="1.8" stroke-linecap="square" stroke-linejoin="miter"/></svg>
          <span class="save-label" style="font-family:'Barlow Condensed',sans-serif;font-size:0.48rem;letter-spacing:0.1em;text-transform:uppercase;font-weight:600;">SAVE</span>
        </button>
        <button class="lock-icon-btn" id="lockIconBtn" onclick="showLockConfirm()" title="Lock">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="1.8" fill="none"/>
            <path d="M8 11V7a4 4 0 018 0v4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
          </svg>
          <span style="font-family:'Barlow Condensed',sans-serif;font-size:0.48rem;letter-spacing:0.1em;text-transform:uppercase;font-weight:600;">LOCK</span>
        </button>
      </div>
    </div>
  </div>
  <div class="controls">
    <button class="btn btn-reveal" id="revealHideBtn" onclick="toggleRevealHide()">Reveal All Answers</button>
    <button class="btn btn-expand" id="expandCollapseBtn" onclick="toggleExpandCollapse()">Expand All Tasks</button>
    <button class="btn btn-export" onclick="openExportModal()">Export</button>
    <button class="btn btn-import" onclick="openImportModal()">Import</button>
    <input type="file" id="importFileInput" accept=".json" style="display:none;" onchange="importAnswers(event)">
    <button class="btn btn-study-highlight" onclick="openStudyHighlightPicker()">Study by Highlight</button>
    <button class="btn btn-hide-empty" id="hideEmptyBtn" onclick="toggleHideEmpty()">Hide Empty Fields</button>
    <div class="more-options-wrap">
      <button class="btn btn-hide" onclick="togglePlaneClassMenu()">Plane Class ▾</button>
      <div class="more-options-menu" id="planeClassMenu" style="width:200px;">
        <button id="catAMEL" onclick="toggleCategoryFilter('AMEL')" style="color:#555;display:flex;justify-content:space-between;align-items:center;">AMEL <span class="cat-status" style="font-size:0.5rem;opacity:0.5;">OFF</span></button>
        <button id="catASES" onclick="toggleCategoryFilter('ASES')" style="color:#555;display:flex;justify-content:space-between;align-items:center;">ASES <span class="cat-status" style="font-size:0.5rem;opacity:0.5;">OFF</span></button>
        <button id="catAMES" onclick="toggleCategoryFilter('AMES')" style="color:#555;display:flex;justify-content:space-between;align-items:center;">AMES <span class="cat-status" style="font-size:0.5rem;opacity:0.5;">OFF</span></button>
      </div>
    </div>
    <div class="more-options-wrap">
      <button class="btn btn-hide" onclick="toggleLinks()">Links ▾</button>
      <div class="more-options-menu" id="linksMenu">
        <div id="linksList"></div>
        <div class="links-add-row" id="linksAddRow" style="display:none;padding:0.5rem;">
          <input id="linkTitle" placeholder="Name (e.g. FAA Handbook)" style="width:100%;padding:0.4rem 0.6rem;margin-bottom:0.3rem;box-sizing:border-box;background:#f9f9f9;border:1px solid var(--border);border-radius:4px;color:#222;font-family:'Barlow Condensed',sans-serif;font-size:0.72rem;outline:none;">
          <div style="display:flex;margin-bottom:0.4rem;border:1px solid var(--border);border-radius:4px;overflow:hidden;background:#f9f9f9;">
            <button onclick="pasteUrl()" title="Paste from clipboard" style="padding:0 0.5rem;background:transparent;border:none;cursor:pointer;color:#888;display:flex;align-items:center;flex-shrink:0;" onmouseover="this.style.color='#333'" onmouseout="this.style.color='#888'">
              <svg width="13" height="13" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="3" width="8" height="10" rx="1" stroke="currentColor" stroke-width="1.2"/><path d="M4 4H3a1 1 0 00-1 1v7a1 1 0 001 1h7a1 1 0 001-1v-1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/><path d="M6 3V2h2v1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <input id="linkUrl" placeholder="" style="flex:1;padding:0.4rem 0.6rem 0.4rem 0;box-sizing:border-box;background:transparent;border:none;color:#222;font-family:'Barlow Condensed',sans-serif;font-size:0.72rem;outline:none;">
          </div>
          <div style="display:flex;gap:0.4rem;">
            <button onclick="saveNewLink()" class="link-btn-save" style="flex:1;padding:0.35rem;background:#efffef;border:1px solid #2e8b57;border-radius:4px;color:#2e8b57;font-family:'Barlow Condensed',sans-serif;font-size:0.63rem;cursor:pointer;text-transform:uppercase;letter-spacing:0.05em;">Save</button>
            <button onclick="cancelAddLink()" class="link-btn-cancel" style="flex:1;padding:0.35rem;background:#fdf0ef;border:1px solid #c0392b;border-radius:4px;color:#c0392b;font-family:'Barlow Condensed',sans-serif;font-size:0.63rem;cursor:pointer;text-transform:uppercase;letter-spacing:0.05em;">Cancel</button>
          </div>
        </div>
        <button onclick="showAddLink()" id="addLinkBtn" class="link-btn-add" style="width:100%;padding:0.55rem 1rem;background:transparent;border:none;color:#2e8b57;font-family:'Barlow Condensed',sans-serif;font-size:0.63rem;text-transform:uppercase;letter-spacing:0.06em;cursor:pointer;text-align:left;box-sizing:border-box;">Add Link</button>
      </div>
    </div>
    <div class="more-options-wrap">
      <button class="btn btn-hide" onclick="toggleMoreOptions()">More Options ▾</button>
      <div class="more-options-menu" id="moreOptionsMenu">
        <button onclick="openChangePw(); toggleMoreOptions()">Change Passcode</button>
        <button onclick="clearSaved()">Clear All Saved Answers</button>
      </div>
    </div>
    <span id="save-indicator" style="font-family:'Barlow Condensed',sans-serif;font-size:0.63rem;letter-spacing:0.06em;text-transform:uppercase;color:#2e8b57;opacity:0;transition:opacity 0.5s;margin-left:0.25rem;"></span>
  </div>
</header>

<!-- ═══ MODERN MODE UI ═══ -->
<div class="m-header">
  <div class="m-h-left"><span class="m-wordmark">CFI ACS</span></div>
  <div class="m-search">
    <span class="m-search-icon"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.35-4.35"/></svg></span>
    <input class="m-search-input" placeholder="Search codes, tasks…">
  </div>
  <div class="m-h-right">
    <button class="m-icon m-lock-icon" onclick="showLockConfirm()" title="Lock"><svg width="100%" height="100%" viewBox="0 0 24 24" fill="none"><rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="1.6"/><path d="M8 11V7a4 4 0 018 0v4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg></button>
  </div>
</div>
<div class="m-toolbar" id="mToolbar">
  <div class="m-toolbar-track" id="mToolbarTrack">
    <button class="m-tool-btn m-tool-icon m-oral-sim-btn" id="mOralSimBtn" onclick="openOralSimLauncher()" title="Oral Sim"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle class="oral-sim-icon-ring" cx="8" cy="8" r="6.5" stroke="currentColor" stroke-width="1.5"/><path class="oral-sim-icon-play" d="M6 5.5l5 2.5-5 2.5V5.5z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round" fill="currentColor"/></svg></button>
    <button class="m-tool-btn m-tool-study" id="mToolStudy" onclick="openStudyHighlightPicker()" title="Study by Highlight"><span class="m-study-dot" style="border:1.5px solid rgba(192,57,43,0.85);"></span><span class="m-study-dot" style="border:1.5px solid rgba(212,160,23,0.85);"></span><span class="m-study-dot" style="border:1.5px solid rgba(46,139,87,0.85);"></span></button>
    <button class="m-tool-btn m-tool-edit" id="mToolEdit" onclick="toggleEditMode()" title="Edit Mode"><svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11.5 1.5l3 3L5 14H2v-3z"/><path d="M9.5 3.5l3 3"/></svg></button>
    <button class="m-tool-btn m-tool-icon" onclick="event.stopPropagation();document.getElementById('mFab').classList.toggle('open')" title="More Options"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><line x1="2" y1="4" x2="14" y2="4"/><line x1="2" y1="8" x2="14" y2="8"/><line x1="2" y1="12" x2="14" y2="12"/></svg></button>
    <button class="m-tool-btn m-tool-icon" onclick="mOpenGrid()" title="View All Areas"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg></button>
  </div>
  <div class="m-fab-menu" id="mFab">
    <div class="m-fab-item m-fab-hide-main" onclick="document.getElementById('mFab').classList.remove('open');toggleEditMode()">Edit Mode</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');manualSave()">Save</div>
    <div class="m-fab-divider"></div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');toggleRevealHide()">Reveal All Answers</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');toggleExpandCollapse()">Expand All</div>
    <div class="m-fab-item m-fab-hide-main" onclick="document.getElementById('mFab').classList.remove('open');openStudyHighlightPicker()">Study by Highlight</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');toggleHideEmpty()">Hide Empty</div>
    <div class="m-fab-divider"></div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');openExportModal()">Export</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');openImportModal()">Import</div>
    <div class="m-fab-divider"></div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');toggleNotesPanel()">Notes</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');toggleLinks()">Links</div>
    <div class="m-fab-item" onclick="document.getElementById('mFab').classList.remove('open');togglePlaneClassPopup()">Plane Class</div>
    <div class="m-fab-divider"></div>
    <div class="m-fab-item" style="color:rgba(192,57,43,0.9);border-color:rgba(192,57,43,0.3);" onclick="document.getElementById('mFab').classList.remove('open');clearSaved()">Clear All Saved</div>
  </div>
</div>
<div class="m-viewport" id="mVP">
  <div class="m-track" id="mTrack"></div>
  <button class="m-nav m-nav-l" id="mNavL" onclick="mGo(mIdx-1)"><svg class="m-nav-svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 4 L9 12 L15 20"/></svg></button>
  <button class="m-nav m-nav-r" id="mNavR" onclick="mGo(mIdx+1)"><svg class="m-nav-svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 4 L15 12 L9 20"/></svg></button>
  <div class="m-dots" id="mDots"></div>
</div>
<div class="m-expanded" id="mExp">
  <div class="m-exp-head"><div class="m-exp-title-grp"><span class="m-exp-roman" id="mExpR"></span><span class="m-exp-title" id="mExpT"></span></div><button class="m-exp-close" onclick="mCloseExp()">✕</button></div>
  <div class="m-exp-body" id="mExpB"></div>
  <div class="m-exp-fab" id="mExpFab" onclick="mToggleExpDrop(event)">
    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><line x1="2" y1="4" x2="14" y2="4"/><line x1="2" y1="8" x2="14" y2="8"/><line x1="2" y1="12" x2="14" y2="12"/></svg>
  </div>
  <div class="m-exp-fab-scrim" id="mExpFabScrim" onclick="mCloseExpDrop()"></div>
  <div class="m-exp-fab-drop" id="mExpFabDrop"></div>
</div>
<div class="m-grid-overlay" id="mGridOverlay">
  <div class="m-grid-head"><span class="m-grid-title">All Areas</span><button class="m-grid-close" onclick="mCloseGrid()">✕</button></div>
  <div class="m-grid-body" id="mGridBody"></div>
</div>
</div>

<div class="bookmark-banner" id="bookmarkBanner" onclick="goToBookmark()">Resume from Bookmark</div>

<div class="notes-panel" id="notesPanel">
  <div class="notes-panel-header" id="notesPanelHeader">
    <h3>Plan / Notes</h3>
    <button class="notes-panel-close" onclick="toggleNotesPanel()" title="Close">✕</button>
  </div>
  <div class="notes-panel-body">
    <div class="notes-save-indicator" id="notesSaveIndicator">Saved</div>
    <div class="notes-editor" id="notesEditor" contenteditable="true" data-placeholder="Write your study plan, goals, reminders, or notes here..."></div>
  </div>
  <div class="np-resize-handle" id="npResizeHandle"></div>
</div>

<div class="main" id="studyGuide"></div>

<script>
const data = {
  areaIndex: 'I',
  area: "Area of Operation I: Fundamentals of Instructing",
  note: "The evaluator must select Task E, Task F, and at least one other Task for initial flight instructor applicants. During a practical test for an added flight instructor rating or flight instructor reinstatement, the evaluator has discretion to evaluate the applicant on Fundamentals of Instructing.",
  tasks: [
    {
      id: "Task A", title: "Effects of Human Behavior and Communication on the Learning Process",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands human behavior and effective communication, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.A.K1", text: "Elements of human behavior, including:" },
          { code: "FI.I.A.K1a", text: "a. Definitions of human behavior" },
          { code: "FI.I.A.K1b", text: "b. Instructor and learner relationship" },
          { code: "FI.I.A.K1c", text: "c. Motivation" },
          { code: "FI.I.A.K1d", text: "d. Human needs" },
          { code: "FI.I.A.K1e", text: "e. Defense mechanisms" },
          { code: "FI.I.A.K2", text: "Learner emotional reactions, including:" },
          { code: "FI.I.A.K2a", text: "a. Anxiety and stress" },
          { code: "FI.I.A.K2b", text: "b. Impatience" },
          { code: "FI.I.A.K2c", text: "c. Worry or lack of interest" },
          { code: "FI.I.A.K2d", text: "d. Physical discomfort, illness, fatigue, and dehydration" },
          { code: "FI.I.A.K2e", text: "e. Apathy due to inadequate instruction" },
          { code: "FI.I.A.K3", text: "Teaching the adult learner." },
          { code: "FI.I.A.K4", text: "Effective communication, including:" },
          { code: "FI.I.A.K4a", text: "a. Basic elements of communication" },
          { code: "FI.I.A.K4b", text: "b. Barriers to effective communication" },
          { code: "FI.I.A.K4c", text: "c. Developing communication skills" },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.A.R1", text: "Recognizing and accommodating human behavior." },
          { code: "FI.I.A.R2", text: "Barriers to communication." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.A.S1", text: "Give examples of how human behavior affects motivation and learning." },
          { code: "FI.I.A.S2", text: "Describe what the instructor can do to deal with:" },
          { code: "FI.I.A.S2a", text: "a. Serious abnormal emotional behavior" },
          { code: "FI.I.A.S2b", text: "b. Defense mechanisms" },
          { code: "FI.I.A.S3", text: "Use effective communication in ground and flight instruction." },
        ]}
      ]
    },
    {
      id: "Task B", title: "Learning Process",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands the learning process, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.B.K1", text: "Definitions of learning." },
          { code: "FI.I.B.K2", text: "Learning theory as it applies to ground and flight instruction, including:" },
          { code: "FI.I.B.K2a", text: "a. Behaviorism" },
          { code: "FI.I.B.K2b", text: "b. Cognitive Theory" },
          { code: "FI.I.B.K3", text: "Perceptions and insight." },
          { code: "FI.I.B.K4", text: "Acquiring knowledge." },
          { code: "FI.I.B.K5", text: "Laws of learning." },
          { code: "FI.I.B.K6", text: "Domains of learning, including:" },
          { code: "FI.I.B.K6a", text: "a. Cognitive" },
          { code: "FI.I.B.K6b", text: "b. Affective" },
          { code: "FI.I.B.K6c", text: "c. Psychomotor" },
          { code: "FI.I.B.K7", text: "Characteristics of learning." },
          { code: "FI.I.B.K8", text: "Scenario-based training (SBT)." },
          { code: "FI.I.B.K9", text: "Acquiring skill knowledge, including:" },
          { code: "FI.I.B.K9a", text: "a. Stages" },
          { code: "FI.I.B.K9b", text: "b. Knowledge of results" },
          { code: "FI.I.B.K9c", text: "c. How to develop skills" },
          { code: "FI.I.B.K9d", text: "d. Learning plateaus" },
          { code: "FI.I.B.K10", text: "Types of practice." },
          { code: "FI.I.B.K11", text: "Evaluation versus critique." },
          { code: "FI.I.B.K12", text: "Distractions, interruptions, fixation, and inattention." },
          { code: "FI.I.B.K13", text: "Errors." },
          { code: "FI.I.B.K14", text: "Memory, including:" },
          { code: "FI.I.B.K14a", text: "a. Sensory" },
          { code: "FI.I.B.K14b", text: "b. Short-Term Memory (STM) and Long-Term Memory (LTM)" },
          { code: "FI.I.B.K14c", text: "c. How usage affects memory" },
          { code: "FI.I.B.K14d", text: "d. Forgetting" },
          { code: "FI.I.B.K15", text: "Retention of learning." },
          { code: "FI.I.B.K16", text: "Transfer of learning." },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.B.R1", text: "Inadequate or incomplete instruction." },
          { code: "FI.I.B.R2", text: "Lack of learner motivation." },
          { code: "FI.I.B.R3", text: "Recognizing and correcting learner errors." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.B.S1", text: "Apply educational theories to ground and flight instruction." },
          { code: "FI.I.B.S2", text: "Recognize and correct conditions that undermine the learning process." },
          { code: "FI.I.B.S3", text: "Plan for and use techniques, including realistic distractions that teach flight students how to manage a workload." },
        ]}
      ]
    },
    {
      id: "Task C", title: "Course Development, Lesson Plans, and Classroom Training Techniques",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands the teaching process, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.C.K1", text: "Teaching, including:" },
          { code: "FI.I.C.K1a", text: "a. Process" },
          { code: "FI.I.C.K1b", text: "b. Essential skills" },
          { code: "FI.I.C.K2", text: "Course of training." },
          { code: "FI.I.C.K3", text: "Preparation of a lesson, including:" },
          { code: "FI.I.C.K3a", text: "a. Training objectives and completion standards" },
          { code: "FI.I.C.K3b", text: "b. Performance-based objectives" },
          { code: "FI.I.C.K3c", text: "c. Importance of Airman Certification Standards (ACS) in aviation training curricula" },
          { code: "FI.I.C.K3d", text: "d. Decision-based objectives" },
          { code: "FI.I.C.K4", text: "Organization of material." },
          { code: "FI.I.C.K5", text: "Training delivery methods, including:" },
          { code: "FI.I.C.K5a", text: "a. Lecture" },
          { code: "FI.I.C.K5b", text: "b. Discussion" },
          { code: "FI.I.C.K5c", text: "c. Guided discussion" },
          { code: "FI.I.C.K5d", text: "d. Cooperative or group learning" },
          { code: "FI.I.C.K5e", text: "e. Demonstration-performance" },
          { code: "FI.I.C.K5f", text: "f. Drill and practice" },
          { code: "FI.I.C.K6", text: "Electronic learning (e-Learning)." },
          { code: "FI.I.C.K7", text: "Instructional aids and training technologies, including:" },
          { code: "FI.I.C.K7a", text: "a. Characteristics of effective instructional aids" },
          { code: "FI.I.C.K7b", text: "b. Reasons for use" },
          { code: "FI.I.C.K7c", text: "c. Guidelines for use" },
          { code: "FI.I.C.K7d", text: "d. Types" },
          { code: "FI.I.C.K8", text: "Integrated flight instruction." },
          { code: "FI.I.C.K9", text: "Problem-based instruction." },
          { code: "FI.I.C.K10", text: "Planning instructional activity, including:" },
          { code: "FI.I.C.K10a", text: "a. Blocks of learning" },
          { code: "FI.I.C.K10b", text: "b. Training syllabus" },
          { code: "FI.I.C.K10c", text: "c. Lesson plans" },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.C.R1", text: "Selection of teaching methods." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.C.S1", text: "Prepare an instructional lesson plan using teaching methods and materials appropriate for Task and learner characteristics, including:" },
          { code: "FI.I.C.S1a", text: "a. Aeronautical knowledge ground lesson applicable for a classroom" },
          { code: "FI.I.C.S1b", text: "b. Maneuver introduction and ground lesson" },
        ]}
      ]
    },
    {
      id: "Task D", title: "Student Evaluation, Assessment, and Testing",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands evaluation and testing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.D.K1", text: "Purpose and characteristics of effective assessment." },
          { code: "FI.I.D.K2", text: "Traditional assessments." },
          { code: "FI.I.D.K3", text: "Authentic assessments, including:" },
          { code: "FI.I.D.K3a", text: "a. Learner-centered assessment" },
          { code: "FI.I.D.K3b", text: "b. Maneuver or procedure grades" },
          { code: "FI.I.D.K3c", text: "c. Assessing risk management skills" },
          { code: "FI.I.D.K4", text: "Choosing an effective assessment method." },
          { code: "FI.I.D.K5", text: "Purposes and types of critiques." },
          { code: "FI.I.D.K6", text: "Oral assessment, including:" },
          { code: "FI.I.D.K6a", text: "a. Characteristics of effective questions" },
          { code: "FI.I.D.K6b", text: "b. Types of questions to avoid" },
          { code: "FI.I.D.K6c", text: "c. Answering learner questions" },
          { code: "FI.I.D.K7", text: "Assessment of piloting ability." },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.D.R1", text: "Delivering an assessment." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.D.S1", text: "Use appropriate methods and techniques to assess learner performance in ground or flight training." },
        ]}
      ]
    },
    {
      id: "Task E", title: "Elements of Effective Teaching in a Professional Environment",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands effects of instructor behavior on effective teaching, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.E.K1", text: "Aviation instructor responsibilities, including:" },
          { code: "FI.I.E.K1a", text: "a. Helping learners" },
          { code: "FI.I.E.K1b", text: "b. Providing adequate instruction" },
          { code: "FI.I.E.K1c", text: "c. Training to established standards of performance" },
          { code: "FI.I.E.K1d", text: "d. Emphasizing the positive" },
          { code: "FI.I.E.K1e", text: "e. Minimizing learner frustrations" },
          { code: "FI.I.E.K2", text: "Flight instructor responsibilities, including supervision and surveillance during training." },
          { code: "FI.I.E.K3", text: "Flight instructor qualifications and professionalism." },
          { code: "FI.I.E.K4", text: "Professional development." },
          { code: "FI.I.E.K5", text: "Instructor ethics and conduct." },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.E.R1", text: "Fulfilling instructor responsibilities." },
          { code: "FI.I.E.R2", text: "Exhibiting professionalism." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.E.S1", text: "Deliver ground or flight instruction on an evaluator-assigned Task in a manner consistent with instructor responsibilities and professional characteristics as stated in K1 through K5." },
        ]}
      ]
    },
    {
      id: "Task F", title: "Elements of Effective Teaching that Include Risk Management and Accident Prevention",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands teaching practical risk management, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "FI.I.F.K1", text: "Teaching risk identification, assessment, and mitigation." },
          { code: "FI.I.F.K2", text: "Teaching risk management tools, including:" },
          { code: "FI.I.F.K2a", text: "a. Pilot/Aircraft/enVironment/External Pressures (PAVE) checklist" },
          { code: "FI.I.F.K2b", text: "b. Flight Risk Assessment Tools (FRATs)" },
          { code: "FI.I.F.K3", text: "When and how to introduce risk management." },
          { code: "FI.I.F.K4", text: "Risk management teaching techniques by phase of instruction." },
          { code: "FI.I.F.K5", text: "Managing risk during flight instruction, including:" },
          { code: "FI.I.F.K5a", text: "a. Common flight instruction risks" },
          { code: "FI.I.F.K5b", text: "b. Best practices" },
          { code: "FI.I.F.K5c", text: "c. Special considerations while teaching takeoffs and landings" },
          { code: "FI.I.F.K6", text: "Aeronautical Decision-Making (ADM) to include using Crew Resource Management (CRM) or Single-Pilot Resource Management (SRM), as appropriate." },
        ]},
        { label: "Risk Management", items: [
          { code: "FI.I.F.R1", text: "Hazards associated with providing flight instruction." },
          { code: "FI.I.F.R2", text: "Obstacles to maintaining situational awareness during flight instruction." },
          { code: "FI.I.F.R3", text: "Recognizing and managing hazards arising from human behavior, including hazardous attitudes." },
        ]},
        { label: "Skills", items: [
          { code: "FI.I.F.S1", text: "Use scenario-based training (SBT) to demonstrate, teach, and assess risk management and Aeronautical Decision-Making (ADM) skills in the context of a Task specified by the evaluator." },
          { code: "FI.I.F.S2", text: "Identify, assess, and mitigate risks commonly associated with flight instruction by maintaining:" },
          { code: "FI.I.F.S2a", text: "a. Awareness and oversight of the learner's actions, with timely and appropriate supervision, intervention, or mitigation as needed" },
          { code: "FI.I.F.S2b", text: "b. Awareness of the learner's cognitive/physiological state, with timely action to mitigate anxiety, fatigue, or other obstruction to learning" },
          { code: "FI.I.F.S2c", text: "c. Overall situational awareness of the aircraft's dynamic state, its position in space, and vigilance for unexpected events or changing circumstances that occur in the environment" },
          { code: "FI.I.F.S3", text: "Model and teach safety practices, including maintaining:" },
          { code: "FI.I.F.S3a", text: "a. Collision avoidance while simultaneously providing instruction" },
          { code: "FI.I.F.S3b", text: "b. Avoidance of unnecessary distractions" },
          { code: "FI.I.F.S3c", text: "c. Coordinated flight" },
          { code: "FI.I.F.S3d", text: "d. Awareness of who is manipulating controls through positive exchange of flight controls" },
          { code: "FI.I.F.S3e", text: "e. Continuous awareness of the aircraft's dynamic state and position in the NAS" },
        ]}
      ]
    }
  ]
};

function toggleInfoPopup(e, id) {
  e.stopPropagation();
  const popup = document.getElementById(id);
  if (!popup) return;

  // Move popup to body if not already there (prevents clipping by overflow:hidden parents)
  if (popup.parentElement !== document.body) {
    document.body.appendChild(popup);
  }

  const isOpen = popup.classList.contains('open');
  document.querySelectorAll('.info-popup.open').forEach(p => p.classList.remove('open'));
  if (!isOpen) {
    popup.classList.add('open');
    // Use the closest button/span as the anchor
    const trigger = e.target.closest('button, span') || e.target;
    const rect = trigger.getBoundingClientRect();
    const popupWidth = 420;
    const gap = 8;
    let left = rect.right + gap;
    if (left + popupWidth > window.innerWidth - 16) {
      left = rect.left - popupWidth - gap;
    }
    if (left < 8) left = 8;
    let top = rect.top;
    const popupHeight = 200;
    if (top + popupHeight > window.innerHeight - 16) {
      top = window.innerHeight - popupHeight - 16;
    }
    if (top < 8) top = 8;
    popup.style.left = left + 'px';
    popup.style.top = top + 'px';
  }
}

document.addEventListener('click', () => {
  document.querySelectorAll('.info-popup.open').forEach(p => p.classList.remove('open'));
});

// ── Formatting ────────────────────────────────────────────────────
function formatDoc(cmd) {
  document.execCommand(cmd, false, null);
  updateFormatButtons();
}

function updateFormatButtons() {
  const cmds = { bold: '.tb-bold', italic: '.tb-italic', underline: '.tb-underline' };
  Object.entries(cmds).forEach(([cmd, sel]) => {
    const isActive = document.queryCommandState(cmd);
    document.querySelectorAll(sel).forEach(btn => btn.classList.toggle('fmt-active', isActive));
  });
}

document.addEventListener('selectionchange', updateFormatButtons);

// ── Image insertion ───────────────────────────────────────────────
function insertImageInEditor(editor, src) {
  editor.focus();
  const img = document.createElement('img');
  img.src = src;
  img.style.cssText = 'max-width:100%;height:auto;display:block;margin:0.4rem 0;border-radius:3px;';
  img.contentEditable = 'false';
  const sel = window.getSelection();
  if (sel && sel.rangeCount) {
    const range = sel.getRangeAt(0);
    range.deleteContents();
    range.insertNode(img);
    range.setStartAfter(img);
    range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range);
  } else {
    editor.appendChild(img);
  }
  localStorage.setItem('cfi_' + editor.id, editor.innerHTML);
  showSaveIndicator();
}

// ── Build editor block ────────────────────────────────────────────
function buildEditorBlock(id, editorClass, placeholder, outerClass) {
  const wrapper = document.createElement('div');
  wrapper.className = 'editor-outer is-hidden-state ' + outerClass;

  // Toolbar
  const toolbar = document.createElement('div');
  toolbar.className = 'editor-toolbar';

  const imgInput = document.createElement('input');
  imgInput.type = 'file';
  imgInput.accept = 'image/*';
  imgInput.style.display = 'none';
  imgInput.addEventListener('change', () => {
    const file = imgInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => insertImageInEditor(editor, e.target.result);
    reader.readAsDataURL(file);
    imgInput.value = '';
  });

  toolbar.innerHTML = `
    <button class="tb-bold" onmousedown="event.preventDefault(); formatDoc('bold')" title="Bold">B</button>
    <button class="tb-italic" onmousedown="event.preventDefault(); formatDoc('italic')" title="Italic">I</button>
    <button class="tb-underline" onmousedown="event.preventDefault(); formatDoc('underline')" title="Underline">U</button>
    <span style="width:1px;background:var(--border);margin:0.1rem 0.2rem;align-self:stretch;"></span>
  `;

  const imgBtn = document.createElement('button');
  imgBtn.title = 'Insert Image';
  imgBtn.innerHTML = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="2" width="12" height="10" rx="1.5" stroke="currentColor" stroke-width="1.3"/><circle cx="4.5" cy="5.5" r="1" fill="currentColor"/><path d="M1 9.5L4 6.5L6.5 9L9 7L13 10.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
  imgBtn.onmousedown = (e) => { e.preventDefault(); editor.focus(); imgInput.click(); };
  toolbar.appendChild(imgBtn);
  toolbar.appendChild(imgInput);

  wrapper.appendChild(toolbar);

  // Editor
  const editor = document.createElement('div');
  editor.className = 'rich-editor ' + editorClass;
  editor.id = id;
  editor.contentEditable = 'false';
  editor.style.cursor = 'default';
  editor.setAttribute('data-placeholder', placeholder);

  editor.addEventListener('focus', () => {
    wrapper.classList.add('toolbar-active');
    const dotsBtn = wrapper.closest('.field-row, .task-summary-section')?.querySelector('.field-edit-btn');
    if (dotsBtn) {
      dotsBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><polyline points="1.5,6 5,9.5 10.5,2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
      dotsBtn.style.color = '#bbb';
    }
  });

  editor.addEventListener('blur', () => {
    setTimeout(() => {
      if (!wrapper.contains(document.activeElement)) {
        wrapper.classList.remove('toolbar-active');
        editor.contentEditable = 'false';
        editor.style.cursor = 'default';
        localStorage.setItem('cfi_' + id, editor.innerHTML);
        showSaveIndicator();
        // Update reveal placeholder
        const hasContent = editor.innerText.trim() !== '';
        revealDiv.textContent = hasContent ? 'Click to reveal' : '';
        revealDiv.classList.toggle('has-content', hasContent);
        // Re-attach click-to-hide after blur
        if (!wrapper.classList.contains('is-hidden-state')) {
        }
        // Reset dots btn
        const btn = wrapper.closest('.field-row, .task-summary-section')?.querySelector('.field-edit-btn');
        if (btn) { btn.textContent = '···'; btn.style.color = ''; }
      }
    }, 150);
  });

  editor.addEventListener('input', () => {
    localStorage.setItem('cfi_' + id, editor.innerHTML);
    showSaveIndicator();
  });

  editor.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && ['z', 'y', 'w'].includes(e.key.toLowerCase())) {
      e.stopPropagation();
    }
  });

  editor.addEventListener('paste', (e) => {
    const items = e.clipboardData && e.clipboardData.items;
    if (items) {
      for (const item of items) {
        if (item.type.startsWith('image/')) {
          e.preventDefault();
          const file = item.getAsFile();
          const reader = new FileReader();
          reader.onload = (ev) => insertImageInEditor(editor, ev.target.result);
          reader.readAsDataURL(file);
          return;
        }
      }
    }
    // Strip all formatting — paste as plain text only
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData('text/plain');
    if (text) {
      document.execCommand('insertText', false, text);
    }
  });
  // Clickable reveal placeholder
  const revealDiv = document.createElement('div');
  const hasContent = !!(localStorage.getItem('cfi_' + id)?.trim());
  revealDiv.className = 'reveal-placeholder' + (hasContent ? ' has-content' : '');
  revealDiv.textContent = hasContent ? 'Click to reveal' : '';
  revealDiv.addEventListener('click', () => {
    wrapper.classList.remove('is-hidden-state');
    editor.scrollTop = 0;
  });

  // Click on revealed editor hides it (unless in edit mode)
  editor.addEventListener('click', () => {
    if (!wrapper.classList.contains('toolbar-active') && editor.contentEditable !== 'true') {
      wrapper.classList.add('is-hidden-state');
      const dotsBtn = wrapper.closest('.field-row, .task-summary-section')?.querySelector('.field-edit-btn');
      if (dotsBtn) { dotsBtn.textContent = '···'; dotsBtn.style.color = ''; }
    }
  });

  wrapper.appendChild(revealDiv);
  wrapper.appendChild(editor);

  return wrapper;
}

// ── Build guide ───────────────────────────────────────────────────
function buildGuide(areaData) {
  const container = document.getElementById('studyGuide');
  const areaDiv = document.createElement('div');
  areaDiv.className = 'area';

  const areaIndex = areaData.areaIndex || 'I';
  const areaHeader = document.createElement('div');
  areaHeader.className = 'area-header collapsed';
  areaHeader.style.position = 'relative';
  const allRefs = [...new Set(areaData.tasks.map(t => t.refs).join(', ').split(', '))].join(', ');

  const noteId = 'area-note-' + areaIndex;
  const refsId = 'area-refs-' + areaIndex;
  const noteBtn = areaData.note ? `<button class="info-btn" title="Note" onclick="toggleInfoPopup(event,'${noteId}')" aria-label="Note" style="flex-shrink:0;margin-right:1rem;">i</button>` : '';
  areaHeader.innerHTML = `${noteBtn}<div style="flex:1;position:relative;"><h2>${areaData.area}</h2><div style="display:block;margin-top:0.1rem;"><span class="refs-toggle" onclick="toggleInfoPopup(event,'${refsId}')" style="font-size:0.55rem;font-family:'Barlow Condensed',sans-serif;letter-spacing:0.06em;text-transform:uppercase;color:rgba(255,255,255,0.45);cursor:pointer;display:inline-block;transition:transform 0.15s;">References</span></div></div><span class="chevron">+</span>`;

  if (areaData.note) {
    const notePopup = document.createElement('div');
    notePopup.className = 'info-popup';
    notePopup.id = noteId;
    notePopup.innerHTML = `<strong>Note</strong>${areaData.note}`;
    document.body.appendChild(notePopup);
  }

  // Create refs popup and append to body directly so it's never clipped
  const refsPopup = document.createElement('div');
  refsPopup.className = 'info-popup';
  refsPopup.id = refsId;
  refsPopup.innerHTML = `<strong>References</strong>${allRefs}`;
  document.body.appendChild(refsPopup);

  areaHeader.onclick = (e) => {
    if (e.target.closest('.info-btn')) return;
    areaBody.classList.toggle('hidden');
    areaHeader.classList.toggle('collapsed');
    areaHeader.querySelector('.chevron').textContent = areaBody.classList.contains('hidden') ? '+' : '−';
  };
  areaDiv.appendChild(areaHeader);

  const areaBody = document.createElement('div');
  areaBody.className = 'area-body hidden';
  const areaBodyInner = document.createElement('div');
  areaBodyInner.className = 'area-body-inner';
  areaBody.appendChild(areaBodyInner);

  areaData.tasks.forEach(task => {
    const taskDiv = document.createElement('div');
    taskDiv.className = 'task';
    if (task.category) {
      taskDiv.dataset.category = task.category;
      taskDiv.classList.add('category-task');
      taskDiv.style.display = 'none';
    }

    const taskHeader = document.createElement('div');
    taskHeader.className = 'task-header';
    taskHeader.style.position = 'relative';
    const objId = `obj-${areaIndex}-${task.id.replace(/\s/g,'-')}`;
    const objBtn = task.objective ? `<button class="info-btn obj-btn" title="Objective" onclick="toggleInfoPopup(event,'${objId}')" aria-label="Objective" style="border-color:rgba(255,255,255,0.2);color:#555;flex-shrink:0;margin-right:0.6rem;">i</button>` : '';
    const taskNoteId = `tasknote-${areaIndex}-${task.id.replace(/\s/g,'-')}`;
    const taskNoteBtn = task.taskNotes ? `<button class="task-note-btn" title="Note" onclick="toggleInfoPopup(event,'${taskNoteId}')" aria-label="Note">NOTE</button>` : '';
    taskHeader.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;">${objBtn}<div style="flex:1;display:flex;align-items:center;flex-wrap:wrap;gap:0.1rem 0;"><span><span class="task-ref">${task.id}.</span> ${task.title}</span>${taskNoteBtn}</div><span class="task-chevron">▾</span></div>`;

    if (task.objective) {
      const objPopup = document.createElement('div');
      objPopup.className = 'info-popup';
      objPopup.id = objId;
      objPopup.innerHTML = `<strong>Objective</strong>${task.objective}`;
      document.body.appendChild(objPopup);
    }
    if (task.taskNotes) {
      const taskNotePopup = document.createElement('div');
      taskNotePopup.className = 'info-popup';
      taskNotePopup.id = taskNoteId;
      taskNotePopup.innerHTML = `<strong>Note</strong>` + task.taskNotes.map(n => `<div style="margin-bottom:0.35rem;">${n}</div>`).join('');
      document.body.appendChild(taskNotePopup);
    }
    const taskBody = document.createElement('div');
    taskBody.className = 'task-body hidden';
    const taskBodyInner = document.createElement('div');
    taskBodyInner.className = 'task-body-inner';
    taskBody.appendChild(taskBodyInner);
    taskHeader.onclick = (e) => {
      if (e.target.closest('.info-btn') || e.target.closest('.task-note-btn')) return;
      taskBody.classList.toggle('hidden');
      const chevron = taskHeader.querySelector('.task-chevron');
      const isHidden = taskBody.classList.contains('hidden');
      chevron.style.transform = isHidden ? 'rotate(-90deg)' : 'rotate(0deg)';
      taskHeader.classList.toggle('expanded', !isHidden);
    };
    taskDiv.appendChild(taskHeader);

    task.sections.forEach(section => {
      const sectionWrapper = document.createElement('div');
      sectionWrapper.className = 'section-wrapper';

      const sectionLabel = document.createElement('div');
      sectionLabel.className = 'section-label';
      sectionLabel.innerHTML = `<span>${section.label}</span><span class="section-chevron">▾</span>`;

      const sectionBody = document.createElement('div');
      sectionBody.className = 'section-body hidden';
      const sectionBodyInner = document.createElement('div');
      sectionBodyInner.className = 'section-body-inner';
      sectionBody.appendChild(sectionBodyInner);

      sectionLabel.onclick = () => {
        sectionBody.classList.toggle('hidden');
        const isHidden = sectionBody.classList.contains('hidden');
        sectionLabel.querySelector('.section-chevron').style.transform = isHidden ? 'rotate(-90deg)' : 'rotate(0deg)';
        sectionWrapper.classList.toggle('open', !isHidden);
        sectionLabel.classList.toggle('expanded', !isHidden);
      };

      // Start collapsed
      sectionLabel.querySelector('.section-chevron').style.transform = 'rotate(-90deg)';

      sectionWrapper.appendChild(sectionLabel);
      sectionWrapper.appendChild(sectionBody);
      taskBodyInner.appendChild(sectionWrapper);

      section.items.forEach(item => {
        const safeCode = item.code.replace(/\./g, '_');
        const ansId = safeCode + '_ans';
        const sumId = safeCode + '_sum';

        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';

        const codeDiv = document.createElement('div');
        codeDiv.className = 'item-code';
        codeDiv.textContent = item.code;
        codeDiv.dataset.safe = safeCode;
        codeDiv.dataset.code = item.code;
        codeDiv.title = 'Click to bookmark';
        codeDiv.style.cursor = 'pointer';
        codeDiv.onclick = function(e) { e.stopPropagation(); setBookmark(this.dataset.code); return false; };

        itemDiv.appendChild(codeDiv);

        const fieldsDiv = document.createElement('div');
        fieldsDiv.className = 'item-fields';

        const titleRow = document.createElement('div');
        titleRow.className = 'item-title-row';

        const titleDiv = document.createElement('div');
        titleDiv.className = 'item-title';
        titleDiv.textContent = item.text;

        // Confidence dots
        const confKey = 'cfi_conf_' + safeCode;
        const savedConf = localStorage.getItem(confKey);

        const dotsRow = document.createElement('div');
        dotsRow.className = 'conf-dots-row';

        ['green', 'yellow', 'red'].forEach(color => {
          const dot = document.createElement('button');
          dot.className = 'conf-dot ' + color;
          dot.title = color === 'green' ? 'Know it well' : color === 'yellow' ? 'Needs more work' : 'Don\'t know it';
          if (savedConf === color) {
            dot.classList.add('active');
            titleDiv.classList.add('conf-' + color);
          }
          dot.onclick = (e) => {
            e.stopPropagation();
            const isActive = dot.classList.contains('active');
            dotsRow.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
            titleDiv.classList.remove('conf-green', 'conf-yellow', 'conf-red');
            if (isActive) {
              localStorage.removeItem(confKey);
            } else {
              dot.classList.add('active');
              titleDiv.classList.add('conf-' + color);
              localStorage.setItem(confKey, color);
            }
          };
          dotsRow.appendChild(dot);
        });

        titleRow.appendChild(titleDiv);
        titleRow.appendChild(dotsRow);
        fieldsDiv.appendChild(titleRow);

        // Answer field
        const ansRow = document.createElement('div');
        ansRow.className = 'field-row';
        const ansLabelRow = document.createElement('div');
        ansLabelRow.className = 'field-label-row';
        const ansLabel = document.createElement('div');
        ansLabel.className = 'field-label';
        ansLabel.textContent = 'Answer';
        const ansBtn = document.createElement('button');
        ansBtn.className = 'field-edit-btn';
        ansBtn.id = ansId + '_toggle_btn';
        ansBtn.textContent = '···';
        ansBtn.onclick = () => toggleFieldEdit(ansBtn, ansId);
        ansLabelRow.appendChild(ansLabel);
        ansLabelRow.appendChild(ansBtn);
        const ansEditorBlock = buildEditorBlock(ansId, '', 'Type your answer here...', 'answer-type');
        const ansEditor = ansEditorBlock.querySelector('.rich-editor');
        ansEditor.addEventListener('input', () => {
          ansLabel.classList.toggle('populated', ansEditor.innerHTML.trim() !== '' && ansEditor.innerText.trim() !== '');
          if (hideEmptyActive) ansRow.classList.toggle('is-empty', ansEditor.innerText.trim() === '');
        });
        const ansToggleRow = document.createElement('div');
        ansToggleRow.className = 'field-with-toggle';
        ansToggleRow.appendChild(ansEditorBlock);
        ansRow.appendChild(ansLabelRow);
        ansRow.appendChild(ansToggleRow);
        fieldsDiv.appendChild(ansRow);

        // Summary field
        const sumRow = document.createElement('div');
        sumRow.className = 'field-row';
        const sumLabelRow = document.createElement('div');
        sumLabelRow.className = 'field-label-row';
        const sumLabel = document.createElement('div');
        sumLabel.className = 'field-label';
        sumLabel.textContent = 'Summary/Notes';
        const sumBtn = document.createElement('button');
        sumBtn.className = 'field-edit-btn';
        sumBtn.id = sumId + '_toggle_btn';
        sumBtn.textContent = '···';
        sumBtn.onclick = () => toggleFieldEdit(sumBtn, sumId);
        sumLabelRow.appendChild(sumLabel);
        sumLabelRow.appendChild(sumBtn);
        const sumEditorBlock = buildEditorBlock(sumId, 'summary-editor', 'Brief summary or key concept...', 'summary-type');
        const sumEditor = sumEditorBlock.querySelector('.rich-editor');
        sumEditor.addEventListener('input', () => {
          sumLabel.classList.toggle('populated', sumEditor.innerHTML.trim() !== '' && sumEditor.innerText.trim() !== '');
          if (hideEmptyActive) sumRow.classList.toggle('is-empty', sumEditor.innerText.trim() === '');
        });
        const sumToggleRow = document.createElement('div');
        sumToggleRow.className = 'field-with-toggle';
        sumToggleRow.appendChild(sumEditorBlock);
        sumRow.appendChild(sumLabelRow);
        sumRow.appendChild(sumToggleRow);
        fieldsDiv.appendChild(sumRow);

        itemDiv.appendChild(codeDiv);
        itemDiv.appendChild(fieldsDiv);
        sectionBodyInner.appendChild(itemDiv);
      });

    });

    taskDiv.appendChild(taskBody);

    // Task overall summary — sits outside taskBody so always visible
    const taskSafeId = (areaIndex + '_' + task.id).replace(/\s/g, '_');
    const taskSumId = 'tasksummary_' + taskSafeId;
    const taskSumSection = document.createElement('div');
    taskSumSection.className = 'task-summary-section';
    const taskSumLabel = document.createElement('div');
    taskSumLabel.className = 'task-summary-label';
    taskSumLabel.textContent = task.id + ' — ' + task.title + ' — Overall Summary';
    taskSumSection.appendChild(taskSumLabel);
    const taskSumLabelRow = document.createElement('div');
    taskSumLabelRow.className = 'field-label-row';
    const taskSumInnerLabel = document.createElement('div');
    taskSumInnerLabel.className = 'field-label';
    taskSumInnerLabel.textContent = '';
    const taskSumBtn = document.createElement('button');
    taskSumBtn.className = 'field-edit-btn';
    taskSumBtn.id = taskSumId + '_toggle_btn';
    taskSumBtn.textContent = '···';
    taskSumBtn.onclick = () => toggleFieldEdit(taskSumBtn, taskSumId);
    taskSumLabelRow.appendChild(taskSumInnerLabel);
    taskSumLabelRow.appendChild(taskSumBtn);
    const taskSumToggleRow = document.createElement('div');
    taskSumToggleRow.className = 'field-with-toggle';
    taskSumToggleRow.appendChild(buildEditorBlock(taskSumId, 'task-summary-editor', 'Your overall summary of ' + task.id + '...', 'task-summary-type'));
    taskSumSection.appendChild(taskSumLabelRow);
    taskSumSection.appendChild(taskSumToggleRow);
    taskDiv.appendChild(taskSumSection);

    areaBodyInner.appendChild(taskDiv);
  });

  areaDiv.appendChild(areaBody);
  container.appendChild(areaDiv);
}

// ── Toggle reveal ─────────────────────────────────────────────────
function toggleFieldEdit(btn, editorId) {
  const editorOuter = document.getElementById(editorId)?.closest('.editor-outer');
  if (!editorOuter) return;
  const editor = editorOuter.querySelector('.rich-editor');
  const isEditing = editorOuter.classList.contains('toolbar-active');

  if (isEditing) {
    // ✓ clicked — exit edit mode, keep revealed
    editor.contentEditable = 'false';
    editor.style.cursor = 'default';
    editorOuter.classList.remove('toolbar-active');
    localStorage.setItem('cfi_' + editorId, editor.innerHTML);
    showSaveIndicator();
    btn.textContent = '···';
    btn.style.color = '';
    // Update reveal placeholder
    const revealDiv = editorOuter.querySelector('.reveal-placeholder');
    if (revealDiv) {
      const hasContent = editor.innerText.trim() !== '';
      revealDiv.textContent = hasContent ? 'Click to reveal' : '';
      revealDiv.classList.toggle('has-content', hasContent);
    }
  } else {
    // Reveal if hidden, then enter edit mode
    editorOuter.classList.remove('is-hidden-state');
    editor.scrollTop = 0;
    editor.contentEditable = 'true';
    editor.style.cursor = '';
    editorOuter.classList.add('toolbar-active');
    editor.focus();
    btn.innerHTML = `<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><polyline points="1.5,6 5,9.5 10.5,2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    btn.style.color = '#bbb';
  }
}

let answersRevealed = false;

let hideEmptyActive = false;

function toggleHideEmpty() {
  hideEmptyActive = !hideEmptyActive;
  const btn = document.getElementById('hideEmptyBtn');
  const main = document.querySelector('.main');

  if (hideEmptyActive) {
    // Hide empty field-rows
    document.querySelectorAll('.field-row').forEach(row => {
      const editor = row.querySelector('.rich-editor');
      const saved = editor ? (localStorage.getItem('cfi_' + editor.id) || '') : '';
      const isEmpty = saved.replace(/<[^>]*>/g, '').trim() === '';
      row.classList.toggle('is-empty', isEmpty);
      if (isEmpty) row.style.display = 'none';
    });
    // Hide empty task-summary-sections
    document.querySelectorAll('.task-summary-section').forEach(row => {
      const editor = row.querySelector('.rich-editor');
      const saved = editor ? (localStorage.getItem('cfi_' + editor.id) || '') : '';
      const isEmpty = saved.replace(/<[^>]*>/g, '').trim() === '';
      if (isEmpty) row.style.display = 'none';
    });
    if (main) main.classList.add('hide-empty-mode');
    if (btn) { btn.textContent = 'Show Empty Fields'; btn.classList.add('active'); }
  } else {
    // Show all field-rows and task-summary-sections
    document.querySelectorAll('.field-row').forEach(row => {
      row.classList.remove('is-empty');
      row.style.display = '';
    });
    document.querySelectorAll('.task-summary-section').forEach(row => {
      row.style.display = '';
    });
    document.querySelectorAll('.editor-outer').forEach(el => {
      el.style.display = '';
    });
    if (main) main.classList.remove('hide-empty-mode');
    if (btn) { btn.textContent = 'Hide Empty Fields'; btn.classList.remove('active'); }
  }
  // Update modern fab items
  document.querySelectorAll('.m-fab-item').forEach(function(el) {
    if (el.textContent.trim().match(/^(Hide|Show) Empty/i)) {
      el.textContent = hideEmptyActive ? 'Show Empty' : 'Hide Empty';
    }
  });
  localStorage.setItem('cfi_hideEmpty', hideEmptyActive ? '1' : '0');
}

// ── Category Filter (AMEL, ASES, AMES) ──────────────────────────
const categoryState = { AMEL: false, ASES: false, AMES: false };

function togglePlaneClassMenu() {
  const menu = document.getElementById('planeClassMenu');
  // Close other menus first
  document.querySelectorAll('.more-options-menu.open').forEach(m => { if (m !== menu) m.classList.remove('open'); });
  menu.classList.toggle('open');
}

function togglePlaneClassPopup() {
  var overlay = document.getElementById('planeClassPopupOverlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'planeClassPopupOverlay';
    overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:600;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;';
    var card = document.createElement('div');
    card.style.cssText = 'position:relative;background:rgba(20,20,20,0.97);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);border:1px solid rgba(255,255,255,0.06);border-radius:18px;box-shadow:none;padding:1.5rem 2rem;min-width:280px;display:flex;flex-direction:column;gap:0.8rem;align-items:center;';
    card.id = 'planeClassPopupCard';
    var closeBtn = document.createElement('button');
    closeBtn.innerHTML = '✕';
    closeBtn.style.cssText = 'position:absolute;top:0.8rem;right:1rem;background:none;border:none;color:rgba(255,255,255,0.2);font-size:0.9rem;cursor:pointer;padding:0.2rem;line-height:1;';
    closeBtn.onmouseover = function() { this.style.color = 'rgba(255,255,255,0.6)'; };
    closeBtn.onmouseout = function() { this.style.color = 'rgba(255,255,255,0.2)'; };
    closeBtn.onclick = function() { togglePlaneClassPopup(); };
    var title = document.createElement('div');
    title.style.cssText = 'font-family:"Barlow",sans-serif;font-weight:700;font-size:0.78rem;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.6);text-align:center;';
    title.textContent = 'Plane Class';
    card.appendChild(closeBtn);
    card.appendChild(title);

    ['AMEL', 'ASES', 'AMES'].forEach(function(cat) {
      var row = document.createElement('button');
      row.id = 'mCat' + cat;
      row.style.cssText = 'width:100%;padding:0.6rem 1rem;background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:12px;color:rgba(255,255,255,0.4);font-family:"Barlow Condensed",sans-serif;font-size:0.68rem;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 0.15s;';
      var label = document.createElement('span');
      label.textContent = cat;
      var status = document.createElement('span');
      status.className = 'mcat-status';
      status.style.cssText = 'font-size:0.5rem;letter-spacing:0.06em;';
      status.textContent = categoryState[cat] ? 'ON' : 'OFF';
      if (categoryState[cat]) {
        row.style.borderColor = 'rgba(46,139,87,0.3)';
        row.style.color = 'rgba(255,255,255,0.7)';
        status.style.color = '#2e8b57';
      } else {
        status.style.color = 'rgba(255,255,255,0.15)';
      }
      row.appendChild(label);
      row.appendChild(status);
      row.onclick = function() {
        toggleCategoryFilter(cat);
        // Update this button's appearance
        var isOn = categoryState[cat];
        status.textContent = isOn ? 'ON' : 'OFF';
        if (isOn) {
          row.style.borderColor = 'rgba(46,139,87,0.3)';
          row.style.color = 'rgba(255,255,255,0.7)';
          status.style.color = '#2e8b57';
        } else {
          row.style.borderColor = 'rgba(255,255,255,0.06)';
          row.style.color = 'rgba(255,255,255,0.4)';
          status.style.color = 'rgba(255,255,255,0.15)';
        }
        // Also rebuild modern cards to reflect filter
        if (typeof mBuildCards === 'function') mBuildCards();
      };
      row.onmouseover = function() { if (!categoryState[cat]) { row.style.borderColor = 'rgba(255,255,255,0.15)'; row.style.color = 'rgba(255,255,255,0.6)'; } };
      row.onmouseout = function() { if (!categoryState[cat]) { row.style.borderColor = 'rgba(255,255,255,0.06)'; row.style.color = 'rgba(255,255,255,0.4)'; } };
      card.appendChild(row);
    });

    overlay.appendChild(card);
    document.body.appendChild(overlay);
    overlay.addEventListener('click', function(e) { if (e.target === overlay) togglePlaneClassPopup(); });
  }
  var isOpen = overlay.classList.contains('m-pop-in');
  if (isOpen) {
    overlay.style.pointerEvents = 'none';
    mPopClose(overlay, function() {
      overlay.style.opacity = '0';
    });
  } else {
    // Sync button states before showing
    ['AMEL', 'ASES', 'AMES'].forEach(function(cat) {
      var row = document.getElementById('mCat' + cat);
      if (!row) return;
      var status = row.querySelector('.mcat-status');
      var isOn = categoryState[cat];
      status.textContent = isOn ? 'ON' : 'OFF';
      if (isOn) {
        row.style.borderColor = 'rgba(46,139,87,0.3)';
        row.style.color = 'rgba(255,255,255,0.7)';
        status.style.color = '#2e8b57';
      } else {
        row.style.borderColor = 'rgba(255,255,255,0.06)';
        row.style.color = 'rgba(255,255,255,0.4)';
        status.style.color = 'rgba(255,255,255,0.15)';
      }
    });
    overlay.style.opacity = '1';
    overlay.style.pointerEvents = 'all';
    mPopOpen(overlay);
  }
}

function toggleCategoryFilter(cat) {
  categoryState[cat] = !categoryState[cat];
  const btn = document.getElementById('cat' + cat);
  const status = btn.querySelector('.cat-status');
  if (categoryState[cat]) {
    status.textContent = 'ON';
    status.style.opacity = '1';
    status.style.color = '#2e8b57';
    btn.style.color = '#222';
  } else {
    status.textContent = 'OFF';
    status.style.opacity = '0.5';
    status.style.color = '';
    btn.style.color = '#555';
  }
  applyCategoryFilters();
  localStorage.setItem('cfi_catFilters', JSON.stringify(categoryState));
}

function applyCategoryFilters() {
  document.querySelectorAll('.task[data-category]').forEach(taskEl => {
    const cat = taskEl.dataset.category;
    let show = false;
    if (cat === 'ASES/AMES') {
      show = categoryState.ASES || categoryState.AMES;
    } else if (cat === 'AMEL') {
      show = categoryState.AMEL;
    } else if (cat === 'ASES') {
      show = categoryState.ASES;
    } else if (cat === 'AMES') {
      show = categoryState.AMES;
    }
    taskEl.style.display = show ? '' : 'none';
  });
  // Also filter modern card task rows
  document.querySelectorAll('.m-task-row[data-category]').forEach(row => {
    const cat = row.dataset.category;
    let show = false;
    if (cat === 'ASES/AMES') {
      show = categoryState.ASES || categoryState.AMES;
    } else if (cat === 'AMEL') {
      show = categoryState.AMEL;
    } else if (cat === 'ASES') {
      show = categoryState.ASES;
    } else if (cat === 'AMES') {
      show = categoryState.AMES;
    }
    row.style.display = show ? '' : 'none';
  });
  // Also filter grid view task rows
  document.querySelectorAll('.m-grid-task[data-category]').forEach(row => {
    const cat = row.dataset.category;
    let show = false;
    if (cat === 'ASES/AMES') {
      show = categoryState.ASES || categoryState.AMES;
    } else if (cat === 'AMEL') {
      show = categoryState.AMEL;
    } else if (cat === 'ASES') {
      show = categoryState.ASES;
    } else if (cat === 'AMES') {
      show = categoryState.AMES;
    }
    row.style.display = show ? '' : 'none';
  });
  // Hide/show Area XIII card (Multiengine Operations) based on AMEL/AMES
  var showXIII = categoryState.AMEL || categoryState.AMES;
  document.querySelectorAll('.m-card[data-area-index="XIII"]').forEach(function(card) {
    card.style.display = showXIII ? '' : 'none';
    // Also hide/show corresponding dot
    var idx = parseInt(card.dataset.index);
    var dots = document.querySelectorAll('.m-dot');
    if (dots[idx]) dots[idx].style.display = showXIII ? '' : 'none';
  });
  // Also hide XIII in grid view
  document.querySelectorAll('.m-grid-card').forEach(function(gc) {
    var roman = gc.querySelector('.m-grid-roman');
    if (roman && roman.textContent.trim() === 'XIII') {
      gc.style.display = showXIII ? '' : 'none';
    }
  });
  // If current carousel position is on hidden XIII card, navigate away
  if (!showXIII && typeof mIdx !== 'undefined') {
    var currentCard = document.querySelector('.m-card[data-index="'+mIdx+'"]');
    if (currentCard && currentCard.dataset.areaIndex === 'XIII') {
      mGo(Math.max(0, mIdx - 1));
    }
  }
}

function loadCategoryFilters() {
  try {
    const saved = localStorage.getItem('cfi_catFilters');
    if (saved) {
      const parsed = JSON.parse(saved);
      Object.keys(parsed).forEach(k => {
        if (k in categoryState && parsed[k]) {
          categoryState[k] = true;
          const btn = document.getElementById('cat' + k);
          if (btn) {
            const status = btn.querySelector('.cat-status');
            status.textContent = 'ON';
            status.style.opacity = '1';
            status.style.color = '#2e8b57';
            btn.style.color = '#222';
          }
        }
      });
      applyCategoryFilters();
    }
  } catch(e) {}
}

function toggleRevealHide() {
  const btn = document.getElementById('revealHideBtn');
  var isModern = document.body.classList.contains('modern-mode');
  // Get all editor-outers including those in expanded view
  var allEditors = document.querySelectorAll('.editor-outer');
  var expBody = document.getElementById('mExpB');

  if (!answersRevealed) {
    // Reveal only populated editors
    allEditors.forEach(el => {
      const editor = el.querySelector('.rich-editor');
      var savedContent = editor && editor.id ? (localStorage.getItem('cfi_' + editor.id) || '') : '';
      var editorText = editor ? editor.innerText.trim() : '';
      var hasContent = editorText !== '' || savedContent.replace(/<[^>]*>/g, '').trim() !== '';
      if (hasContent) {
        el.classList.remove('is-hidden-state');
        el.style.display = '';
        var fieldRow = el.closest('.field-row') || el.closest('.task-summary-section');
        if (fieldRow) fieldRow.style.display = '';
        if (editor) {
          editor.contentEditable = 'false';
          editor.style.cursor = 'default';
          editor.scrollTop = 0;
        }
      } else {
        // Empty - keep hidden
        el.style.display = 'none';
        var fieldRow = el.closest('.field-row') || el.closest('.task-summary-section');
        if (fieldRow) fieldRow.style.display = 'none';
      }
    });
    if (btn) { btn.textContent = 'Hide All Answers'; btn.classList.remove('btn-reveal'); btn.classList.add('btn-hide-all'); }
    answersRevealed = true;
  } else {
    // Hide all editors
    allEditors.forEach(el => {
      el.classList.remove('toolbar-active');
      el.classList.add('is-hidden-state');
      const editor = el.querySelector('.rich-editor');
      var hasContent = editor && editor.innerText.trim() !== '';
      if (isModern && !hasContent) {
        el.style.display = 'none';
        var fieldRow = el.closest('.field-row') || el.closest('.task-summary-section');
        if (fieldRow) fieldRow.style.display = 'none';
      }
    });
    document.querySelectorAll('.field-edit-btn').forEach(b => { b.textContent = '···'; b.style.color = ''; });
    if (btn) { btn.textContent = 'Reveal All Answers'; btn.classList.remove('btn-hide-all'); btn.classList.add('btn-reveal'); }
    answersRevealed = false;
  }
  // Update modern fab items
  document.querySelectorAll('.m-fab-item').forEach(function(el) {
    if (el.textContent.trim().match(/^(Reveal|Hide) All/i)) {
      el.textContent = answersRevealed ? 'Hide All Answers' : 'Reveal All Answers';
    }
  });
  localStorage.setItem('cfi_answersRevealed', answersRevealed ? '1' : '0');
}

let tasksExpanded = false;

function toggleExpandCollapse() {
  const btn = document.getElementById('expandCollapseBtn');
  if (!tasksExpanded) {
    document.querySelectorAll('.area-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.area-header').forEach(el => { el.classList.remove('collapsed'); const c = el.querySelector('.chevron'); if(c) c.textContent = '−'; });
    document.querySelectorAll('.task-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.task-header').forEach(el => el.classList.add('expanded'));
    document.querySelectorAll('.task-chevron').forEach(el => el.style.transform = 'rotate(0deg)');
    document.querySelectorAll('.section-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.section-label').forEach(el => el.classList.add('expanded'));
    document.querySelectorAll('.section-chevron').forEach(el => el.style.transform = 'rotate(0deg)');
    btn.textContent = 'Collapse All Tasks';
    tasksExpanded = true;
  } else {
    document.querySelectorAll('.task-body').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.task-header').forEach(el => el.classList.remove('expanded'));
    document.querySelectorAll('.task-chevron').forEach(el => el.style.transform = 'rotate(-90deg)');
    document.querySelectorAll('.section-body').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.section-label').forEach(el => el.classList.remove('expanded'));
    document.querySelectorAll('.section-chevron').forEach(el => el.style.transform = 'rotate(-90deg)');
    btn.textContent = 'Expand All Tasks';
    tasksExpanded = false;
  }
  document.querySelectorAll('.m-fab-item').forEach(function(el) {
    if (el.textContent.trim().match(/^(Expand|Collapse) All/i)) {
      el.textContent = tasksExpanded ? 'Collapse All' : 'Expand All';
    }
  });
  localStorage.setItem('cfi_tasksExpanded', tasksExpanded ? '1' : '0');
}

function restoreUIState() {
  if (localStorage.getItem('cfi_answersRevealed') === '1') toggleRevealHide();
  if (localStorage.getItem('cfi_tasksExpanded') === '1') toggleExpandCollapse();
  if (localStorage.getItem('cfi_hideEmpty') === '1') toggleHideEmpty();
}

// ── Save / Load ───────────────────────────────────────────────────
function loadAll() {
  document.querySelectorAll('.rich-editor').forEach(el => {
    const saved = localStorage.getItem('cfi_' + el.id);
    if (saved !== null) el.innerHTML = saved;
  });
  // Update reveal placeholders, hidden state, and field labels based on loaded content
  // Use innerHTML check (not innerText) because elements may be visibility:hidden
  document.querySelectorAll('.editor-outer').forEach(outer => {
    const editor = outer.querySelector('.rich-editor');
    if (!editor) return;
    const saved = localStorage.getItem('cfi_' + editor.id);
    const hasContent = saved && saved.trim() !== '' && saved.replace(/<[^>]*>/g, '').trim() !== '';
    const revealDiv = outer.querySelector('.reveal-placeholder');
    if (hasContent) {
      outer.classList.add('is-hidden-state');
      if (revealDiv) {
        revealDiv.textContent = 'Click to reveal';
        revealDiv.classList.add('has-content');
      }
    } else {
      outer.classList.remove('is-hidden-state');
      if (revealDiv) {
        revealDiv.textContent = '';
        revealDiv.classList.remove('has-content');
      }
    }
  });
  // Set initial populated state on labels — check localStorage directly
  document.querySelectorAll('.field-label').forEach(label => {
    const toggleRow = label.closest('.field-label-row')?.nextElementSibling;
    if (!toggleRow) return;
    const editor = toggleRow.querySelector('.rich-editor');
    if (!editor) return;
    const saved = localStorage.getItem('cfi_' + editor.id) || '';
    const hasContent = saved.trim() !== '' && saved.replace(/<[^>]*>/g, '').trim() !== '';
    label.classList.toggle('populated', hasContent);
  });
  loadCategoryFilters();
}

function showSaveIndicator() {
  const ind = document.getElementById('save-indicator');
  ind.textContent = 'Saving...';
  ind.style.opacity = '1';
  clearTimeout(ind._timer);
  ind._timer = setTimeout(() => {
    ind.textContent = '✓ Saved';
    setTimeout(() => { ind.style.opacity = '0'; }, 1500);
  }, 500);
}

// ── Export / Import ───────────────────────────────────────────────
function exportAnswers() {
  const data = { answers: {}, confidence: {}, bookmark: null, links: null, version: 2 };

  // Answers — read from localStorage as source of truth, not DOM
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('cfi_') &&
        !k.startsWith('cfi_conf_') &&
        !k.startsWith('cfi_answersRevealed') &&
        !k.startsWith('cfi_tasksExpanded') &&
        !k.startsWith('cfi_bookmark') &&
        !k.startsWith('cfi_links') &&
        !k.startsWith('cfi_notes') &&
        !k.startsWith('cfi_pw_') &&
        !k.startsWith('cfi_lock') &&
        !k.startsWith('cfi_hide') &&
        !k.startsWith('cfi_oral')) {
      const val = localStorage.getItem(k);
      if (val && val.trim()) data.answers[k.replace(/^cfi_/, '')] = val;
    }
  });

  // Also sweep DOM for any unsaved in-progress edits
  document.querySelectorAll('.rich-editor').forEach(el => {
    if (el.id && el.innerHTML.trim()) {
      data.answers[el.id] = el.innerHTML;
      localStorage.setItem('cfi_' + el.id, el.innerHTML); // ensure saved
    }
  });

  // Confidence ratings
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('cfi_conf_')) data.confidence[k] = localStorage.getItem(k);
  });

  // Bookmark
  const bookmark = localStorage.getItem('cfi_bookmark');
  if (bookmark) data.bookmark = bookmark;

  // Custom links
  const links = localStorage.getItem('cfi_links');
  if (links) data.links = JSON.parse(links);

  // Notes
  const notes = localStorage.getItem('cfi_notes');
  if (notes) data.notes = notes;

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'cfi_acs_progress.json'; a.click();
  URL.revokeObjectURL(url);
  const ind = document.getElementById('save-indicator');
  ind.textContent = '✓ Exported!'; ind.style.opacity = '1';
  setTimeout(() => { ind.style.opacity = '0'; }, 2000);
}

function importAnswers(event) {
  const file = event.target.files[0];
  if (!file) { alert('No file selected'); return; }
  const ind = document.getElementById('save-indicator');
  ind.textContent = 'Reading file...'; ind.style.opacity = '1';
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);

      // Support old format (flat object of answers)
      const answers = data.answers || data;
      const confidence = data.confidence || {};
      const bookmark = data.bookmark || null;
      const links = data.links || null;

      // Restore answers — always write to localStorage, update DOM if element exists
      Object.entries(answers).forEach(([id, html]) => {
        localStorage.setItem('cfi_' + id, html);
        const el = document.getElementById(id);
        if (el) el.innerHTML = html;
      });

      // Restore confidence ratings
      Object.entries(confidence).forEach(([k, v]) => {
        localStorage.setItem(k, v);
      });
      // Clear all existing active dots and title conf classes first
      document.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
      document.querySelectorAll('.item-title').forEach(t => t.classList.remove('conf-green', 'conf-yellow', 'conf-red'));
      // Re-apply confidence UI
      document.querySelectorAll('.conf-dot').forEach(dot => {
        const item = dot.closest('.item');
        if (!item) return;
        const codeEl = item.querySelector('.item-code');
        if (!codeEl) return;
        const safeCode = codeEl.textContent.trim().replace(/\./g, '_');
        const confKey = 'cfi_conf_' + safeCode;
        const saved = localStorage.getItem(confKey);
        const titleDiv = item.querySelector('.item-title');
        if (saved && dot.classList.contains(saved)) {
          dot.classList.add('active');
          if (titleDiv) titleDiv.classList.add('conf-' + saved);
        }
      });

      // Restore bookmark
      if (bookmark) {
        localStorage.setItem('cfi_bookmark', bookmark);
        document.getElementById('bookmarkBanner').classList.add('visible');
        applyBookmarkUI(bookmark);
      }

      // Restore links
      if (links) {
        localStorage.setItem('cfi_links', JSON.stringify(links));
      }

      // Restore notes
      if (data.notes) {
        localStorage.setItem('cfi_notes', data.notes);
        const notesEditor = document.getElementById('notesEditor');
        if (notesEditor) notesEditor.innerHTML = data.notes;
      }

      // Re-populate all editors from localStorage now that data is written
      loadAll();
      restoreUIState();

      // Refresh populated labels and hide-empty state for all fields
      document.querySelectorAll('.field-row').forEach(row => {
        const editor = row.querySelector('.rich-editor');
        if (!editor) return;
        const hasContent = editor.innerText.trim() !== '';
        const label = row.querySelector('.field-label');
        if (label) label.classList.toggle('populated', hasContent);
        if (hideEmptyActive) row.classList.toggle('is-empty', !hasContent);
      });

      const answerCount = Object.keys(answers).length;
      const ind = document.getElementById('save-indicator');
      ind.textContent = `✓ Imported ${answerCount} fields!`; ind.style.opacity = '1';
      setTimeout(() => { ind.style.opacity = '0'; }, 2500);
    } catch(err) {
      alert('Import error: ' + err.message + '\n\n' + err.stack);
    }
  };
  reader.readAsText(file);
  event.target.value = '';
}

function clearSaved() {
  if (!document.body.classList.contains('modern-mode')) toggleMoreOptions();
  resetClearConfirm();
  var el = document.getElementById('clearConfirmOverlay');
  el.classList.add('open');
  mPopOpen(el);
}

function resetClearConfirm() {
  document.getElementById('clearConfirmTitle').textContent = 'Clear All Saved Answers?';
  document.getElementById('clearConfirmBtn').textContent = 'Clear All';
  document.getElementById('clearConfirmBtn')._step = 1;
}

function clearConfirmStep() {
  const btn = document.getElementById('clearConfirmBtn');
  if (!btn._step || btn._step === 1) {
    document.getElementById('clearConfirmTitle').textContent = 'This cannot be undone. Are you absolutely sure?';
    btn.textContent = 'Yes, Delete Everything';
    btn._step = 2;
  } else {
    executeClearSaved();
    resetClearConfirm();
  }
}

function executeClearSaved() {
  var ccEl = document.getElementById('clearConfirmOverlay');
  mPopClose(ccEl, function() { ccEl.classList.remove('open'); });
  Object.keys(localStorage).forEach(k => { if (k.startsWith('cfi_')) localStorage.removeItem(k); });
  document.querySelectorAll('.rich-editor').forEach(el => el.innerHTML = '');
  // Clear reveal placeholders so empty fields don't show "Click to reveal"
  document.querySelectorAll('.reveal-placeholder').forEach(div => {
    div.textContent = '';
    div.classList.remove('has-content');
  });
  // Reset reveal state
  answersRevealed = false;
  const revealBtn = document.getElementById('revealHideBtn');
  if (revealBtn) revealBtn.textContent = 'Reveal All Answers';
  document.querySelectorAll('.rich-editor').forEach(el => el.classList.remove('revealed'));
  document.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
  document.querySelectorAll('.item-title').forEach(t => t.classList.remove('conf-green', 'conf-yellow', 'conf-red'));
  document.querySelectorAll('.item-code').forEach(el => el.classList.remove('bookmarked'));
  document.querySelectorAll('.item').forEach(el => el.classList.remove('is-bookmarked'));
  document.querySelectorAll('.area-header, .task-header, .section-label').forEach(h => h.classList.remove('bookmark-highlight'));
  document.getElementById('bookmarkBanner').classList.remove('visible');
  const ind = document.getElementById('save-indicator');
  ind.textContent = 'Cleared'; ind.style.opacity = '1';
  setTimeout(() => { ind.style.opacity = '0'; }, 2000);
}

function manualSave() {
  document.querySelectorAll('.rich-editor').forEach(el => {
    if (el.id) localStorage.setItem('cfi_' + el.id, el.innerHTML);
  });
  const btn = document.querySelector('.manual-save-btn');
  const lbl = btn.querySelector('.save-label');
  if (lbl) {
    lbl.textContent = 'SAVING...';
    clearTimeout(btn._saveTimer);
    btn._saveTimer = setTimeout(() => {
      lbl.textContent = 'SAVED';
      setTimeout(() => { lbl.textContent = 'SAVE'; }, 1500);
    }, 500);
  }
  showSaveIndicator();
}

// ── Links management ──────────────────────────────────────────────
const DEFAULT_LINKS = [
  { title: "Aviation Instructor's Handbook", url: "https://www.faa.gov/sites/faa.gov/files/regulations_policies/handbooks_manuals/aviation/aviation_instructors_handbook/aviation_instructors_handbook.pdf" },
  { title: "Pilot's Handbook of Aeronautical Knowledge", url: "https://www.faa.gov/regulations_policies/handbooks_manuals/aviation/faa-h-8083-25c.pdf" },
  { title: "CFI ACS", url: "https://www.faa.gov/training_testing/testing/acs/cfi_airplane_acs_25.pdf" }
];

function getLinks() {
  const saved = localStorage.getItem('cfi_links');
  return saved ? JSON.parse(saved) : DEFAULT_LINKS;
}

function saveLinks(links) {
  localStorage.setItem('cfi_links', JSON.stringify(links));
}

let linksEditMode = false;
let linksPopupEditMode = false;

function renderLinks() {
  const list = document.getElementById('linksList');
  const links = getLinks();
  list.innerHTML = '';

  links.forEach((link, i) => {
    const row = document.createElement('div');
    row.style.cssText = 'display:flex;align-items:center;';

    const a = document.createElement('a');
    a.href = link.url;
    a.target = '_blank';
    a.textContent = link.title;
    a.style.cssText = 'flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0.6rem 1rem;';

    if (linksEditMode) {
      const del = document.createElement('button');
      del.textContent = 'Remove';
      del.title = 'Remove';
      del.style.cssText = 'display:block;width:100%;background:transparent;border:none;color:#c0392b;font-size:0.58rem;font-family:"Barlow Condensed",sans-serif;text-transform:uppercase;letter-spacing:0.06em;cursor:pointer;padding:0.25rem 1rem 0.4rem;text-align:left;';
      del.onclick = (e) => {
        e.stopPropagation();
        if (!confirm(`Remove "${link.title}"?`)) return;
        const links = getLinks();
        links.splice(i, 1);
        saveLinks(links);
        renderLinks();
      };
      row.style.cssText = 'display:flex;flex-direction:column;';
      a.style.cssText = 'padding:0.6rem 1rem 0.2rem;white-space:normal;word-break:break-word;';
      row.appendChild(a);
      row.appendChild(del);
    } else {
      row.style.cssText = 'display:flex;align-items:center;';
      row.appendChild(a);
    }

    list.appendChild(row);
  });

  // Edit toggle button
  const editBtn = document.createElement('button');
  editBtn.textContent = linksEditMode ? 'Done Editing' : 'Edit Links';
  editBtn.className = 'link-btn-edit';
  editBtn.style.cssText = 'width:100%;padding:0.5rem 1rem;background:transparent;border:none;color:#d95f1a;font-family:"Barlow Condensed",sans-serif;font-size:0.63rem;text-transform:uppercase;letter-spacing:0.06em;cursor:pointer;text-align:left;box-sizing:border-box;';
  editBtn.onclick = (e) => {
    e.stopPropagation();
    linksEditMode = !linksEditMode;
    renderLinks();
  };
  list.appendChild(editBtn);
}

function showAddLink() {
  document.getElementById('linksAddRow').style.display = 'block';
  document.getElementById('addLinkBtn').style.display = 'none';
  document.getElementById('linkTitle').focus();
}

function cancelAddLink() {
  document.getElementById('linksAddRow').style.display = 'none';
  document.getElementById('addLinkBtn').style.display = 'block';
  document.getElementById('linkTitle').value = '';
  document.getElementById('linkUrl').value = '';
}

async function pasteUrl() {
  try {
    const text = await navigator.clipboard.readText();
    document.getElementById('linkUrl').value = text;
  } catch(e) {
    alert('Clipboard access denied. Please paste manually with Ctrl+V / Cmd+V.');
  }
}

function saveNewLink() {
  const title = document.getElementById('linkTitle').value.trim();
  const url = document.getElementById('linkUrl').value.trim();
  if (!title || !url) { alert('Please enter a name and a URL.'); return; }
  const links = getLinks();
  links.push({ title, url: url.startsWith('http') ? url : 'https://' + url });
  saveLinks(links);
  renderLinks();
  cancelAddLink();
}

function toggleLinks() {
  var isModern = document.body.classList.contains('modern-mode');
  if (isModern) {
    // Modern mode: use centered popup overlay
    var overlay = document.getElementById('linksPopupOverlay');
    if (!overlay) {
      // Create the overlay once
      overlay = document.createElement('div');
      overlay.id = 'linksPopupOverlay';
      overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:600;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:none;';
      var card = document.createElement('div');
      card.id = 'linksPopupCard';
      card.style.cssText = 'position:relative;background:rgba(20,20,20,0.97);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);border:1px solid rgba(255,255,255,0.06);border-radius:18px;box-shadow:none;padding:1.5rem 1.8rem;min-width:320px;max-width:90vw;max-height:80vh;overflow-y:auto;display:flex;flex-direction:column;gap:0.3rem;';
      var title = document.createElement('div');
      title.style.cssText = 'font-family:"Barlow",sans-serif;font-weight:700;font-size:0.78rem;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.6);text-align:center;margin-bottom:0.5rem;';
      title.textContent = 'Links';
      var closeBtn = document.createElement('button');
      closeBtn.innerHTML = '✕';
      closeBtn.style.cssText = 'position:absolute;top:0.8rem;right:1rem;background:none;border:none;color:rgba(255,255,255,0.2);font-size:0.9rem;cursor:pointer;padding:0.2rem;line-height:1;';
      closeBtn.onmouseover = function() { this.style.color = 'rgba(255,255,255,0.6)'; };
      closeBtn.onmouseout = function() { this.style.color = 'rgba(255,255,255,0.2)'; };
      closeBtn.onclick = function() { toggleLinks(); };
      var listWrap = document.createElement('div');
      listWrap.id = 'linksPopupList';
      // Add link row
      var addRow = document.createElement('div');
      addRow.id = 'linksPopupAddRow';
      addRow.style.cssText = 'display:none;padding:0.5rem 0;';
      addRow.innerHTML = '<input id="linksPopupTitle" placeholder="Name (e.g. FAA Handbook)" style="width:100%;padding:0.5rem 0.7rem;margin-bottom:0.4rem;box-sizing:border-box;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:10px;color:rgba(255,255,255,0.7);font-family:\'Barlow Condensed\',sans-serif;font-size:0.72rem;outline:none;">'
        + '<div style="display:flex;margin-bottom:0.4rem;border:1px solid rgba(255,255,255,0.08);border-radius:10px;overflow:hidden;background:rgba(255,255,255,0.03);">'
        + '<button onclick="(async function(){try{var t=await navigator.clipboard.readText();document.getElementById(\'linksPopupUrl\').value=t}catch(e){alert(\'Clipboard access denied.\')}})()" title="Paste" style="padding:0 0.6rem;background:transparent;border:none;cursor:pointer;color:rgba(255,255,255,0.25);display:flex;align-items:center;"><svg width="13" height="13" viewBox="0 0 14 14" fill="none"><rect x="4" y="3" width="8" height="10" rx="1" stroke="currentColor" stroke-width="1.2"/><path d="M4 4H3a1 1 0 00-1 1v7a1 1 0 001 1h7a1 1 0 001-1v-1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg></button>'
        + '<input id="linksPopupUrl" placeholder="URL" style="flex:1;padding:0.5rem 0.7rem 0.5rem 0;box-sizing:border-box;background:transparent;border:none;color:rgba(255,255,255,0.7);font-family:\'Barlow Condensed\',sans-serif;font-size:0.72rem;outline:none;">'
        + '</div>'
        + '<div style="display:flex;gap:0.4rem;">'
        + '<button onclick="var t=document.getElementById(\'linksPopupTitle\').value.trim(),u=document.getElementById(\'linksPopupUrl\').value.trim();if(!t||!u){alert(\'Enter name and URL.\');return;}var l=getLinks();l.push({title:t,url:u.startsWith(\'http\')?u:\'https://\'+u});saveLinks(l);renderLinksPopup();document.getElementById(\'linksPopupAddRow\').style.display=\'none\';" style="flex:1;padding:0.4rem;background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:rgba(255,255,255,0.5);font-family:\'Barlow Condensed\',sans-serif;font-size:0.63rem;cursor:pointer;text-transform:uppercase;letter-spacing:0.05em;">Add</button>'
        + '<button onclick="document.getElementById(\'linksPopupAddRow\').style.display=\'none\';" style="flex:1;padding:0.4rem;background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;color:rgba(255,255,255,0.3);font-family:\'Barlow Condensed\',sans-serif;font-size:0.63rem;cursor:pointer;text-transform:uppercase;letter-spacing:0.05em;">Cancel</button>'
        + '</div>';
      card.appendChild(closeBtn);
      card.appendChild(title);
      card.appendChild(listWrap);
      card.appendChild(addRow);
      // Edit links button
      var editBtn = document.createElement('button');
      editBtn.id = 'linksPopupEditBtn';
      editBtn.textContent = 'Edit Links';
      editBtn.style.cssText = 'width:100%;padding:0.5rem;background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;color:rgba(255,255,255,0.3);font-family:"Barlow Condensed",sans-serif;font-size:0.63rem;text-transform:uppercase;letter-spacing:0.06em;cursor:pointer;margin-top:0.3rem;';
      editBtn.onmouseover = function() { this.style.borderColor = 'rgba(255,255,255,0.15)'; this.style.color = 'rgba(255,255,255,0.6)'; };
      editBtn.onmouseout = function() { this.style.borderColor = 'rgba(255,255,255,0.06)'; this.style.color = 'rgba(255,255,255,0.3)'; };
      editBtn.onclick = function() {
        linksPopupEditMode = !linksPopupEditMode;
        this.textContent = linksPopupEditMode ? 'Done Editing' : 'Edit Links';
        renderLinksPopup();
      };
      card.appendChild(editBtn);
      // Add link button
      var addBtn = document.createElement('button');
      addBtn.id = 'linksPopupAddBtn';
      addBtn.textContent = '+ Add Link';
      addBtn.style.cssText = 'width:100%;padding:0.5rem;background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;color:rgba(255,255,255,0.3);font-family:"Barlow Condensed",sans-serif;font-size:0.63rem;text-transform:uppercase;letter-spacing:0.06em;cursor:pointer;margin-top:0.3rem;';
      addBtn.onmouseover = function() { this.style.borderColor = 'rgba(255,255,255,0.15)'; this.style.color = 'rgba(255,255,255,0.6)'; };
      addBtn.onmouseout = function() { this.style.borderColor = 'rgba(255,255,255,0.06)'; this.style.color = 'rgba(255,255,255,0.3)'; };
      addBtn.onclick = function() {
        document.getElementById('linksPopupAddRow').style.display = 'block';
        document.getElementById('linksPopupTitle').value = '';
        document.getElementById('linksPopupUrl').value = '';
        document.getElementById('linksPopupTitle').focus();
      };
      card.appendChild(addBtn);
      overlay.appendChild(card);
      document.body.appendChild(overlay);
      overlay.addEventListener('click', function(e) { if (e.target === overlay) toggleLinks(); });
    }
    var isOpen = overlay.classList.contains('m-pop-in');
    if (isOpen) {
      overlay.style.pointerEvents = 'none';
      mPopClose(overlay, function() {
        overlay.style.opacity = '0';
      });
      linksPopupEditMode = false;
      var eb = document.getElementById('linksPopupEditBtn');
      if (eb) eb.textContent = 'Edit Links';
    } else {
      linksPopupEditMode = false;
      renderLinksPopup();
      overlay.style.opacity = '1';
      overlay.style.pointerEvents = 'all';
      mPopOpen(overlay);
    }
  } else {
    // Classic/dark mode: original dropdown
    const menu = document.getElementById('linksMenu');
    menu.classList.toggle('open');
    if (menu.classList.contains('open')) {
      linksEditMode = false;
      renderLinks();
    }
  }
}

function renderLinksPopup() {
  var list = document.getElementById('linksPopupList');
  if (!list) return;
  var links = getLinks();
  list.innerHTML = '';
  links.forEach(function(link, i) {
    var row = document.createElement('div');
    row.style.cssText = 'display:flex;align-items:center;gap:0.5rem;padding:0.4rem 0;border-bottom:1px solid rgba(255,255,255,0.04);';
    var a = document.createElement('a');
    a.href = link.url;
    a.target = '_blank';
    a.textContent = link.title;
    a.style.cssText = 'flex:1;color:rgba(255,255,255,0.5);font-family:"Barlow Condensed",sans-serif;font-size:0.72rem;text-decoration:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;';
    a.onmouseover = function() { this.style.color = 'rgba(255,255,255,0.8)'; };
    a.onmouseout = function() { this.style.color = 'rgba(255,255,255,0.5)'; };
    row.appendChild(a);
    if (linksPopupEditMode) {
      var del = document.createElement('button');
      del.innerHTML = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><line x1="2" y1="2" x2="10" y2="10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><line x1="10" y1="2" x2="2" y2="10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>';
      del.style.cssText = 'background:none;border:none;color:rgba(255,100,100,0.4);cursor:pointer;padding:0.2rem;flex-shrink:0;';
      del.onmouseover = function() { this.style.color = 'rgba(255,100,100,0.8)'; };
      del.onmouseout = function() { this.style.color = 'rgba(255,100,100,0.4)'; };
      del.onclick = function(e) {
        e.stopPropagation();
        var ls = getLinks(); ls.splice(i, 1); saveLinks(ls); renderLinksPopup();
      };
      row.appendChild(del);
    }
    list.appendChild(row);
  });
}


function setTheme(theme) {
  document.body.classList.add('modern-mode');
  localStorage.setItem('cfi_theme', 'modern');
}

function loadTheme() {
  setTheme('modern');
}

function toggleMoreOptions() {
  const menu = document.getElementById('moreOptionsMenu');
  menu.classList.toggle('open');
}

document.addEventListener('click', (e) => {
  document.querySelectorAll('.more-options-wrap').forEach(wrap => {
    if (!wrap.contains(e.target)) {
      wrap.querySelectorAll('.more-options-menu').forEach(m => m.classList.remove('open'));
    }
  });

});

// ── Edit Mode ─────────────────────────────────────────────────────
let editModeActive = false;

function toggleEditMode() {
  const btn = document.getElementById('editModeBtn');
  editModeActive = !editModeActive;

  if (editModeActive) {
    document.body.style.background = '';
    document.getElementById('editModeToast').style.display = 'flex';    // Enter edit mode: expand all, reveal all, swap icon to dots
    btn.classList.add('active');
    btn.title = 'Exit Edit Mode (saves changes)';
    btn.innerHTML = `<span style="font-size:1.1rem;font-weight:700;letter-spacing:0.05em;line-height:1;color:#fff;">···</span><span style="font-family:'Barlow Condensed',sans-serif;font-size:0.48rem;letter-spacing:0.1em;text-transform:uppercase;font-weight:600;color:#fff;">EDITING...</span>`;

    // Expand all
    document.querySelectorAll('.area-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.area-header').forEach(el => { el.classList.remove('collapsed'); const c = el.querySelector('.chevron'); if(c) c.textContent = '−'; });
    document.querySelectorAll('.task-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.task-header').forEach(el => el.classList.add('expanded'));
    document.querySelectorAll('.task-chevron').forEach(el => el.style.transform = 'rotate(0deg)');
    document.querySelectorAll('.section-body').forEach(el => el.classList.remove('hidden'));
    document.querySelectorAll('.section-label').forEach(el => el.classList.add('expanded'));
    document.querySelectorAll('.section-chevron').forEach(el => el.style.transform = 'rotate(0deg)');
    tasksExpanded = true;
    const expandBtn = document.getElementById('expandCollapseBtn');
    if (expandBtn) expandBtn.textContent = 'Collapse All Tasks';

    // Make all editors editable and reveal all
    document.querySelectorAll('.editor-outer').forEach(el => {
      el.classList.remove('is-hidden-state');
      el.style.display = '';
      var fieldRow = el.closest('.field-row') || el.closest('.task-summary-section');
      if (fieldRow) fieldRow.style.display = '';
      const editor = el.querySelector('.rich-editor');
      if (editor) {
        editor.contentEditable = 'true';
        editor.style.cursor = '';
        el.dataset.editModeLocked = 'false';
      }
    });
    document.querySelectorAll('.field-edit-btn').forEach(b => { b.textContent = '···'; b.style.color = ''; });
    answersRevealed = true;
    const revealBtn = document.getElementById('revealHideBtn');
    if (revealBtn) { revealBtn.textContent = 'Hide All Answers'; revealBtn.classList.remove('btn-reveal'); revealBtn.classList.add('btn-hide-all'); }

    // Suspend hide-empty mode so all fields are visible for editing
    const main = document.querySelector('.main');
    if (hideEmptyActive) {
      main.classList.remove('hide-empty-mode');
    }

    // Update modern fab item text
    document.querySelectorAll('.m-fab-item').forEach(function(el) {
      if (el.textContent.trim() === 'Edit Mode') el.textContent = 'Exit Edit Mode';
    });
    // Update modern toolbar edit button
    var mEditBtn = document.getElementById('mToolEdit');
    if (mEditBtn) mEditBtn.classList.add('m-edit-active');

  } else {
    document.getElementById('editModeToast').style.display = 'none';
    // Exit edit mode: save all, lock editors, restore pencil icon
    btn.classList.remove('active');
    btn.title = 'Edit Mode';
    btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.5 2.5L13.5 4.5L5.5 12.5H3.5V10.5L11.5 2.5Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" fill="none"/><path d="M2.5 13.5H13.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg><span style="font-family:'Barlow Condensed',sans-serif;font-size:0.48rem;letter-spacing:0.1em;text-transform:uppercase;font-weight:600;">EDIT</span>`;

    // Save all
    document.querySelectorAll('.rich-editor').forEach(el => {
      if (el.id) localStorage.setItem('cfi_' + el.id, el.innerHTML);
    });
    showSaveIndicator();

    // Restore all editors and field visibility in one pass
    document.querySelectorAll('.editor-outer').forEach(outer => {
      outer.classList.remove('toolbar-active');
      outer.classList.add('is-hidden-state');
      outer.dataset.editModeLocked = 'false';
      outer.style.display = '';
      const editor = outer.querySelector('.rich-editor');
      if (editor) {
        editor.contentEditable = 'false';
        editor.style.cursor = 'default';
      }
      var fieldRow = outer.closest('.field-row') || outer.closest('.task-summary-section');
      if (fieldRow) {
        fieldRow.style.display = '';
        fieldRow.classList.remove('is-empty');
      }
      // If hide-empty is active, hide only empty fields
      if (hideEmptyActive) {
        var hasContent = editor && editor.textContent.trim() !== '';
        if (!hasContent) {
          outer.style.display = 'none';
          if (fieldRow) { fieldRow.style.display = 'none'; fieldRow.classList.add('is-empty'); }
        }
      }
    });
    document.querySelectorAll('.field-edit-btn').forEach(b => { b.textContent = '···'; b.style.color = ''; });

    if (hideEmptyActive) {
      var main = document.querySelector('.main');
      if (main) main.classList.add('hide-empty-mode');
    }

    // Reset reveal all button
    answersRevealed = false;
    const revealBtn = document.getElementById('revealHideBtn');
    if (revealBtn) { revealBtn.textContent = 'Reveal All Answers'; revealBtn.classList.add('btn-reveal'); revealBtn.classList.remove('btn-hide-all'); }

    // Update modern fab item text
    document.querySelectorAll('.m-fab-item').forEach(function(el) {
      if (el.textContent.trim() === 'Exit Edit Mode') el.textContent = 'Edit Mode';
    });
    // Update modern toolbar edit button
    var mEditBtn = document.getElementById('mToolEdit');
    if (mEditBtn) mEditBtn.classList.remove('m-edit-active');
  }
}


// ── Bookmark ──────────────────────────────────────────────────────
function setBookmark(code) {
  if (!code) return;
  document.title = 'BOOKMARK: ' + code;

  const existing = localStorage.getItem('cfi_bookmark');

  // Clear all highlights
  document.querySelectorAll('.item-code').forEach(el => el.classList.remove('bookmarked'));
  document.querySelectorAll('.item').forEach(el => { el.classList.remove('is-bookmarked'); el.style.outline = ''; el.style.outlineOffset = ''; el.style.background = ''; });
  document.querySelectorAll('.area-header').forEach(h => h.classList.remove('bookmark-highlight'));
  document.querySelectorAll('.task-header').forEach(h => h.classList.remove('bookmark-highlight'));
  document.querySelectorAll('.section-label').forEach(h => h.classList.remove('bookmark-highlight'));

  if (existing === code) {
    const codeEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
    if (codeEl) {
      const itemEl = codeEl.closest('.item');
      if (itemEl) {
        itemEl.classList.add('no-hover');
        setTimeout(() => itemEl.classList.remove('no-hover'), 800);
      }
    }
    localStorage.removeItem('cfi_bookmark');
    document.getElementById('bookmarkBanner').classList.remove('visible');
    if (typeof mRefreshBookmark === 'function') mRefreshBookmark();
    return;
  }

  localStorage.setItem('cfi_bookmark', code);
  document.getElementById('bookmarkBanner').classList.add('visible');
  applyBookmarkUI(code);
  if (typeof mRefreshBookmark === 'function') mRefreshBookmark();

  // Force visual indicator on the clicked element directly
  var clickedEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
  if (clickedEl) {
    var parentItem = clickedEl.closest('.item');
    if (parentItem) {
      parentItem.style.outline = '3px solid #d95f1a';
      parentItem.style.outlineOffset = '2px';
      parentItem.style.background = 'rgba(217,95,26,0.05)';
    }
  }
}

function applyBookmarkUI(code) {
  // Try exact match first, then safe code match
  var codeEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
  if (!codeEl) {
    var safeCode = code.replace(/\./g, '_');
    codeEl = document.querySelector('.item-code[data-safe="' + safeCode + '"]');
  }
  if (!codeEl) return;

  codeEl.classList.add('bookmarked');
  var itemEl = codeEl.closest('.item');
  if (itemEl) itemEl.classList.add('is-bookmarked');

  const sectionBody = codeEl.closest('.section-body');
  if (sectionBody) {
    const sectionLabel = sectionBody.previousElementSibling;
    if (sectionLabel) sectionLabel.classList.add('bookmark-highlight');
  }

  const taskBody = codeEl.closest('.task-body');
  if (taskBody) {
    const taskHeader = taskBody.previousElementSibling;
    if (taskHeader) taskHeader.classList.add('bookmark-highlight');
  }

  const areaBody = codeEl.closest('.area-body');
  if (areaBody) {
    const areaHeader = areaBody.previousElementSibling;
    if (areaHeader) areaHeader.classList.add('bookmark-highlight');
  }
}

function goToBookmark() {
  const code = localStorage.getItem('cfi_bookmark');
  if (!code) return;

  // Modern mode: find area/task indices and open the task
  if (document.body.classList.contains('modern-mode')) {
    var allAreas = [data,data2,data3,data4,data5,data6,data7,data8,data9,data10,data11,data12,data13,data14];
    for (var ai = 0; ai < allAreas.length; ai++) {
      var a = allAreas[ai];
      for (var ti = 0; ti < a.tasks.length; ti++) {
        var found = false;
        (a.tasks[ti].sections||[]).forEach(function(sec) {
          (sec.items||[]).forEach(function(item) {
            if (item.code === code) found = true;
          });
        });
        if (found) {
          mGo(ai);
          var bookmarkCode = code;
          setTimeout(function() {
            mOpenTask(ai, ti);
            // Expand all sections and scroll to the bookmarked item
            setTimeout(function() {
              var expBody = document.getElementById('mExpB');
              if (expBody) {
                expBody.querySelectorAll('.section-body').forEach(function(b) { b.classList.remove('hidden'); });
                expBody.querySelectorAll('.section-label').forEach(function(l) { l.classList.add('expanded'); });
                expBody.querySelectorAll('.section-wrapper').forEach(function(w) { w.classList.add('open'); });
                expBody.querySelectorAll('.section-chevron').forEach(function(c) { c.style.transform = 'rotate(0deg)'; });
              }
              var bkEl = expBody ? [...expBody.querySelectorAll('.item-code')].find(function(el) { return el.textContent.trim() === bookmarkCode; }) : null;
              if (bkEl) {
                var bkItem = bkEl.closest('.item');
                if (bkItem) bkItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
              }
            }, 200);
          }, 400);
          return;
        }
      }
    }
    return;
  }

  // Classic/Dark mode: expand and scroll
  const codeEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
  if (!codeEl) return;

  const itemDiv = codeEl.closest('.item');
  const sectionBody = itemDiv.closest('.section-body');
  const taskBody = itemDiv.closest('.task-body');
  const areaBody = itemDiv.closest('.area-body');

  if (areaBody) {
    areaBody.classList.remove('hidden');
    const areaHeader = areaBody.previousElementSibling;
    if (areaHeader) areaHeader.classList.remove('collapsed');
  }
  if (taskBody) {
    taskBody.classList.remove('hidden');
    const taskHeader = taskBody.previousElementSibling;
    if (taskHeader) {
      const chevron = taskHeader.querySelector('.task-chevron');
      if (chevron) chevron.style.transform = 'rotate(0deg)';
    }
  }
  if (sectionBody) {
    sectionBody.classList.remove('hidden');
    const sectionLabel = sectionBody.previousElementSibling;
    if (sectionLabel) {
      const chevron = sectionLabel.querySelector('.section-chevron');
      if (chevron) chevron.style.transform = 'rotate(0deg)';
    }
  }

  setTimeout(() => itemDiv.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
}

function loadBookmark() {
  const code = localStorage.getItem('cfi_bookmark');
  if (!code) return;
  document.getElementById('bookmarkBanner').classList.add('visible');
  applyBookmarkUI(code);
}

// ── Notes Panel ───────────────────────────────────────────────────
function toggleNotesPanel() {
  const panel = document.getElementById('notesPanel');
  const btn = document.getElementById('notesPanelBtn');
  const isOpen = panel.classList.contains('open');

  if (isOpen) {
    mPopClose(panel, function() {
      panel.classList.remove('open');
    });
    btn.classList.remove('active');
    document.removeEventListener('mousedown', _notesPanelOutsideClick);
  } else {
    // Restore saved position/size or reset to center
    panel.classList.remove('np-dragged');
    panel.style.top = '';
    panel.style.left = '';
    panel.style.width = '';
    panel.style.height = '';
    if (window._npRestoreGeometry) window._npRestoreGeometry();
    panel.classList.add('open');
    if (document.body.classList.contains('modern-mode')) {
      mPopOpen(panel);
    }
    btn.classList.add('active');
    setTimeout(() => {
      document.addEventListener('mousedown', _notesPanelOutsideClick);
    }, 0);
  }
}

function _notesPanelOutsideClick(e) {
  const panel = document.getElementById('notesPanel');
  const btn = document.getElementById('notesPanelBtn');
  if (!panel.contains(e.target) && !btn.contains(e.target)) {
    mPopClose(panel, function() {
      panel.classList.remove('open');
    });
    btn.classList.remove('active');
    document.removeEventListener('mousedown', _notesPanelOutsideClick);
  }
}

function initNotesPanel() {
  const editor = document.getElementById('notesEditor');
  const saved = localStorage.getItem('cfi_notes');
  if (saved) editor.innerHTML = saved;

  editor.addEventListener('input', () => {
    localStorage.setItem('cfi_notes', editor.innerHTML);
    const ind = document.getElementById('notesSaveIndicator');
    ind.textContent = 'Saved';
    ind.style.opacity = '1';
    clearTimeout(ind._t);
    ind._t = setTimeout(() => { ind.style.opacity = '0'; }, 1500);
  });

  // ── Drag by header ──────────────────────────────────────────
  var header = document.getElementById('notesPanelHeader');
  var panel = document.getElementById('notesPanel');
  var resizeHandle = document.getElementById('npResizeHandle');
  var dragging = false, resizing = false, startX, startY, startLeft, startTop, startW, startH;

  if (header) {
    header.addEventListener('mousedown', function(e) {
      if (e.target.closest('.notes-panel-close')) return;
      if (!document.body.classList.contains('modern-mode')) return;
      dragging = true;
      var rect = panel.getBoundingClientRect();
      // Switch from centered transform to absolute positioning
      if (!panel.classList.contains('np-dragged')) {
        panel.classList.add('np-dragged');
        panel.style.top = rect.top + 'px';
        panel.style.left = rect.left + 'px';
        panel.style.width = rect.width + 'px';
        panel.style.height = rect.height + 'px';
      }
      startX = e.clientX;
      startY = e.clientY;
      startLeft = rect.left;
      startTop = rect.top;
      e.preventDefault();
    });

    header.addEventListener('touchstart', function(e) {
      if (e.target.closest('.notes-panel-close')) return;
      if (!document.body.classList.contains('modern-mode')) return;
      dragging = true;
      var rect = panel.getBoundingClientRect();
      if (!panel.classList.contains('np-dragged')) {
        panel.classList.add('np-dragged');
        panel.style.top = rect.top + 'px';
        panel.style.left = rect.left + 'px';
        panel.style.width = rect.width + 'px';
        panel.style.height = rect.height + 'px';
      }
      var t = e.touches[0];
      startX = t.clientX;
      startY = t.clientY;
      startLeft = rect.left;
      startTop = rect.top;
    }, {passive: false});
  }

  // ── Resize handle ──────────────────────────────────────────
  if (resizeHandle) {
    resizeHandle.addEventListener('mousedown', function(e) {
      if (!document.body.classList.contains('modern-mode')) return;
      resizing = true;
      var rect = panel.getBoundingClientRect();
      if (!panel.classList.contains('np-dragged')) {
        panel.classList.add('np-dragged');
        panel.style.top = rect.top + 'px';
        panel.style.left = rect.left + 'px';
        panel.style.width = rect.width + 'px';
        panel.style.height = rect.height + 'px';
      }
      startX = e.clientX;
      startY = e.clientY;
      startW = rect.width;
      startH = rect.height;
      e.preventDefault();
    });

    resizeHandle.addEventListener('touchstart', function(e) {
      if (!document.body.classList.contains('modern-mode')) return;
      resizing = true;
      var rect = panel.getBoundingClientRect();
      if (!panel.classList.contains('np-dragged')) {
        panel.classList.add('np-dragged');
        panel.style.top = rect.top + 'px';
        panel.style.left = rect.left + 'px';
        panel.style.width = rect.width + 'px';
        panel.style.height = rect.height + 'px';
      }
      var t = e.touches[0];
      startX = t.clientX;
      startY = t.clientY;
      startW = rect.width;
      startH = rect.height;
    }, {passive: false});
  }

  document.addEventListener('mousemove', function(e) {
    if (dragging) {
      var dx = e.clientX - startX, dy = e.clientY - startY;
      panel.style.left = Math.max(0, Math.min(window.innerWidth - 60, startLeft + dx)) + 'px';
      panel.style.top = Math.max(0, Math.min(window.innerHeight - 40, startTop + dy)) + 'px';
    }
    if (resizing) {
      var dx = e.clientX - startX, dy = e.clientY - startY;
      panel.style.width = Math.max(260, startW + dx) + 'px';
      panel.style.height = Math.max(180, startH + dy) + 'px';
    }
  });

  document.addEventListener('touchmove', function(e) {
    if (dragging || resizing) {
      var t = e.touches[0];
      if (dragging) {
        var dx = t.clientX - startX, dy = t.clientY - startY;
        panel.style.left = Math.max(0, Math.min(window.innerWidth - 60, startLeft + dx)) + 'px';
        panel.style.top = Math.max(0, Math.min(window.innerHeight - 40, startTop + dy)) + 'px';
      }
      if (resizing) {
        var dx = t.clientX - startX, dy = t.clientY - startY;
        panel.style.width = Math.max(260, startW + dx) + 'px';
        panel.style.height = Math.max(180, startH + dy) + 'px';
      }
      e.preventDefault();
    }
  }, {passive: false});

  function npSaveGeometry() {
    var rect = panel.getBoundingClientRect();
    localStorage.setItem('cfi_notes_geo', JSON.stringify({
      top: panel.style.top, left: panel.style.left,
      width: panel.style.width, height: panel.style.height
    }));
  }

  function npRestoreGeometry() {
    var saved = localStorage.getItem('cfi_notes_geo');
    if (!saved || !document.body.classList.contains('modern-mode')) return false;
    try {
      var geo = JSON.parse(saved);
      if (geo.top && geo.left) {
        panel.classList.add('np-dragged');
        panel.style.top = geo.top;
        panel.style.left = geo.left;
        if (geo.width) panel.style.width = geo.width;
        if (geo.height) panel.style.height = geo.height;
        return true;
      }
    } catch(e) {}
    return false;
  }
  // Expose restore for toggleNotesPanel
  window._npRestoreGeometry = npRestoreGeometry;

  document.addEventListener('mouseup', function() {
    if (dragging || resizing) npSaveGeometry();
    dragging = false; resizing = false;
  });
  document.addEventListener('touchend', function() {
    if (dragging || resizing) npSaveGeometry();
    dragging = false; resizing = false;
  });
}


// ── Passcode / Lock ───────────────────────────────────────────────
const DEFAULT_PASSWORD = '12121212';

function getStoredHash() {
  return localStorage.getItem('cfi_pw_hash') || hashPassword(DEFAULT_PASSWORD);
}

function hashPassword(pw) {
  let hash = 0;
  for (let i = 0; i < pw.length; i++) {
    hash = ((hash << 5) - hash) + pw.charCodeAt(i);
    hash |= 0;
  }
  return 'h_' + Math.abs(hash).toString(36) + '_' + pw.length;
}

function getPasscodeValue() {
  let val = '';
  for (let i = 0; i < 8; i++) val += (document.getElementById('d' + i)?.value || '');
  return val;
}

function setDigitBoxError() {
  for (let i = 0; i < 8; i++) {
    const box = document.getElementById('d' + i);
    const stripe = document.getElementById('ts' + i);
    if (box)    { box.value = ''; }
    if (stripe) { stripe.classList.add('error'); stripe.classList.remove('filled'); }
  }
  setTimeout(() => {
    for (let i = 0; i < 8; i++) {
      const stripe = document.getElementById('ts' + i);
      if (stripe) stripe.classList.remove('error');
    }
    document.getElementById('d0')?.focus();
  }, 400);
}

function initDigitBoxes() {
  for (let i = 0; i < 8; i++) {
    const box = document.getElementById('d' + i);
    const stripe = document.getElementById('ts' + i);
    if (!box) continue;

    box.addEventListener('input', () => {
      box.value = box.value.replace(/[^0-9]/g, '').slice(-1);
      if (box.value) {
        stripe?.classList.add('filled');
        const next = document.getElementById('d' + (i + 1));
        if (next) next.focus();
        if (i === 7) setTimeout(() => unlockApp(), 120);
      } else {
        stripe?.classList.remove('filled');
      }
    });

    box.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !box.value) {
        const prev = document.getElementById('d' + (i - 1));
        const prevStripe = document.getElementById('ts' + (i - 1));
        if (prev) { prev.value = ''; prevStripe?.classList.remove('filled'); prev.focus(); }
      }
      if (e.key === 'Enter') unlockApp();
    });

    box.addEventListener('paste', (e) => {
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
      for (let j = 0; j < Math.min(text.length, 8 - i); j++) {
        const target = document.getElementById('d' + (i + j));
        const tStripe = document.getElementById('ts' + (i + j));
        if (target) { target.value = text[j]; tStripe?.classList.add('filled'); }
      }
      const lastIdx = Math.min(i + text.length, 7);
      document.getElementById('d' + lastIdx)?.focus();
      if (i + text.length >= 8) setTimeout(() => unlockApp(), 120);
    });

    box.addEventListener('focus', () => box.select());
  }
}

function showLockConfirm() {
  var el = document.getElementById('lockConfirmOverlay');
  el.classList.remove('m-pop-out');
  el.classList.add('open');
}

function hideLockConfirm() {
  var el = document.getElementById('lockConfirmOverlay');
  mPopClose(el, function() { el.classList.remove('open'); });
}

function lockApp() {
  hideLockConfirm();
  sessionStorage.removeItem('cfi_unlocked');
  for (let i = 0; i < 8; i++) {
    const box = document.getElementById('d' + i);
    const stripe = document.getElementById('ts' + i);
    if (box)    { box.value = ''; }
    if (stripe) { stripe.classList.remove('filled', 'error'); }
  }
  document.getElementById('lockError').textContent = '';
  document.getElementById('lockScreen').classList.remove('hidden');
  setTimeout(() => document.getElementById('d0')?.focus(), 150);
}

function checkLock() {
  const unlocked = sessionStorage.getItem('cfi_unlocked');
  if (unlocked === '1') {
    document.getElementById('lockScreen').classList.add('hidden');
  }
  initDigitBoxes();
  setTimeout(() => document.getElementById('d0')?.focus(), 150);
}

function unlockApp() {
  const val = getPasscodeValue();
  const errorEl = document.getElementById('lockError');
  if (val.length < 8) { errorEl.textContent = 'Enter all 8 digits'; return; }

  if (hashPassword(val) === getStoredHash()) {
    sessionStorage.setItem('cfi_unlocked', '1');
    document.getElementById('lockScreen').classList.add('hidden');
    errorEl.textContent = '';
  } else {
    errorEl.textContent = 'Incorrect passcode';
    setDigitBoxError();
  }
}

function openChangePw() {
  document.getElementById('pwCurrent').value = '';
  document.getElementById('pwNew').value = '';
  document.getElementById('pwConfirm').value = '';
  document.getElementById('pwModalError').textContent = '';
  var el = document.getElementById('changePwModal');
  el.classList.add('open');
  mPopOpen(el);
  setTimeout(() => document.getElementById('pwCurrent').focus(), 100);
}

function closeChangePw() {
  var el = document.getElementById('changePwModal');
  mPopClose(el, function() { el.classList.remove('open'); });
}

function saveNewPassword() {
  const current = document.getElementById('pwCurrent').value.trim();
  const newPw = document.getElementById('pwNew').value.trim();
  const confirm = document.getElementById('pwConfirm').value.trim();
  const errEl = document.getElementById('pwModalError');

  if (!/^\d{8}$/.test(current)) { errEl.textContent = 'Current passcode must be 8 digits'; return; }
  if (hashPassword(current) !== getStoredHash()) { errEl.textContent = 'Current passcode is incorrect'; return; }
  if (!/^\d{8}$/.test(newPw)) { errEl.textContent = 'New passcode must be exactly 8 digits'; return; }
  if (newPw !== confirm) { errEl.textContent = 'Passcodes do not match'; return; }

  localStorage.setItem('cfi_pw_hash', hashPassword(newPw));
  errEl.textContent = '';
  closeChangePw();

  const ind = document.getElementById('save-indicator');
  ind.textContent = '✓ Passcode updated!'; ind.style.opacity = '1';
  setTimeout(() => { ind.style.opacity = '0'; }, 2500);
}


const data2 = {
  areaIndex: 'II',
  area: "Area of Operation II: Technical Subject Areas",
  note: "The evaluator must select Tasks C, K, and at least one other Task from this Area of Operation. The evaluator must also select Task P for multiengine applicants.",
  tasks: [
    {
      id: "Task A", title: "Human Factors",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands personal health, flight physiology, aeromedical and human factors, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.A.K1", text: "Symptoms, recognition, causes, effects, and corrective actions associated with aeromedical and physiological issues, including:" },
          { code: "AI.II.A.K1a", text: "a. Hypoxia" },
          { code: "AI.II.A.K1b", text: "b. Hyperventilation" },
          { code: "AI.II.A.K1c", text: "c. Middle ear and sinus problems" },
          { code: "AI.II.A.K1d", text: "d. Spatial disorientation" },
          { code: "AI.II.A.K1e", text: "e. Motion sickness" },
          { code: "AI.II.A.K1f", text: "f. Carbon monoxide poisoning" },
          { code: "AI.II.A.K1g", text: "g. Stress" },
          { code: "AI.II.A.K1h", text: "h. Fatigue" },
          { code: "AI.II.A.K1i", text: "i. Dehydration and nutrition" },
          { code: "AI.II.A.K1j", text: "j. Hypothermia" },
          { code: "AI.II.A.K1k", text: "k. Optical illusions" },
          { code: "AI.II.A.K1l", text: "l. Dissolved nitrogen in the bloodstream after scuba dives" },
          { code: "AI.II.A.K2", text: "Regulations regarding use of alcohol and drugs." },
          { code: "AI.II.A.K3", text: "Effects of alcohol, drugs, and over-the-counter medications." },
          { code: "AI.II.A.K4", text: "Aeronautical Decision-Making (ADM) to include using Crew Resource Management (CRM) or Single Pilot Resource Management (SRM), as appropriate." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.A.R1", text: "Aeromedical and physiological issues." },
          { code: "AI.II.A.R2", text: "Hazardous attitudes." },
          { code: "AI.II.A.R3", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.II.A.R4", text: "Confirmation and expectation bias." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.A.S1", text: "Associate the symptoms and effects for at least three of the conditions listed in K1a through K1l with the cause(s) and corrective action(s)." },
          { code: "AI.II.A.S2", text: "Perform self-assessment, including fitness for flight and personal minimums, for actual flight or a scenario given by the evaluator." },
        ]}
      ]
    },
    {
      id: "Task B", title: "Visual Scanning and Collision Avoidance",
      refs: "AC 90-48; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands visual scanning and collision avoidance, can apply that knowledge, manage associated risks, demonstrate pilot-in-command skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.B.K1", text: "Environmental conditions that degrade vision." },
          { code: "AI.II.B.K2", text: "Vestibular and visual illusions." },
          { code: "AI.II.B.K3", text: "\"See and Avoid\" responsibilities." },
          { code: "AI.II.B.K4", text: "Visual scanning procedure and the importance of peripheral vision." },
          { code: "AI.II.B.K5", text: "Aircraft blind spots and clearing procedures." },
          { code: "AI.II.B.K6", text: "Visual cues of an impending mid-air collision." },
          { code: "AI.II.B.K7", text: "Situations that create the greatest collision risk." },
          { code: "AI.II.B.K8", text: "Division of attention inside and outside the aircraft." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.B.R1", text: "Distractions to visual scanning." },
          { code: "AI.II.B.R2", text: "Relaxed intermediate focal distance." },
          { code: "AI.II.B.R3", text: "High volume operational environments." },
          { code: "AI.II.B.R4", text: "Collision reaction time." },
          { code: "AI.II.B.R5", text: "Use of a safety pilot." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.B.S1", text: "Effectively scan using short regularly spaced eye movements." },
          { code: "AI.II.B.S2", text: "Scan around physical obstructions." },
          { code: "AI.II.B.S3", text: "Use appropriate visual scanning techniques." },
          { code: "AI.II.B.S4", text: "Use electronic traffic alert systems, if available." },
        ]}
      ]
    },
    {
      id: "Task C", title: "Runway Incursion Avoidance",
      refs: "AC 91-73; AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands runway incursion avoidance, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.C.K1", text: "Runway incursion definition." },
          { code: "AI.II.C.K2", text: "Taxi instructions/clearances." },
          { code: "AI.II.C.K3", text: "The importance of recording taxi instructions and reviewing taxi routes on the airport diagram." },
          { code: "AI.II.C.K4", text: "Airport markings, signs, and lights including the importance of hold lines associated with runways." },
          { code: "AI.II.C.K5", text: "Appropriate flight deck activities during taxiing, including taxi route planning, briefing the location of Hot Spots, communicating and coordinating with ATC." },
          { code: "AI.II.C.K6", text: "Communication and operational procedures at uncontrolled airports." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.C.R1", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.II.C.R2", text: "Confirmation or expectation bias as related to taxi instructions." },
          { code: "AI.II.C.R3", text: "Entering or crossing runways." },
          { code: "AI.II.C.R4", text: "Night taxi operations." },
          { code: "AI.II.C.R5", text: "Low visibility taxi operations." },
          { code: "AI.II.C.R6", text: "Runway incursion after landing." },
          { code: "AI.II.C.R7", text: "Operating on taxiways between parallel runways." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.C.S1", text: "Deliver instruction on the elements and techniques for runway incursion avoidance." },
        ]}
      ]
    },
    {
      id: "Task D", title: "Principles of Flight",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands aerodynamics appropriate to the desired instructor certificate, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.D.K1", text: "Airfoil design characteristics." },
          { code: "AI.II.D.K2", text: "Airplane stability, maneuverability and controllability." },
          { code: "AI.II.D.K3", text: "Turning tendency (e.g., torque, p-factor, spiraling slipstream, and gyroscopic precession)." },
          { code: "AI.II.D.K4", text: "Forces acting on an airplane." },
          { code: "AI.II.D.K5", text: "Load factors in airplane design." },
          { code: "AI.II.D.K6", text: "Wingtip vortices and appropriate precautions." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.D.R1", text: "The basic aerodynamic principles of flight." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.D.S1", text: "Deliver instruction on principles of flight, including at least three of the elements listed in K1 through K6." },
        ]}
      ]
    },
    {
      id: "Task E", title: "Aircraft Flight Controls and Operation of Systems",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands flight controls and systems on the airplane provided for the flight test, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If K1 is selected, the evaluator must assess the applicant\u2019s knowledge of all sub elements."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.E.K1", text: "Airplane systems, including:" },
          { code: "AI.II.E.K1a", text: "a. Primary flight controls" },
          { code: "AI.II.E.K1b", text: "b. Secondary flight controls" },
          { code: "AI.II.E.K1c", text: "c. Powerplant and propeller" },
          { code: "AI.II.E.K1d", text: "d. Landing gear" },
          { code: "AI.II.E.K1e", text: "e. Fuel, oil, and hydraulic" },
          { code: "AI.II.E.K1f", text: "f. Electrical" },
          { code: "AI.II.E.K1g", text: "g. Avionics" },
          { code: "AI.II.E.K1h", text: "h. Pitot-static, vacuum/pressure, and associated flight instruments" },
          { code: "AI.II.E.K1i", text: "i. Environmental" },
          { code: "AI.II.E.K1j", text: "j. Deicing and anti-icing" },
          { code: "AI.II.E.K1k", text: "k. Water rudders (ASES, AMES)" },
          { code: "AI.II.E.K1l", text: "l. Oxygen system" },
          { code: "AI.II.E.K2", text: "Indications of and procedures for managing system abnormalities or failures." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.E.R1", text: "Detection of system malfunctions or failures." },
          { code: "AI.II.E.R2", text: "Management of a system failure." },
          { code: "AI.II.E.R3", text: "Monitoring and management of automated systems." },
          { code: "AI.II.E.R4", text: "Providing instruction in unfamiliar aircraft or operating with unfamiliar flight display systems and avionics." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.E.S1", text: "Operate at least three of the systems listed in K1a through K1l appropriately." },
        ]}
      ]
    },
    {
      id: "Task F", title: "Performance and Limitations",
      refs: "FAA-H-8083-1, FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands aircraft performance and limitations, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.F.K1", text: "Elements related to performance and limitations by explaining the use of charts, tables, and data to determine performance." },
          { code: "AI.II.F.K2", text: "Factors affecting performance, including:" },
          { code: "AI.II.F.K2a", text: "a. Atmospheric conditions" },
          { code: "AI.II.F.K2b", text: "b. Pilot technique" },
          { code: "AI.II.F.K2c", text: "c. Airplane configuration" },
          { code: "AI.II.F.K2d", text: "d. Airport environment" },
          { code: "AI.II.F.K2e", text: "e. Loading and weight and balance" },
          { code: "AI.II.F.K3", text: "Weight and balance terms, including: basic empty weight, maximum gross weight, arm, moment, reference datum, center of gravity (CG) and CG limits, and useful load." },
          { code: "AI.II.F.K4", text: "Methods for computing CG." },
          { code: "AI.II.F.K5", text: "Aerodynamics." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.F.R1", text: "Use of performance charts, tables, and data." },
          { code: "AI.II.F.R2", text: "Airplane limitations." },
          { code: "AI.II.F.R3", text: "Possible differences between calculated performance and actual performance." },
          { code: "AI.II.F.R4", text: "Exceeding weight limits." },
          { code: "AI.II.F.R5", text: "Operating outside of CG limits." },
          { code: "AI.II.F.R6", text: "Shifting, adding, and removing weight." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.F.S1", text: "Use the appropriate airplane performance charts, tables, and data." },
          { code: "AI.II.F.S2", text: "Compute the weight and balance, correct out-of-center of gravity loading errors and determine if the weight and balance remains within limits during all phases of flight." },
        ]}
      ]
    },
    {
      id: "Task G", title: "National Airspace System",
      refs: "14 CFR parts 71, 91, 93; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; VFR Navigation Charts",
      objective: "To determine the applicant understands the National Airspace System, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.G.K1", text: "Airspace classes and associated requirements and limitations." },
          { code: "AI.II.G.K2", text: "Chart symbols." },
          { code: "AI.II.G.K3", text: "Special use airspace (SUA), special flight rules areas (SFRA), temporary flight restrictions (TFR), and other airspace areas." },
          { code: "AI.II.G.K4", text: "Currency of publications." },
          { code: "AI.II.G.K5", text: "Special visual flight rules (VFR) requirements." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.G.R1", text: "Various classes and types of airspace." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.G.S1", text: "Identify and comply with the requirements for basic VFR weather minimums and flying in particular classes of airspace." },
          { code: "AI.II.G.S2", text: "Correctly identify airspace and operate in accordance with associated communication and equipment requirements." },
          { code: "AI.II.G.S3", text: "Identify the requirements for operating in SUA or within a TFR. Identify and comply with special air traffic rules (SATR) and SFRA operations, if applicable." },
        ]}
      ]
    },
    {
      id: "Task H", title: "Navigation Systems and Radar Services",
      refs: "AC 91-78; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands navigation systems and radar services, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["The evaluator should reference the manufacturer\u2019s equipment supplement(s) as necessary for appropriate limitations, procedures, etc."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.H.K1", text: "Ground-based navigation (identification, orientation, course determination, equipment, tests, regulations, interference, appropriate use of navigation data, and signal integrity)." },
          { code: "AI.II.H.K2", text: "Satellite-based navigation (e.g., equipment, regulations, authorized use of databases, and Receiver Autonomous Integrity Monitoring (RAIM))." },
          { code: "AI.II.H.K3", text: "Radar assistance to visual flight rules (VFR) aircraft (e.g., operations, equipment, available services, traffic advisories)." },
          { code: "AI.II.H.K4", text: "Transponder (Mode(s) A, C, and S) and Automatic Dependent Surveillance-Broadcast (ADS-B)." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.H.R1", text: "Management of automated navigation and autoflight systems." },
          { code: "AI.II.H.R2", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.II.H.R3", text: "Limitations of the navigation system in use." },
          { code: "AI.II.H.R4", text: "Loss of a navigation signal." },
          { code: "AI.II.H.R5", text: "Use of an electronic flight bag (EFB), if used." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.H.S1", text: "Use an airborne electronic navigation system." },
          { code: "AI.II.H.S2", text: "Determine the airplane's position using the navigation system." },
          { code: "AI.II.H.S3", text: "Intercept and track a given course, radial, or bearing." },
          { code: "AI.II.H.S4", text: "Recognize and describe the indication of station or waypoint passage." },
          { code: "AI.II.H.S5", text: "Use proper communication procedures when utilizing radar services." },
        ]}
      ]
    },
    {
      id: "Task I", title: "Navigation and Cross-Country Flight Planning",
      refs: "14 CFR part 91; AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25, NOTAMs; VFR Navigation Charts",
      objective: "To determine the applicant understands navigation and cross-country flight planning, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["Preparation, presentation, and explanation of a computer-generated flight plan is an acceptable option."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.I.K1", text: "Route planning, including consideration of different classes and special use airspace (SUA) and selection of appropriate and available navigation/communication systems and facilities." },
          { code: "AI.II.I.K2", text: "Altitude selection accounting for terrain and obstacles, glide distance of airplane, visual flight rules (VFR) cruising altitudes, and effect of wind." },
          { code: "AI.II.I.K3", text: "Plotting a course." },
          { code: "AI.II.I.K4", text: "Power setting selection." },
          { code: "AI.II.I.K5", text: "Calculating:" },
          { code: "AI.II.I.K5a", text: "a. Time, climb and descent rates, course, distance, heading, true airspeed, and groundspeed" },
          { code: "AI.II.I.K5b", text: "b. Estimated time of arrival, including conversion to universal coordinated time (UTC)" },
          { code: "AI.II.I.K5c", text: "c. Fuel requirements, including reserve" },
          { code: "AI.II.I.K6", text: "Elements of a VFR flight plan." },
          { code: "AI.II.I.K7", text: "Correlate weather information to make a go/no-go decision." },
          { code: "AI.II.I.K8", text: "Procedures for activating and closing a VFR flight plan." },
          { code: "AI.II.I.K9", text: "Magnetic compass errors." },
          { code: "AI.II.I.K10", text: "Pilotage and dead reckoning." },
          { code: "AI.II.I.K11", text: "Planned calculations versus actual results and required corrections." },
          { code: "AI.II.I.K12", text: "Diversion and lost procedures." },
          { code: "AI.II.I.K13", text: "Inflight intercept procedures." },
          { code: "AI.II.I.K14", text: "Use of an electronic flight bag (EFB), if used." },
          { code: "AI.II.I.K15", text: "Chart symbols." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.I.R1", text: "Pilot." },
          { code: "AI.II.I.R2", text: "Aircraft." },
          { code: "AI.II.I.R3", text: "Environment (e.g., weather, airports, airspace, terrain, obstacles)." },
          { code: "AI.II.I.R4", text: "External pressures." },
          { code: "AI.II.I.R5", text: "Limitations of air traffic control (ATC) services." },
          { code: "AI.II.I.R6", text: "Fuel planning." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.I.S1", text: "Prepare, present, and explain a cross-country flight plan assigned by the evaluator, including a risk analysis to the first fuel stop." },
          { code: "AI.II.I.S2", text: "Apply pertinent information from appropriate and current aeronautical charts, Chart Supplements; Notices to Air Missions (NOTAMs) relative to airport, runway and taxiway closures; and other flight publications." },
          { code: "AI.II.I.S3", text: "Create a navigation plan and simulate filing a VFR flight plan." },
          { code: "AI.II.I.S4", text: "Recalculate fuel reserves based on a scenario provided by the evaluator." },
        ]}
      ]
    },
    {
      id: "Task J", title: "14 CFR and Publications",
      refs: "14 CFR parts 1, 61, 91; 49 CFR part 830; AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands the Code of Federal Regulations and other relevant publications, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.J.K1", text: "14 CFR parts 1, 61, and 91." },
          { code: "AI.II.J.K2", text: "49 CFR part 830." },
          { code: "AI.II.J.K3", text: "Advisory Circulars, INFOs, and SAFOs." },
          { code: "AI.II.J.K4", text: "Airman Certification Standards or Practical Test Standards." },
          { code: "AI.II.J.K5", text: "Pilot's Operating Handbooks or flight manuals." },
          { code: "AI.II.J.K6", text: "Aeronautical Information Manual (AIM)." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.J.R1", text: "Use of expired charts, manuals, or publications without current updates." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.J.S1", text: "Teach at least one of the elements listed in K1 through K6." },
        ]}
      ]
    },
    {
      id: "Task K", title: "Endorsements and Logbook Entries",
      refs: "14 CFR part 61; AC 61-65; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands logbook entries and endorsements, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.K.K1", text: "Required logbook entries for instruction given." },
          { code: "AI.II.K.K2", text: "Required student pilot pre-solo knowledge test, solo endorsements, and logbook entries." },
          { code: "AI.II.K.K3", text: "Other required pilot logbook endorsements (e.g., Class B Airspace, Special Federal Aviation Regulation (SFAR))." },
          { code: "AI.II.K.K4", text: "Preparation of a recommendation for a pilot practical test, including appropriate logbook entry and relevant certificate/rating application for:" },
          { code: "AI.II.K.K4a", text: "a. Initial pilot certification" },
          { code: "AI.II.K.K4b", text: "b. Additional pilot certification" },
          { code: "AI.II.K.K4c", text: "c. Additional aircraft qualification" },
          { code: "AI.II.K.K5", text: "Endorsement of a pilot logbook for the satisfactory completion of an FAA flight review." },
          { code: "AI.II.K.K6", text: "Required flight instructor records." },
          { code: "AI.II.K.K7", text: "Flight instructor renewal and reinstatement requirements." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.K.R1", text: "Endorsements without appropriate limitations or expiration dates." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.K.S1", text: "Describe and prepare logbook entries/endorsements required for at least two of the events specified in the elements or sub-elements of K1 through K5." },
        ]}
      ]
    },
    {
      id: "Task L", title: "Water and Seaplane Characteristics, Seaplane Bases, Maritime Rules, and Aids to Marine Navigation (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM; USCG Navigation Rules",
      objective: "To determine the applicant understands water and seaplane characteristics, seaplane bases, maritime rules, and aids to marine navigation, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.L.K1", text: "Characteristics of a water surface as affected by features, such as:" },
          { code: "AI.II.L.K1a", text: "a. Size and location" },
          { code: "AI.II.L.K1b", text: "b. Protected and unprotected areas" },
          { code: "AI.II.L.K1c", text: "c. Surface wind" },
          { code: "AI.II.L.K1d", text: "d. Direction and strength of water current" },
          { code: "AI.II.L.K1e", text: "e. Floating and partially submerged debris" },
          { code: "AI.II.L.K1f", text: "f. Sandbars, islands, and shoals" },
          { code: "AI.II.L.K1g", text: "g. Vessel traffic and wakes" },
          { code: "AI.II.L.K1h", text: "h. Direction and height of waves" },
          { code: "AI.II.L.K1i", text: "i. Other characteristics specific to the area" },
          { code: "AI.II.L.K2", text: "Float and hull construction, and its effect on seaplane performance." },
          { code: "AI.II.L.K3", text: "Causes of porpoising and skipping, and the pilot action needed to prevent or correct these occurrences." },
          { code: "AI.II.L.K4", text: "How to locate and identify seaplane bases on charts or in directories." },
          { code: "AI.II.L.K5", text: "Operating restrictions at various bases." },
          { code: "AI.II.L.K6", text: "Right-of-way, steering, and sailing rules pertinent to seaplane operation." },
          { code: "AI.II.L.K7", text: "Marine navigation aids, such as buoys, beacons, lights, sound signals, and range markers." },
          { code: "AI.II.L.K8", text: "Naval vessel protection zones." },
          { code: "AI.II.L.K9", text: "No wake zones." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.L.R1", text: "Local conditions." },
          { code: "AI.II.L.R2", text: "Impact of marine traffic." },
          { code: "AI.II.L.R3", text: "Right-of-way and sailing rules pertinent to seaplane operations." },
          { code: "AI.II.L.R4", text: "Limited services and assistance available at seaplane bases." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.L.S1", text: "Explain how float and hull construction can affect seaplane performance." },
          { code: "AI.II.L.S2", text: "Describe how to correct for porpoising and skipping." },
          { code: "AI.II.L.S3", text: "Identify marine navigation aids." },
          { code: "AI.II.L.S4", text: "Describe correct right-of-way, steering, and sailing operations." },
          { code: "AI.II.L.S5", text: "Assess the water surface characteristics for the proposed flight." },
          { code: "AI.II.L.S6", text: "Identify restrictions at local seaplane bases." },
        ]}
      ]
    },
    {
      id: "Task M", title: "Night Operations",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands night operations, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.M.K1", text: "Physiological aspects of vision related to night flying." },
          { code: "AI.II.M.K2", text: "Lighting systems identifying airports, runways, taxiways and obstructions, as well as pilot controlled lighting." },
          { code: "AI.II.M.K3", text: "Airplane equipment and lighting requirements for night operations." },
          { code: "AI.II.M.K4", text: "Personal equipment essential for night flight." },
          { code: "AI.II.M.K5", text: "Night orientation, navigation, chart reading techniques and methods for maintaining night vision effectiveness." },
          { code: "AI.II.M.K6", text: "Use of instruments to verify the aircraft attitude at night." },
          { code: "AI.II.M.K7", text: "Visual illusions at night." },
          { code: "AI.II.M.K8", text: "Night taxi operations." },
          { code: "AI.II.M.K9", text: "Interpretation of traffic position and direction based solely on position lights." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.M.R1", text: "Inoperative equipment." },
          { code: "AI.II.M.R2", text: "Weather considerations specific to night operations." },
          { code: "AI.II.M.R3", text: "Collision hazards." },
          { code: "AI.II.M.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.II.M.R5", text: "Effect of visual illusions and night adaptation during all phases of night flying." },
          { code: "AI.II.M.R6", text: "Runway incursion." },
          { code: "AI.II.M.R7", text: "Night currency versus proficiency." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.M.S1", text: "Teach at least one of the elements listed in K1 through K9." },
        ]}
      ]
    },
    {
      id: "Task N", title: "High Altitude Operations - Supplemental Oxygen",
      refs: "14 CFR part 91; AC 61-107; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant exhibits satisfactory knowledge, risk management, and skills associated with flight at higher altitudes where supplemental oxygen is required or recommended, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.N.K1", text: "Regulatory requirements for supplemental oxygen use by flight crew and passengers." },
          { code: "AI.II.N.K2", text: "Physiological factors, including:" },
          { code: "AI.II.N.K2a", text: "a. Impairment" },
          { code: "AI.II.N.K2b", text: "b. Symptoms of hypoxia" },
          { code: "AI.II.N.K2c", text: "c. Time of useful consciousness (TUC)" },
          { code: "AI.II.N.K3", text: "Operational factors, including:" },
          { code: "AI.II.N.K3a", text: "a. Characteristics, limitations, and applicability of continuous flow, demand, and pressure demand oxygen systems" },
          { code: "AI.II.N.K3b", text: "b. Differences between and identification of \"aviator's breathing oxygen\" and other types of oxygen" },
          { code: "AI.II.N.K3c", text: "c. Precautions when using supplemental oxygen systems" },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.N.R1", text: "High altitude flight." },
          { code: "AI.II.N.R2", text: "Use of supplemental oxygen." },
          { code: "AI.II.N.R3", text: "Management of compressed gas containers." },
          { code: "AI.II.N.R4", text: "Combustion hazards in an oxygen-rich environment." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.N.S1", text: "Provide an adequate briefing on use of supplemental oxygen equipment." },
          { code: "AI.II.N.S2", text: "Operate or simulate operation of the installed or portable oxygen equipment in the aircraft, if installed or available." },
          { code: "AI.II.N.S3", text: "Determine the quantity of supplemental oxygen required in a scenario given by the evaluator." },
        ]}
      ]
    },
    {
      id: "Task O", title: "High Altitude Operations - Pressurization",
      refs: "AC 61-107; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands flight in pressurized aircraft at high altitudes, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.O.K1", text: "Fundamental concepts of aircraft pressurization system, including failure modes." },
          { code: "AI.II.O.K2", text: "Physiological factors, including:" },
          { code: "AI.II.O.K2a", text: "a. Impairment" },
          { code: "AI.II.O.K2b", text: "b. Symptoms of hypoxia" },
          { code: "AI.II.O.K2c", text: "c. Time of useful consciousness (TUC)" },
          { code: "AI.II.O.K2d", text: "d. Effects of rapid decompression on crew and passengers" },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.O.R1", text: "High altitude flight." },
          { code: "AI.II.O.R2", text: "Malfunction of pressurization system, if equipment is installed." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.O.S1", text: "Operate the pressurization system, if equipment is installed." },
          { code: "AI.II.O.S2", text: "Respond appropriately to simulated pressurization malfunctions, if equipment is installed." },
        ]}
      ]
    },
    {
      id: "Task P", title: "One Engine Inoperative (OEI) Performance (AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands elements related to multiengine performance, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["Evaluator assesses the applicant\u2019s knowledge of at least two knowledge elements from this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.II.P.K1", text: "Proficient use of appropriate performance charts, tables, graphs, or other data to determine airplane performance and limitations for all phases of flight." },
          { code: "AI.II.P.K2", text: "Effects of exceeding limitations." },
          { code: "AI.II.P.K3", text: "Effects of atmospheric conditions on performance." },
          { code: "AI.II.P.K4", text: "Factors to be considered to determine required performance is within the airplane\u2019s single and multiengine capabilities." },
          { code: "AI.II.P.K5", text: "Aerodynamics of OEI operation including:" },
          { code: "AI.II.P.K5a", text: "a. Critical engine" },
          { code: "AI.II.P.K5b", text: "b. Effects of bank angle on VMC" },
          { code: "AI.II.P.K5c", text: "c. Zero side slip" },
          { code: "AI.II.P.K5d", text: "d. Reasons for loss of directional control" },
          { code: "AI.II.P.K6", text: "The relationship between minimum control speed (VMC) and stall speed and the effect of density altitude on that relationship." },
          { code: "AI.II.P.K7", text: "How to determine the best course of action after an engine failure." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.II.P.R1", text: "Exceeding the critical angle of attack." },
          { code: "AI.II.P.R2", text: "Loss of directional control." },
          { code: "AI.II.P.R3", text: "Flying over terrain that exceeds the single engine service ceiling." },
          { code: "AI.II.P.R4", text: "Fuel management." },
        ]},
        { label: "Skills", items: [
          { code: "AI.II.P.S1", text: "Compute the expected single engine climb performance." },
        ]}
      ]
    }
  ]
};

const data3 = {
  areaIndex: 'III',
  area: "Area of Operation III: Preflight Preparation",
  note: "The evaluator must select at least one Task from this Area of Operation.",
  tasks: [
    {
      id: "Task A", title: "Pilot Qualifications",
      refs: "14 CFR parts 61, 68, 91; AC 60-28, AC 68-1; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands pilot training and qualification requirements for different levels of pilot certificate including student pilot, sport pilot, recreational pilot, private pilot, commercial pilot, and flight instructor; can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.III.A.K1", text: "Certification, currency, and recordkeeping requirements, including training and logbook entries." },
          { code: "AI.III.A.K2", text: "Privileges and limitations of pilot certificates and ratings at student pilot, sport, recreational, private, commercial, and flight instructor levels." },
          { code: "AI.III.A.K3", text: "Medical certificates: class, expiration, privileges, temporary disqualifications, and operations under BasicMed." },
          { code: "AI.III.A.K4", text: "Documents pilots must possess to exercise privileges of the specified certificate(s) and rating(s)." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.III.A.R1", text: "Proficiency versus currency." },
          { code: "AI.III.A.R2", text: "Flying unfamiliar aircraft or operating with unfamiliar flight display systems and avionics." },
        ]},
        { label: "Skills", items: [
          { code: "AI.III.A.S1", text: "Deliver instruction on at least two of the elements specified in K1 through K4." },
        ]}
      ]
    },
    {
      id: "Task B", title: "Airworthiness Requirements",
      refs: "14 CFR parts 23, 39, 43, 91; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25",
      objective: "To determine the applicant understands airworthiness requirements, including aircraft certificates, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.III.B.K1", text: "General airworthiness requirements and compliance for airplanes, including:" },
          { code: "AI.III.B.K1a", text: "a. Location and expiration dates of required aircraft certificates" },
          { code: "AI.III.B.K1b", text: "b. Required inspections and aircraft logbook documentation" },
          { code: "AI.III.B.K1c", text: "c. Airworthiness Directives and Special Airworthiness Information Bulletins" },
          { code: "AI.III.B.K1d", text: "d. Purpose and procedure for obtaining a special flight permit" },
          { code: "AI.III.B.K2", text: "Pilot-performed preventive maintenance." },
          { code: "AI.III.B.K3", text: "Equipment requirements for day and night VFR flight, including:" },
          { code: "AI.III.B.K3a", text: "a. Flying with inoperative equipment" },
          { code: "AI.III.B.K3b", text: "b. Using an approved Minimum Equipment List (MEL)" },
          { code: "AI.III.B.K3c", text: "c. Kinds of Operation Equipment List (KOEL)" },
          { code: "AI.III.B.K3d", text: "d. Required discrepancy records or placards" },
          { code: "AI.III.B.K4", text: "Standard and special airworthiness certificates and their associated operational limitations." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.III.B.R1", text: "Inoperative equipment discovered prior to flight." },
        ]},
        { label: "Skills", items: [
          { code: "AI.III.B.S1", text: "Locate and describe airplane airworthiness and registration information." },
          { code: "AI.III.B.S2", text: "Determine the airplane is airworthy in the scenario given by the evaluator." },
          { code: "AI.III.B.S3", text: "Apply appropriate procedures for operating with inoperative equipment in a scenario given by the evaluator." },
        ]}
      ]
    },
    {
      id: "Task C", title: "Weather Information",
      refs: "14 CFR part 91; AC 91-92; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25, FAA-H-8083-28",
      objective: "To determine the applicant understands weather information, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If K2 is selected, the evaluator must assess the applicant\u2019s knowledge of at least three sub-elements.", "If K3 is selected, the evaluator must assess the applicant\u2019s knowledge of at least three sub-elements."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.III.C.K1", text: "Sources of weather data (e.g., National Weather Service, Flight Service) for flight planning purposes." },
          { code: "AI.III.C.K2", text: "Acceptable weather products and resources required for preflight planning, current and forecast weather for departure, en route, and arrival phases of flight such as:" },
          { code: "AI.III.C.K2a", text: "a. Airport Observations (METAR and SPECI) and Pilot Observations (PIREP)" },
          { code: "AI.III.C.K2b", text: "b. Surface Analysis Chart, Ceiling and Visibility Chart (CVA)" },
          { code: "AI.III.C.K2c", text: "c. Terminal Aerodrome Forecasts (TAF)" },
          { code: "AI.III.C.K2d", text: "d. Graphical Forecasts for Aviation (GFA)" },
          { code: "AI.III.C.K2e", text: "e. Wind and Temperature Aloft Forecast (FB)" },
          { code: "AI.III.C.K2f", text: "f. Convective Outlook (AC)" },
          { code: "AI.III.C.K2g", text: "g. Inflight Aviation Weather Advisories including Airmen\u2019s Meteorological Information (AIRMET), Significant Meteorological Information (SIGMET), and Convective SIGMET" },
          { code: "AI.III.C.K3", text: "Meteorology applicable to the departure, en route, alternate, and destination under visual flight rules (VFR) in Visual Meteorological Conditions (VMC), including expected climate and hazardous conditions such as:" },
          { code: "AI.III.C.K3a", text: "a. Atmospheric composition and stability" },
          { code: "AI.III.C.K3b", text: "b. Wind (e.g., windshear, mountain wave, factors affecting wind, etc.)" },
          { code: "AI.III.C.K3c", text: "c. Temperature and heat exchange" },
          { code: "AI.III.C.K3d", text: "d. Moisture/precipitation" },
          { code: "AI.III.C.K3e", text: "e. Weather system formation, including air masses and fronts" },
          { code: "AI.III.C.K3f", text: "f. Clouds" },
          { code: "AI.III.C.K3g", text: "g. Turbulence" },
          { code: "AI.III.C.K3h", text: "h. Thunderstorms and microbursts" },
          { code: "AI.III.C.K3i", text: "i. Icing and freezing level information" },
          { code: "AI.III.C.K3j", text: "j. Fog/mist" },
          { code: "AI.III.C.K3k", text: "k. Frost" },
          { code: "AI.III.C.K3l", text: "l. Obstructions to visibility (e.g., smoke, haze, volcanic ash, etc.)" },
          { code: "AI.III.C.K4", text: "Flight deck instrument displays of digital weather and aeronautical information." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.III.C.R1", text: "Making the go/no-go and continue/divert decisions, including:" },
          { code: "AI.III.C.R1a", text: "a. Circumstances that would make diversion prudent" },
          { code: "AI.III.C.R1b", text: "b. Personal weather minimums" },
          { code: "AI.III.C.R1c", text: "c. Hazardous weather conditions, including known or forecast icing or turbulence aloft" },
          { code: "AI.III.C.R2", text: "Use and limitations of:" },
          { code: "AI.III.C.R2a", text: "a. Installed onboard weather equipment" },
          { code: "AI.III.C.R2b", text: "b. Aviation weather reports and forecasts" },
          { code: "AI.III.C.R2c", text: "c. Inflight weather resources" },
        ]},
        { label: "Skills", items: [
          { code: "AI.III.C.S1", text: "Use available aviation weather resources to obtain an adequate weather briefing." },
          { code: "AI.III.C.S2", text: "Analyze the implications of at least three of the conditions listed in K3a through K3l, using actual weather or weather conditions provided by the evaluator." },
          { code: "AI.III.C.S3", text: "Correlate weather information to make a go/no-go decision." },
        ]}
      ]
    }
  ]
};

const data4 = {
  areaIndex: 'IV',
  area: "Area of Operation IV: Preflight Lesson on a Maneuver to be Performed in Flight",
  note: "The evaluator asks the applicant to present a preflight lesson on the selected maneuver as the lesson would be taught to a student and determines the outcome of this Task before the flight portion of the practical test. Previously developed lesson plans from the instructor applicant\u2019s library may be used.",
  tasks: [
    {
      id: "Task A", title: "Maneuver Lesson",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands the elements associated with a maneuver Task selected from Area of Operation VII through Area of Operation XII (ASEL, ASES) or Area of Operation VII through Area of Operation XIII (AMEL, AMES) and applies that knowledge when delivering ground instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IV.A.K1", text: "Purpose of the maneuver." },
          { code: "AI.IV.A.K2", text: "Elements of the maneuver and the associated common errors." },
          { code: "AI.IV.A.K3", text: "Desired outcome(s), including completion standards." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IV.A.R1", text: "The selected maneuver Task." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IV.A.S1", text: "Deliver instruction on the selected maneuver using a lesson plan, teaching methods, and teaching aids, as appropriate, that incorporate K1 through K3." },
        ]}
      ]
    }
  ]
};

const data5 = {
  areaIndex: 'V',
  area: "Area of Operation V: Preflight Procedures",
  note: "The evaluator must select at least one Task from this Area of Operation.",
  tasks: [
    {
      id: "Task A", title: "Preflight Assessment",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25, FAA-H-8083-28; POH/ AFM",
      objective: "To determine the applicant understands preflight assessment, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.A.K1", text: "Pilot self-assessment." },
          { code: "AI.V.A.K2", text: "Determining that the airplane to be used is appropriate and airworthy." },
          { code: "AI.V.A.K3", text: "Airplane preflight inspection, including:" },
          { code: "AI.V.A.K3a", text: "a. Which items should be inspected" },
          { code: "AI.V.A.K3b", text: "b. The reasons for checking each item" },
          { code: "AI.V.A.K3c", text: "c. How to detect possible defects" },
          { code: "AI.V.A.K3d", text: "d. The associated regulations" },
          { code: "AI.V.A.K4", text: "Environmental factors, including weather, terrain, route selection, and obstructions." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.A.R1", text: "Pilot." },
          { code: "AI.V.A.R2", text: "Aircraft." },
          { code: "AI.V.A.R3", text: "Environment (e.g., weather, airports, airspace, terrain, obstacles)." },
          { code: "AI.V.A.R4", text: "External pressures." },
          { code: "AI.V.A.R5", text: "Aviation security concerns." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.A.S1", text: "Inspect the airplane with reference to an appropriate checklist." },
          { code: "AI.V.A.S2", text: "Verify the airplane is in condition for safe flight and conforms to its type design." },
          { code: "AI.V.A.S3", text: "Perform self-assessment." },
          { code: "AI.V.A.S4", text: "Continue to assess the environment for safe flight." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Flight Deck Management",
      refs: "14 CFR part 91; AC 120-71; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands flight deck management, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.B.K1", text: "Passenger briefing requirements, including operation and required use of safety restraint systems." },
          { code: "AI.V.B.K2", text: "Use of appropriate checklists." },
          { code: "AI.V.B.K3", text: "Requirements for current and appropriate navigation data." },
          { code: "AI.V.B.K4", text: "Securing items and cargo." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.B.R1", text: "Use of systems or equipment, including automation and portable electronic devices." },
          { code: "AI.V.B.R2", text: "Inoperative equipment." },
          { code: "AI.V.B.R3", text: "Passenger distractions." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.B.S1", text: "Secure all items in the aircraft." },
          { code: "AI.V.B.S2", text: "Conduct an appropriate passenger briefing, including identifying the pilot-in-command (PIC), use of safety belts, shoulder harnesses, doors, passenger conduct, sterile aircraft, propeller blade avoidance, and emergency procedures." },
          { code: "AI.V.B.S3", text: "Properly program and manage the aircraft’s automation, as applicable." },
          { code: "AI.V.B.S4", text: "Appropriately manage risks by utilizing ADM, including SRM/CRM." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Engine Starting",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands engine starting, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.C.K1", text: "Starting under various conditions." },
          { code: "AI.V.C.K2", text: "Starting the engine(s) by use of external power." },
          { code: "AI.V.C.K3", text: "Engine limitations as they relate to starting." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.C.R1", text: "Propeller safety." },
          { code: "AI.V.C.R2", text: "Use of external power unit." },
          { code: "AI.V.C.R3", text: "Limitations during starting." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.C.S1", text: "Position the airplane properly considering structures, other aircraft, wind, and the safety of nearby persons and property." },
          { code: "AI.V.C.S2", text: "Complete the appropriate checklist(s)." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Taxiing, Airport Signs, and Lighting (ASEL, AMEL)",
      refs: "AC 91-73; AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands taxiing an airplane, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.D.K1", text: "Elements of safe taxi operations." },
          { code: "AI.V.D.K2", text: "Current airport aeronautical references and information resources such as the Chart Supplement, airport diagram, and Notices to Air Missions (NOTAMs)." },
          { code: "AI.V.D.K3", text: "Taxi instructions/clearances." },
          { code: "AI.V.D.K4", text: "Airport markings, signs, and lights." },
          { code: "AI.V.D.K5", text: "Visual indicators for wind." },
          { code: "AI.V.D.K6", text: "Aircraft lighting, as appropriate." },
          { code: "AI.V.D.K7", text: "Procedures for:" },
          { code: "AI.V.D.K7a", text: "a. Appropriate flight deck activities prior to taxi, including route planning and identifying the location of Hot Spots" },
          { code: "AI.V.D.K7b", text: "b. Radio communications at towered and nontowered airports" },
          { code: "AI.V.D.K7c", text: "c. Entering or crossing runways" },
          { code: "AI.V.D.K7d", text: "d. Night taxi operations" },
          { code: "AI.V.D.K7e", text: "e. Low visibility taxi operations" },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.D.R1", text: "Activities and distractions." },
          { code: "AI.V.D.R2", text: "Confirmation or expectation bias as related to taxi instructions." },
          { code: "AI.V.D.R3", text: "A taxi route or departure runway change." },
          { code: "AI.V.D.R4", text: "Runway incursion." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.D.S1", text: "Receive and correctly read back clearances/instructions, if applicable." },
          { code: "AI.V.D.S2", text: "Use an airport diagram or taxi chart during taxi, if published, and maintain situational awareness." },
          { code: "AI.V.D.S3", text: "Position the flight controls for the existing wind, if applicable." },
          { code: "AI.V.D.S4", text: "Complete the appropriate checklist(s)." },
          { code: "AI.V.D.S5", text: "Perform a brake check immediately after the airplane begins moving." },
          { code: "AI.V.D.S6", text: "Maintain positive control of the airplane during ground operations by controlling direction and speed without excessive use of brakes." },
          { code: "AI.V.D.S7", text: "Comply with airport/taxiway markings, signals, and air traffic control (ATC) clearances and instructions." },
          { code: "AI.V.D.S8", text: "Position the airplane properly relative to hold lines." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Taxiing and Sailing (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AC 91-73; AIM; Chart Supplements; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM; USCG Navigation Rules",
      objective: "To determine the applicant understands taxiing and sailing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.E.K1", text: "Procedures for various types of taxiing and sailing." },
          { code: "AI.V.E.K2", text: "Current airport aeronautical references and information resources such as the Chart Supplement, airport diagram, and Notices to Air Missions (NOTAMs)." },
          { code: "AI.V.E.K3", text: "Taxi instructions/clearances." },
          { code: "AI.V.E.K4", text: "Airport/seaplane base markings, signs, and lights." },
          { code: "AI.V.E.K5", text: "Visual indicators for wind." },
          { code: "AI.V.E.K6", text: "Airplane lighting." },
          { code: "AI.V.E.K7", text: "Procedures for:" },
          { code: "AI.V.E.K7a", text: "a. Appropriate flight deck activities during taxiing or sailing" },
          { code: "AI.V.E.K7b", text: "b. Radio communications at towered and nontowered seaplane bases" },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.E.R1", text: "Activities and distractions." },
          { code: "AI.V.E.R2", text: "Porpoising and skipping." },
          { code: "AI.V.E.R3", text: "Low visibility taxi and sailing operations." },
          { code: "AI.V.E.R4", text: "Other aircraft, vessels, and hazards." },
          { code: "AI.V.E.R5", text: "Confirmation or expectation bias as related to taxi instructions." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.E.S1", text: "Receive and correctly read back clearances/instructions, if applicable." },
          { code: "AI.V.E.S2", text: "Use an appropriate airport diagram or taxi chart, if published." },
          { code: "AI.V.E.S3", text: "Comply with seaplane base/airport/taxiway markings, signals, and signs." },
          { code: "AI.V.E.S4", text: "Depart the dock/mooring buoy or beach/ramp in a safe manner, considering wind, current, traffic, and hazards." },
          { code: "AI.V.E.S5", text: "Complete the appropriate checklist(s)." },
          { code: "AI.V.E.S6", text: "Position the flight controls, flaps, doors, water rudders, and power correctly for the existing conditions to follow the desired course while sailing and to prevent or correct for porpoising and skipping during step taxi." },
          { code: "AI.V.E.S7", text: "Exhibit procedures for steering and maneuvering while maintaining proper situational awareness and desired orientation, path, and position while taxiing using idle, plow, or step taxi technique, as appropriate." },
          { code: "AI.V.E.S8", text: "Plan and follow the most favorable taxi or sailing course for current conditions." },
          { code: "AI.V.E.S9", text: "Abide by right-of-way rules, maintain positive airplane control, proper speed, and separation between other aircraft, vessels, and persons." },
          { code: "AI.V.E.S10", text: "Comply with applicable taxi elements in Task D if the practical test is conducted in an amphibious airplane." },
        ]},
      ]
    },
    {
      id: "Task F", title: "Before Takeoff Check",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands before takeoff checks, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.V.F.K1", text: "Purpose of before takeoff checklist items, including:" },
          { code: "AI.V.F.K1a", text: "a. Reasons for checking each item" },
          { code: "AI.V.F.K1b", text: "b. Detecting malfunctions" },
          { code: "AI.V.F.K1c", text: "c. Ensuring the aircraft is in safe operating condition as recommended by the manufacturer" },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.V.F.R1", text: "Division of attention while conducting before takeoff checks." },
          { code: "AI.V.F.R2", text: "Unexpected runway changes by air traffic control (ATC)." },
          { code: "AI.V.F.R3", text: "Wake turbulence." },
          { code: "AI.V.F.R4", text: "Potential powerplant failure during takeoff or other malfunction considering operational factors such as airplane characteristics, runway/takeoff path length, surface conditions, environmental conditions, and obstructions." },
        ]},
        { label: "Skills", items: [
          { code: "AI.V.F.S1", text: "Review takeoff performance." },
          { code: "AI.V.F.S2", text: "Complete the appropriate checklist(s)." },
          { code: "AI.V.F.S3", text: "Position the airplane appropriately considering wind direction and the presence of any aircraft, vessels, or buildings as applicable." },
          { code: "AI.V.F.S4", text: "Divide attention inside and outside the flight deck." },
          { code: "AI.V.F.S5", text: "Verify that engine parameters and airplane configuration are suitable." },
        ]},
      ]
    },
  ]
};

const data6 = {
  areaIndex: 'VI',
  area: "Area of Operation VI: Airport and Seaplane Base Operations",
  note: "The evaluator must select at least one Task from this Area of Operation.",
  tasks: [
    {
      id: "Task A", title: "Communications, Light Signals, and Runway Lighting Systems",
      refs: "14 CFR part 91; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands communications, ATC light signals, and runway lighting systems and can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VI.A.K1", text: "How to obtain appropriate radio frequencies." },
          { code: "AI.VI.A.K2", text: "Proper radio communication procedures and air traffic control (ATC) phraseology." },
          { code: "AI.VI.A.K3", text: "ATC light signal recognition." },
          { code: "AI.VI.A.K4", text: "Appropriate use of transponder(s)." },
          { code: "AI.VI.A.K5", text: "Lost communication procedures." },
          { code: "AI.VI.A.K6", text: "Equipment issues that could cause loss of communication." },
          { code: "AI.VI.A.K7", text: "Radar assistance." },
          { code: "AI.VI.A.K8", text: "Runway Status Lighting Systems." },
          { code: "AI.VI.A.K9", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VI.A.R1", text: "Communication." },
          { code: "AI.VI.A.R2", text: "Deciding if and when to declare an emergency." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VI.A.S1", text: "Select and activate appropriate frequencies." },
          { code: "AI.VI.A.S2", text: "Transmit using standard phraseology and procedures as specified in the Aeronautical Information Manual (AIM) and Pilot/Controller Glossary." },
          { code: "AI.VI.A.S3", text: "Acknowledge radio communications and comply with ATC instructions or as directed by the evaluator." },
          { code: "AI.VI.A.S4", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Traffic Patterns",
      refs: "14 CFR part 91; AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands traffic patterns, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VI.B.K1", text: "Towered and nontowered airport operations." },
          { code: "AI.VI.B.K2", text: "Traffic pattern selection for the current conditions." },
          { code: "AI.VI.B.K3", text: "Right-of-way rules." },
          { code: "AI.VI.B.K4", text: "Use of automated weather and airport information." },
          { code: "AI.VI.B.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VI.B.R1", text: "Collision hazards." },
          { code: "AI.VI.B.R2", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VI.B.R3", text: "Windshear and wake turbulence." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VI.B.S1", text: "Identify and interpret airport/seaplane base runways, taxiways, markings, signs, and lighting." },
          { code: "AI.VI.B.S2", text: "Comply with recommended traffic pattern procedures." },
          { code: "AI.VI.B.S3", text: "Correct for wind drift to maintain the proper ground track." },
          { code: "AI.VI.B.S4", text: "Maintain orientation with the runway/landing area in use." },
          { code: "AI.VI.B.S5", text: "Maintain traffic pattern altitude, ±100 feet, and the appropriate airspeed, ±10 knots." },
          { code: "AI.VI.B.S6", text: "Maintain situational awareness and proper spacing from other aircraft in the traffic pattern." },
          { code: "AI.VI.B.S7", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data7 = {
  areaIndex: 'VII',
  area: "Area of Operation VII: Takeoffs, Landings, and Go-Arounds",
  note: "The evaluator must select at least two takeoff and two landing Tasks from Area of Operation VII, Takeoffs, Landings, and Go-Arounds.",
  tasks: [
    {
      id: "Task A", title: "Normal Takeoff and Climb",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands normal takeoff and climb, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If a crosswind condition does not exist, the applicant’s knowledge of crosswind elements must be evaluated through oral testing."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.A.K1", text: "Procedures for normal and crosswind takeoff." },
          { code: "AI.VII.A.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.A.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.A.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.A.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.A.R1", text: "Selection of runway based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.A.R2", text: "Effects of:" },
          { code: "AI.VII.A.R2a", text: "a. Crosswind" },
          { code: "AI.VII.A.R2b", text: "b. Windshear" },
          { code: "AI.VII.A.R2c", text: "c. Tailwind" },
          { code: "AI.VII.A.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.A.R2e", text: "e. Takeoff surface/condition" },
          { code: "AI.VII.A.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.A.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.A.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.A.R4", text: "Collision hazards." },
          { code: "AI.VII.A.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.A.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.A.R7", text: "Runway incursion." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.A.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.A.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.A.S3", text: "Verify assigned/correct runway or takeoff path." },
          { code: "AI.VII.A.S4", text: "Determine wind direction with or without visible wind direction indicators." },
          { code: "AI.VII.A.S5", text: "Position the flight controls for the existing wind, if applicable." },
          { code: "AI.VII.A.S6", text: "Clear the area, taxi into takeoff position, and align the airplane on the runway centerline (ASEL, AMEL) or takeoff path (ASES, AMES)." },
          { code: "AI.VII.A.S7", text: "Retract the water rudders, as appropriate (ASES, AMES)." },
          { code: "AI.VII.A.S8", text: "Advance the throttle smoothly to takeoff power and confirm proper engine and flight instrument indications prior to rotation." },
          { code: "AI.VII.A.S9", text: "Avoid excessive water spray on the propeller(s) (ASES, AMES)." },
          { code: "AI.VII.A.S10", text: "Establish and maintain the most efficient planing/lift-off attitude, and correct for porpoising or skipping (ASES, AMES)." },
          { code: "AI.VII.A.S11", text: "Rotate and lift off at the recommended airspeed and accelerate to VY." },
          { code: "AI.VII.A.S12", text: "Establish a pitch attitude to maintain the manufacturer’s recommended speed or VY, ±5 knots." },
          { code: "AI.VII.A.S13", text: "Configure the airplane in accordance with manufacturer’s guidance." },
          { code: "AI.VII.A.S14", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.A.S15", text: "Maintain directional control and proper wind-drift correction throughout takeoff and climb." },
          { code: "AI.VII.A.S16", text: "Comply with noise abatement procedures, as applicable." },
          { code: "AI.VII.A.S17", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Normal Approach and Landing",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands normal approach and landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If a crosswind condition does not exist, the applicant’s knowledge of crosswind elements must be evaluated through oral testing."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.B.K1", text: "Procedures for normal and crosswind approach and landing." },
          { code: "AI.VII.B.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.B.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.B.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.B.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.B.R1", text: "Selection of runway/landing surface, approach path, and touchdown area based on pilot capability, aircraft performance and limitations, available distance, and wind." },
          { code: "AI.VII.B.R2", text: "Effects of:" },
          { code: "AI.VII.B.R2a", text: "a. Crosswind" },
          { code: "AI.VII.B.R2b", text: "b. Windshear" },
          { code: "AI.VII.B.R2c", text: "c. Tailwind" },
          { code: "AI.VII.B.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.B.R2e", text: "e. Landing surface/condition" },
          { code: "AI.VII.B.R3", text: "Planning for:" },
          { code: "AI.VII.B.R3a", text: "a. Rejected landing and go-around" },
          { code: "AI.VII.B.R3b", text: "b. Land and hold short operations (LAHSO)" },
          { code: "AI.VII.B.R4", text: "Collision hazards." },
          { code: "AI.VII.B.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.B.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.B.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.B.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.B.S3", text: "Ensure the airplane is aligned with the correct/assigned runway or landing surface." },
          { code: "AI.VII.B.S4", text: "Scan the runway or landing surface and adjoining area for traffic and obstructions." },
          { code: "AI.VII.B.S5", text: "Select and aim for a suitable touchdown point considering the wind conditions, landing surface, and obstructions." },
          { code: "AI.VII.B.S6", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.B.S7", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 times the stalling speed or the minimum steady flight speed in the landing configuration (VSO), ±5 knots with gust factor applied." },
          { code: "AI.VII.B.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.VII.B.S9", text: "Make smooth, timely, and correct control application during round out and touchdown." },
          { code: "AI.VII.B.S10", text: "Touch down at a proper pitch attitude, within 200 feet beyond or on the specified point, with no side drift, and with the airplane’s longitudinal axis aligned with and over the runway center/landing path." },
          { code: "AI.VII.B.S11", text: "Execute a timely go-around if the approach cannot be made within the tolerances specified above or for any other condition that may result in an unsafe approach or landing." },
          { code: "AI.VII.B.S12", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Soft-Field Takeoff and Climb (ASEL)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands soft-field takeoff and climb, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.C.K1", text: "Purpose of and procedures for soft-field takeoff and climb." },
          { code: "AI.VII.C.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.C.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.C.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.C.K5", text: "Ground effect." },
          { code: "AI.VII.C.K6", text: "Importance of weight transfer from wheels to wings." },
          { code: "AI.VII.C.K7", text: "Left turning tendencies." },
          { code: "AI.VII.C.K8", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.C.R1", text: "Selection of runway based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.C.R2", text: "Effects of:" },
          { code: "AI.VII.C.R2a", text: "a. Crosswind" },
          { code: "AI.VII.C.R2b", text: "b. Windshear" },
          { code: "AI.VII.C.R2c", text: "c. Tailwind" },
          { code: "AI.VII.C.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.C.R2e", text: "e. Runway surface/condition" },
          { code: "AI.VII.C.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.C.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.C.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.C.R4", text: "Collision hazards." },
          { code: "AI.VII.C.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.C.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.C.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.C.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.C.S3", text: "Verify assigned/correct runway." },
          { code: "AI.VII.C.S4", text: "Determine wind direction with or without visible wind direction indicators." },
          { code: "AI.VII.C.S5", text: "Position the flight controls for the existing wind, if applicable." },
          { code: "AI.VII.C.S6", text: "Clear the area, maintain necessary flight control inputs, taxi into takeoff position and align the airplane on the runway centerline without stopping, while advancing the throttle smoothly to takeoff power." },
          { code: "AI.VII.C.S7", text: "Confirm takeoff power and proper engine and flight instrument indications." },
          { code: "AI.VII.C.S8", text: "Establish and maintain a pitch attitude that transfers the weight of the airplane from the wheels to the wings as rapidly as possible." },
          { code: "AI.VII.C.S9", text: "Lift off at the lowest possible airspeed and remain in ground effect while accelerating to VX or VY, as appropriate." },
          { code: "AI.VII.C.S10", text: "Establish a pitch attitude for VX or VY, as appropriate, and maintain selected airspeed ±5 knots during the climb." },
          { code: "AI.VII.C.S11", text: "Configure the airplane after a positive rate of climb has been verified or in accordance with airplane manufacturer’s instructions." },
          { code: "AI.VII.C.S12", text: "Maintain VX or VY, as appropriate, ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.C.S13", text: "Maintain directional control and proper wind-drift correction throughout takeoff and climb." },
          { code: "AI.VII.C.S14", text: "Comply with noise abatement procedures, as applicable." },
          { code: "AI.VII.C.S15", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Soft-Field Approach and Landing (ASEL)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands soft-field approach and landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.D.K1", text: "Purpose of and procedures for soft-field approach and landing." },
          { code: "AI.VII.D.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.D.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.D.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.D.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.D.R1", text: "Selection of runway based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.D.R2", text: "Effects of:" },
          { code: "AI.VII.D.R2a", text: "a. Crosswind" },
          { code: "AI.VII.D.R2b", text: "b. Windshear" },
          { code: "AI.VII.D.R2c", text: "c. Tailwind" },
          { code: "AI.VII.D.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.D.R2e", text: "e. Runway surface/condition" },
          { code: "AI.VII.D.R3", text: "Planning for:" },
          { code: "AI.VII.D.R3a", text: "a. Rejected landing and go-around" },
          { code: "AI.VII.D.R3b", text: "b. Land and hold short operations (LAHSO)" },
          { code: "AI.VII.D.R4", text: "Collision hazards." },
          { code: "AI.VII.D.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.D.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.D.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.D.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.D.S3", text: "Ensure the airplane is aligned with the correct/assigned runway." },
          { code: "AI.VII.D.S4", text: "Scan the landing runway and adjoining area for traffic and obstructions." },
          { code: "AI.VII.D.S5", text: "Select and aim for a suitable touchdown point considering the wind conditions, landing surface, and obstructions." },
          { code: "AI.VII.D.S6", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.D.S7", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 times the stalling speed or the minimum steady flight speed in the landing configuration (VSO), ±5 knots with gust factor applied." },
          { code: "AI.VII.D.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.VII.D.S9", text: "Make smooth, timely, and correct control inputs during the round out and touchdown, and, for tricycle gear airplanes, keep the nose wheel off the surface until loss of elevator effectiveness." },
          { code: "AI.VII.D.S10", text: "Touch down at a proper pitch attitude with minimum sink rate, no side drift, and with the airplane’s longitudinal axis aligned with the center of the runway." },
          { code: "AI.VII.D.S11", text: "Maintain elevator as recommended by manufacturer during rollout and exit the “soft” area at a speed that would preclude sinking into the surface." },
          { code: "AI.VII.D.S12", text: "Execute a timely go-around if the approach cannot be made within the tolerances specified above or for any other condition that may result in an unsafe approach or landing." },
          { code: "AI.VII.D.S13", text: "Maintain proper position of the flight controls and sufficient speed to taxi while on the soft surface." },
          { code: "AI.VII.D.S14", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Short-Field Takeoff and Maximum Performance Climb (ASEL, AMEL)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands short-field takeoff and maximum performance climb, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.E.K1", text: "Purpose of and procedures for short-field takeoff and maximum performance climb." },
          { code: "AI.VII.E.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.E.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.E.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.E.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.E.R1", text: "Selection of runway based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.E.R2", text: "Effects of:" },
          { code: "AI.VII.E.R2a", text: "a. Crosswind" },
          { code: "AI.VII.E.R2b", text: "b. Windshear" },
          { code: "AI.VII.E.R2c", text: "c. Tailwind" },
          { code: "AI.VII.E.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.E.R2e", text: "e. Landing surface/condition" },
          { code: "AI.VII.E.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.E.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.E.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.E.R4", text: "Collision hazards." },
          { code: "AI.VII.E.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.E.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.E.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.E.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.E.S3", text: "Verify assigned/correct runway." },
          { code: "AI.VII.E.S4", text: "Determine wind direction with or without visible wind direction indicators." },
          { code: "AI.VII.E.S5", text: "Position the flight controls for the existing wind, if applicable." },
          { code: "AI.VII.E.S6", text: "Clear the area, taxi into takeoff position, and align the airplane on the runway centerline utilizing maximum available takeoff area." },
          { code: "AI.VII.E.S7", text: "Apply brakes while setting engine power to achieve maximum performance." },
          { code: "AI.VII.E.S8", text: "Confirm takeoff power prior to brake release and verify proper engine and flight instrument indications prior to rotation." },
          { code: "AI.VII.E.S9", text: "Rotate and lift off at the recommended airspeed and accelerate to the recommended obstacle clearance airspeed or VX, ±5 knots." },
          { code: "AI.VII.E.S10", text: "Establish a pitch attitude to maintain the recommended obstacle clearance airspeed or VX, ±5 knots until the obstacle is cleared or until the airplane is 50 feet above the surface." },
          { code: "AI.VII.E.S11", text: "Establish a pitch attitude for VY and accelerate to VY ±5 knots after clearing the obstacle or at 50 feet above ground level (AGL) if simulating an obstacle." },
          { code: "AI.VII.E.S12", text: "Configure the airplane in accordance with the manufacturer’s guidance after a positive rate of climb has been verified." },
          { code: "AI.VII.E.S13", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.E.S14", text: "Maintain directional control and proper wind-drift correction throughout takeoff and climb." },
          { code: "AI.VII.E.S15", text: "Comply with noise abatement procedures, as applicable." },
          { code: "AI.VII.E.S16", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task F", title: "Short-Field Approach and Landing (ASEL, AMEL)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands short-field approach and landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.F.K1", text: "Purpose of and procedures for short-field approach and landing." },
          { code: "AI.VII.F.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.F.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.F.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.F.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.F.R1", text: "Selection of runway based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.F.R2", text: "Effects of:" },
          { code: "AI.VII.F.R2a", text: "a. Crosswind" },
          { code: "AI.VII.F.R2b", text: "b. Windshear" },
          { code: "AI.VII.F.R2c", text: "c. Tailwind" },
          { code: "AI.VII.F.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.F.R2e", text: "e. Landing surface/condition" },
          { code: "AI.VII.F.R3", text: "Planning for:" },
          { code: "AI.VII.F.R3a", text: "a. Rejected landing and go-around" },
          { code: "AI.VII.F.R3b", text: "b. Land and hold short operations (LAHSO)" },
          { code: "AI.VII.F.R4", text: "Collision hazards." },
          { code: "AI.VII.F.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.F.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.F.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.F.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.F.S3", text: "Ensure the airplane is aligned with the correct/assigned runway." },
          { code: "AI.VII.F.S4", text: "Scan the landing runway and adjoining area for traffic and obstructions." },
          { code: "AI.VII.F.S5", text: "Select and aim for a suitable touchdown point considering the wind conditions, landing surface, and obstructions." },
          { code: "AI.VII.F.S6", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.F.S7", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 times the stalling speed or the minimum steady flight speed in the landing configuration (VSO), ±5 knots with gust factor applied." },
          { code: "AI.VII.F.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.VII.F.S9", text: "Make smooth, timely, and correct control application before, during, and after touchdown." },
          { code: "AI.VII.F.S10", text: "Touch down at a proper pitch attitude within 100 feet beyond or on the specified point, threshold markings, or runway numbers, with no side drift, minimum float, and with the airplane’s longitudinal axis aligned with and over the runway centerline." },
          { code: "AI.VII.F.S11", text: "Use manufacturer’s recommended procedures for airplane configuration and braking." },
          { code: "AI.VII.F.S12", text: "Execute a timely go-around if the approach cannot be made within the tolerances specified above or for any other condition that may result in an unsafe approach or landing." },
          { code: "AI.VII.F.S13", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task G", title: "Confined Area Takeoff and Maximum Performance Climb (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands confined area takeoff and maximum performance climb, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.G.K1", text: "Purpose of and procedures for confined area takeoff and maximum performance climb." },
          { code: "AI.VII.G.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.G.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.G.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.G.K5", text: "Effects of water surface." },
          { code: "AI.VII.G.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.G.R1", text: "Selection of takeoff path based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.G.R2", text: "Effects of:" },
          { code: "AI.VII.G.R2a", text: "a. Crosswind" },
          { code: "AI.VII.G.R2b", text: "b. Windshear" },
          { code: "AI.VII.G.R2c", text: "c. Tailwind" },
          { code: "AI.VII.G.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.G.R2e", text: "e. Water surface/condition" },
          { code: "AI.VII.G.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.G.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.G.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.G.R4", text: "Collision hazards." },
          { code: "AI.VII.G.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.G.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.G.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.G.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.G.S3", text: "Verify assigned/correct takeoff path." },
          { code: "AI.VII.G.S4", text: "Determine wind direction with or without visible wind direction indicators." },
          { code: "AI.VII.G.S5", text: "Position the flight controls for the existing wind, if applicable." },
          { code: "AI.VII.G.S6", text: "Clear the area, taxi into takeoff position utilizing maximum available takeoff area, and align the airplane on the takeoff path." },
          { code: "AI.VII.G.S7", text: "Retract the water rudders, as appropriate." },
          { code: "AI.VII.G.S8", text: "Establish a pitch attitude that maintains the most efficient planing/lift-off attitude and correct for porpoising and skipping." },
          { code: "AI.VII.G.S9", text: "Advance the throttle smoothly to takeoff power and confirm proper engine and flight instrument indications prior to rotation." },
          { code: "AI.VII.G.S10", text: "Avoid excessive water spray on the propeller(s)." },
          { code: "AI.VII.G.S11", text: "Rotate and lift off at the recommended airspeed, and accelerate to the recommended obstacle clearance airspeed or VX." },
          { code: "AI.VII.G.S12", text: "Establish a pitch attitude to maintain the recommended obstacle clearance airspeed or VX, ±5 knots until the obstacle is cleared or until the airplane is 50 feet above the surface." },
          { code: "AI.VII.G.S13", text: "Establish a pitch attitude for VY and accelerate to VY ±5 knots after clearing the obstacle or at 50 feet above ground level (AGL) if simulating an obstacle." },
          { code: "AI.VII.G.S14", text: "Retract flaps, if extended, after a positive rate of climb has been verified or in accordance with airplane manufacturer’s guidance." },
          { code: "AI.VII.G.S15", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.G.S16", text: "Maintain directional control and proper wind-drift correction throughout takeoff and climb." },
          { code: "AI.VII.G.S17", text: "Comply with noise abatement procedures, as applicable." },
          { code: "AI.VII.G.S18", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task H", title: "Confined Area Approach and Landing (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands confined area approach and landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.H.K1", text: "Purpose of and procedures for confined area approach and landing." },
          { code: "AI.VII.H.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.H.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.H.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.H.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.H.R1", text: "Selection of approach path and touchdown area based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.H.R2", text: "Effects of:" },
          { code: "AI.VII.H.R2a", text: "a. Crosswind" },
          { code: "AI.VII.H.R2b", text: "b. Windshear" },
          { code: "AI.VII.H.R2c", text: "c. Tailwind" },
          { code: "AI.VII.H.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.H.R2e", text: "e. Water surface/condition" },
          { code: "AI.VII.H.R3", text: "Planning for a go-around and rejected landing." },
          { code: "AI.VII.H.R4", text: "Collision hazards." },
          { code: "AI.VII.H.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.H.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.H.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.H.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.H.S3", text: "Ensure the airplane is aligned for an approach to the correct/assigned landing surface." },
          { code: "AI.VII.H.S4", text: "Scan the landing area for traffic and obstructions." },
          { code: "AI.VII.H.S5", text: "Select and aim for a suitable touchdown point considering the wind conditions, landing surface, and obstructions." },
          { code: "AI.VII.H.S6", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.H.S7", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 VSO, +10/-5 knots with gust factor applied." },
          { code: "AI.VII.H.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.VII.H.S9", text: "Make smooth, timely, and correct control application before, during, and after touchdown." },
          { code: "AI.VII.H.S10", text: "Contact the water at the recommended airspeed with a proper pitch attitude for the surface conditions." },
          { code: "AI.VII.H.S11", text: "Touch down at a proper pitch attitude, within 100 feet beyond or on the specified point, with no side drift, minimum float, and with the airplane’s longitudinal axis aligned with the projected landing path." },
          { code: "AI.VII.H.S12", text: "Execute a timely go-around if the approach cannot be made within the tolerances specified above or for any other condition that may result in an unsafe approach or landing." },
          { code: "AI.VII.H.S13", text: "Apply elevator control as necessary to stop in the shortest distance consistent with safety." },
          { code: "AI.VII.H.S14", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task I", title: "Glassy Water Takeoff and Climb (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands glassy-water takeoff and climb, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If a glassy water condition does not exist, the applicant must be evaluated by simulating the Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.I.K1", text: "Purpose of and procedures for glassy water takeoff and climb." },
          { code: "AI.VII.I.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.I.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.I.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.I.K5", text: "Appropriate use of glassy water takeoff and climb technique." },
          { code: "AI.VII.I.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.I.R1", text: "Selection of takeoff path based on pilot capability, airplane performance and limitations, and available distance." },
          { code: "AI.VII.I.R2", text: "Water surface/condition." },
          { code: "AI.VII.I.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.I.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.I.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.I.R4", text: "Collision hazards." },
          { code: "AI.VII.I.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.I.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.I.R7", text: "Gear position in an amphibious airplane." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.I.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.I.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.I.S3", text: "Position flight controls and configure the aircraft for the existing conditions." },
          { code: "AI.VII.I.S4", text: "Clear the area, select appropriate takeoff path considering surface hazards or vessels and surface conditions." },
          { code: "AI.VII.I.S5", text: "Retract the water rudders, as appropriate." },
          { code: "AI.VII.I.S6", text: "Advance the throttle smoothly to takeoff power and confirm proper engine and flight instrument indications prior to rotation." },
          { code: "AI.VII.I.S7", text: "Establish and maintain an appropriate planing attitude, directional control, and correct for porpoising, skipping, and increase in water drag." },
          { code: "AI.VII.I.S8", text: "Avoid excessive water spray on the propeller(s)." },
          { code: "AI.VII.I.S9", text: "Use appropriate techniques to lift seaplane from the water considering surface conditions." },
          { code: "AI.VII.I.S10", text: "Establish proper attitude/airspeed and accelerate to VY ±5 knots during the climb." },
          { code: "AI.VII.I.S11", text: "Configure the airplane after a positive rate of climb has been verified or in accordance with airplane manufacturer’s instructions." },
          { code: "AI.VII.I.S12", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.I.S13", text: "Maintain directional control throughout takeoff and climb." },
          { code: "AI.VII.I.S14", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task J", title: "Glassy Water Approach and Landing (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands glassy-water approach and landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If a glassy water condition does not exist, the applicant must be evaluated by simulating the Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.J.K1", text: "Purpose of and procedures for glassy water approach and landing." },
          { code: "AI.VII.J.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.J.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.J.K4", text: "When and why glassy water techniques are used." },
          { code: "AI.VII.J.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.J.R1", text: "Selection of approach path and touchdown area based on pilot capability, airplane performance and limitations, and available distance." },
          { code: "AI.VII.J.R2", text: "Water surface/condition." },
          { code: "AI.VII.J.R3", text: "Planning for a go-around and rejected landing." },
          { code: "AI.VII.J.R4", text: "Collision hazards." },
          { code: "AI.VII.J.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.J.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.J.R7", text: "Gear position in an amphibious airplane." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.J.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.J.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.J.S3", text: "Scan the landing area for traffic and obstructions." },
          { code: "AI.VII.J.S4", text: "Select a proper approach and landing path considering the landing surface, visual attitude references, water depth, and collision hazards." },
          { code: "AI.VII.J.S5", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.J.S6", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 VSO, ±5 knots." },
          { code: "AI.VII.J.S7", text: "Make smooth, timely, and correct power and control adjustments to maintain proper pitch attitude and rate of descent to touchdown." },
          { code: "AI.VII.J.S8", text: "Contact the water in a proper pitch attitude, and slow to idle taxi speed." },
          { code: "AI.VII.J.S9", text: "Maintain directional control throughout the approach and landing." },
          { code: "AI.VII.J.S10", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task K", title: "Rough Water Takeoff and Climb (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands rough water takeoff and climb, can apply that knowledge, manage",
      taskNotes: ["If a rough water condition does not exist, the applicant must be evaluated by simulating the Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.K.K1", text: "Purpose of and procedures for a rough water takeoff and climb." },
          { code: "AI.VII.K.K2", text: "Effects of atmospheric conditions, including wind, on takeoff and climb performance." },
          { code: "AI.VII.K.K3", text: "Best angle of climb speed (VX) and best rate of climb speed (VY)." },
          { code: "AI.VII.K.K4", text: "Appropriate airplane configuration." },
          { code: "AI.VII.K.K5", text: "Appropriate use of rough water takeoff and climb technique." },
          { code: "AI.VII.K.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.K.R1", text: "Selection of takeoff path based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.K.R2", text: "Effects of:" },
          { code: "AI.VII.K.R2a", text: "a. Crosswind" },
          { code: "AI.VII.K.R2b", text: "b. Windshear" },
          { code: "AI.VII.K.R2c", text: "c. Tailwind" },
          { code: "AI.VII.K.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.K.R2e", text: "e. Water surface/condition" },
          { code: "AI.VII.K.R3", text: "Abnormal operations, including planning for:" },
          { code: "AI.VII.K.R3a", text: "a. Rejected takeoff" },
          { code: "AI.VII.K.R3b", text: "b. Potential engine failure in takeoff/climb phase of flight" },
          { code: "AI.VII.K.R4", text: "Collision hazards." },
          { code: "AI.VII.K.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.K.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.K.R7", text: "Gear position in an amphibious airplane." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.K.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.K.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.K.S3", text: "Verify assigned/correct takeoff path." },
          { code: "AI.VII.K.S4", text: "Determine wind direction with or without visible wind direction indicators." },
          { code: "AI.VII.K.S5", text: "Position flight controls and configure the airplane for the existing conditions." },
          { code: "AI.VII.K.S6", text: "Clear the area, select an appropriate takeoff path considering wind, swells, surface hazards, or vessels." },
          { code: "AI.VII.K.S7", text: "Retract the water rudders, as appropriate." },
          { code: "AI.VII.K.S8", text: "Advance the throttle smoothly to takeoff power and confirm proper engine and flight instrument indications prior to rotation." },
          { code: "AI.VII.K.S9", text: "Establish and maintain an appropriate planing attitude, directional control, and correct for porpoising, skipping, and increase in water drag." },
          { code: "AI.VII.K.S10", text: "Avoid excessive water spray on the propeller(s)." },
          { code: "AI.VII.K.S11", text: "Lift off at minimum airspeed and accelerate to VY ±5 knots before leaving ground effect." },
          { code: "AI.VII.K.S12", text: "Configure the airplane after a positive rate of climb has been verified or in accordance with airplane manufacturer’s instructions." },
          { code: "AI.VII.K.S13", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.K.S14", text: "Maintain directional control and proper wind-drift correction throughout takeoff and climb." },
          { code: "AI.VII.K.S15", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task L", title: "Rough Water Approach and Landing (ASES, AMES)",
      category: "ASES/AMES",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands rough water approach, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["If a rough water condition does not exist, the applicant must be evaluated by simulating the Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.L.K1", text: "Purpose of and procedures for rough water approach and landing." },
          { code: "AI.VII.L.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.L.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.L.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.L.K5", text: "When and why rough water techniques are used." },
          { code: "AI.VII.L.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.L.R1", text: "Selection of approach path and touchdown area based on pilot capability, airplane performance and limitations, available distance, and wind." },
          { code: "AI.VII.L.R2", text: "Effects of:" },
          { code: "AI.VII.L.R2a", text: "a. Crosswind" },
          { code: "AI.VII.L.R2b", text: "b. Windshear" },
          { code: "AI.VII.L.R2c", text: "c. Tailwind" },
          { code: "AI.VII.L.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.L.R2e", text: "e. Water surface/condition" },
          { code: "AI.VII.L.R3", text: "Planning for a go-around and rejected landing." },
          { code: "AI.VII.L.R4", text: "Collision hazards." },
          { code: "AI.VII.L.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.L.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.L.R7", text: "Gear position in an amphibious airplane." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.L.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.L.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.L.S3", text: "Ensure the airplane is aligned with the correct/assigned waterway." },
          { code: "AI.VII.L.S4", text: "Scan the landing area for traffic and obstructions." },
          { code: "AI.VII.L.S5", text: "Select and aim for a suitable touchdown point considering the wind conditions, landing surface, and obstructions." },
          { code: "AI.VII.L.S6", text: "Establish the recommended approach and landing configuration, airspeed, and trim, and adjust pitch attitude and power as required to maintain a stabilized approach." },
          { code: "AI.VII.L.S7", text: "Maintain manufacturer’s published approach airspeed or in its absence not more than 1.3 times the stalling speed or the minimum steady flight speed in the landing configuration (VSO), ±5 knots with gust factor applied." },
          { code: "AI.VII.L.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.VII.L.S9", text: "Make smooth, timely, and correct power and control adjustments to maintain proper pitch attitude and rate of descent to touchdown." },
          { code: "AI.VII.L.S10", text: "Contact the water in a proper pitch attitude, considering the type of rough water." },
          { code: "AI.VII.L.S11", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task M", title: "Slip to a Landing (ASEL, ASES)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands a slip to a landing, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.M.K1", text: "Purpose of and procedures for forward or side slip to a landing." },
          { code: "AI.VII.M.K2", text: "Concepts of energy management during a forward or side slip approach." },
          { code: "AI.VII.M.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing performance." },
          { code: "AI.VII.M.K4", text: "Wind correction techniques during a forward or side slip." },
          { code: "AI.VII.M.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.M.R1", text: "Selection of runway/landing surface, approach path, and touchdown area based on pilot capability, aircraft performance and limitations, available distance, and wind." },
          { code: "AI.VII.M.R2", text: "Effects of:" },
          { code: "AI.VII.M.R2a", text: "a. Crosswind" },
          { code: "AI.VII.M.R2b", text: "b. Windshear" },
          { code: "AI.VII.M.R2c", text: "c. Tailwind" },
          { code: "AI.VII.M.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.M.R2e", text: "e. Landing surface/condition" },
          { code: "AI.VII.M.R3", text: "Planning for:" },
          { code: "AI.VII.M.R3a", text: "a. Rejected landing and go-around" },
          { code: "AI.VII.M.R3b", text: "b. Land and hold short operations (LAHSO)" },
          { code: "AI.VII.M.R4", text: "Collision hazards." },
          { code: "AI.VII.M.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.M.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.M.R7", text: "Forward slip operations, including fuel flowage, tail stalls with flaps, and airspeed control." },
          { code: "AI.VII.M.R8", text: "Surface contact with the airplane’s longitudinal axis misaligned." },
          { code: "AI.VII.M.R9", text: "Unstable approach." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.M.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.M.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.M.S3", text: "Plan and follow a flightpath to the selected landing area considering altitude, wind, terrain, and obstructions." },
          { code: "AI.VII.M.S4", text: "Select the most suitable touchdown point based on wind, landing surface, obstructions, and airplane limitations." },
          { code: "AI.VII.M.S5", text: "Position airplane on downwind leg, parallel to landing runway or selected landing surface." },
          { code: "AI.VII.M.S6", text: "Configure the airplane correctly." },
          { code: "AI.VII.M.S7", text: "As necessary, correlate crosswind with direction of slip and transition to sideslip as appropriate before touchdown." },
          { code: "AI.VII.M.S8", text: "Touch down at a proper pitch attitude, within 400 feet beyond or on the specified point, with no side drift, and with the airplane’s longitudinal axis aligned with and over the runway center/landing path." },
          { code: "AI.VII.M.S9", text: "Maintain a ground track aligned with the runway center/landing path." },
          { code: "AI.VII.M.S10", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task N", title: "Go-Around/Rejected Landing",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands go-around/rejected landing with emphasis on factors that contribute to landing conditions that may require a go-around, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.N.K1", text: "Purpose of and procedures for go-around or rejected landing." },
          { code: "AI.VII.N.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.N.K3", text: "Effects of atmospheric conditions, including wind and density altitude, on a go-around or rejected landing." },
          { code: "AI.VII.N.K4", text: "Wind correction techniques on takeoff/departure and approach/landing." },
          { code: "AI.VII.N.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.N.R1", text: "Delayed recognition of the need for a go-around/rejected landing." },
          { code: "AI.VII.N.R2", text: "Delayed performance of a go-around at low altitude." },
          { code: "AI.VII.N.R3", text: "Power application." },
          { code: "AI.VII.N.R4", text: "Configuring the airplane." },
          { code: "AI.VII.N.R5", text: "Collision hazards." },
          { code: "AI.VII.N.R6", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.N.R7", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.N.R8", text: "Managing a go-around/rejected landing after accepting a LAHSO clearance." },
          { code: "AI.VII.N.R9", text: "Runway incursion." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.N.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.N.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.N.S3", text: "Make a timely decision to discontinue the approach to landing." },
          { code: "AI.VII.N.S4", text: "Apply takeoff power immediately and transition to climb pitch attitude for VX or VY as appropriate ±5 knots." },
          { code: "AI.VII.N.S5", text: "Configure the airplane after a positive rate of climb has been verified or in accordance with airplane manufacturer’s instructions." },
          { code: "AI.VII.N.S6", text: "Maneuver to the side of the runway/landing area when necessary to clear and avoid conflicting traffic." },
          { code: "AI.VII.N.S7", text: "Maintain VY ±5 knots to a safe maneuvering altitude." },
          { code: "AI.VII.N.S8", text: "Maintain directional control and proper wind-drift correction throughout the climb." },
          { code: "AI.VII.N.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task O", title: "Power-Off 180° Accuracy Approach and Landing (ASEL, ASES)",
      refs: "AIM; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands a power-off 180° accuracy approach, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VII.O.K1", text: "Purpose of and procedures for proper 180° accuracy approach and landing." },
          { code: "AI.VII.O.K2", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.VII.O.K3", text: "Effects of atmospheric conditions, including wind, on approach and landing." },
          { code: "AI.VII.O.K4", text: "Wind correction techniques on approach and landing." },
          { code: "AI.VII.O.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VII.O.R1", text: "Selection of runway/landing surface, approach path, and touchdown area based on pilot capability, aircraft performance and limitations, available distance, and wind." },
          { code: "AI.VII.O.R2", text: "Effects of:" },
          { code: "AI.VII.O.R2a", text: "a. Crosswind" },
          { code: "AI.VII.O.R2b", text: "b. Windshear" },
          { code: "AI.VII.O.R2c", text: "c. Tailwind" },
          { code: "AI.VII.O.R2d", text: "d. Wake turbulence" },
          { code: "AI.VII.O.R2e", text: "e. Landing surface/condition" },
          { code: "AI.VII.O.R3", text: "Planning for:" },
          { code: "AI.VII.O.R3a", text: "a. Rejected landing and go-around" },
          { code: "AI.VII.O.R3b", text: "b. Land and hold short operations (LAHSO)" },
          { code: "AI.VII.O.R4", text: "Collision hazards." },
          { code: "AI.VII.O.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.VII.O.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VII.O.R7", text: "Forward slip operations, including fuel flowage, tail stalls with flaps, and airspeed control." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VII.O.S1", text: "Complete the appropriate checklist(s)." },
          { code: "AI.VII.O.S2", text: "Make radio calls as appropriate." },
          { code: "AI.VII.O.S3", text: "Plan and follow a flightpath to the selected landing area considering altitude, wind, terrain, and obstructions." },
          { code: "AI.VII.O.S4", text: "Select the most suitable touchdown point based on wind, landing surface, obstructions, and aircraft limitations." },
          { code: "AI.VII.O.S5", text: "Position airplane on downwind leg, parallel to landing runway." },
          { code: "AI.VII.O.S6", text: "Correctly configure the airplane." },
          { code: "AI.VII.O.S7", text: "As necessary, correlate crosswind with direction of forward slip and transition to side slip before touchdown." },
          { code: "AI.VII.O.S8", text: "Touch down at a proper pitch attitude, within 200 feet beyond or on the specified point with no side drift and with the airplane’s longitudinal axis aligned with and over the runway centerline or landing path, as applicable." },
          { code: "AI.VII.O.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data8 = {
  areaIndex: 'VIII',
  area: "Area of Operation VIII: Fundamentals of Flight",
  note: "The evaluator must select at least one Task from this Area of Operation.",
  tasks: [
    {
      id: "Task A", title: "Straight-and-Level Flight",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands straight-and-level flight, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VIII.A.K1", text: "Purpose of and procedures for proper straight-and-level flight." },
          { code: "AI.VIII.A.K2", text: "Flight control and trim use." },
          { code: "AI.VIII.A.K3", text: "The pilot\'s visual references when performing the maneuver." },
          { code: "AI.VIII.A.K4", text: "Integrated flight instruction." },
          { code: "AI.VIII.A.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VIII.A.R1", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VIII.A.R2", text: "Collision hazards." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VIII.A.S1", text: "Establish and maintain straight-and-level flight." },
          { code: "AI.VIII.A.S2", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Level Turns",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands level turns, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VIII.B.K1", text: "Purpose of and procedures for level turns." },
          { code: "AI.VIII.B.K2", text: "Flight control and trim use." },
          { code: "AI.VIII.B.K3", text: "The pilot\'s visual references when performing the maneuver." },
          { code: "AI.VIII.B.K4", text: "Integrated flight instruction." },
          { code: "AI.VIII.B.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VIII.B.R1", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VIII.B.R2", text: "Collision hazards." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VIII.B.S1", text: "Establish, maintain, and roll out of a level turn." },
          { code: "AI.VIII.B.S2", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Straight Climbs and Climbing Turns",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands straight climbs and climbing turns, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VIII.C.K1", text: "Purpose of and procedures for straight climbs and climbing turns." },
          { code: "AI.VIII.C.K2", text: "Flight control and trim use." },
          { code: "AI.VIII.C.K3", text: "The pilot\'s visual references when performing the maneuver." },
          { code: "AI.VIII.C.K4", text: "Integrated flight instruction." },
          { code: "AI.VIII.C.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VIII.C.R1", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VIII.C.R2", text: "Collision hazards." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VIII.C.S1", text: "Establish, maintain, and level off from climbs and climbing turns." },
          { code: "AI.VIII.C.S2", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Straight Descents and Descending Turns",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25",
      objective: "To determine the applicant understands straight descents and descending turns, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.VIII.D.K1", text: "Purpose of and procedures for straight descents and descending turns." },
          { code: "AI.VIII.D.K2", text: "Flight control and trim use." },
          { code: "AI.VIII.D.K3", text: "The pilot\'s visual references when performing the maneuver." },
          { code: "AI.VIII.D.K4", text: "Integrated flight instruction." },
          { code: "AI.VIII.D.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.VIII.D.R1", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.VIII.D.R2", text: "Collision hazards." },
        ]},
        { label: "Skills", items: [
          { code: "AI.VIII.D.S1", text: "Establish, maintain, and level off from straight descents and descending turns." },
          { code: "AI.VIII.D.S2", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data9 = {
  areaIndex: 'IX',
  area: "Area of Operation IX: Performance and Ground Reference Maneuvers",
  note: "For ASEL or ASES, the evaluator must select at least four Tasks including Task A or B, Task C or D, and Tasks E and F from Area of Operation IX , Performance and Ground Reference Maneuvers. For AMEL or AMES the evaluator must select at least Tasks A and E.",
  tasks: [
    {
      id: "Task A", title: "Steep Turns",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands steep turns, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.A.K1", text: "Purpose of and procedures for steep turn." },
          { code: "AI.IX.A.K2", text: "Pilot sensations and control forces." },
          { code: "AI.IX.A.K3", text: "Aerodynamics associated with steep turns, including:" },
          { code: "AI.IX.A.K3a", text: "a. Maintaining coordinated flight" },
          { code: "AI.IX.A.K3b", text: "b. Overbanking tendencies" },
          { code: "AI.IX.A.K3c", text: "c. Maneuvering speed, including the impact of weight changes" },
          { code: "AI.IX.A.K3d", text: "d. Load factor and accelerated stalls" },
          { code: "AI.IX.A.K3e", text: "e. Rate and radius of turn" },
          { code: "AI.IX.A.K4", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.A.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.A.R2", text: "Collision hazards." },
          { code: "AI.IX.A.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.A.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.A.R5", text: "Uncoordinated flight." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.A.S1", text: "Clear the area." },
          { code: "AI.IX.A.S2", text: "Establish the manufacturer\'s recommended airspeed; or if one is not available, an airspeed not to exceed maneuvering speed (VA)." },
          { code: "AI.IX.A.S3", text: "Roll into a coordinated 360° steep turn with approximately a 50° bank." },
          { code: "AI.IX.A.S4", text: "Perform the Task in the opposite direction." },
          { code: "AI.IX.A.S5", text: "Maintain the entry altitude ±100 feet, airspeed ±10 knots, bank ±5°, and roll out on the entry heading ±10°." },
          { code: "AI.IX.A.S6", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Steep Spiral (ASEL, ASES)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands steep spirals, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.B.K1", text: "Purpose of and procedures for a proper steep spiral." },
          { code: "AI.IX.B.K2", text: "Relationship to emergency landing procedures." },
          { code: "AI.IX.B.K3", text: "Maintaining a constant radius about a point." },
          { code: "AI.IX.B.K4", text: "Effects of wind on ground track and relation to a ground reference." },
          { code: "AI.IX.B.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.B.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.B.R2", text: "Collision hazards." },
          { code: "AI.IX.B.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.B.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.B.R5", text: "Uncoordinated flight." },
          { code: "AI.IX.B.R6", text: "Effects of wind." },
          { code: "AI.IX.B.R7", text: "Airframe or airspeed limitations." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.B.S1", text: "Clear the area." },
          { code: "AI.IX.B.S2", text: "Select an altitude sufficient to continue through a series of at least three, 360° turns." },
          { code: "AI.IX.B.S3", text: "Establish and maintain a steep spiral, not to exceed 60° angle of bank, to maintain a constant radius about a suitable ground reference point." },
          { code: "AI.IX.B.S4", text: "Apply wind-drift correction to track a constant radius circle around selected reference point with bank not to exceed 60° a steepest point in turn." },
          { code: "AI.IX.B.S5", text: "Divide attention between airplane control, traffic avoidance and the ground track while maintaining coordinated flight." },
          { code: "AI.IX.B.S6", text: "Maintain the specified airspeed, ±10 knots and roll out toward an object or specified heading, ±10°, and complete the maneuver no lower than 1,500 feet above ground level (AGL)." },
          { code: "AI.IX.B.S7", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Chandelles (ASEL, ASES)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands chandelles, can apply that knowledge, manage associated risks,",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.C.K1", text: "Purpose of and procedures for chandelles." },
          { code: "AI.IX.C.K2", text: "Aerodynamics associated with chandelles, including:" },
          { code: "AI.IX.C.K2a", text: "a. Maintaining coordinated flight" },
          { code: "AI.IX.C.K2b", text: "b. Overbanking tendencies" },
          { code: "AI.IX.C.K2c", text: "c. Maneuvering speed, including the impact of weight changes" },
          { code: "AI.IX.C.K2d", text: "d. Accelerated stalls" },
          { code: "AI.IX.C.K3", text: "Appropriate airplane configuration for maximum performance climb." },
          { code: "AI.IX.C.K4", text: "Proper pitch control required for continuously decreasing airspeed." },
          { code: "AI.IX.C.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.C.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.C.R2", text: "Collision hazards." },
          { code: "AI.IX.C.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.C.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.C.R5", text: "Uncoordinated flight." },
          { code: "AI.IX.C.R6", text: "Energy management." },
          { code: "AI.IX.C.R7", text: "Rate and radius of turn with confined area operations." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.C.S1", text: "Clear the area." },
          { code: "AI.IX.C.S2", text: "Select an altitude that allows the maneuver to be performed no lower than 1,500 feet above ground level (AGL)." },
          { code: "AI.IX.C.S3", text: "Establish the appropriate entry configuration, power, and airspeed." },
          { code: "AI.IX.C.S4", text: "Establish the angle of bank at approximately 30°." },
          { code: "AI.IX.C.S5", text: "Simultaneously apply power and pitch to maintain a smooth, coordinated climbing turn, in either direction, to the 90° point, with a constant bank and continuously decreasing airspeed." },
          { code: "AI.IX.C.S6", text: "Begin a coordinated constant rate rollout from the 90° point to the 180° point maintaining power and a constant pitch attitude." },
          { code: "AI.IX.C.S7", text: "Complete rollout at the 180° point, ±10° just above a stall airspeed, and maintaining that airspeed momentarily avoiding a stall." },
          { code: "AI.IX.C.S8", text: "Resume a straight-and-level flight with minimum loss of altitude." },
          { code: "AI.IX.C.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Lazy Eights (ASEL, ASES)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands lazy eights, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.D.K1", text: "Purpose of and procedures for lazy eights." },
          { code: "AI.IX.D.K2", text: "Aerodynamics associated with lazy eights, including how to maintain coordinated flight." },
          { code: "AI.IX.D.K3", text: "Performance and airspeed limitations." },
          { code: "AI.IX.D.K4", text: "Phases of the lazy eight maneuver from entry to recovery." },
          { code: "AI.IX.D.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.D.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.D.R2", text: "Collision hazards." },
          { code: "AI.IX.D.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.D.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.D.R5", text: "Uncoordinated flight." },
          { code: "AI.IX.D.R6", text: "Energy management." },
          { code: "AI.IX.D.R7", text: "Accelerated stalls." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.D.S1", text: "Clear the area." },
          { code: "AI.IX.D.S2", text: "Select an altitude that allows the maneuver to be performed no lower than 1,500 feet above ground level (AGL)." },
          { code: "AI.IX.D.S3", text: "Establish the recommended entry configuration, power, and airspeed." },
          { code: "AI.IX.D.S4", text: "Maintain coordinated flight throughout the maneuver." },
          { code: "AI.IX.D.S5", text: "Complete the maneuver in accordance with the following:" },
          { code: "AI.IX.D.S5a", text: "a. Approximately 30° bank at the steepest point" },
          { code: "AI.IX.D.S5b", text: "b. Constant change of pitch and roll rate and airspeed" },
          { code: "AI.IX.D.S5c", text: "c. Altitude at 180° point, ±100 feet from entry altitude" },
          { code: "AI.IX.D.S5d", text: "d. Airspeed at the 180° point, ±10 knots from entry airspeed" },
          { code: "AI.IX.D.S5e", text: "e. Heading at the 180° point, ±10°" },
          { code: "AI.IX.D.S6", text: "Continue the maneuver through the number of symmetrical loops specified, then resume straight-and- level flight." },
          { code: "AI.IX.D.S7", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Ground Reference Maneuvers",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands ground reference maneuvers, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["The evaluator selects at least one ground reference maneuver for the applicant to demonstrate."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.E.K1", text: "Purpose of and procedures for ground reference maneuvers." },
          { code: "AI.IX.E.K2", text: "Effects of wind on ground track and relation to a ground reference." },
          { code: "AI.IX.E.K3", text: "Effects of bank angle and groundspeed on rate and radius of turn." },
          { code: "AI.IX.E.K4", text: "Relationship of rectangular course to airport traffic pattern." },
          { code: "AI.IX.E.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.E.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.E.R2", text: "Collision hazards." },
          { code: "AI.IX.E.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.E.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.E.R5", text: "Uncoordinated flight." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.E.S1", text: "Clear the area." },
          { code: "AI.IX.E.S2", text: "Select a suitable ground reference area, line, or point as appropriate." },
          { code: "AI.IX.E.S3", text: "Plan the maneuver:" },
          { code: "AI.IX.E.S3a", text: "a. Rectangular course: enter a left or right pattern, 600 to 1,000 feet above ground level (AGL) at an appropriate distance from the selected reference area, 45° to the downwind leg" },
          { code: "AI.IX.E.S3b", text: "b. S-turns: enter perpendicular to the selected reference line, 600 to 1,000 feet AGL at an appropriate distance from the selected reference area" },
          { code: "AI.IX.E.S3c", text: "c. Turns around a point: enter at an appropriate distance from the reference point, 600 to 1,000 feet AGL at an appropriate distance from the selected reference area" },
          { code: "AI.IX.E.S4", text: "Apply adequate wind-drift correction during straight and turning flight to maintain a constant ground track around a rectangular reference area, or to maintain a constant radius turn on each side of a selected reference line or point." },
          { code: "AI.IX.E.S5", text: "If performing S-Turns, reverse the turn directly over the selected reference line; if performing turns around a point, complete turns in either direction, as specified by the evaluator." },
          { code: "AI.IX.E.S6", text: "Divide attention between airplane control, traffic avoidance and the ground track while maintaining coordinated flight." },
          { code: "AI.IX.E.S7", text: "Maintain altitude ±100 feet; maintain airspeed ±10 knots." },
          { code: "AI.IX.E.S8", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task F", title: "Eights on Pylons (ASEL, ASES)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands eights on pylons, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.IX.F.K1", text: "Purpose of and procedures for eights on pylons." },
          { code: "AI.IX.F.K2", text: "Aerodynamics associated with the eights on pylons, including coordinated and uncoordinated flight." },
          { code: "AI.IX.F.K3", text: "Pivotal altitude and factors that affect it." },
          { code: "AI.IX.F.K4", text: "Effect of wind on ground track." },
          { code: "AI.IX.F.K5", text: "Phases of the eights on pylons maneuver from entry to recovery." },
          { code: "AI.IX.F.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.IX.F.R1", text: "Division of attention between aircraft control and orientation." },
          { code: "AI.IX.F.R2", text: "Collision hazards." },
          { code: "AI.IX.F.R3", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.IX.F.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.IX.F.R5", text: "Uncoordinated flight." },
          { code: "AI.IX.F.R6", text: "Energy management." },
          { code: "AI.IX.F.R7", text: "Emergency landing considerations." },
        ]},
        { label: "Skills", items: [
          { code: "AI.IX.F.S1", text: "Clear the area." },
          { code: "AI.IX.F.S2", text: "Determine the approximate pivotal altitude." },
          { code: "AI.IX.F.S3", text: "Select suitable pylons that permits straight-and-level flight between the pylons." },
          { code: "AI.IX.F.S4", text: "Enter the maneuver in the correct direction and position using an appropriate altitude and airspeed." },
          { code: "AI.IX.F.S5", text: "Establish the correct bank angle for the conditions, not to exceed 40°." },
          { code: "AI.IX.F.S6", text: "Apply smooth and continuous corrections so that the line-of-sight reference line remains on the pylon." },
          { code: "AI.IX.F.S7", text: "Divide attention between accurate, coordinated airplane control and outside visual references." },
          { code: "AI.IX.F.S8", text: "Maintain pylon position using appropriate pivotal altitude, avoiding slips and skids." },
          { code: "AI.IX.F.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data10 = {
  areaIndex: 'X',
  area: "Area of Operation X: Slow flight, Stalls, and Spins",
  note: "For single-engine, the evaluator must select Task A or B; Task C, D, or E; Task F, G, or H; and Task I. For multiengine the evaluator must select Task A and Task C, D, or E.",
  tasks: [
    {
      id: "Task A", title: "Maneuvering During Slow Flight",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands maneuvering during slow flight in cruise configuration, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.A.K1", text: "Purpose of and procedures for proper slow flight." },
          { code: "AI.X.A.K2", text: "Aerodynamics associated with slow flight in various airplane configurations, including the relationship between angle of attack, airspeed, load factor, power setting, airplane weight and center of gravity, airplane attitude, and yaw effects." },
          { code: "AI.X.A.K3", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.A.R1", text: "Inadvertent slow flight and flight with a stall warning, which could lead to loss of control." },
          { code: "AI.X.A.R2", text: "Range and limitations of stall warning indicators (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.A.R3", text: "Uncoordinated flight." },
          { code: "AI.X.A.R4", text: "Effect of environmental elements on airplane performance (e.g., turbulence, microbursts, and high- density altitude)." },
          { code: "AI.X.A.R5", text: "Collision hazards." },
          { code: "AI.X.A.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.A.S1", text: "Clear the area." },
          { code: "AI.X.A.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 1,500 feet above ground level (AGL) (ASEL, ASES) or 3,000 feet AGL (AMEL, AMES)." },
          { code: "AI.X.A.S3", text: "Establish and maintain an airspeed at which any further increase in angle of attack, increase in load factor, or reduction in power, would result in a stall warning (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.A.S4", text: "Accomplish coordinated straight-and-level flight, turns, climbs, and descents with the aircraft configured as specified by the evaluator without a stall warning (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.A.S5", text: "Maintain the specified altitude, ±50 feet; specified heading, ±10°; airspeed, +5/-0 knots; and specified angle of bank, ±5°." },
          { code: "AI.X.A.S6", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Demonstration of Flight Characteristics at Various Configurations and Airspeeds (ASEL and ASES)",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands flight characteristics and power required at different airspeeds and configurations appropriate to the make and model of airplane flown, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.B.K1", text: "Purpose of and procedures for demonstration of flight characteristics at various configurations and airspeeds." },
          { code: "AI.X.B.K2", text: "Power required at various airspeeds between cruise airspeed and critically slow airspeeds near the critical angle of attack." },
          { code: "AI.X.B.K3", text: "The minimum power required speed and its role in differentiating the region of normal command and the region of reversed command on the power-required curve." },
          { code: "AI.X.B.K4", text: "The relationships between lift, drag, angle of attack, airspeed, load factor, power required, weight, center of gravity, attitude, yaw effects, controllability, and stalls and spins." },
          { code: "AI.X.B.K5", text: "Pitch, power, and trim control inputs that are required to operate the airplane in level flight, turns, climbs, and descents and how the control inputs change at various airspeeds between cruise airspeed and critically slow airspeeds." },
          { code: "AI.X.B.K6", text: "Flight characteristics and aerodynamics associated with configuration changes applicable to the specific to the make and model of airplane provided for the practical test." },
          { code: "AI.X.B.K7", text: "Airspeeds specific to the airplane for various operations, how to identify them on the airspeed indicator (if applicable), and their significance in airplane performance, including:" },
          { code: "AI.X.B.K7a", text: "a. Design/operating maneuvering speed" },
          { code: "AI.X.B.K7b", text: "b. Landing gear extended/operating speed, if applicable" },
          { code: "AI.X.B.K7c", text: "c. Flaps extended/operating speed, if applicable" },
          { code: "AI.X.B.K7d", text: "d. Best glide speed" },
          { code: "AI.X.B.K7e", text: "e. Reference landing speed" },
          { code: "AI.X.B.K7f", text: "f. Stalling speeds" },
          { code: "AI.X.B.K8", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.B.R1", text: "Lack of familiarity with airplane airspeed limitations and interpretation of the airspeed indicator." },
          { code: "AI.X.B.R2", text: "Exceeding airspeed limitations." },
          { code: "AI.X.B.R3", text: "Flight characteristics in the region of reversed command and the potential for loss of control." },
          { code: "AI.X.B.R4", text: "Inadvertent exceedance of the critical angle of attack." },
          { code: "AI.X.B.R5", text: "Range, limitations, and operational characteristics of airspeed indicators and stall warning indicators (e.g., airplane buffet, stall horn, etc.)." },
          { code: "AI.X.B.R6", text: "Unacknowledged stall warning indications." },
          { code: "AI.X.B.R7", text: "Effects of environmental elements on airplane performance and controllability. (e.g., turbulence, microbursts, and high density altitude)." },
          { code: "AI.X.B.R8", text: "Collision hazards." },
          { code: "AI.X.B.R9", text: "Maneuvering at critically slow airspeeds." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.B.S1", text: "Conduct and explain the procedure, manage the associated risk, and fly the airplane, while maintaining altitude ±100 feet, airspeed +5/-0 knots, heading ±10°, and specified bank angle ±5°, as appropriate." },
          { code: "AI.X.B.S2", text: "Select an altitude that allows the maneuver to be performed no lower than 1,500 feet above ground level (AGL)." },
          { code: "AI.X.B.S3", text: "Clear the area." },
          { code: "AI.X.B.S4", text: "Clean configuration demonstration:" },
          { code: "AI.X.B.S4a", text: "a. Establish and maintain design/operating maneuvering speed appropriate to the airplane’s weight while describing pitch, power, and trim inputs to maintain altitude and airspeed, then;" },
          { code: "AI.X.B.S4b", text: "b. With gear and flaps retracted (as applicable), slow the airplane to, and maintain, best glide speed (or as specified by evaluator), noting the power setting required, then;" },
          { code: "AI.X.B.S4c", text: "c. Continue to slow the airplane to, and maintain, an airspeed at which any further increase in angle of attack, increase in load factor, or reduction in power would result in an immediate stall, and maintain that airspeed in level flight, noting the airspeed and power setting required, while;" },
          { code: "AI.X.B.S4d", text: "d. Verbally acknowledging stall warning indications, then;" },
          { code: "AI.X.B.S4e", text: "e. Without changing power setting, lower the pitch attitude and accelerate to a faster airspeed until reestablishing the airplane in level flight, noting the new airspeed and amount of altitude lost, then;" },
          { code: "AI.X.B.S4f", text: "f. Return to normal cruise flight at the altitude and heading specified by the evaluator" },
          { code: "AI.X.B.S5", text: "Landing configuration demonstration." },
          { code: "AI.X.B.S5a", text: "a. Establish and maintain design/operating maneuvering speed appropriate to the airplane’s weight while describing pitch, power, and trim inputs to maintain altitude and airspeed, then;" },
          { code: "AI.X.B.S5b", text: "b. Slow the airplane to, and maintain, the appropriate limiting airspeeds and fully extend the landing gear and flaps (as appropriate), then;" },
          { code: "AI.X.B.S5c", text: "c. With gear and flaps fully extended (as applicable), slow the airplane to, and maintain, reference landing speed (or as specified by the evaluator), noting the power setting required, then;" },
          { code: "AI.X.B.S5d", text: "d. With gear and flaps fully extended, continue to slow the airplane to, and maintain, an airspeed at which any further increase in angle of attack, increase in load factor, or reduction in power would result in an immediate stall, and maintain that airspeed in level flight, noting the airspeed and power setting required, while;" },
          { code: "AI.X.B.S5e", text: "e. Verbally acknowledging stall warning indications, then;" },
          { code: "AI.X.B.S5f", text: "f. Without changing power setting, lower the pitch attitude and accelerate to a faster airspeed until reestablishing the airplane in in level flight, noting the new airspeed and amount of altitude lost, then;" },
          { code: "AI.X.B.S5g", text: "g. Return to normal cruise flight at the altitude and heading specified by the evaluator" },
          { code: "AI.X.B.S6", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Power-Off Stalls",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands power-off stalls, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.C.K1", text: "Purpose of and procedures for power-off stalls." },
          { code: "AI.X.C.K2", text: "Aerodynamics associated with stalls in various airplane configurations, including the relationship between angle of attack, airspeed, load factor, power setting, airplane weight and center of gravity, airplane attitude, and yaw effects." },
          { code: "AI.X.C.K3", text: "Stall characteristics as they relate to airplane design, and recognition impending stall and full stall indications using sight, sound, or feel." },
          { code: "AI.X.C.K4", text: "Factors and situations that can lead to a power-off stall and actions that can be taken to prevent it." },
          { code: "AI.X.C.K5", text: "Fundamentals of stall recovery." },
          { code: "AI.X.C.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.C.R1", text: "Factors and situations that could lead to an inadvertent power-off stall, spin, and loss of control." },
          { code: "AI.X.C.R2", text: "Range and limitations of stall warning indicators (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.C.R3", text: "Stall warning(s) during normal operations." },
          { code: "AI.X.C.R4", text: "Stall recovery procedure." },
          { code: "AI.X.C.R5", text: "Secondary stalls, accelerated stalls, and cross-control stalls." },
          { code: "AI.X.C.R6", text: "Effect of environmental elements on airplane performance related to power-off stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.C.R7", text: "Collision hazards." },
          { code: "AI.X.C.R8", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.C.S1", text: "Clear the area." },
          { code: "AI.X.C.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 1,500 feet above ground level (AGL) (ASEL, ASES) or 3,000 feet AGL (AMEL, AMES)." },
          { code: "AI.X.C.S3", text: "Configure the airplane in the approach or landing configuration, as specified by the evaluator, and maintain coordinated flight throughout the maneuver." },
          { code: "AI.X.C.S4", text: "Establish a stabilized descent." },
          { code: "AI.X.C.S5", text: "Transition smoothly from the approach or landing attitude to a pitch attitude that induces a stall." },
          { code: "AI.X.C.S6", text: "Maintain a specified heading, ±10° if in straight flight; maintain a specified angle of bank not to exceed 20°, ±5° if in turning flight, until an impending or full stall occurs, as specified by the evaluator." },
          { code: "AI.X.C.S7", text: "Acknowledge the cues at the first indication of a stall (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.C.S8", text: "Recover at the first indication of a stall or after a full stall has occurred, as specified by the evaluator." },
          { code: "AI.X.C.S9", text: "Configure the airplane as recommended by the manufacturer, and accelerate to best angle of climb speed (VX) or best rate of climb speed (VY)." },
          { code: "AI.X.C.S10", text: "Return to the altitude, heading, and airspeed specified by the evaluator." },
          { code: "AI.X.C.S11", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Power-On Stalls",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands power-on stalls, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.D.K1", text: "Purpose of and procedures for power-on stalls." },
          { code: "AI.X.D.K2", text: "Aerodynamics associated with stalls in various airplane configurations, including the relationship between angle of attack, airspeed, load factor, power setting, airplane weight and center of gravity, airplane attitude, and yaw effects." },
          { code: "AI.X.D.K3", text: "Stall characteristics as they relate to airplane design, and recognition impending stall and full stall indications using sight, sound, or feel." },
          { code: "AI.X.D.K4", text: "Factors and situations that can lead to a power-on stall and actions that can be taken to prevent it." },
          { code: "AI.X.D.K5", text: "Fundamentals of stall recovery." },
          { code: "AI.X.D.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.D.R1", text: "Factors and situations that could lead to an inadvertent power-on stall, spin, and loss of control." },
          { code: "AI.X.D.R2", text: "Range and limitations of stall warning indicators (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.D.R3", text: "Stall warning(s) during normal operations." },
          { code: "AI.X.D.R4", text: "Stall recovery procedure." },
          { code: "AI.X.D.R5", text: "Secondary stalls, accelerated stalls, elevator trim stalls, and cross-control stalls." },
          { code: "AI.X.D.R6", text: "Effect of environmental elements on airplane performance related to power-on stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.D.R7", text: "Collision hazards." },
          { code: "AI.X.D.R8", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.D.S1", text: "Clear the area." },
          { code: "AI.X.D.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 1,500 feet above ground level (AGL) (ASEL, ASES) or 3,000 feet AGL (AMEL, AMES)." },
          { code: "AI.X.D.S3", text: "Establish the takeoff, departure, or cruise configuration, as specified by the evaluator, and maintain coordinated flight throughout the maneuver." },
          { code: "AI.X.D.S4", text: "Set power to no less than 65 percent power." },
          { code: "AI.X.D.S5", text: "Transition smoothly from the takeoff or departure attitude to the pitch attitude that induces a stall." },
          { code: "AI.X.D.S6", text: "Maintain a specified heading ±10° if in straight flight; maintain a specified angle of bank not to exceed 20°, ±10° if in turning flight, until an impending or full stall is reached, as specified by the evaluator." },
          { code: "AI.X.D.S7", text: "Acknowledge the cues at the first indication of a stall (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.D.S8", text: "Recover at the first indication of a stall or after a full stall has occurred, as specified by the evaluator." },
          { code: "AI.X.D.S9", text: "Configure the airplane as recommended by the manufacturer, and accelerate to best angle of climb speed (VX) or best rate of climb speed (VY)." },
          { code: "AI.X.D.S10", text: "Return to the altitude, heading, and airspeed specified by the evaluator." },
          { code: "AI.X.D.S11", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Accelerated Stalls",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands accelerated stalls (power-on and power-off), can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.E.K1", text: "Purpose of and procedures for accelerated stalls." },
          { code: "AI.X.E.K2", text: "Aerodynamics associated with accelerated stalls in various airplane configurations, including the relationship between angle of attack, airspeed, load factor, power setting, airplane weight and center of gravity, airplane attitude, and yaw effects." },
          { code: "AI.X.E.K3", text: "Stall characteristics as they relate to airplane design, and recognition impending stall and full stall indications using sight, sound, or feel." },
          { code: "AI.X.E.K4", text: "Factors leading to an accelerated stall and preventive actions." },
          { code: "AI.X.E.K5", text: "Fundamentals of stall recovery." },
          { code: "AI.X.E.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.E.R1", text: "Factors and situations that could lead to an inadvertent accelerated stall, spin, and loss of control." },
          { code: "AI.X.E.R2", text: "Range and limitations of stall warning indicators (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.E.R3", text: "Stall warning(s) during normal operations." },
          { code: "AI.X.E.R4", text: "Stall recovery procedure." },
          { code: "AI.X.E.R5", text: "Secondary stalls, cross-control stalls, and spins." },
          { code: "AI.X.E.R6", text: "Effect of environmental elements on airplane performance related to accelerated stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.E.R7", text: "Collision hazards." },
          { code: "AI.X.E.R8", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.E.S1", text: "Clear the area." },
          { code: "AI.X.E.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 3,000 feet above ground level (AGL)." },
          { code: "AI.X.E.S3", text: "Establish the configuration as specified by the evaluator." },
          { code: "AI.X.E.S4", text: "Set power appropriate for the configuration, such that the airspeed does not exceed the maneuvering speed (VA) or any other applicable Pilot\'s Operating Handbook (POH)/Airplane Flight Manual (AFM) limitation." },
          { code: "AI.X.E.S5", text: "Establish and maintain a coordinated turn in a 45° bank, increasing elevator back pressure smoothly and firmly until an impending stall is reached." },
          { code: "AI.X.E.S6", text: "Acknowledge the cues at the first indication of a stall (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.E.S7", text: "Execute a stall recovery in accordance with procedures set forth in the Pilot\'s Operating Handbook (POH)/Flight Manual (FM)." },
          { code: "AI.X.E.S8", text: "Configure the airplane as recommended by the manufacturer, and accelerate to best angle of climb speed (VX) or best rate of climb speed (VY)." },
          { code: "AI.X.E.S9", text: "Return to the altitude, heading, and airspeed specified by the evaluator." },
          { code: "AI.X.E.S10", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task F", title: "Cross-Controlled Stall Demonstration (ASEL, ASES)",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands cross-controlled stalls, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.F.K1", text: "Aerodynamics of cross-controlled stalls." },
          { code: "AI.X.F.K2", text: "Flight situations where unintentional cross-controlled stalls may occur." },
          { code: "AI.X.F.K3", text: "Recognition of cross-controlled stalls." },
          { code: "AI.X.F.K4", text: "Entry procedure and minimum entry altitude." },
          { code: "AI.X.F.K5", text: "Recovery procedure." },
          { code: "AI.X.F.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.F.R1", text: "Stall recovery procedure." },
          { code: "AI.X.F.R2", text: "Effect of environmental elements on airplane performance related to cross-controlled stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.F.R3", text: "Collision hazards." },
          { code: "AI.X.F.R4", text: "Aircraft limitations." },
          { code: "AI.X.F.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.F.S1", text: "Clear the area." },
          { code: "AI.X.F.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 3,000 feet above ground level (AGL)." },
          { code: "AI.X.F.S3", text: "Configure the airplane (with gear down) and close the throttle." },
          { code: "AI.X.F.S4", text: "Establish a normal glide airspeed and trim the airplane." },
          { code: "AI.X.F.S5", text: "Roll into a medium-banked turn, apply excess rudder in the turn while holding bank constant with opposite aileron input, and add elevator pressure to keep the nose from lowering." },
          { code: "AI.X.F.S6", text: "Acknowledge the cues at the first indication of a stall (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.F.S7", text: "Recover at the first indication of a stall or after a full stall has occurred, as specified by the evaluator." },
          { code: "AI.X.F.S8", text: "Describe and demonstrate conditions that lead to a cross-controlled stall for future avoidance." },
          { code: "AI.X.F.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task G", title: "Elevator Trim Stall Demonstration (ASEL, ASES)",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands elevator trim stalls, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.G.K1", text: "Aerodynamics of elevator trim stalls." },
          { code: "AI.X.G.K2", text: "Flight situations where elevator trim stalls could occur." },
          { code: "AI.X.G.K3", text: "Recognition of elevator trim stalls." },
          { code: "AI.X.G.K4", text: "Entry procedure and minimum entry altitude." },
          { code: "AI.X.G.K5", text: "Recovery procedure." },
          { code: "AI.X.G.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.G.R1", text: "Stall recovery procedure." },
          { code: "AI.X.G.R2", text: "Effect of environmental elements on airplane performance related to cross-controlled stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.G.R3", text: "Collision hazards." },
          { code: "AI.X.G.R4", text: "Aircraft limitations." },
          { code: "AI.X.G.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.G.S1", text: "Clear the area." },
          { code: "AI.X.G.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 3,000 feet above ground level (AGL)." },
          { code: "AI.X.G.S3", text: "Retard the throttle and configure the airplane for landing." },
          { code: "AI.X.G.S4", text: "Establish a normal glide airspeed and trim the airplane." },
          { code: "AI.X.G.S5", text: "Advance the throttle to the maximum allowable power as in a go-around." },
          { code: "AI.X.G.S6", text: "Acknowledge the cues at the first indication of a stall (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.G.S7", text: "Recover at the first indication of a stall or after a full stall has occurred, as specified by the evaluator." },
          { code: "AI.X.G.S8", text: "Adjust trim and return to the desired flightpath." },
          { code: "AI.X.G.S9", text: "Describe and demonstrate conditions that lead to an elevator trim stall for future avoidance." },
          { code: "AI.X.G.S10", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task H", title: "Secondary Stall Demonstration (ASEL, ASES)",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands secondary stalls, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.H.K1", text: "Aerodynamics of secondary stalls." },
          { code: "AI.X.H.K2", text: "Flight situations where secondary stalls may occur." },
          { code: "AI.X.H.K3", text: "Recognition of a secondary stall." },
          { code: "AI.X.H.K4", text: "Entry procedure and minimum entry altitude." },
          { code: "AI.X.H.K5", text: "Recovery procedure." },
          { code: "AI.X.H.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.H.R1", text: "Stall recovery procedure." },
          { code: "AI.X.H.R2", text: "Effect of environmental elements on airplane performance related to cross-controlled stalls (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.H.R3", text: "Collision hazards." },
          { code: "AI.X.H.R4", text: "Aircraft limitations." },
          { code: "AI.X.H.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.H.S1", text: "Clear the area." },
          { code: "AI.X.H.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 3,000 feet above ground level (AGL)." },
          { code: "AI.X.H.S3", text: "Enter a stall in a specified configuration and exceed the critical angle of attach a second time during the recovery." },
          { code: "AI.X.H.S4", text: "Recover promptly and appropriately after a secondary stall occurs." },
          { code: "AI.X.H.S5", text: "Describe and demonstrate conditions that lead to a secondary stall for future avoidance." },
          { code: "AI.X.H.S6", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task I", title: "Spin Awareness and Spins",
      refs: "AC 61-67; FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands spins, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["At the discretion of the evaluator, a logbook record attesting applicant instructional competency in spin entries, spins, and spin recoveries may be accepted in lieu of this Task. The flight instructor who conducted the spin instruction must certify the logbook record.", "See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.X.I.K1", text: "Purpose of and procedures for spin awareness and spins." },
          { code: "AI.X.I.K2", text: "Aerodynamics associated with spins in various airplane configurations, including the relationship between angle of attack, airspeed, load factor, power setting, airplane weight and center of gravity, airplane attitude, and yaw effects." },
          { code: "AI.X.I.K3", text: "What causes a spin and how to identify the entry, incipient, and developed phases of a spin." },
          { code: "AI.X.I.K4", text: "Spin recovery procedure." },
          { code: "AI.X.I.K5", text: "Human factors associated with spin instruction." },
          { code: "AI.X.I.K6", text: "How to determine if an airplane approved for the spin maneuver based on airworthiness category and type certificate." },
          { code: "AI.X.I.K7", text: "Flight situations where unintentional spins may occur." },
          { code: "AI.X.I.K8", text: "Entry procedure and minimum entry altitude for intentional spins." },
          { code: "AI.X.I.K9", text: "Control procedure to maintain a stabilized spin." },
          { code: "AI.X.I.K10", text: "Recognize conditions that lead to a spin for future avoidance." },
          { code: "AI.X.I.K11", text: "Orientation during a spin, including which instrument(s) are reliable for determining the directions of spin." },
          { code: "AI.X.I.K12", text: "Recovery procedure and minimum recovery altitude for intentional spins." },
          { code: "AI.X.I.K13", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.X.I.R1", text: "Factors and situations that could lead to inadvertent spin and loss of control." },
          { code: "AI.X.I.R2", text: "Range and limitations of stall warning indicators (e.g., aircraft buffet, stall horn, etc.)." },
          { code: "AI.X.I.R3", text: "Spin recovery procedure." },
          { code: "AI.X.I.R4", text: "Effect of environmental elements on airplane performance related to spins (e.g., turbulence, microbursts, and high-density altitude)." },
          { code: "AI.X.I.R5", text: "Collision hazards." },
          { code: "AI.X.I.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.X.I.S1", text: "Clear the area." },
          { code: "AI.X.I.S2", text: "Select an entry altitude that allows the Task to be completed no lower than 4,000 feet AGL." },
          { code: "AI.X.I.S3", text: "Enter and recover from an intentional spin if requested by the evaluator." },
          { code: "AI.X.I.S4", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data11 = {
  areaIndex: 'XI',
  area: "Area of Operation XI: Basic Instrument Maneuvers",
  note: "The evaluator must select at least one Task from this Area of Operation.",
  tasks: [
    {
      id: "Task A", title: "Straight-and-Level Flight",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-15, FAA-H-8083-16, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands attitude instrument flying during straight-and-level flight, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction, solely by reference to instruments.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XI.A.K1", text: "Flight instruments as they relate to:" },
          { code: "AI.XI.A.K1a", text: "a. Instrument limitations and potential errors" },
          { code: "AI.XI.A.K1b", text: "b. Indication of the aircraft attitude" },
          { code: "AI.XI.A.K1c", text: "c. Function and operation" },
          { code: "AI.XI.A.K1d", text: "d. Proper instrument cross-check techniques" },
          { code: "AI.XI.A.K2", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XI.A.R1", text: "Instrument flying hazards, including failure to maintain visual flight rules (VFR), spatial disorientation, loss of control, fatigue, stress, and emergency off airport landings." },
          { code: "AI.XI.A.R2", text: "When to seek assistance or declare an emergency in a deteriorating situation." },
          { code: "AI.XI.A.R3", text: "Collision hazards." },
          { code: "AI.XI.A.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XI.A.R5", text: "Fixation and omission." },
          { code: "AI.XI.A.R6", text: "Instrument Interpretation." },
          { code: "AI.XI.A.R7", text: "Control application solely by reference to instruments." },
          { code: "AI.XI.A.R8", text: "Trimming the aircraft." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XI.A.S1", text: "Maintain straight-and-level flight using proper instrument cross-check and interpretation, and coordinated control application." },
          { code: "AI.XI.A.S2", text: "Maintain altitude ±100 feet, heading ±10°, and airspeed ±10 knots." },
          { code: "AI.XI.A.S3", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Constant Airspeed Climbs",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-15, FAA-H-8083-16, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands attitude instrument flying during constant airspeed climbs, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction, solely by reference to instruments.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XI.B.K1", text: "Flight instruments as they relate to:" },
          { code: "AI.XI.B.K1a", text: "a. Instrument limitations and potential errors" },
          { code: "AI.XI.B.K1b", text: "b. Indication of the aircraft attitude" },
          { code: "AI.XI.B.K1c", text: "c. Function and operation" },
          { code: "AI.XI.B.K1d", text: "d. Proper instrument cross-check techniques" },
          { code: "AI.XI.B.K2", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XI.B.R1", text: "Instrument flying hazards, including failure to maintain visual flight rules (VFR), spatial disorientation, loss of control, fatigue, stress, and emergency off airport landings." },
          { code: "AI.XI.B.R2", text: "When to seek assistance or declare an emergency in a deteriorating situation." },
          { code: "AI.XI.B.R3", text: "Collision hazards." },
          { code: "AI.XI.B.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XI.B.R5", text: "Fixation and omission." },
          { code: "AI.XI.B.R6", text: "Instrument Interpretation." },
          { code: "AI.XI.B.R7", text: "Control application solely by reference to instruments." },
          { code: "AI.XI.B.R8", text: "Trimming the aircraft." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XI.B.S1", text: "Transition to the climb pitch attitude and power setting on an assigned heading using proper instrument cross-check and interpretation, and coordinated flight control application." },
          { code: "AI.XI.B.S2", text: "Climb at a constant airspeed to specific altitudes in straight flight and turns." },
          { code: "AI.XI.B.S3", text: "Level off at the assigned altitude and maintain altitude ±100 feet, heading ±10°, and airspeed ±10 knots." },
          { code: "AI.XI.B.S4", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Constant Airspeed Descents",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-15, FAA-H-8083-16, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands attitude instrument flying during constant airspeed descents, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction, solely by reference to instruments.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XI.C.K1", text: "Flight instruments as they relate to:" },
          { code: "AI.XI.C.K1a", text: "a. Instrument limitations and potential errors" },
          { code: "AI.XI.C.K1b", text: "b. Indication of the aircraft attitude" },
          { code: "AI.XI.C.K1c", text: "c. Function and operation" },
          { code: "AI.XI.C.K1d", text: "d. Proper instrument cross-check techniques" },
          { code: "AI.XI.C.K2", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XI.C.R1", text: "Instrument flying hazards, including failure to maintain visual flight rules (VFR), spatial disorientation, loss of control, fatigue, stress, and emergency off airport landings." },
          { code: "AI.XI.C.R2", text: "When to seek assistance or declare an emergency in a deteriorating situation." },
          { code: "AI.XI.C.R3", text: "Collision hazards." },
          { code: "AI.XI.C.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XI.C.R5", text: "Fixation and omission." },
          { code: "AI.XI.C.R6", text: "Instrument Interpretation." },
          { code: "AI.XI.C.R7", text: "Control application solely by reference to instruments." },
          { code: "AI.XI.C.R8", text: "Trimming the aircraft." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XI.C.S1", text: "Transition to the descent pitch attitude and power setting on an assigned heading using proper instrument cross-check and interpretation, and coordinated flight control application." },
          { code: "AI.XI.C.S2", text: "Descend at a constant airspeed to specific altitudes in straight flight and turns." },
          { code: "AI.XI.C.S3", text: "Level off at the assigned altitude and maintain altitude ±100 feet, heading ±10°, and airspeed ±10 knots." },
          { code: "AI.XI.C.S4", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Turns to Headings",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-15, FAA-H-8083-16, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands attitude instrument flying during turns to headings, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction, solely by reference to instruments.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XI.D.K1", text: "Flight instruments as they relate to:" },
          { code: "AI.XI.D.K1a", text: "a. Instrument limitations and potential errors" },
          { code: "AI.XI.D.K1b", text: "b. Indication of the aircraft attitude" },
          { code: "AI.XI.D.K1c", text: "c. Function and operation" },
          { code: "AI.XI.D.K1d", text: "d. Proper instrument cross-check techniques" },
          { code: "AI.XI.D.K2", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XI.D.R1", text: "Instrument flying hazards, including failure to maintain visual flight rules (VFR), spatial disorientation, loss of control, fatigue, stress, and emergency off airport landings." },
          { code: "AI.XI.D.R2", text: "When to seek assistance or declare an emergency in a deteriorating situation." },
          { code: "AI.XI.D.R3", text: "Collision hazards." },
          { code: "AI.XI.D.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XI.D.R5", text: "Fixation and omission." },
          { code: "AI.XI.D.R6", text: "Instrument Interpretation." },
          { code: "AI.XI.D.R7", text: "Control application solely by reference to instruments." },
          { code: "AI.XI.D.R8", text: "Trimming the aircraft." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XI.D.S1", text: "Turns to headings, maintain altitude ±100 feet, maintain a standard rate turn, roll out on the assigned heading ±10°, and maintain airspeed ±10 knots." },
          { code: "AI.XI.D.S2", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Recovery from Unusual Flight Attitudes",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-15, FAA-H-8083-16, FAA-H-8083-25; POH/ AFM",
      objective: "To determine the applicant understands attitude instrument flying while recovering from unusual attitudes, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction, solely by reference to instruments.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XI.E.K1", text: "Prevention of unusual attitudes, including flight causal, physiological, and environmental factors, and system and equipment failures." },
          { code: "AI.XI.E.K2", text: "Procedures for recovery from unusual attitudes in flight." },
          { code: "AI.XI.E.K3", text: "Procedures available to safely regain visual meteorological conditions (VMC) after flight into inadvertent instrument meteorological conditions or unintended instrument meteorological conditions (IIMC)/(UIMC)." },
          { code: "AI.XI.E.K4", text: "Appropriate use of automation, if applicable." },
          { code: "AI.XI.E.K5", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XI.E.R1", text: "Situations that could lead to loss of control in-flight (LOC-I) or unusual attitudes in-flight (e.g., stress, task saturation, inadequate instrument scan distractions, and spatial disorientation)." },
          { code: "AI.XI.E.R2", text: "Assessment of the unusual attitude." },
          { code: "AI.XI.E.R3", text: "Control input errors, inducing undesired aircraft attitudes." },
          { code: "AI.XI.E.R4", text: "Collision hazards." },
          { code: "AI.XI.E.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XI.E.R6", text: "Interpreting flight instruments." },
          { code: "AI.XI.E.R7", text: "Control application solely by reference to instruments." },
          { code: "AI.XI.E.R8", text: "Operating envelope considerations." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XI.E.S1", text: "Use proper instrument cross-check and interpretation to identify an unusual attitude (including both nose-high and nose-low) in flight, and apply the appropriate flight control, power input, and aircraft configuration in the correct sequence, to return to a stabilized level flight attitude." },
          { code: "AI.XI.E.S2", text: "Use single-pilot resource management (SRM) or crew resource management (CRM), as appropriate." },
          { code: "AI.XI.E.S3", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data12 = {
  areaIndex: 'XII',
  area: "Area of Operation XII: Emergency Operations",
  note: "For ASEL or ASES, the evaluator must select at least Tasks B and C. For AMEL or AMES, the evaluator must select Tasks E or F; Task G; and at least one other Task.",
  tasks: [
    {
      id: "Task A", title: "Emergency Descent",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands emergency descent, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.A.K1", text: "Purpose of and procedures for emergency descent." },
          { code: "AI.XII.A.K2", text: "Situations that would require an emergency descent (e.g., depressurization, smoke, or engine fire)." },
          { code: "AI.XII.A.K3", text: "Immediate action items and emergency procedures." },
          { code: "AI.XII.A.K4", text: "Aircraft performance and limitations." },
          { code: "AI.XII.A.K5", text: "Airspeed, including airspeed limitations." },
          { code: "AI.XII.A.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.A.R1", text: "Altitude, wind, terrain, obstructions, gliding distance, and available landing distance considerations." },
          { code: "AI.XII.A.R2", text: "Collision hazards." },
          { code: "AI.XII.A.R3", text: "Configuring the airplane." },
          { code: "AI.XII.A.R4", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.A.S1", text: "Clear the area." },
          { code: "AI.XII.A.S2", text: "Establish and maintain the appropriate airspeed and configuration appropriate to the scenario specified by the evaluator and as covered in Pilot\'s Operating Handbook (POH)/Airplane Flight Manual (AFM) for the emergency descent." },
          { code: "AI.XII.A.S3", text: "Maintain orientation, divide attention appropriately, and plan and execute a smooth recovery." },
          { code: "AI.XII.A.S4", text: "Use bank angle between 30° and 45° to maintain positive load factors during the descent." },
          { code: "AI.XII.A.S5", text: "Maintain appropriate airspeed +0/-10 knots, and level off at a specified altitude ±100 feet." },
          { code: "AI.XII.A.S6", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XII.A.S7", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Emergency Approach and Landing (Simulated) (ASEL, ASES)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands power failure at altitude and associated emergency approach and landing procedures, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.B.K1", text: "Immediate action items and emergency procedures." },
          { code: "AI.XII.B.K2", text: "Airspeed, including:" },
          { code: "AI.XII.B.K2a", text: "a. Importance of best glide speed and its relationship to distance" },
          { code: "AI.XII.B.K2b", text: "b. Difference between best glide speed and minimum sink speed" },
          { code: "AI.XII.B.K2c", text: "c. Effects of wind on glide distance" },
          { code: "AI.XII.B.K3", text: "Effects of atmospheric conditions on emergency approach and landing." },
          { code: "AI.XII.B.K4", text: "A stabilized approach, including energy management concepts." },
          { code: "AI.XII.B.K5", text: "Emergency Locator Transmitters (ELTs) and other emergency locating devices." },
          { code: "AI.XII.B.K6", text: "Air traffic control (ATC) services to aircraft in distress." },
          { code: "AI.XII.B.K7", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.B.R1", text: "Altitude, wind, terrain, obstructions, gliding distance, and available landing distance considerations." },
          { code: "AI.XII.B.R2", text: "Following or changing the planned flightpath to the selected landing area." },
          { code: "AI.XII.B.R3", text: "Collision hazards." },
          { code: "AI.XII.B.R4", text: "Configuring the airplane." },
          { code: "AI.XII.B.R5", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.XII.B.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.B.S1", text: "Establish and maintain the recommended best glide airspeed, ±10 knots." },
          { code: "AI.XII.B.S2", text: "Configure the airplane in accordance with the Pilot\'s Operating Handbook (POH)\\Airplane Flight Manual (AFM) and existing conditions." },
          { code: "AI.XII.B.S3", text: "Select a suitable landing area considering altitude, wind, terrain, obstructions, and available glide distance." },
          { code: "AI.XII.B.S4", text: "Plan and follow a flightpath to the selected landing area considering altitude, wind, terrain, and obstructions." },
          { code: "AI.XII.B.S5", text: "Prepare for landing as specified by the evaluator." },
          { code: "AI.XII.B.S6", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XII.B.S7", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Systems and Equipment Malfunctions",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands system and equipment malfunctions appropriate to the aircraft provided for the practical test, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.C.K1", text: "Causes of partial or complete power loss related to the specific type of powerplant(s)." },
          { code: "AI.XII.C.K2", text: "System and equipment malfunctions specific to the aircraft, including:" },
          { code: "AI.XII.C.K2a", text: "a. Electrical malfunction" },
          { code: "AI.XII.C.K2b", text: "b. Vacuum/pressure and associated flight instrument malfunctions" },
          { code: "AI.XII.C.K2c", text: "c. Pitot-static system malfunction" },
          { code: "AI.XII.C.K2d", text: "d. Electronic flight deck display malfunction" },
          { code: "AI.XII.C.K2e", text: "e. Landing gear or flap malfunction" },
          { code: "AI.XII.C.K2f", text: "f. Inoperative trim" },
          { code: "AI.XII.C.K3", text: "Causes and remedies for smoke or fire onboard the aircraft." },
          { code: "AI.XII.C.K4", text: "Any other system specific to the aircraft (e.g., supplemental oxygen, deicing)." },
          { code: "AI.XII.C.K5", text: "Inadvertent door or window opening." },
          { code: "AI.XII.C.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.C.R1", text: "Startle response." },
          { code: "AI.XII.C.R2", text: "Checklist usage for a system or equipment malfunction." },
          { code: "AI.XII.C.R3", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XII.C.R4", text: "Undesired aircraft state." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.C.S1", text: "Determine appropriate action for simulated emergencies specified by the evaluator, from at least three of the elements or sub-elements listed in K1 through K5." },
          { code: "AI.XII.C.S2", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XII.C.S3", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task D", title: "Emergency Equipment and Survival Gear",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands emergency equipment and survival gear, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information"],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.D.K1", text: "Emergency Locator Transmitter (ELT) operations, limitations, and testing requirements." },
          { code: "AI.XII.D.K2", text: "Fire extinguisher operations and limitations." },
          { code: "AI.XII.D.K3", text: "Emergency equipment and survival gear needed for:" },
          { code: "AI.XII.D.K3a", text: "a. Climate extremes (hot/cold)" },
          { code: "AI.XII.D.K3b", text: "b. Mountainous terrain" },
          { code: "AI.XII.D.K3c", text: "c. Overwater operations" },
          { code: "AI.XII.D.K4", text: "When to deploy a ballistic parachute and associated passenger briefings, if equipped." },
          { code: "AI.XII.D.K5", text: "When to activate an emergency auto-land system and brief passengers, if equipped." },
          { code: "AI.XII.D.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.D.R1", text: "Survival gear (water, clothing, shelter) for 48 to 72 hours." },
          { code: "AI.XII.D.R2", text: "Use of a ballistic parachute system." },
          { code: "AI.XII.D.R3", text: "Use of an emergency auto-land system, if installed." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.D.S1", text: "Identify appropriate equipment and personal gear." },
          { code: "AI.XII.D.S2", text: "Brief passengers on proper use of on-board emergency equipment and survival gear." },
          { code: "AI.XII.D.S3", text: "Simulate ballistic parachute deployment procedures, if equipped." },
          { code: "AI.XII.D.S4", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task E", title: "Engine Failure During Takeoff Before VMC (Simulated) (AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands engine failure during takeoff, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.E.K1", text: "Factors affecting minimum controllable speed (VMC)." },
          { code: "AI.XII.E.K2", text: "VMC (red line) and best single-engine rate of climb airspeed (VYSE) (blue line)." },
          { code: "AI.XII.E.K3", text: "Accelerate/stop distance." },
          { code: "AI.XII.E.K4", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.E.R1", text: "Potential engine failure during takeoff." },
          { code: "AI.XII.E.R2", text: "Configuring the airplane." },
          { code: "AI.XII.E.R3", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.E.S1", text: "Close the throttles smoothly and promptly when a simulated engine failure occurs." },
          { code: "AI.XII.E.S2", text: "Maintain directional control and apply brakes (AMEL), or flight controls (AMES), as necessary." },
          { code: "AI.XII.E.S3", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task F", title: "Engine Failure After Liftoff (Simulated) (AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands engine failure after liftoff, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.F.K1", text: "Factors affecting minimum controllable speed (VMC)." },
          { code: "AI.XII.F.K2", text: "VMC (red line), VYSE (blue line), and safe single-engine speed (VSSE)." },
          { code: "AI.XII.F.K3", text: "Accelerate/stop and accelerate/go distances." },
          { code: "AI.XII.F.K4", text: "How to identify, verify, feather, and secure an inoperative engine." },
          { code: "AI.XII.F.K5", text: "Importance of drag reduction, including propeller feathering, gear and flap retraction, the manufacturer’s recommended control input and its relation to zero sideslip." },
          { code: "AI.XII.F.K6", text: "Simulated propeller feathering and the evaluator’s zero-thrust procedures and responsibilities." },
          { code: "AI.XII.F.K7", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.F.R1", text: "Potential engine failure after lift-off." },
          { code: "AI.XII.F.R2", text: "Collision hazards." },
          { code: "AI.XII.F.R3", text: "Configuring the airplane." },
          { code: "AI.XII.F.R4", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.XII.F.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.F.S1", text: "Promptly recognize an engine failure, maintain control, and use appropriate emergency procedures." },
          { code: "AI.XII.F.S2", text: "Establish VYSE; if obstructions are present, establish best single-engine angle of climb speed (VXSE) or VMC +5 knots, whichever is greater, until obstructions are cleared. Then transition to VYSE." },
          { code: "AI.XII.F.S3", text: "Reduce drag by retracting landing gear and flaps in accordance with the manufacturer’s guidance." },
          { code: "AI.XII.F.S4", text: "Simulate feathering the propeller on the inoperative engine (evaluator should then establish zero thrust on the inoperative engine)." },
          { code: "AI.XII.F.S5", text: "Use flight controls in the proper combination as recommended by the manufacturer, or as required to maintain best performance, and trim as required." },
          { code: "AI.XII.F.S6", text: "Monitor the operating engine and aircraft systems and make adjustments as necessary." },
          { code: "AI.XII.F.S7", text: "Recognize the airplane’s performance capabilities. If a climb is not possible at VYSE, maintain VYSE and return to the departure airport for landing, or initiate an approach to the most suitable landing area available." },
          { code: "AI.XII.F.S8", text: "Simulate securing the inoperative engine." },
          { code: "AI.XII.F.S9", text: "Maintain heading ±10° and airspeed ±5 knots." },
          { code: "AI.XII.F.S10", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XII.F.S11", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task G", title: "Approach and Landing with an Inoperative Engine (Simulated)(AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands approach and landing with an inoperative engine, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XII.G.K1", text: "Factors affecting minimum controllable speed (VMC)." },
          { code: "AI.XII.G.K2", text: "VMC (red line) and best single-engine rate of climb airspeed (VYSE) (blue line)." },
          { code: "AI.XII.G.K3", text: "How to identify, verify, feather, and secure an inoperative engine." },
          { code: "AI.XII.G.K4", text: "Importance of drag reduction, including propeller feathering, gear and flap retraction, the manufacturer’s recommended control input and its relation to zero sideslip." },
          { code: "AI.XII.G.K5", text: "Applicant responsibilities during simulated feathering." },
          { code: "AI.XII.G.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XII.G.R1", text: "Potential engine failure after in flight or during an approach." },
          { code: "AI.XII.G.R2", text: "Collision hazards." },
          { code: "AI.XII.G.R3", text: "Configuring the airplane." },
          { code: "AI.XII.G.R4", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.XII.G.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
          { code: "AI.XII.G.R6", text: "Possible single-engine go-around." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XII.G.S1", text: "Promptly recognize an engine failure and maintain positive aircraft control." },
          { code: "AI.XII.G.S2", text: "Set the engine controls, reduce drag, identify and verify the inoperative engine, and simulate feathering of the propeller on the inoperative engine (evaluator should then establish zero thrust on the inoperative engine)." },
          { code: "AI.XII.G.S3", text: "Follow the manufacturer’s recommended emergency procedures and complete the appropriate checklist." },
          { code: "AI.XII.G.S4", text: "Monitor the operating engine and aircraft systems and make adjustments as necessary." },
          { code: "AI.XII.G.S5", text: "Maintain the manufacturer\'s recommended approach airspeed ±5 knots in the landing configuration with a stabilized approach, until landing is assured." },
          { code: "AI.XII.G.S6", text: "Make smooth, timely, and correct control application before, during, and after touchdown." },
          { code: "AI.XII.G.S7", text: "Touch down on the first one-third of available runway/landing surface, with no drift, and the airplane’s longitudinal axis aligned with and over the runway center or landing path." },
          { code: "AI.XII.G.S8", text: "Maintain directional control and appropriate crosswind correction throughout the approach and landing." },
          { code: "AI.XII.G.S9", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XII.G.S10", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data13 = {
  areaIndex: 'XIII',
  area: "Area of Operation XIII: Multiengine Operations",
  note: "The evaluator must assess all Tasks.",
  tasks: [
    {
      id: "Task A", title: "Maneuvering with One Engine Inoperative (AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands one engine inoperative, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XIII.A.K1", text: "Factors affecting minimum controllable speed (VMC)." },
          { code: "AI.XIII.A.K2", text: "VMC (red line) and best single-engine rate of climb airspeed (VYSE) (blue line)." },
          { code: "AI.XIII.A.K3", text: "How to identify, verify, feather, and secure an inoperative engine." },
          { code: "AI.XIII.A.K4", text: "Importance of drag reduction, including propeller feathering, gear and flap retraction, the manufacturer’s recommended control input and its relation to zero sideslip." },
          { code: "AI.XIII.A.K5", text: "Feathering, securing, unfeathering, and restarting." },
          { code: "AI.XIII.A.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XIII.A.R1", text: "Potential engine failure during flight." },
          { code: "AI.XIII.A.R2", text: "Collision hazards." },
          { code: "AI.XIII.A.R3", text: "Configuring the airplane." },
          { code: "AI.XIII.A.R4", text: "Low altitude maneuvering, including stall, spin, or controlled flight into terrain (CFIT)." },
          { code: "AI.XIII.A.R5", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XIII.A.S1", text: "Recognize an engine failure, maintain control, use manufacturer’s memory item procedures, and use appropriate emergency procedures." },
          { code: "AI.XIII.A.S2", text: "Set the engine controls, identify and verify the inoperative engine, and feather the appropriate propeller." },
          { code: "AI.XIII.A.S3", text: "Use flight controls in the proper combination as recommended by the manufacturer, or as required to maintain best performance, and trim as required." },
          { code: "AI.XIII.A.S4", text: "Attempt to determine and resolve the reason for the engine failure." },
          { code: "AI.XIII.A.S5", text: "Secure the inoperative engine and monitor the operating engine and make necessary adjustments." },
          { code: "AI.XIII.A.S6", text: "Restart the inoperative engine using manufacturer’s restart procedures." },
          { code: "AI.XIII.A.S7", text: "Maintain altitude ±100 feet or minimum sink rate if applicable, airspeed ±10 knots, and selected headings ±10°." },
          { code: "AI.XIII.A.S8", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XIII.A.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "VMC Demonstration (AMEL, AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands VMC demonstration, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XIII.B.K1", text: "Purpose of the maneuver." },
          { code: "AI.XIII.B.K2", text: "Proper procedures for maneuver entry and safe recovery." },
          { code: "AI.XIII.B.K3", text: "Factors affecting VMC and how VMC differs from stall speed (VS)." },
          { code: "AI.XIII.B.K4", text: "VMC (red line), VYSE (blue line), and safe single-engine speed (VSSE)." },
          { code: "AI.XIII.B.K5", text: "Cause of loss of directional control at airspeeds below VMC." },
          { code: "AI.XIII.B.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XIII.B.R1", text: "Configuring the airplane." },
          { code: "AI.XIII.B.R2", text: "Maneuvering with one engine inoperative." },
          { code: "AI.XIII.B.R3", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XIII.B.S1", text: "Configure the airplane in accordance with the manufacturer’s recommendations, in the absence of the manufacturer’s recommendations, then at safe single-engine speed (VSSE/VYSE), as appropriate, and:" },
          { code: "AI.XIII.B.S1a", text: "a. Landing gear retracted" },
          { code: "AI.XIII.B.S1b", text: "b. Flaps set for takeoff" },
          { code: "AI.XIII.B.S1c", text: "c. Cowl flaps set for takeoff" },
          { code: "AI.XIII.B.S1d", text: "d. Trim set for takeoff" },
          { code: "AI.XIII.B.S1e", text: "e. Propellers set for high revolutions per minute (rpm)" },
          { code: "AI.XIII.B.S1f", text: "f. Power on critical engine reduced to idle and propeller windmilling" },
          { code: "AI.XIII.B.S1g", text: "g. Power on operating engine set to takeoff or maximum available power" },
          { code: "AI.XIII.B.S2", text: "Establish a single-engine climb attitude with the airspeed at approximately 10 knots above VSSE." },
          { code: "AI.XIII.B.S3", text: "Establish a bank angle not to exceed 5° toward the operating engine, as required for best performance and controllability." },
          { code: "AI.XIII.B.S4", text: "Increase the pitch attitude slowly to reduce the airspeed at approximately 1 knot per second while applying increased rudder pressure as needed to maintain directional control." },
          { code: "AI.XIII.B.S5", text: "Recognize and recover at the first indication of loss of directional control, stall warning, or buffet." },
          { code: "AI.XIII.B.S6", text: "Recover promptly by simultaneously reducing power sufficiently on the operating engine, decreasing the angle of attack as necessary to regain airspeed and directional control, and without adding power on the simulated failed engine." },
          { code: "AI.XIII.B.S7", text: "Recover within 20° of entry heading." },
          { code: "AI.XIII.B.S8", text: "Advance power smoothly on the operating engine and accelerate to VSSE/VYSE, as appropriate, ±5 knots during recovery." },
          { code: "AI.XIII.B.S9", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task C", title: "Demonstration of Effects of Various Airspeeds and Configurations during Engine Inoperative Performance (AMEL and AMES)",
      category: "AMEL",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; FAA-P-8740-66; POH/AFM",
      objective: "To determine the applicant understands the effects of various airspeeds and configurations during engine inoperative performance, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      taskNotes: ["See Appendix 2: Safety of Flight and Appendix 3: Aircraft, Equipment, and Operational Requirements & Limitations for information related to this Task."],
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XIII.C.K1", text: "Purpose for and elements of demonstration of effects of various airspeeds and configurations during engine inoperative performance." },
          { code: "AI.XIII.C.K2", text: "Selection of appropriate altitude for the demonstration." },
          { code: "AI.XIII.C.K3", text: "Proper entry procedure to include pitch attitude, bank attitude, and airspeed." },
          { code: "AI.XIII.C.K4", text: "Effects on performance of airspeed changes at, above, and below VYSE." },
          { code: "AI.XIII.C.K5", text: "Effects on performance of various configurations including:" },
          { code: "AI.XIII.C.K5a", text: "a. Landing gear extended" },
          { code: "AI.XIII.C.K5b", text: "b. Wing flaps extended" },
          { code: "AI.XIII.C.K5c", text: "c. Landing gear and wing flaps extended" },
          { code: "AI.XIII.C.K5d", text: "d. Windmilling propeller on the inoperative engine" },
          { code: "AI.XIII.C.K6", text: "Airspeed control throughout the demonstration." },
          { code: "AI.XIII.C.K7", text: "Smooth control technique and coordination throughout the demonstration." },
          { code: "AI.XIII.C.K8", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XIII.C.R1", text: "Altitude selection." },
          { code: "AI.XIII.C.R2", text: "Entry and recovery procedures." },
          { code: "AI.XIII.C.R3", text: "Loss of control or stall." },
          { code: "AI.XIII.C.R4", text: "Configuring the airplane." },
          { code: "AI.XIII.C.R5", text: "Collision hazards." },
          { code: "AI.XIII.C.R6", text: "Distractions, task prioritization, loss of situational awareness, or disorientation." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XIII.C.S1", text: "Demonstrate, describe, and explain effects of various airspeeds and configurations during engine inoperative performance." },
          { code: "AI.XIII.C.S2", text: "Demonstrate smooth control inputs when transitioning between various airspeeds and configurations, which include:" },
          { code: "AI.XIII.C.S2a", text: "a. Landing gear extended" },
          { code: "AI.XIII.C.S2b", text: "b. Wing flaps extended" },
          { code: "AI.XIII.C.S2c", text: "c. Landing gear and wing flaps extended" },
          { code: "AI.XIII.C.S2d", text: "d. Windmilling propeller on the inoperative engine" },
          { code: "AI.XIII.C.S3", text: "Maintain appropriate airspeed, attitude, and altitude combinations for the various configurations." },
          { code: "AI.XIII.C.S4", text: "Return to normal cruise flight at the altitude and heading specified by the evaluator." },
          { code: "AI.XIII.C.S5", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

const data14 = {
  areaIndex: 'XIV',
  area: "Area of Operation XIV: Postflight Procedures",
  note: "The evaluator must select Task A (ASEL, AMEL) or Task B (ASES, AMES).",
  tasks: [
    {
      id: "Task A", title: "After Landing, Parking, and Securing (ASEL, AMEL)",
      refs: "FAA-H-8083-2, FAA-H-8083-3, FAA-H-8083-9, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands after landing, parking, and securing procedures, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XIV.A.K1", text: "Airplane shutdown, securing, and postflight inspection." },
          { code: "AI.XIV.A.K2", text: "Documenting in-flight/postflight discrepancies." },
          { code: "AI.XIV.A.K3", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XIV.A.R1", text: "Activities and distractions." },
          { code: "AI.XIV.A.R2", text: "Airport specific security procedures." },
          { code: "AI.XIV.A.R3", text: "Disembarking passengers safely on the ramp and monitoring passenger movement while on the ramp." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XIV.A.S1", text: "Park in an appropriate area, considering the safety of nearby persons and property." },
          { code: "AI.XIV.A.S2", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XIV.A.S3", text: "Conduct a postflight inspection and document discrepancies and servicing requirements, if any." },
          { code: "AI.XIV.A.S4", text: "Secure the airplane." },
          { code: "AI.XIV.A.S5", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
    {
      id: "Task B", title: "Seaplane Post-Landing Procedures (ASES, AMES)",
      category: "ASES/AMES",
      refs: "FAA-H-8083-2, FAA-H-8083-9, FAA-H-8083-23, FAA-H-8083-25; POH/AFM",
      objective: "To determine the applicant understands anchoring, docking, mooring, and ramping/beaching, can apply that knowledge, manage associated risks, demonstrate appropriate skills, and provide effective instruction.",
      sections: [
        { label: "Knowledge", items: [
          { code: "AI.XIV.B.K1", text: "Mooring." },
          { code: "AI.XIV.B.K2", text: "Docking." },
          { code: "AI.XIV.B.K3", text: "Anchoring." },
          { code: "AI.XIV.B.K4", text: "Beaching/ramping." },
          { code: "AI.XIV.B.K5", text: "Postflight inspection, recording of in-flight/postflight discrepancies." },
          { code: "AI.XIV.B.K6", text: "Common errors related to this Task." },
        ]},
        { label: "Risk Management", items: [
          { code: "AI.XIV.B.R1", text: "Activities and distractions." },
          { code: "AI.XIV.B.R2", text: "Seaplane base specific security procedures, if applicable." },
          { code: "AI.XIV.B.R3", text: "Disembarking passengers safely on the ramp and monitoring passenger movement while on the ramp." },
        ]},
        { label: "Skills", items: [
          { code: "AI.XIV.B.S1", text: "If anchoring, select a suitable area considering seaplane movement, water depth, tide, wind, and weather changes. Use an adequate number of anchors and lines of sufficient strength and length to ensure the seaplane’s security." },
          { code: "AI.XIV.B.S2", text: "If not anchoring, approach the dock/mooring buoy or beach/ramp in the proper direction and at a safe speed, considering water depth, tide, current, and wind." },
          { code: "AI.XIV.B.S3", text: "Complete the appropriate checklist(s)." },
          { code: "AI.XIV.B.S4", text: "Conduct a postflight inspection and document discrepancies and servicing requirements, if any." },
          { code: "AI.XIV.B.S5", text: "Secure the seaplane considering the effect of wind, waves, and changes in water level, or comply with applicable after landing, parking, and securing procedures if operating an amphibious airplane on land." },
          { code: "AI.XIV.B.S6", text: "Analyze and correct common errors related to this Task." },
        ]},
      ]
    },
  ]
};

// ── Search ────────────────────────────────────────────────────────
let searchIndex = [];
let searchHighlightEl = null;
let searchResultIndex = -1;

function buildSearchIndex() {
  searchIndex = [];
  document.querySelectorAll('.item').forEach(itemEl => {
    const codeEl = itemEl.querySelector('.item-code');
    const titleEl = itemEl.querySelector('.item-title');
    if (!codeEl || !titleEl) return;
    const code = codeEl.textContent.trim();
    const text = titleEl.textContent.trim();
    const sectionLabel = itemEl.closest('.section-wrapper')?.querySelector('.section-label span')?.textContent.trim() || '';
    const taskHeader = itemEl.closest('.task-body')?.previousElementSibling?.querySelector('div > div')?.textContent.trim() || '';
    searchIndex.push({ code, text, sectionLabel, taskHeader, itemEl });
  });
}

let searchOpen = false;

function toggleSearch() {
  const panel = document.getElementById('searchPanel');
  const btn = document.getElementById('searchBtn');
  if (searchOpen) {
    panel.classList.remove('open');
    btn.classList.remove('active');
    clearSearch();
    searchOpen = false;
  } else {
    if (searchIndex.length === 0) buildSearchIndex();
    panel.classList.add('open');
    btn.classList.add('active');
    searchOpen = true;
    setTimeout(() => document.getElementById('searchInput').focus(), 200);
  }
}

function runSearch(query) {
  const resultsEl = document.getElementById('searchResults');
  const clearBtn = document.getElementById('searchClearBtn');
  searchResultIndex = -1;
  clearBtn.style.display = query.length > 0 ? 'block' : 'none';
  query = query.trim();
  if (query.length < 2) { resultsEl.innerHTML = ''; return; }

  const q = query.toLowerCase();
  const matches = searchIndex.filter(entry =>
    entry.text.toLowerCase().includes(q) ||
    entry.code.toLowerCase().includes(q) ||
    entry.sectionLabel.toLowerCase().includes(q) ||
    entry.taskHeader.toLowerCase().includes(q)
  ).slice(0, 30);

  if (matches.length === 0) {
    resultsEl.innerHTML = `<div style="padding:0.8rem 0.4rem;font-family:'Barlow Condensed',sans-serif;font-size:0.72rem;color:#999;text-transform:uppercase;letter-spacing:0.06em;">No results found</div>`;
    return;
  }

  resultsEl.innerHTML = '';
  matches.forEach((match, i) => {
    const row = document.createElement('div');
    row.className = 'search-result-row';
    row.dataset.index = i;

    const highlight = (str) => {
      const idx = str.toLowerCase().indexOf(q);
      if (idx === -1) return str;
      return str.slice(0, idx) + `<mark style="background:#fff3cd;border-radius:2px;padding:0 1px;">${str.slice(idx, idx + q.length)}</mark>` + str.slice(idx + q.length);
    };

    const codeSpan = `<span style="font-family:'Barlow Condensed',sans-serif;font-size:0.62rem;color:var(--accent);letter-spacing:0.04em;display:block;margin-bottom:0.1rem;">${highlight(match.code)}</span>`;
    const textSpan = `<span style="font-family:'Barlow',sans-serif;font-size:0.78rem;color:var(--ink);line-height:1.4;">${highlight(match.text)}</span>`;
    const metaSpan = `<span style="font-family:'Barlow Condensed',sans-serif;font-size:0.58rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.06em;display:block;margin-top:0.15rem;">${match.sectionLabel}</span>`;

    row.innerHTML = codeSpan + textSpan + metaSpan;
    row.onmouseenter = () => setSearchActive(row);
    row.onclick = () => jumpToResult(match);
    resultsEl.appendChild(row);
  });
}

function setSearchActive(row) {
  document.querySelectorAll('.search-result-row').forEach(r => { r.style.background = ''; r.classList.remove('active'); });
  row.classList.add('active');
  searchResultIndex = parseInt(row.dataset.index);
}

function searchKeyNav(e) {
  const rows = document.querySelectorAll('.search-result-row');
  if (!rows.length) return;
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    searchResultIndex = Math.min(searchResultIndex + 1, rows.length - 1);
    rows.forEach((r, i) => { r.style.background = ''; r.classList.toggle('active', i === searchResultIndex); });
    rows[searchResultIndex]?.scrollIntoView({ block: 'nearest' });
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    searchResultIndex = Math.max(searchResultIndex - 1, 0);
    rows.forEach((r, i) => { r.style.background = ''; r.classList.toggle('active', i === searchResultIndex); });
    rows[searchResultIndex]?.scrollIntoView({ block: 'nearest' });
  } else if (e.key === 'Enter') {
    if (searchResultIndex >= 0 && rows[searchResultIndex]) rows[searchResultIndex].click();
  } else if (e.key === 'Escape') {
    searchOpen = true; // force toggleSearch to close
    toggleSearch();
  }
}

function jumpToResult(match) {
  const itemEl = match.itemEl;
  const areaBody = itemEl.closest('.area-body');
  if (areaBody) {
    areaBody.classList.remove('hidden');
    const areaHeader = areaBody.previousElementSibling;
    if (areaHeader) { areaHeader.classList.remove('collapsed'); const c = areaHeader.querySelector('.chevron'); if (c) c.textContent = '−'; }
  }
  const taskBody = itemEl.closest('.task-body');
  if (taskBody) {
    taskBody.classList.remove('hidden');
    const chevron = taskBody.previousElementSibling?.querySelector('.task-chevron');
    if (chevron) chevron.style.transform = 'rotate(0deg)';
  }
  const sectionBody = itemEl.closest('.section-body');
  if (sectionBody) {
    sectionBody.classList.remove('hidden');
    const sectionLabel = sectionBody.previousElementSibling;
    if (sectionLabel) {
      sectionLabel.querySelector('.section-chevron').style.transform = 'rotate(0deg)';
      sectionLabel.closest('.section-wrapper')?.classList.add('open');
    }
  }

  document.getElementById('searchResults').innerHTML = '';
  document.getElementById('searchInput').value = '';
  document.getElementById('searchClearBtn').style.display = 'none';

  setTimeout(() => {
    itemEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
    if (searchHighlightEl) searchHighlightEl.style.outline = '';
    itemEl.style.outline = '2.5px solid #2e8b57';
    itemEl.style.borderRadius = '4px';
    searchHighlightEl = itemEl;
    setTimeout(() => { itemEl.style.outline = ''; }, 2000);
  }, 120);
}

function clearSearch() {
  const input = document.getElementById('searchInput');
  const clearBtn = document.getElementById('searchClearBtn');
  if (input) input.value = '';
  if (clearBtn) clearBtn.style.display = 'none';
  const results = document.getElementById('searchResults');
  if (results) results.innerHTML = '';
  searchResultIndex = -1;
}

document.addEventListener('click', (e) => {
  const panel = document.getElementById('searchPanel');
  const btn = document.getElementById('searchBtn');
  if (searchOpen && panel && !panel.contains(e.target) && btn && !btn.contains(e.target)) {
    searchOpen = true;
    toggleSearch();
  }
});

buildGuide(data);
buildGuide(data2);
buildGuide(data3);
buildGuide(data4);
buildGuide(data5);
buildGuide(data6);
buildGuide(data7);
buildGuide(data8);
buildGuide(data9);
buildGuide(data10);
buildGuide(data11);
buildGuide(data12);
buildGuide(data13);
buildGuide(data14);
loadAll();

// ═══ MODERN MODE — Card Carousel Engine (self-contained, no modifications to existing code) ═══
(function modernCarousel() {
  var allAreas = [data,data2,data3,data4,data5,data6,data7,data8,data9,data10,data11,data12,data13,data14];
  var track = document.getElementById('mTrack');
  var dotsEl = document.getElementById('mDots');
  if (!track) return;
  var mIdxLocal = 0;
  window.mIdx = 0;

  allAreas.forEach(function(a, i) {
    var card = document.createElement('div');
    card.className = 'm-card'; card.dataset.index = i; card.dataset.areaIndex = a.areaIndex;
    var tasksHTML = a.tasks.map(function(t, ti) {
      var catAttr = t.category ? ' data-category="'+t.category+'"' : '';
      var catHidden = '';
      if (t.category) {
        var show = false;
        if (t.category === 'ASES/AMES') show = categoryState.ASES || categoryState.AMES;
        else if (categoryState.hasOwnProperty(t.category)) show = categoryState[t.category];
        if (!show) catHidden = ' style="display:none"';
      }
      return '<div class="m-task-row"'+catAttr+catHidden+' data-area="'+i+'" data-task="'+ti+'" onclick="event.stopPropagation();mOpenTask('+i+','+ti+',event)"><span class="m-task-id">'+t.id+'</span><span class="m-task-title">'+t.title+'</span><span class="m-task-arrow">›</span></div>';
    }).join('');
    // Count confidence ratings for this area
    var totalItems = 0;
    var counts = {green:0, yellow:0, red:0};
    a.tasks.forEach(function(t) {
      (t.sections||[]).forEach(function(sec) {
        (sec.items||[]).forEach(function(item) {
          totalItems++;
          var key = 'cfi_conf_' + item.code.replace(/\./g,'_');
          var val = localStorage.getItem(key);
          if (val && counts.hasOwnProperty(val)) counts[val]++;
        });
      });
    });
    var gPct = totalItems ? Math.round(counts.green/totalItems*100) : 0;
    var yPct = totalItems ? Math.round(counts.yellow/totalItems*100) : 0;
    var rPct = totalItems ? Math.round(counts.red/totalItems*100) : 0;
    var romanColor = 'rgba(255,255,255,0.08)';
    var maxConf = Math.max(counts.green, counts.yellow, counts.red);
    if (maxConf > 0) {
      if (counts.green >= counts.yellow && counts.green >= counts.red) romanColor = 'rgba(46,139,87,0.35)';
      else if (counts.yellow >= counts.green && counts.yellow >= counts.red) romanColor = 'rgba(212,160,23,0.35)';
      else romanColor = 'rgba(192,57,43,0.35)';
    }
    card.innerHTML = '<div class="m-card-head"><div class="m-card-roman" style="color:'+romanColor+'">'+a.areaIndex+'</div><div class="m-card-title">'+a.area.replace(/^Area of Operation [IVXLCDM]+:\s*/,'')+'</div><div class="m-card-count">'+a.tasks.length+' Task'+(a.tasks.length>1?'s':'')+'</div></div><div class="m-card-body">'+tasksHTML+'</div><div class="m-card-prog"><div class="m-prog-bar-wrap"><div class="m-prog-track"><div class="m-prog-fill-green" style="width:'+gPct+'%"></div></div><span class="m-prog-count m-prog-count-green">'+counts.green+'</span></div><div class="m-prog-bar-wrap"><div class="m-prog-track"><div class="m-prog-fill-yellow" style="width:'+yPct+'%"></div></div><span class="m-prog-count m-prog-count-yellow">'+counts.yellow+'</span></div><div class="m-prog-bar-wrap"><div class="m-prog-track"><div class="m-prog-fill-red" style="width:'+rPct+'%"></div></div><span class="m-prog-count m-prog-count-red">'+counts.red+'</span></div></div>';
    track.appendChild(card);
    var dot = document.createElement('div');
    dot.className = 'm-dot';
    dot.onclick = function(e) { e.stopPropagation(); mGo(i); };
    dotsEl.appendChild(dot);
  });

  function cardW() {
    var c = track.children[0];
    if (!c) return 428;
    var s = getComputedStyle(c);
    return c.offsetWidth + parseFloat(s.marginLeft) + parseFloat(s.marginRight);
  }
  function getMaxVisibleIdx() {
    var cards = track.querySelectorAll('.m-card');
    for (var i = cards.length - 1; i >= 0; i--) {
      if (cards[i].style.display !== 'none') return i;
    }
    return 0;
  }

  function mUpdate() {
    var cards = track.querySelectorAll('.m-card');
    for (var i=0; i<cards.length; i++) {
      cards[i].classList.remove('m-active','m-adj','m-far','m-far2','m-far3');
      cards[i].style.opacity = '';
      if (cards[i].style.display === 'none') continue;
      var d = Math.abs(i - mIdxLocal);
      if (d === 0) cards[i].classList.add('m-active');
      else if (d === 1) cards[i].classList.add('m-adj');
      else if (d === 2) cards[i].classList.add('m-far');
      else if (d === 3) cards[i].classList.add('m-far2');
      else cards[i].classList.add('m-far3');
    }
    var dots = dotsEl.querySelectorAll('.m-dot');
    for (var j=0; j<dots.length; j++) dots[j].classList.toggle('m-dot-on', j===mIdxLocal);
    document.getElementById('mNavL').classList.toggle('m-nav-off', mIdxLocal===0);
    document.getElementById('mNavR').classList.toggle('m-nav-off', mIdxLocal>=getMaxVisibleIdx());
  }
  function mPos(anim) {
    var vp = document.getElementById('mVP');
    var vw = vp.offsetWidth;
    var w = cardW();
    // Count visible cards before mIdxLocal to get correct position
    var visibleBefore = 0;
    var cards = track.querySelectorAll('.m-card');
    for (var ci = 0; ci < mIdxLocal; ci++) {
      if (cards[ci] && cards[ci].style.display !== 'none') visibleBefore++;
    }
    var off = (vw/2) - (w/2) - (visibleBefore * w);
    if (anim) { track.classList.add('m-anim'); setTimeout(function(){track.classList.remove('m-anim');}, 550); }
    track.style.transform = 'translateX('+off+'px)';
    mUpdate();
  }
  window.mGo = function(i) {
    var max = getMaxVisibleIdx();
    i = Math.max(0, Math.min(max, i));
    // Skip hidden cards (e.g. Area XIII when AMEL/AMES not selected)
    var card = track.querySelector('.m-card[data-index="'+i+'"]');
    if (card && card.style.display === 'none') {
      // Try direction based on where we came from
      var dir = i > mIdxLocal ? 1 : -1;
      var next = i + dir;
      while (next >= 0 && next <= max) {
        var nc = track.querySelector('.m-card[data-index="'+next+'"]');
        if (nc && nc.style.display !== 'none') { i = next; break; }
        next += dir;
      }
      // If couldn't find in that direction, try opposite
      if (i === parseInt(card.dataset.index)) {
        next = i - dir;
        while (next >= 0 && next <= max) {
          var nc2 = track.querySelector('.m-card[data-index="'+next+'"]');
          if (nc2 && nc2.style.display !== 'none') { i = next; break; }
          next -= dir;
        }
      }
    }
    mIdxLocal = i; window.mIdx = mIdxLocal; mPos(true); lastSwipeTime = Date.now();
  };

  // Drag with momentum
  var sx=0, so=0, drag=false;
  window.mHasDragged = false;
  track.addEventListener('mousedown', ds); track.addEventListener('touchstart', ds, {passive:true});
  window.addEventListener('mousemove', dm); window.addEventListener('touchmove', dm, {passive:false});
  window.addEventListener('mouseup', de); window.addEventListener('touchend', de);
  var sy = 0; var dirLocked = false; var isVertical = false;
  var lastSwipeTime = 0;
  function ds(e) { var t=e.target||e.srcElement; if(!t.closest('.m-card')&&!t.closest('.m-nav')) return; drag=true; window.mHasDragged=false; dirLocked=false; isVertical=false; track.classList.remove('m-anim'); track.classList.add('m-dragging'); sx=e.touches?e.touches[0].clientX:e.clientX; sy=e.touches?e.touches[0].clientY:e.clientY; so=new DOMMatrix(getComputedStyle(track).transform).m41; }
  function dm(e) { if(!drag) return; var x=e.touches?e.touches[0].clientX:e.clientX; var y=e.touches?e.touches[0].clientY:e.clientY; var dx=Math.abs(x-sx); var dy=Math.abs(y-sy); if(!dirLocked&&(dx>8||dy>8)){dirLocked=true;isVertical=dy>dx;} if(!dirLocked||isVertical){if(drag){track.classList.remove('m-dragging');}return;} if(e.cancelable)e.preventDefault(); if(dx>5) window.mHasDragged=true;
    // Clamp drag with rubber-band at edges
    var raw = so + x - sx;
    var vp = document.getElementById('mVP');
    var vpW = vp.offsetWidth;
    var w = cardW();
    // Count visible cards for bounds
    var visibleCount = 0;
    var allCards = track.querySelectorAll('.m-card');
    for (var vc = 0; vc < allCards.length; vc++) {
      if (allCards[vc].style.display !== 'none') visibleCount++;
    }
    var minOff = (vpW/2) - (w/2) - ((visibleCount - 1) * w);
    var maxOff = (vpW/2) - (w/2);
    if (raw > maxOff) { raw = maxOff + (raw - maxOff) * 0.15; }
    else if (raw < minOff) { raw = minOff + (raw - minOff) * 0.15; }
    track.style.transform='translateX('+raw+'px)';
  }
  function de(e) {
    if(!drag) return; drag=false; track.classList.remove('m-dragging');
    if(isVertical||!dirLocked) { dirLocked=false; isVertical=false; mPos(true); return; }
    dirLocked=false; isVertical=false;
    var x=e.changedTouches?e.changedTouches[0].clientX:e.clientX;
    var d=x-sx;
    var cw = cardW();
    // Simple: if dragged more than 20% of card width, move one card
    if (Math.abs(d) > cw * 0.15) {
      if (d < 0) {
        mGo(mIdxLocal + 1);
      } else {
        mGo(mIdxLocal - 1);
      }
    } else {
      // Snap back to current
      window.mIdx = mIdxLocal; mPos(true);
    }
    lastSwipeTime = Date.now();
  }

  // Block card body scroll briefly after card navigation
  var SCROLL_DELAY = 400; // ms
  track.addEventListener('touchmove', function(e) {
    if (Date.now() - lastSwipeTime < SCROLL_DELAY) {
      var cardBody = e.target.closest('.m-card-body');
      if (cardBody && e.cancelable) {
        e.preventDefault();
      }
    }
  }, {passive:false});

  // Keyboard
  document.addEventListener('keydown', function(e) {
    if (!document.body.classList.contains('modern-mode')) return;
    if (document.getElementById('mExp').classList.contains('m-exp-open')) { if(e.key==='Escape') mCloseExp(); return; }
    if (document.activeElement.tagName==='INPUT'||document.activeElement.contentEditable==='true') return;
    if (e.key==='ArrowLeft') mGo(mIdxLocal-1);
    if (e.key==='ArrowRight') mGo(mIdxLocal+1);
    if (e.key==='Enter') mOpenExp(mIdxLocal);
  });

  // Mouse wheel horizontal scroll on card viewport
  var vpEl = document.getElementById('mVP');
  if (vpEl) {
    var wheelAccum = 0;
    var wheelDecay = null;
    var wheelMovedAt = 0;
    vpEl.addEventListener('wheel', function(e) {
      if (!document.body.classList.contains('modern-mode')) return;
      if (document.getElementById('mExp').classList.contains('m-exp-open')) return;
      // Block card body scrolling briefly after card navigation
      var sinceSwipe = Date.now() - lastSwipeTime;
      var isHorizontal = Math.abs(e.deltaX) > Math.abs(e.deltaY);
      if (!isHorizontal && sinceSwipe > SCROLL_DELAY) {
        // Check if the scroll target is inside a scrollable card body
        var cardBody = e.target.closest('.m-card-body');
        if (cardBody) {
          var canScrollUp = cardBody.scrollTop > 0;
          var canScrollDown = cardBody.scrollTop < (cardBody.scrollHeight - cardBody.clientHeight - 1);
          if ((e.deltaY < 0 && canScrollUp) || (e.deltaY > 0 && canScrollDown)) {
            return; // Let the card body scroll naturally
          }
        }
      }
      e.preventDefault();
      var delta = isHorizontal ? e.deltaX : e.deltaY;
      if (Math.abs(delta) < 2) return;
      wheelAccum += delta;
      var now = Date.now();
      var sinceLast = now - wheelMovedAt;
      // Smooth ramp: instant flick = 25, then ramps up to 140 over 500ms, easing back down after
      var thresh;
      if (sinceLast > 500) {
        thresh = 25;
      } else {
        thresh = 25 + 115 * (1 - sinceLast / 500);
      }
      if (Math.abs(wheelAccum) >= thresh) {
        var dir = wheelAccum > 0 ? 1 : -1;
        mGo(mIdxLocal + dir);
        wheelMovedAt = now;
        wheelAccum = 0;
      }
      clearTimeout(wheelDecay);
      wheelDecay = setTimeout(function() { wheelAccum = 0; }, 300);
    }, {passive: false});
  }

  // Expanded view — clones real area content
  // Open single task in expanded view
  window.mOpenTask = function(areaIdx, taskIdx, evt) {
    var expEl = document.getElementById('mExp');
    // Calculate clip-path origin from clicked row
    var clickedRow = evt ? evt.currentTarget || evt.target.closest('.m-task-row') || evt.target.closest('.m-grid-task') : null;
    if (clickedRow) {
      var rect = clickedRow.getBoundingClientRect();
      var cx = rect.left + rect.width / 2;
      var cy = rect.top + rect.height / 2;
      var vw = window.innerWidth;
      var vh = window.innerHeight;
      expEl.style.setProperty('--exp-t', (cy / vh * 100).toFixed(1) + '%');
      expEl.style.setProperty('--exp-b', ((1 - cy / vh) * 100).toFixed(1) + '%');
      expEl.style.setProperty('--exp-l', (cx / vw * 100).toFixed(1) + '%');
      expEl.style.setProperty('--exp-r', ((1 - cx / vw) * 100).toFixed(1) + '%');
    } else {
      expEl.style.setProperty('--exp-t', '40%');
      expEl.style.setProperty('--exp-b', '40%');
      expEl.style.setProperty('--exp-l', '30%');
      expEl.style.setProperty('--exp-r', '30%');
    }
    expEl.classList.remove('m-exp-closing');
    var a = allAreas[areaIdx];
    var t = a.tasks[taskIdx];
    document.getElementById('mExpR').textContent = t.id;
    document.getElementById('mExpT').textContent = t.title;
    var body = document.getElementById('mExpB'); body.innerHTML = '';

    // Find the real rendered task in the hidden #studyGuide
    var areas = document.querySelectorAll('#studyGuide .area');
    if (areas[areaIdx]) {
      var tasks = areas[areaIdx].querySelectorAll('.task');
      if (tasks[taskIdx]) {
        var clone = tasks[taskIdx].cloneNode(true);
        // Expand everything
        clone.querySelectorAll('.task-body').forEach(function(b) { b.classList.remove('hidden'); });
        clone.querySelectorAll('.task-header').forEach(function(h) { h.classList.add('expanded'); });
        clone.querySelectorAll('.task-chevron').forEach(function(c) { c.style.transform = 'rotate(0deg)'; });
        // Keep sections collapsed (Knowledge, Risk Management, Skills)
        clone.querySelectorAll('.section-body').forEach(function(b) { b.classList.add('hidden'); });
        clone.querySelectorAll('.section-label').forEach(function(l) { l.classList.remove('expanded'); });
        clone.querySelectorAll('.section-wrapper').forEach(function(w) { w.classList.remove('open'); });
        clone.querySelectorAll('.section-chevron').forEach(function(c) { c.style.transform = 'rotate(-90deg)'; });
        clone.style.cssText = 'background:transparent;border:none;box-shadow:none;margin:0;';

        // Apply current state to cloned content
        if (editModeActive || answersRevealed) {
          // Show all editors - clear display:none and is-hidden-state
          clone.querySelectorAll('.editor-outer').forEach(function(eo) {
            eo.classList.remove('is-hidden-state');
            eo.style.display = '';
            var fr = eo.closest('.field-row') || eo.closest('.task-summary-section');
            if (fr) fr.style.display = '';
          });
          if (editModeActive) {
            clone.querySelectorAll('.editor-outer').forEach(function(eo) {
              var ed = eo.querySelector('.rich-editor');
              if (ed) { ed.contentEditable = 'true'; ed.style.cursor = ''; eo.dataset.editModeLocked = 'false'; }
            });
            // Expand all sections in edit mode
            clone.querySelectorAll('.section-body').forEach(function(b) { b.classList.remove('hidden'); });
            clone.querySelectorAll('.section-label').forEach(function(l) { l.classList.add('expanded'); });
            clone.querySelectorAll('.section-wrapper').forEach(function(w) { w.classList.add('open'); });
            clone.querySelectorAll('.section-chevron').forEach(function(c) { c.style.transform = 'rotate(0deg)'; });
          }
        }
        // Re-attach section toggle handlers (cloneNode doesn't copy JS listeners)
        clone.querySelectorAll('.section-label').forEach(function(label) {
          label.onclick = function() {
            var wrapper = label.closest('.section-wrapper');
            var body = wrapper ? wrapper.querySelector('.section-body') : null;
            if (!body) return;
            body.classList.toggle('hidden');
            var isHidden = body.classList.contains('hidden');
            var chev = label.querySelector('.section-chevron');
            if (chev) chev.style.transform = isHidden ? 'rotate(-90deg)' : 'rotate(0deg)';
            if (wrapper) wrapper.classList.toggle('open', !isHidden);
            label.classList.toggle('expanded', !isHidden);
          };
        });
        // Re-attach confidence dot handlers
        clone.querySelectorAll('.conf-dots-row').forEach(function(row) {
          var dots = row.querySelectorAll('.conf-dot');
          var item = row.closest('.item');
          var codeEl = item ? item.querySelector('.item-code') : null;
          var titleEl = item ? item.querySelector('.item-title') : null;
          if (!codeEl) return;
          var code = codeEl.textContent.trim().replace(/\./g, '_');
          var confKey = 'cfi_conf_' + code;
          dots.forEach(function(dot) {
            var color = dot.classList.contains('green') ? 'green' : dot.classList.contains('yellow') ? 'yellow' : 'red';
            dot.onclick = function(e) {
              e.stopPropagation();
              var isActive = dot.classList.contains('active');
              dots.forEach(function(d) { d.classList.remove('active'); });
              if (titleEl) titleEl.classList.remove('conf-green', 'conf-yellow', 'conf-red');
              if (isActive) {
                localStorage.removeItem(confKey);
              } else {
                dot.classList.add('active');
                if (titleEl) titleEl.classList.add('conf-' + color);
                localStorage.setItem(confKey, color);
              }
              // Sync to real DOM
              var realDots = document.querySelectorAll('#studyGuide .item-code');
              realDots.forEach(function(rc) {
                if (rc.textContent.trim().replace(/\./g,'_') === code) {
                  var realItem = rc.closest('.item');
                  if (!realItem) return;
                  var realRow = realItem.querySelector('.conf-dots-row');
                  var realTitle = realItem.querySelector('.item-title');
                  if (realRow) realRow.querySelectorAll('.conf-dot').forEach(function(rd) { rd.classList.remove('active'); });
                  if (realTitle) realTitle.classList.remove('conf-green','conf-yellow','conf-red');
                  if (!isActive && realRow) {
                    var rd = realRow.querySelector('.conf-dot.' + color);
                    if (rd) rd.classList.add('active');
                    if (realTitle) realTitle.classList.add('conf-' + color);
                  }
                }
              });
            };
          });
        });
        // Re-attach bookmark click handlers on cloned item-codes
        clone.querySelectorAll('.item-code').forEach(function(codeEl) {
          codeEl.addEventListener('mouseup', function(e) {
            e.stopPropagation();
            e.preventDefault();
            setBookmark(codeEl.textContent.trim());
          });
        });
        // Re-attach field-edit-btn (3 dots) handlers for editing in expanded view
        clone.querySelectorAll('.field-edit-btn').forEach(function(btn) {
          btn.onclick = function(e) {
            e.stopPropagation();
            var fieldRow = btn.closest('.field-row') || btn.closest('.task-summary-section');
            if (!fieldRow) return;
            var editorOuter = fieldRow.querySelector('.editor-outer');
            if (!editorOuter) return;
            var editor = editorOuter.querySelector('.rich-editor');
            if (!editor) return;
            var isEditing = editorOuter.classList.contains('toolbar-active');
            if (isEditing) {
              editor.contentEditable = 'false';
              editorOuter.classList.remove('toolbar-active');
              // Save back to real DOM via the editor's id
              if (editor.id) {
                localStorage.setItem('cfi_' + editor.id, editor.innerHTML);
                var realEditor = document.querySelector('#studyGuide #' + editor.id);
                if (realEditor) realEditor.innerHTML = editor.innerHTML;
              }
              btn.textContent = '···';
              btn.style.color = '';
              var revealDiv = editorOuter.querySelector('.reveal-placeholder');
              if (revealDiv) {
                var hasContent = editor.innerText.trim() !== '';
                revealDiv.textContent = hasContent ? 'Click to reveal' : '';
                revealDiv.classList.toggle('has-content', hasContent);
              }
            } else {
              editorOuter.classList.remove('is-hidden-state');
              editorOuter.style.display = '';
              var parentRow = editorOuter.closest('.field-row') || editorOuter.closest('.task-summary-section');
              if (parentRow) parentRow.style.display = '';
              editor.contentEditable = 'true';
              editorOuter.classList.add('toolbar-active');
              editor.focus();
              btn.innerHTML = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><polyline points="1.5,6 5,9.5 10.5,2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>';
              btn.style.color = '#bbb';
            }
          };
        });
        // Also re-attach toolbar button handlers (bold/italic/underline/done)
        clone.querySelectorAll('.editor-toolbar').forEach(function(tb) {
          tb.querySelectorAll('button').forEach(function(b) {
            if (b.classList.contains('tb-bold')) b.onclick = function() { document.execCommand('bold'); };
            else if (b.classList.contains('tb-italic')) b.onclick = function() { document.execCommand('italic'); };
            else if (b.classList.contains('tb-underline')) b.onclick = function() { document.execCommand('underline'); };
            else if (b.classList.contains('tb-done')) {
              b.onclick = function() {
                var eo = tb.closest('.editor-outer');
                var ed = eo ? eo.querySelector('.rich-editor') : null;
                if (ed) { ed.contentEditable = 'false'; eo.classList.remove('toolbar-active'); if (ed.id) { localStorage.setItem('cfi_' + ed.id, ed.innerHTML); var r = document.querySelector('#studyGuide #' + ed.id); if (r) r.innerHTML = ed.innerHTML; } }
                var dotBtn = (eo ? eo.closest('.field-row') || eo.closest('.task-summary-section') : null);
                var fb = dotBtn ? dotBtn.querySelector('.field-edit-btn') : null;
                if (fb) { fb.textContent = '···'; fb.style.color = ''; }
              };
            }
          });
        });
        // Re-attach focus/blur handlers on cloned editors (lost by cloneNode)
        clone.querySelectorAll('.editor-outer').forEach(function(eo) {
          var ed = eo.querySelector('.rich-editor');
          if (!ed) return;
          var revealDiv = eo.querySelector('.reveal-placeholder');
          // Re-attach reveal placeholder click
          if (revealDiv) {
            revealDiv.addEventListener('click', function() {
              eo.classList.remove('is-hidden-state');
              ed.scrollTop = 0;
            });
          }
          // Re-attach editor click (toggle hide when not editing)
          ed.addEventListener('click', function() {
            if (!eo.classList.contains('toolbar-active') && ed.contentEditable !== 'true') {
              eo.classList.add('is-hidden-state');
              var db = eo.closest('.field-row, .task-summary-section');
              db = db ? db.querySelector('.field-edit-btn') : null;
              if (db) { db.textContent = '···'; db.style.color = ''; }
            }
          });
          // Focus: show toolbar
          ed.addEventListener('focus', function() {
            eo.classList.add('toolbar-active');
            var dotsBtn = eo.closest('.field-row, .task-summary-section');
            dotsBtn = dotsBtn ? dotsBtn.querySelector('.field-edit-btn') : null;
            if (dotsBtn) {
              dotsBtn.innerHTML = '<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><polyline points="1.5,6 5,9.5 10.5,2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>';
              dotsBtn.style.color = '#bbb';
            }
          });
          // Blur: hide toolbar, save
          ed.addEventListener('blur', function() {
            setTimeout(function() {
              if (!eo.contains(document.activeElement)) {
                eo.classList.remove('toolbar-active');
                ed.contentEditable = 'false';
                ed.style.cursor = 'default';
                if (ed.id) {
                  localStorage.setItem('cfi_' + ed.id, ed.innerHTML);
                  var realEd = document.querySelector('#studyGuide #' + ed.id);
                  if (realEd) realEd.innerHTML = ed.innerHTML;
                }
                if (revealDiv) {
                  var hasContent = ed.innerText.trim() !== '';
                  revealDiv.textContent = hasContent ? 'Click to reveal' : '';
                  revealDiv.classList.toggle('has-content', hasContent);
                }
                var btn2 = eo.closest('.field-row, .task-summary-section');
                btn2 = btn2 ? btn2.querySelector('.field-edit-btn') : null;
                if (btn2) { btn2.textContent = '···'; btn2.style.color = ''; }
              }
            }, 150);
          });
        });
        body.appendChild(clone);
      }
    }
    document.getElementById('mExp').classList.add('m-exp-open');
    // Re-apply bookmark highlight on the cloned content
    var bk = localStorage.getItem('cfi_bookmark');
    if (bk) {
      var bkEl = [...body.querySelectorAll('.item-code')].find(function(el) { return el.textContent.trim() === bk; });
      if (bkEl) {
        bkEl.classList.add('bookmarked');
        var bkItem = bkEl.closest('.item');
        if (bkItem) {
          bkItem.classList.add('is-bookmarked');
          bkItem.style.outline = '3px solid #d95f1a';
          bkItem.style.outlineOffset = '2px';
        }
        var secBody = bkEl.closest('.section-body');
        if (secBody) {
          var secLabel = secBody.previousElementSibling;
          if (secLabel) secLabel.classList.add('bookmark-highlight');
        }
        var taskBody2 = bkEl.closest('.task-body');
        if (taskBody2) {
          var taskHdr = taskBody2.previousElementSibling;
          if (taskHdr) taskHdr.classList.add('bookmark-highlight');
        }
      }
    }
  };

  // Keep mOpenExp for keyboard Enter (opens first task of active card)
  window.mOpenExp = function(i) { mOpenTask(i, 0); };
  // Refresh confidence bar counts on all cards
  function mRefreshBars() {
    allAreas.forEach(function(a, i) {
      var card = track.children[i];
      if (!card) return;
      var totalItems = 0;
      var counts = {green:0, yellow:0, red:0};
      a.tasks.forEach(function(t) {
        (t.sections||[]).forEach(function(sec) {
          (sec.items||[]).forEach(function(item) {
            totalItems++;
            var key = 'cfi_conf_' + item.code.replace(/\./g,'_');
            var val = localStorage.getItem(key);
            if (val && counts.hasOwnProperty(val)) counts[val]++;
          });
        });
      });
      var gPct = totalItems ? Math.round(counts.green/totalItems*100) : 0;
      var yPct = totalItems ? Math.round(counts.yellow/totalItems*100) : 0;
      var rPct = totalItems ? Math.round(counts.red/totalItems*100) : 0;
      var fills = card.querySelectorAll('.m-prog-fill-green,.m-prog-fill-yellow,.m-prog-fill-red');
      var nums = card.querySelectorAll('.m-prog-count');
      if (fills[0]) fills[0].style.width = gPct+'%';
      if (fills[1]) fills[1].style.width = yPct+'%';
      if (fills[2]) fills[2].style.width = rPct+'%';
      if (nums[0]) nums[0].textContent = counts.green;
      if (nums[1]) nums[1].textContent = counts.yellow;
      if (nums[2]) nums[2].textContent = counts.red;
      var roman = card.querySelector('.m-card-roman');
      if (roman) {
        var maxConf = Math.max(counts.green, counts.yellow, counts.red);
        if (maxConf > 0) {
          if (counts.green >= counts.yellow && counts.green >= counts.red) roman.style.color = 'rgba(46,139,87,0.35)';
          else if (counts.yellow >= counts.green && counts.yellow >= counts.red) roman.style.color = 'rgba(212,160,23,0.35)';
          else roman.style.color = 'rgba(192,57,43,0.35)';
        } else {
          roman.style.color = 'rgba(255,255,255,0.08)';
        }
      }
    });
  }

  window.mRefreshBookmark = function() {
    // Clear all card bookmark highlights
    Array.from(track.children).forEach(function(c) { c.classList.remove('m-bookmarked'); });
    // Clear all task row bookmark highlights
    document.querySelectorAll('.m-task-row.m-task-bookmarked').forEach(function(r) { r.classList.remove('m-task-bookmarked'); });
    var code = localStorage.getItem('cfi_bookmark');
    if (!code) return;
    // Find which area and task contains this code
    allAreas.forEach(function(a, i) {
      a.tasks.forEach(function(t, ti) {
        var found = false;
        (t.sections||[]).forEach(function(sec) {
          (sec.items||[]).forEach(function(item) {
            if (item.code === code) found = true;
          });
        });
        if (found) {
          if (track.children[i]) track.children[i].classList.add('m-bookmarked');
          var row = track.querySelector('.m-task-row[data-area="'+i+'"][data-task="'+ti+'"]');
          if (row) row.classList.add('m-task-bookmarked');
        }
      });
    });
  };

  window.mCloseExp = function() { var exp = document.getElementById('mExp'); exp.classList.add('m-exp-closing'); setTimeout(function(){ exp.classList.remove('m-exp-open','m-exp-closing'); }, 250); mCloseExpDrop(); mRefreshBars(); mRefreshBookmark(); var bk = localStorage.getItem('cfi_bookmark'); if (bk) applyBookmarkUI(bk); };

  // Populate expanded-view floating More dropdown with same items as toolbar
  (function() {
    var src = document.getElementById('mFab');
    var dst = document.getElementById('mExpFabDrop');
    if (!src || !dst) return;
    Array.from(src.children).forEach(function(el) {
      if (el.classList.contains('m-fab-divider')) return;
      if (!el.classList.contains('m-fab-item')) return;
      var clone = el.cloneNode(true);
      clone.classList.remove('m-fab-hide-main');
      clone.addEventListener('click', function() { mCloseExpDrop(); });
      dst.appendChild(clone);
    });
  })();

  window.mToggleExpDrop = function(e) {
    e.stopPropagation();
    var drop = document.getElementById('mExpFabDrop');
    var scrim = document.getElementById('mExpFabScrim');
    var isOpen = drop.classList.contains('open');
    if (isOpen) {
      mCloseExpDrop();
    } else {
      drop.classList.remove('m-pop-out');
      scrim.classList.remove('m-pop-out');
      drop.classList.add('open');
      scrim.classList.add('open');
    }
  };

  window.mCloseExpDrop = function() {
    var drop = document.getElementById('mExpFabDrop');
    var scrim = document.getElementById('mExpFabScrim');
    if (!drop.classList.contains('open')) return;
    drop.classList.add('m-pop-out');
    scrim.classList.add('m-pop-out');
    setTimeout(function() {
      drop.classList.remove('open', 'm-pop-out');
      scrim.classList.remove('open', 'm-pop-out');
    }, 180);
  };

  // Close fab dropdown when clicking outside
  document.addEventListener('click', function(e) {
    var fab = document.getElementById('mExpFab');
    var drop = document.getElementById('mExpFabDrop');
    if (fab && drop && !fab.contains(e.target) && !drop.contains(e.target)) {
      mCloseExpDrop();
    }
  });

  // FAB close on outside click
  document.addEventListener('click', function(e) { if (!e.target.closest('.m-toolbar')) { var f=document.getElementById('mFab'); if(f) f.classList.remove('open'); } });

  // Modern inline search dropdown
  (function() {
    var mSearchInput = document.querySelector('.m-search-input');
    var mSearchWrap = document.querySelector('.m-search');
    if (!mSearchInput || !mSearchWrap) return;

    // Create dropdown - append to body to escape stacking contexts
    var dropdown = document.createElement('div');
    dropdown.id = 'mSearchDrop';
    dropdown.style.cssText = 'display:none;position:fixed;margin-top:6px;background:rgba(50,50,50,0.97);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);border:1px solid rgba(255,255,255,0.08);border-radius:12px;box-shadow:none;max-height:60vh;overflow-y:auto;z-index:9000;padding:0.3rem 0;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.04) transparent;';
    document.body.appendChild(dropdown);
    function positionDropdown() {
      var rect = mSearchWrap.getBoundingClientRect();
      dropdown.style.left = rect.left + 'px';
      dropdown.style.top = (rect.bottom + 6) + 'px';
      dropdown.style.width = rect.width + 'px';
    }

    // Build search index if needed
    if (typeof buildSearchIndex === 'function' && searchIndex.length === 0) buildSearchIndex();

    var activeIdx = -1;

    mSearchInput.addEventListener('input', function() {
      var q = this.value.trim().toLowerCase();
      activeIdx = -1;
      if (q.length < 2) { dropdown.style.display = 'none'; return; }
      positionDropdown();
      if (searchIndex.length === 0 && typeof buildSearchIndex === 'function') buildSearchIndex();

      var matches = searchIndex.filter(function(e) {
        return e.text.toLowerCase().indexOf(q) !== -1 ||
               e.code.toLowerCase().indexOf(q) !== -1 ||
               e.sectionLabel.toLowerCase().indexOf(q) !== -1 ||
               e.taskHeader.toLowerCase().indexOf(q) !== -1;
      }).slice(0, 20);

      if (matches.length === 0) {
        dropdown.innerHTML = '<div style="padding:0.8rem 1rem;font-family:\'Barlow Condensed\',sans-serif;font-size:0.6rem;color:rgba(255,255,255,0.2);text-transform:uppercase;letter-spacing:0.08em;">No results</div>';
      } else {
        dropdown.innerHTML = matches.map(function(m, i) {
          return '<div class="m-sr" data-idx="'+i+'" style="padding:0.5rem 1rem;cursor:pointer;transition:background 0.15s;border-bottom:1px solid rgba(80,120,170,0.04);" onmouseover="this.style.background=\'rgba(0,0,0,0.03)\'" onmouseout="this.style.background=\'transparent\'">'
            + '<div style="font-family:\'Barlow Condensed\',sans-serif;font-size:0.5rem;color:rgba(255,255,255,0.3);letter-spacing:0.06em;margin-bottom:0.15rem;">' + m.code + '</div>'
            + '<div style="font-size:0.68rem;color:rgba(255,255,255,0.6);font-weight:300;line-height:1.35;">' + m.text.substring(0,120) + (m.text.length>120?'…':'') + '</div>'
            + '</div>';
        }).join('');

        // Click handler on results
        dropdown.querySelectorAll('.m-sr').forEach(function(row, i) {
          row.onclick = function() {
            var match = matches[i];
            dropdown.style.display = 'none';
            mSearchInput.value = '';
            if (match.itemEl) {
              var itemCode = match.code;
              var areas = document.querySelectorAll('.area');
              for (var ai = 0; ai < areas.length; ai++) {
                var taskIdx = -1;
                var tasks = areas[ai].querySelectorAll('.task');
                for (var ti = 0; ti < tasks.length; ti++) {
                  if ([...tasks[ti].querySelectorAll('.item-code')].some(function(c){ return c.textContent.trim() === itemCode; })) {
                    taskIdx = ti;
                    break;
                  }
                }
                if (taskIdx >= 0) {
                  mGo(ai);
                  setTimeout(function() {
                    if (typeof mOpenTask === 'function') mOpenTask(ai, taskIdx);
                    setTimeout(function() {
                      var expBody = document.getElementById('mExpB');
                      if (expBody) {
                        expBody.querySelectorAll('.section-body').forEach(function(b) { b.classList.remove('hidden'); });
                        expBody.querySelectorAll('.section-label').forEach(function(l) { l.classList.add('expanded'); });
                        expBody.querySelectorAll('.section-wrapper').forEach(function(w) { w.classList.add('open'); });
                        expBody.querySelectorAll('.section-chevron').forEach(function(c) { c.style.transform = 'rotate(0deg)'; });
                        var codeEls = expBody.querySelectorAll('.item-code');
                        for (var ci = 0; ci < codeEls.length; ci++) {
                          if (codeEls[ci].textContent.trim() === itemCode) {
                            var itm = codeEls[ci].closest('.item');
                            if (itm) {
                              itm.scrollIntoView({behavior:'smooth',block:'center'});
                              itm.style.outline = '1px solid rgba(46,139,87,0.6)';
                              itm.style.outlineOffset = '2px';
                              itm.style.borderRadius = '6px';
                              setTimeout(function(){ itm.style.outline=''; itm.style.outlineOffset=''; }, 5000);
                            }
                            break;
                          }
                        }
                      }
                    }, 450);
                  }, 150);
                  break;
                }
              }
            }
          };
        });
      }
      positionDropdown();
      dropdown.style.display = 'block';
    });

    mSearchInput.addEventListener('keydown', function(e) {
      var rows = dropdown.querySelectorAll('.m-sr');
      if (!rows.length) return;
      if (e.key === 'ArrowDown') { e.preventDefault(); activeIdx = Math.min(activeIdx+1, rows.length-1); highlightRow(rows); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); activeIdx = Math.max(activeIdx-1, 0); highlightRow(rows); }
      else if (e.key === 'Enter' && activeIdx >= 0) { e.preventDefault(); rows[activeIdx].click(); }
      else if (e.key === 'Escape') { dropdown.style.display = 'none'; mSearchInput.blur(); }
    });

    function highlightRow(rows) {
      for (var i=0; i<rows.length; i++) rows[i].style.background = i===activeIdx ? 'rgba(0,0,0,0.04)' : 'transparent';
      if (rows[activeIdx]) rows[activeIdx].scrollIntoView({block:'nearest'});
    }

    // Close on outside click
    document.addEventListener('click', function(e) { if (!e.target.closest('.m-search')) dropdown.style.display = 'none'; });
  })();

  // Resize
  window.addEventListener('resize', function() { if(document.body.classList.contains('modern-mode')) mPos(false); });

  // Init
  function tryInit() {
    if (!document.body.classList.contains('modern-mode')) return;
    var vp = document.getElementById('mVP');
    if (vp && vp.offsetWidth > 0) { mIdxLocal=0; window.mIdx=0; mPos(false); }
    else requestAnimationFrame(tryInit);
  }
  requestAnimationFrame(tryInit);
  window.addEventListener('load', function() { if(document.body.classList.contains('modern-mode')) { mIdxLocal=0; window.mIdx=0; setTimeout(function(){mPos(false);},50); setTimeout(function(){ if(typeof applyCategoryFilters==='function') applyCategoryFilters(); },100); } });

  // Hook theme switch — wraps existing setTheme without replacing it
  var origST = window.setTheme;
  window.setTheme = function(t) {
    origST(t);
    if (t==='modern') { mIdxLocal=0; window.mIdx=0; requestAnimationFrame(function(){requestAnimationFrame(function(){mPos(false);})}); setTimeout(function(){mPos(false);},50); setTimeout(function(){mPos(false);},200); }
  };
})();

// ═══ Shared popup animation helper ═══
window.mPopOpen = function(el, triggerEl) {
  if (!el) return;
  if (triggerEl) {
    var rect = triggerEl.getBoundingClientRect();
    var cx = rect.left + rect.width / 2;
    var cy = rect.top + rect.height / 2;
    var vw = window.innerWidth, vh = window.innerHeight;
    el.style.setProperty('--exp-t', (cy / vh * 100).toFixed(1) + '%');
    el.style.setProperty('--exp-b', ((1 - cy / vh) * 100).toFixed(1) + '%');
    el.style.setProperty('--exp-l', (cx / vw * 100).toFixed(1) + '%');
    el.style.setProperty('--exp-r', ((1 - cx / vw) * 100).toFixed(1) + '%');
  } else {
    el.style.setProperty('--exp-t', '35%');
    el.style.setProperty('--exp-b', '35%');
    el.style.setProperty('--exp-l', '25%');
    el.style.setProperty('--exp-r', '25%');
  }
  el.classList.remove('m-pop-out');
  el.classList.add('m-pop-in');
};
window.mPopClose = function(el, cb) {
  if (!el) return;
  el.classList.remove('m-pop-in');
  el.classList.add('m-pop-out');
  setTimeout(function() {
    el.classList.remove('m-pop-out');
    if (cb) cb();
  }, 220);
};

// ═══ Grid View ═══
(function() {
  var allAreas = [data,data2,data3,data4,data5,data6,data7,data8,data9,data10,data11,data12,data13,data14];

  window.mOpenGrid = function() {
    var overlay = document.getElementById('mGridOverlay');
    var body = document.getElementById('mGridBody');
    body.innerHTML = '';
    allAreas.forEach(function(a, i) {
      var totalItems = 0, counts = {green:0, yellow:0, red:0};
      a.tasks.forEach(function(t) {
        (t.sections||[]).forEach(function(sec) {
          (sec.items||[]).forEach(function(item) {
            totalItems++;
            var key = 'cfi_conf_' + item.code.replace(/\./g,'_');
            var val = localStorage.getItem(key);
            if (val && counts.hasOwnProperty(val)) counts[val]++;
          });
        });
      });
      var gPct = totalItems ? Math.round(counts.green/totalItems*100) : 0;
      var yPct = totalItems ? Math.round(counts.yellow/totalItems*100) : 0;
      var rPct = totalItems ? Math.round(counts.red/totalItems*100) : 0;
      var romanColor = 'rgba(255,255,255,0.08)';
      var maxConf = Math.max(counts.green, counts.yellow, counts.red);
      if (maxConf > 0) {
        if (counts.green >= counts.yellow && counts.green >= counts.red) romanColor = 'rgba(46,139,87,0.35)';
        else if (counts.yellow >= counts.green && counts.yellow >= counts.red) romanColor = 'rgba(212,160,23,0.35)';
        else romanColor = 'rgba(192,57,43,0.35)';
      }
      var tasksHTML = a.tasks.map(function(t, ti) {
        var catAttr = t.category ? ' data-category="'+t.category+'"' : '';
        var catHidden = '';
        if (t.category) {
          var show = false;
          if (t.category === 'ASES/AMES') show = categoryState.ASES || categoryState.AMES;
          else if (categoryState.hasOwnProperty(t.category)) show = categoryState[t.category];
          if (!show) catHidden = ' style="display:none"';
        }
        return '<div class="m-grid-task"'+catAttr+catHidden+' data-area="'+i+'" data-task="'+ti+'" onclick="event.stopPropagation();mCloseGrid();mGo('+i+');setTimeout(function(){mOpenTask('+i+','+ti+');},300);">'+t.id+' '+t.title+'</div>';
      }).join('');
      var card = document.createElement('div');
      card.className = 'm-grid-card';
      card.onclick = function() { mCloseGrid(); mGo(i); };
      card.innerHTML = '<div class="m-grid-card-head"><div class="m-grid-card-roman" style="color:'+romanColor+'">'+a.areaIndex+'</div><div class="m-grid-card-title">'+a.area.replace(/^Area of Operation [IVXLCDM]+:\s*/,'')+'</div><div class="m-grid-card-count">'+a.tasks.length+' Task'+(a.tasks.length>1?'s':'')+'</div></div><div class="m-grid-card-tasks">'+tasksHTML+'</div><div class="m-grid-card-prog"><div class="m-grid-prog-bar"><div class="m-grid-prog-fill-green" style="width:'+gPct+'%"></div></div><div class="m-grid-prog-bar"><div class="m-grid-prog-fill-yellow" style="width:'+yPct+'%"></div></div><div class="m-grid-prog-bar"><div class="m-grid-prog-fill-red" style="width:'+rPct+'%"></div></div></div>';
      body.appendChild(card);
    });
    overlay.classList.add('open');
    mPopOpen(overlay, document.querySelector('.m-tool-icon[title="View All Areas"]'));
  };

  window.mCloseGrid = function() {
    var overlay = document.getElementById('mGridOverlay');
    mPopClose(overlay, function() { overlay.classList.remove('open'); });
  };

  // ESC to close
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && document.getElementById('mGridOverlay').classList.contains('open')) {
      mCloseGrid();
    }
  });
})();
document.addEventListener('paste', (e) => {
  const target = e.target;
  if (!target.classList.contains('rich-editor') &&
      target.id !== 'notesEditor' &&
      !target.closest('#notesPanel')) return;
  if (target.contentEditable !== 'true') return;

  e.preventDefault();
  const text = (e.clipboardData || window.clipboardData).getData('text/plain');
  // Insert as plain text at cursor position
  const sel = window.getSelection();
  if (!sel.rangeCount) return;
  sel.deleteFromDocument();
  const range = sel.getRangeAt(0);
  // Preserve line breaks as <br>
  const lines = text.split(/\r?\n/);
  const frag = document.createDocumentFragment();
  lines.forEach((line, i) => {
    if (i > 0) frag.appendChild(document.createElement('br'));
    if (line) frag.appendChild(document.createTextNode(line));
  });
  range.insertNode(frag);
  // Move cursor to end of inserted content
  range.collapse(false);
  sel.removeAllRanges();
  sel.addRange(range);

  // Trigger save
  target.dispatchEvent(new Event('input', { bubbles: true }));
});
restoreUIState();
loadBookmark();
if (typeof mRefreshBookmark === 'function') mRefreshBookmark();
initNotesPanel();
loadTheme();
checkLock();
buildSearchIndex();

// ── Oral Sim button intro animation ──────────────────────────────
(function() {
  const btn = document.getElementById('oralSimHeaderBtn');
  const mBtn = document.getElementById('mOralSimBtn');
  if (!btn && !mBtn) return;
  var buttons = [btn, mBtn].filter(Boolean);
  const play = btn ? btn.querySelector('.oral-sim-icon-play') : null;
  const label = btn ? btn.querySelector('.oral-sim-slide-label') : null;

  buttons.forEach(function(b) { b.classList.add('oral-sim-pulsing'); });

  setTimeout(() => {
    // Pulse done — lock play to orange
    buttons.forEach(function(b) { b.classList.remove('oral-sim-pulsing'); });
    buttons.forEach(function(b) {
      var p = b.querySelector('.oral-sim-icon-play');
      if (p && !b.classList.contains('m-oral-sim-btn')) { p.style.fill = 'var(--accent)'; p.style.stroke = 'var(--accent)'; }
    });
    // Slide label out as preview
    if (label) {
      label.classList.add('preview');
      setTimeout(() => {
        label.classList.remove('preview');
      }, 5000);
    }

    // Start idle animation every 5s (after preview finishes)
    setTimeout(() => {
      function triggerIdle() {
        buttons.forEach(function(b) {
          if (b.matches(':hover')) return;
          b.classList.remove('idle-animate');
          void b.offsetWidth;
          b.classList.add('idle-animate');
          setTimeout(function() { b.classList.remove('idle-animate'); }, 1200);
        });
      }
      triggerIdle();
      setInterval(triggerIdle, 5000);
    }, 5500); // wait for preview to finish

  }, 7000);
})();

// ── Mobile: scroll-aware fade on controls row ─────────────────────
(function() {
  function isMobile() { return window.innerWidth <= 600; }

  function updateFade(el) {
    if (!isMobile()) { el.style.webkitMaskImage = ''; el.style.maskImage = ''; return; }
    const atStart = el.scrollLeft <= 2;
    const atEnd   = el.scrollLeft >= el.scrollWidth - el.clientWidth - 2;
    let mask = '';
    if (!atStart && !atEnd) {
      mask = 'linear-gradient(to right, transparent 0%, black 10%, black 82%, transparent 100%)';
    } else if (!atStart && atEnd) {
      mask = 'linear-gradient(to right, transparent 0%, black 10%, black 100%)';
    } else if (atStart && !atEnd) {
      mask = 'linear-gradient(to right, black 0%, black 82%, transparent 100%)';
    }
    el.style.webkitMaskImage = mask;
    el.style.maskImage = mask;
  }

  function initScrollFade() {
    const controls = document.querySelector('.controls');
    if (!controls) return;
    updateFade(controls);
    controls.addEventListener('scroll', () => updateFade(controls), { passive: true });
    window.addEventListener('resize', () => updateFade(controls));
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initScrollFade);
  } else {
    initScrollFade();
  }
})();

// ── Study by Highlight ────────────────────────────────────────────
let studyPickerSelected = new Set();
let studyRevealAll = false;
const studyPendingRemovals = new Map();      // safeCode -> { titleText }
const studyPendingColorChanges = new Map();  // safeCode -> { from, to, titleText }
const studyPendingContentChanges = new Map(); // storageKey -> { label, titleText, hadContent, hasContent }

function openStudyHighlightPicker() {
  studyPickerSelected.clear();
  ['green','yellow','red'].forEach(c => {
    document.getElementById('pickerDot' + c.charAt(0).toUpperCase() + c.slice(1)).classList.remove('selected');
  });
  var el = document.getElementById('studyPickerOverlay');
  el.classList.remove('m-pop-out');
  el.classList.add('open');
}

function closeStudyHighlightPicker() {
  var el = document.getElementById('studyPickerOverlay');
  mPopClose(el, function() { el.classList.remove('open'); });
}

function togglePickerDot(color) {
  const id = 'pickerDot' + color.charAt(0).toUpperCase() + color.slice(1);
  const el = document.getElementById(id);
  if (studyPickerSelected.has(color)) {
    studyPickerSelected.delete(color);
    el.classList.remove('selected');
  } else {
    studyPickerSelected.add(color);
    el.classList.add('selected');
  }
}

function startStudyMode() {
  if (studyPickerSelected.size === 0) return;
  closeStudyHighlightPicker();
  const colors = [...studyPickerSelected];
  const items = [];
  const seen = new Set();
  Object.keys(localStorage).forEach(k => {
    if (!k.startsWith('cfi_conf_')) return;
    const color = localStorage.getItem(k);
    if (!colors.includes(color)) return;
    const safeCode = k.replace('cfi_conf_', '');
    if (seen.has(safeCode)) return;
    seen.add(safeCode);
    const ansContent = localStorage.getItem('cfi_' + safeCode + '_ans') ?? '';
    const sumContent = localStorage.getItem('cfi_' + safeCode + '_sum') ?? '';
    const code = safeCode.replace(/_/g, '.');
    const codeEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
    const titleText = codeEl ? codeEl.closest('.item')?.querySelector('.item-title')?.textContent || '' : '';
    items.push({ code, safeCode, color, ansContent, sumContent, titleText });
  });

  const allCodes = [...document.querySelectorAll('.item-code')];

  items.sort((a, b) => {
    const aIdx = allCodes.findIndex(el => el.textContent.trim() === a.code);
    const bIdx = allCodes.findIndex(el => el.textContent.trim() === b.code);
    return aIdx - bIdx;
  });

  const body = document.getElementById('studyModeBody');
  body.innerHTML = '';
  studyRevealAll = false;
  studyPendingRemovals.clear();
  studyPendingColorChanges.clear();
  studyPendingContentChanges.clear();
  const revealBtn = document.getElementById('studyRevealBtn');
  revealBtn.textContent = 'Reveal All';

  const indContainer = document.getElementById('studyModeDotIndicators');
  indContainer.innerHTML = '';
  colors.forEach(c => {
    const ind = document.createElement('div');
    ind.className = 'study-mode-indicator ' + c;
    indContainer.appendChild(ind);
  });
  document.getElementById('studyModeCount').textContent = items.length + ' item' + (items.length !== 1 ? 's' : '');

  if (items.length === 0) {
    body.innerHTML = '<div class="study-empty">No highlighted items found for the selected colors.</div>';
  } else {
    items.forEach(item => {
      const row = document.createElement('div');
      row.className = 'study-item';

      // Single header row: code | dots | title
      const headerRow = document.createElement('div');
      headerRow.className = 'study-item-header';

      const codeEl = document.createElement('div');
      codeEl.className = 'study-item-code';
      codeEl.textContent = item.code;
      headerRow.appendChild(codeEl);

      // Confidence dots inline
      const dotsRow = document.createElement('div');
      dotsRow.className = 'study-conf-dots';
      ['green','yellow','red'].forEach(color => {
        const dot = document.createElement('button');
        dot.className = 'study-conf-dot ' + color;
        dot.title = color === 'green' ? 'Know it well' : color === 'yellow' ? 'Needs more work' : "Don't know it";
        if (item.color === color) dot.classList.add('active');
        dot.onclick = () => {
          const isActive = dot.classList.contains('active');
          const prevColor = item.color;
          dotsRow.querySelectorAll('.study-conf-dot').forEach(d => d.classList.remove('active'));
          titleEl.classList.remove('conf-green','conf-yellow','conf-red');
          if (isActive) {
            // Mark as pending removal — strikethrough style, stays visible until exit
            studyPendingRemovals.set(item.safeCode, { row, titleEl, dotsRow });
            studyPendingColorChanges.delete(item.safeCode); // removal supersedes color change
            titleEl.style.textDecoration = 'line-through';
            titleEl.style.opacity = '0.45';
            dot.style.opacity = '0.3';
            item.color = null;
          } else {
            dot.classList.add('active');
            titleEl.classList.add('conf-' + color);
            localStorage.setItem('cfi_conf_' + item.safeCode, color);
            // Track color change (only if not a removal being undone)
            if (studyPendingRemovals.has(item.safeCode)) {
              // Undoing a removal
              studyPendingRemovals.delete(item.safeCode);
              titleEl.style.textDecoration = '';
              titleEl.style.opacity = '';
              dotsRow.querySelectorAll('.study-conf-dot').forEach(d => d.style.opacity = '');
            } else if (prevColor && prevColor !== color) {
              // Genuine color change
              studyPendingColorChanges.set(item.safeCode, { from: prevColor, to: color, titleText: item.titleText, code: item.code });
            } else if (!prevColor) {
              // Re-highlighting after removal undo — no change to track
            }
            item.color = color;
            const mainItem = document.querySelector(`.item-code[data-safe="${item.safeCode}"]`)?.closest('.item');
            if (mainItem) {
              mainItem.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
              mainItem.querySelector('.conf-dot.' + color)?.classList.add('active');
              mainItem.querySelector('.item-title')?.classList.remove('conf-green','conf-yellow','conf-red');
              mainItem.querySelector('.item-title')?.classList.add('conf-' + color);
            }
          }
        };
        dotsRow.appendChild(dot);
      });
      headerRow.appendChild(dotsRow);

      const titleEl = document.createElement('div');
      titleEl.className = 'study-item-title conf-' + item.color;
      titleEl.textContent = item.titleText || item.code;
      headerRow.appendChild(titleEl);

      row.appendChild(headerRow);

      // Fields below
      const fieldsCol = document.createElement('div');
      fieldsCol.className = 'study-item-fields';

      // Editable answer field
      if (item.ansContent !== null) {
        fieldsCol.appendChild(buildStudyField('Answer', item.safeCode + '_ans', item.ansContent));
      }
      // Editable summary field
      if (item.sumContent !== null) {
        fieldsCol.appendChild(buildStudyField('Summary / Notes', item.safeCode + '_sum', item.sumContent));
      }

      row.appendChild(fieldsCol);
      body.appendChild(row);
    });
  }
  document.getElementById('studyModeOverlay').classList.add('open');
  mPopOpen(document.getElementById('studyModeOverlay'));
}

function buildStudyField(label, storageKey, editorContent) {
  const field = document.createElement('div');
  field.className = 'study-item-field';

  const lbl = document.createElement('div');
  lbl.className = 'study-item-label';
  lbl.textContent = label;

  const editBtn = document.createElement('button');
  editBtn.className = 'study-edit-btn';
  editBtn.title = 'Edit';
  editBtn.textContent = '···';
  editBtn.onmousedown = (e) => {
    e.preventDefault();
    e.stopPropagation();
    if (el.classList.contains('is-editing')) {
      deactivateEdit();
    } else {
      activateEdit();
    }
  };

  const lblRow = document.createElement('div');
  lblRow.style.cssText = 'display:flex;align-items:center;';
  lblRow.appendChild(lbl);
  lblRow.appendChild(editBtn);

  // Toolbar (hidden until edit mode)
  const toolbar = document.createElement('div');
  toolbar.className = 'editor-toolbar';
  toolbar.style.display = 'none';

  const imgInput = document.createElement('input');
  imgInput.type = 'file';
  imgInput.accept = 'image/*';
  imgInput.style.display = 'none';
  imgInput.addEventListener('change', () => {
    const file = imgInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => insertImageInEditor(el, e.target.result);
    reader.readAsDataURL(file);
    imgInput.value = '';
  });

  toolbar.innerHTML = `
    <button class="tb-bold"      onmousedown="event.preventDefault(); formatDoc('bold')"      title="Bold">B</button>
    <button class="tb-italic"    onmousedown="event.preventDefault(); formatDoc('italic')"    title="Italic">I</button>
    <button class="tb-underline" onmousedown="event.preventDefault(); formatDoc('underline')" title="Underline">U</button>
    <span style="width:1px;background:var(--border);margin:0.1rem 0.2rem;align-self:stretch;"></span>
  `;

  const imgBtn = document.createElement('button');
  imgBtn.title = 'Insert Image';
  imgBtn.innerHTML = `<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="2" width="12" height="10" rx="1.5" stroke="currentColor" stroke-width="1.3"/><circle cx="4.5" cy="5.5" r="1" fill="currentColor"/><path d="M1 9.5L4 6.5L6.5 9L9 7L13 10.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
  imgBtn.onmousedown = (e) => { e.preventDefault(); el.focus(); imgInput.click(); };
  toolbar.appendChild(imgBtn);
  toolbar.appendChild(imgInput);

  // Content box
  const el = document.createElement('div');
  const hasContent = editorContent.trim() !== '';
  el.className = 'study-item-content hidden-content' + (hasContent ? ' has-content' : '');
  el.contentEditable = 'false';
  el.innerHTML = editorContent;

  // Wrap so hover doesn't interfere with button
  const wrap = document.createElement('div');
  wrap.className = 'study-field-wrap';
  wrap.appendChild(el);

  function activateEdit() {
    el.contentEditable = 'true';
    el.classList.add('is-editing');
    el.classList.remove('hidden-content');
    toolbar.style.display = 'flex';
    editBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><polyline points="1.5,6 5,9.5 10.5,2.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    editBtn.style.color = '';
    el.focus();
  }

  function deactivateEdit() {
    el.contentEditable = 'false';
    el.classList.remove('is-editing');
    toolbar.style.display = 'none';
    editBtn.textContent = '···';
    editBtn.style.color = '';
    save();
  }

  function save() {
    const prevContent = localStorage.getItem('cfi_' + storageKey) ?? '';
    const hadContent = prevContent.trim() !== '';
    localStorage.setItem('cfi_' + storageKey, el.innerHTML);
    const hasContent = el.innerText.trim() !== '';
    el.classList.toggle('has-content', hasContent);

    // Track content change for exit confirm
    if (hadContent !== hasContent || (hadContent && hasContent && el.innerHTML !== prevContent)) {
      const safeCode = storageKey.replace(/_ans$|_sum$/, '');
      const code = safeCode.replace(/_/g, '.');
      const codeEl = [...document.querySelectorAll('.item-code')].find(e => e.textContent.trim() === code);
      const titleText = codeEl?.closest('.item')?.querySelector('.item-title')?.textContent?.trim() || '';
      const fieldLabel = storageKey.endsWith('_ans') ? 'Answer' : 'Summary/Notes';
      const changeKey = storageKey;
      if (!hadContent && hasContent) {
        studyPendingContentChanges.set(changeKey, { action: 'added', fieldLabel, code, titleText });
      } else if (hadContent && !hasContent) {
        studyPendingContentChanges.set(changeKey, { action: 'removed', fieldLabel, code, titleText });
      } else {
        studyPendingContentChanges.set(changeKey, { action: 'edited', fieldLabel, code, titleText });
      }
    }

    // Sync to main page editor
    const mainEditor = document.getElementById(storageKey);
    if (mainEditor) {
      mainEditor.innerHTML = el.innerHTML;
      const mainReveal = mainEditor.closest('.editor-outer')?.querySelector('.reveal-placeholder');
      if (mainReveal) {
        mainReveal.textContent = hasContent ? 'Click to reveal' : '';
        mainReveal.classList.toggle('has-content', hasContent);
      }
      const mainLabel = mainEditor.closest('.field-with-toggle')
        ?.previousElementSibling?.querySelector('.field-label');
      if (mainLabel) mainLabel.classList.toggle('populated', hasContent);
      const mainFieldRow = mainEditor.closest('.field-row');
      if (mainFieldRow && hideEmptyActive) {
        mainFieldRow.classList.toggle('is-empty', !hasContent);
      }
    }
  }

  // Click: reveal if hidden, hide if revealed (not editing)
  el.addEventListener('click', () => {
    if (el.classList.contains('hidden-content')) {
      el.classList.remove('hidden-content');
      el.scrollTop = 0;
      return;
    }
    if (!el.classList.contains('is-editing')) {
      el.scrollTop = 0;
      el.classList.add('hidden-content');
    }
  });

  el.addEventListener('blur', () => {
    setTimeout(() => {
      if (document.activeElement === el) return;
      if (el.classList.contains('is-editing')) deactivateEdit();
    }, 150);
  });

  field.appendChild(lblRow);
  field.appendChild(toolbar);
  field.appendChild(wrap);
  return field;
}

function updateStudyCount() {
  const remaining = document.querySelectorAll('#studyModeBody .study-item').length;
  document.getElementById('studyModeCount').textContent = remaining + ' item' + (remaining !== 1 ? 's' : '');
}

function toggleStudyReveal() {
  studyRevealAll = !studyRevealAll;
  document.querySelectorAll('#studyModeBody .study-item-content').forEach(el => {
    el.classList.toggle('hidden-content', !studyRevealAll);
    if (studyRevealAll) {
      el.scrollTop = 0;
    } else {
      el.contentEditable = 'false';
      el.classList.remove('is-editing');
    }
  });
  document.querySelectorAll('#studyModeBody .editor-toolbar').forEach(tb => {
    if (!studyRevealAll) tb.style.display = 'none';
  });
  document.getElementById('studyRevealBtn').textContent = studyRevealAll ? 'Hide All Answers' : 'Reveal All Answers';
}
function requestExitStudyMode() {
  const totalChanges = studyPendingRemovals.size + studyPendingColorChanges.size + studyPendingContentChanges.size;
  if (totalChanges === 0) {
    confirmExitStudyMode();
    return;
  }

  const list = document.getElementById('studyExitList');
  list.innerHTML = '';

  const colorDot = (c) => `<svg width="10" height="10" viewBox="0 0 10 10"><circle cx="5" cy="5" r="4" fill="${c === 'green' ? '#2e8b57' : c === 'yellow' ? '#d4a017' : '#c0392b'}" stroke="${c === 'green' ? '#2e8b57' : c === 'yellow' ? '#d4a017' : '#c0392b'}" stroke-width="1"/></svg>`;
  const colorLabel = (c) => `${colorDot(c)}`;

  // Removals
  studyPendingRemovals.forEach((_, safeCode) => {
    const code = safeCode.replace(/_/g, '.');
    const codeEl = [...document.querySelectorAll('.item-code')].find(el => el.textContent.trim() === code);
    const titleText = codeEl?.closest('.item')?.querySelector('.item-title')?.textContent?.trim() || '';
    list.appendChild(buildExitItem(code, 'Remove highlight', titleText));
  });

  // Color changes
  studyPendingColorChanges.forEach(({ from, to, titleText, code }) => {
    list.appendChild(buildExitItem(code, `${colorLabel(from)} → ${colorLabel(to)}`, titleText, true));
  });

  // Content changes
  studyPendingContentChanges.forEach(({ action, fieldLabel, code, titleText }) => {
    const actionText = action === 'added' ? `${fieldLabel}: text added`
                     : action === 'removed' ? `${fieldLabel}: text removed`
                     : `${fieldLabel}: text edited`;
    list.appendChild(buildExitItem(code, actionText, titleText));
  });

  document.getElementById('studyExitOverlay').classList.add('open');
}

function buildExitItem(code, action, titleText, actionIsHtml = false) {
  const item = document.createElement('div');
  item.className = 'study-exit-item';
  const actionSpan = document.createElement('span');
  actionSpan.className = 'study-exit-item-action';
  if (actionIsHtml) {
    actionSpan.innerHTML = action;
    actionSpan.style.display = 'flex';
    actionSpan.style.alignItems = 'center';
    actionSpan.style.gap = '0.3rem';
  } else {
    actionSpan.textContent = action;
  }
  const codeSpan = document.createElement('span');
  codeSpan.className = 'study-exit-item-code';
  codeSpan.textContent = code;
  const titleSpan = document.createElement('span');
  titleSpan.className = 'study-exit-item-title';
  titleSpan.textContent = titleText;
  item.appendChild(codeSpan);
  item.appendChild(actionSpan);
  item.appendChild(titleSpan);
  return item;
}

function cancelExitStudyMode() {
  document.getElementById('studyExitOverlay').classList.remove('open');
}

function confirmExitStudyMode() {
  document.getElementById('studyExitOverlay').classList.remove('open');
  closeStudyMode();
}


// ═══════════════════════════════════════════════════════════════════
// ── ORAL SIMULATOR ─────────────────────────────────────────────────
// ═══════════════════════════════════════════════════════════════════

// Area metadata — order, labels, flight-maneuver flag
const ORAL_AREAS = [
  { id: 'I',   label: 'Area I — Fundamentals of Instructing',      flightManeuver: false },
  { id: 'II',  label: 'Area II — Technical Subject Areas',          flightManeuver: false },
  { id: 'III', label: 'Area III — Preflight Preparation',           flightManeuver: false },
  { id: 'IV',  label: 'Area IV — Preflight Lesson on Maneuver',     flightManeuver: false, specialLesson: true },
  { id: 'V',   label: 'Area V — Preflight Procedures',              flightManeuver: false },
  { id: 'VI',  label: 'Area VI — Airport & Seaplane Base Ops',      flightManeuver: false },
  { id: 'VII', label: 'Area VII — Takeoffs, Landings & Go-Arounds', flightManeuver: true  },
  { id: 'VIII',label: 'Area VIII — Fundamentals of Flight',         flightManeuver: true  },
  { id: 'IX',  label: 'Area IX — Performance Maneuvers',            flightManeuver: true  },
  { id: 'X',   label: 'Area X — Ground Reference Maneuvers',        flightManeuver: true  },
  { id: 'XI',  label: 'Area XI — Basic Instrument Maneuvers',       flightManeuver: true  },
  { id: 'XII', label: 'Area XII — Emergency Operations',            flightManeuver: true  },
  { id: 'XIV', label: 'Area XIV — Postflight Procedures',           flightManeuver: false },
];

// Area IV lesson maneuver pool (Areas VII–XII tasks)
const AREA_IV_MANEUVERS = [
  'Normal Takeoff and Climb', 'Crosswind Takeoff and Climb',
  'Short-Field Takeoff and Maximum Performance Climb',
  'Short-Field Approach and Landing', 'Soft-Field Takeoff and Climb',
  'Soft-Field Approach and Landing', 'Normal Approach and Landing',
  'Crosswind Approach and Landing', 'Go-Around / Rejected Landing',
  'Straight-and-Level Flight', 'Turns to Headings', 'Recovery from Unusual Attitudes',
  'Straight Climbs and Climbing Turns', 'Straight Descents and Descending Turns',
  'Steep Turns', 'Chandelles', 'Lazy Eights', 'Steep Spirals', 'Eights on Pylons',
  'Rectangular Course', 'S-Turns', 'Turns Around a Point',
  'Slow Flight', 'Power-Off Stalls', 'Power-On Stalls',
  'Crossed-Control Stalls', 'Elevator Trim Stalls', 'Secondary Stalls', 'Spins',
  'Emergency Descent', 'Emergency Approach and Landing', 'Engine Failure During Takeoff',
  'Systems and Equipment Malfunctions'
];

// Examiner thinking phrases
const THINKING_PHRASES = [
  'Hmm...', 'Let\'s see...', 'Alright...', 'Okay...', 'Good, good...', 'Interesting...',
  'Mhm...', 'Go ahead...', 'Right then...'
];

// Fail threshold — wrong answers in a task area before failure
const ORAL_FAIL_THRESHOLD = 4;

// Session state
let oralState = {
  active: false,
  scope: 'full',          // 'full' | 'area'
  targetArea: null,       // area id if scope='area'
  mode: 'direct',         // 'direct' | 'rephrased'
  areaIndex: 0,           // current position in ORAL_AREAS
  areaQueue: [],          // ordered area ids for this session
  currentAreaId: null,
  currentTaskLabel: '',   // e.g. "Task C | Chandelles (ASEL)"
  questionQueue: [],      // shuffled items for current area
  questionIndex: 0,
  wrongInArea: [],        // { code, title } of wrong items this area
  wrongTotal: 0,
  correctTotal: 0,
  totalQAsked: 0,
  digMode: false,         // true = pulling from unhighlighted items
  digQueue: [],
  revealed: { ans: false, sum: false },
  currentItem: null,      // { code, safeCode, title, taskLabel, areaId, isSkill }
  sessionKey: 'oralSimSession',
};

// ── Launcher ──────────────────────────────────────────────────────

function openOralSimLauncher() {
  // Load saved API key
  const savedKey = localStorage.getItem('oralApiKey') || '';
  document.getElementById('oralApiKeyInput').value = savedKey;
  updateApiStatus();

  // Check for saved session
  const saved = loadOralSession();
  const banner = document.getElementById('oralResumeBanner');
  const goBtn = document.getElementById('oralLauncherGo');
  if (saved && saved.active) {
    const areaLabel = ORAL_AREAS.find(a => a.id === saved.currentAreaId)?.label || '';
    document.getElementById('oralResumeDetail').textContent =
      `Paused in ${areaLabel} — ${saved.totalQAsked} questions answered`;
    banner.classList.add('visible');
    goBtn.textContent = 'New Session';
  } else {
    banner.classList.remove('visible');
    goBtn.textContent = 'Begin Oral';
  }

  var olEl = document.getElementById('oralLauncherOverlay');
  olEl.classList.remove('m-pop-out');
  olEl.classList.add('open');
}

function closeOralSimLauncher() {
  var el = document.getElementById('oralLauncherOverlay');
  mPopClose(el, function() { el.classList.remove('open'); });
}

function setOralScope(scope) {
  oralState.scope = scope;
  document.getElementById('scopeFull').classList.toggle('selected', scope === 'full');
  document.getElementById('scopeArea').classList.toggle('selected', scope === 'area');
  document.getElementById('oralAreaSelect').classList.toggle('visible', scope === 'area');
}

function setOralMode(mode) {
  oralState.mode = mode;
  document.getElementById('modeDirect').classList.toggle('selected', mode === 'direct');
  document.getElementById('modeRephrased').classList.toggle('selected', mode === 'rephrased');
  document.getElementById('oralApiRow').classList.toggle('visible', mode === 'rephrased');
}

function updateApiStatus() {
  const key = document.getElementById('oralApiKeyInput').value.trim();
  const status = document.getElementById('oralApiStatus');
  if (key && key.startsWith('sk-')) {
    status.textContent = 'API Key Ready ✓';
    status.className = 'oral-api-status ready';
    localStorage.setItem('oralApiKey', key);
  } else {
    status.textContent = 'No valid API key — enter key above';
    status.className = 'oral-api-status missing';
  }
}

// ── Session Build ─────────────────────────────────────────────────

function buildOralAreaQueue() {
  if (oralState.scope === 'area') {
    const sel = document.getElementById('oralAreaSelect').value;
    return [sel];
  }
  // Full oral — only include areas with highlighted items, but ALWAYS include Area IV
  const areas = ORAL_AREAS.map(a => a.id).filter(id => {
    if (id === 'IV') return true; // always include — mandatory lesson plan
    return getHighlightedItemsForArea(id).length > 0;
  });
  return areas;
}

function getHighlightedItemsForArea(areaId) {
  const items = [];
  document.querySelectorAll('.item').forEach(itemEl => {
    const codeEl = itemEl.querySelector('.item-code');
    if (!codeEl) return;
    const code = codeEl.textContent.trim();
    if (!code.startsWith('AI.' + areaId + '.') && !code.startsWith('FI.' + areaId + '.')) return;

    // Check if item is in a hidden category task
    const taskEl = itemEl.closest('.task[data-category]');
    if (taskEl) {
      const cat = taskEl.dataset.category;
      if (cat === 'AMEL' && !categoryState.AMEL) return;
      if (cat === 'ASES' && !categoryState.ASES) return;
      if (cat === 'AMES' && !categoryState.AMES) return;
      if (cat === 'ASES/AMES' && !categoryState.ASES && !categoryState.AMES) return;
    }

    const safeCode = code.replace(/\./g, '_');
    const confColor = localStorage.getItem('cfi_conf_' + safeCode);
    if (!confColor) return; // not highlighted

    const titleEl = itemEl.querySelector('.item-title');
    const title = titleEl ? titleEl.textContent.trim() : '';
    const ansContent = localStorage.getItem('cfi_' + safeCode + '_ans') || '';
    const sumContent = localStorage.getItem('cfi_' + safeCode + '_sum') || '';

    // Determine task label for card header
    const taskBody = itemEl.closest('.task-body');
    const taskHeader = taskBody ? taskBody.previousElementSibling : null;
    const taskRef = taskHeader ? taskHeader.querySelector('.task-ref')?.textContent?.trim() || '' : '';
    const taskTitleNode = taskHeader ? taskHeader.querySelector('.task-ref')?.nextSibling : null;
    const taskTitleText = taskTitleNode ? taskTitleNode.textContent?.trim() || '' : '';
    const taskHeaderText = taskRef ? `${taskRef} ${taskTitleText}`.trim() : taskTitleText;

    // Determine if skill item
    const sectionLabel = itemEl.closest('.section-wrapper')?.querySelector('.section-label span')?.textContent?.trim() || '';
    const isSkill = sectionLabel === 'Skills';

    items.push({ code, safeCode, title, ansContent, sumContent, taskLabel: taskHeaderText, areaId, isSkill });
  });
  return items;
}

function getUnhighlightedItemsForArea(areaId) {
  const items = [];
  document.querySelectorAll('.item').forEach(itemEl => {
    const codeEl = itemEl.querySelector('.item-code');
    if (!codeEl) return;
    const code = codeEl.textContent.trim();
    if (!code.startsWith('AI.' + areaId + '.') && !code.startsWith('FI.' + areaId + '.')) return;

    const taskEl = itemEl.closest('.task[data-category]');
    if (taskEl) {
      const cat = taskEl.dataset.category;
      if (cat === 'AMEL' && !categoryState.AMEL) return;
      if (cat === 'ASES' && !categoryState.ASES) return;
      if (cat === 'AMES' && !categoryState.AMES) return;
      if (cat === 'ASES/AMES' && !categoryState.ASES && !categoryState.AMES) return;
    }

    const safeCode = code.replace(/\./g, '_');
    const confColor = localStorage.getItem('cfi_conf_' + safeCode);
    if (confColor) return; // already highlighted — skip

    const titleEl = itemEl.querySelector('.item-title');
    const title = titleEl ? titleEl.textContent.trim() : '';
    const ansContent = localStorage.getItem('cfi_' + safeCode + '_ans') || '';
    const sumContent = localStorage.getItem('cfi_' + safeCode + '_sum') || '';

    const taskBody = itemEl.closest('.task-body');
    const taskHeader = taskBody ? taskBody.previousElementSibling : null;
    const taskRef = taskHeader ? taskHeader.querySelector('.task-ref')?.textContent?.trim() || '' : '';
    const taskTitleNode2 = taskHeader ? taskHeader.querySelector('.task-ref')?.nextSibling : null;
    const taskTitleText2 = taskTitleNode2 ? taskTitleNode2.textContent?.trim() || '' : '';
    const taskHeaderText = taskRef ? `${taskRef} ${taskTitleText2}`.trim() : taskTitleText2;

    const sectionLabel = itemEl.closest('.section-wrapper')?.querySelector('.section-label span')?.textContent?.trim() || '';
    const isSkill = sectionLabel === 'Skills';

    items.push({ code, safeCode, title, ansContent, sumContent, taskLabel: taskHeaderText, areaId, isSkill });
  });
  return items;
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ── Session Persistence ───────────────────────────────────────────

function saveOralSession() {
  localStorage.setItem(oralState.sessionKey, JSON.stringify({
    active: oralState.active,
    scope: oralState.scope,
    targetArea: oralState.targetArea,
    mode: oralState.mode,
    areaQueue: oralState.areaQueue,
    areaIndex: oralState.areaIndex,
    currentAreaId: oralState.currentAreaId,
    wrongTotal: oralState.wrongTotal,
    correctTotal: oralState.correctTotal,
    totalQAsked: oralState.totalQAsked,
  }));
}

function loadOralSession() {
  try {
    const raw = localStorage.getItem('oralSimSession');
    return raw ? JSON.parse(raw) : null;
  } catch(e) { return null; }
}

function clearOralSession() {
  localStorage.removeItem('oralSimSession');
}

// ── Start / Resume ────────────────────────────────────────────────

function startOralSim(resume) {
  const saved = loadOralSession();

  if (resume && saved && saved.active) {
    // Restore from saved state
    Object.assign(oralState, {
      active: true,
      scope: saved.scope,
      targetArea: saved.targetArea,
      mode: saved.mode,
      areaQueue: saved.areaQueue,
      areaIndex: saved.areaIndex,
      currentAreaId: saved.currentAreaId,
      wrongTotal: saved.wrongTotal,
      correctTotal: saved.correctTotal,
      totalQAsked: saved.totalQAsked,
      wrongInArea: [],
      digMode: false,
    });
  } else {
    clearOralSession();
    const areaQueue = buildOralAreaQueue();
    Object.assign(oralState, {
      active: true,
      scope: oralState.scope,
      targetArea: oralState.scope === 'area' ? document.getElementById('oralAreaSelect').value : null,
      mode: oralState.mode,
      areaQueue,
      areaIndex: 0,
      currentAreaId: areaQueue[0],
      wrongTotal: 0,
      correctTotal: 0,
      totalQAsked: 0,
      wrongInArea: [],
      digMode: false,
      questionQueue: [],
      questionIndex: 0,
      digQueue: [],
    });
  }

  closeOralSimLauncher();

  // Set up UI
  const modeBadge = document.getElementById('oralSimModeBadge');
  modeBadge.textContent = oralState.mode === 'direct' ? 'Direct' : 'AI QUIZ';
  modeBadge.className = 'oral-sim-mode-badge ' + oralState.mode;

  document.getElementById('oralSimOverlay').classList.add('open');
  mPopOpen(document.getElementById('oralSimOverlay'));
  loadOralArea(oralState.currentAreaId);
}

// ── Area Loading ──────────────────────────────────────────────────

function loadOralArea(areaId) {
  oralState.currentAreaId = areaId;
  oralState.wrongInArea = [];
  oralState.digMode = false;

  const areaMeta = ORAL_AREAS.find(a => a.id === areaId);

  // Skip areas with no highlighted items (Area IV always proceeds — mandatory lesson plan)
  const highlightedCheck = getHighlightedItemsForArea(areaId);
  if (highlightedCheck.length === 0 && !areaMeta?.specialLesson) {
    advanceOralArea();
    return;
  }

  // Special: Area IV — mandatory lesson plan question first
  if (areaMeta && areaMeta.specialLesson) {
    const maneuver = AREA_IV_MANEUVERS[Math.floor(Math.random() * AREA_IV_MANEUVERS.length)];
    const syntheticItem = {
      code: 'AI.IV.A.K1',
      safeCode: 'AI_IV_A_K1',
      title: `Present a preflight lesson on "${maneuver}" as you would teach it to a student. Previously developed lesson plans may be used.`,
      ansContent: localStorage.getItem('cfi_AI_IV_A_K1_ans') || '',
      sumContent: localStorage.getItem('cfi_AI_IV_A_K1_sum') || '',
      taskLabel: 'Task A | Maneuver Lesson',
      areaId: 'IV',
      isSkill: false,
      isLessonPlan: true,
      maneuver,
    };
    oralState.questionQueue = [syntheticItem];
    oralState.questionIndex = 0;

    // After lesson plan, add regular highlighted items
    const regularItems = shuffle(getHighlightedItemsForArea(areaId));
    oralState.questionQueue = [syntheticItem, ...regularItems];
  } else {
    const highlighted = shuffle(getHighlightedItemsForArea(areaId));
    oralState.questionQueue = highlighted;
    oralState.questionIndex = 0;
  }

  oralState.digQueue = shuffle(getUnhighlightedItemsForArea(areaId));

  updateOralProgress();
  saveOralSession();
  nextOralQuestion();
}

// ── Progress Bar ──────────────────────────────────────────────────

function updateOralProgress() {
  const idx = oralState.areaQueue.indexOf(oralState.currentAreaId);
  const total = oralState.areaQueue.length;
  document.getElementById('oralSimProgress').textContent =
    `Area ${idx + 1} of ${total}`;
}

// ── Question Display ──────────────────────────────────────────────

function nextOralQuestion() {
  let item = null;

  if (oralState.digMode) {
    if (oralState.digQueue.length === 0) {
      // No more dig items — move to next area
      advanceOralArea();
      return;
    }
    item = oralState.digQueue.shift();
  } else {
    if (oralState.questionIndex >= oralState.questionQueue.length) {
      // Done with this area's highlighted items
      advanceOralArea();
      return;
    }
    item = oralState.questionQueue[oralState.questionIndex];
    oralState.questionIndex++;
  }

  oralState.currentItem = item;

  // Reset reveal state
  oralState.revealed = { ans: false, sum: false };
  document.getElementById('oralAnsBox').classList.remove('visible');
  document.getElementById('oralSumBox').classList.remove('visible');
  document.getElementById('oralRevealAns').classList.remove('revealed');
  document.getElementById('oralRevealSum').classList.remove('revealed');
  document.getElementById('oralGradeRow').className = 'oral-grade-row';
  document.getElementById('oralQSources').classList.remove('visible');
  document.getElementById('oralQSourcesList').innerHTML = '';

  // Set task header — two lines
  const areaMeta = ORAL_AREAS.find(a => a.id === item.areaId);
  const areaLabel = areaMeta ? areaMeta.label : '';
  const headerEl = document.getElementById('oralQTaskHeader');
  headerEl.innerHTML = `<span>${areaLabel}</span>${item.taskLabel ? `<span style="color:var(--muted);font-weight:400;">${item.taskLabel}</span>` : ''}`;

  // Set question text
  const qEl = document.getElementById('oralQQuestion');

  if (oralState.mode === 'rephrased') {
    qEl.textContent = '';
    document.getElementById('oralQThinking').textContent = getThinkingPhrase();
    generateRephrasedQuestion(item).then(q => {
      qEl.textContent = q;
      document.getElementById('oralQThinking').textContent = '';
    });
  } else {
    // Direct mode
    let questionText = item.title;
    if (item.isSkill) {
      const areaMeta = ORAL_AREAS.find(a => a.id === item.areaId);
      if (areaMeta && areaMeta.flightManeuver) {
        questionText = `From a teaching perspective — ${item.title}`;
      }
    }
    qEl.textContent = questionText;
    document.getElementById('oralQThinking').textContent = '';
  }

  // Populate answer boxes (hidden until revealed)
  const ansEl = document.getElementById('oralAnsContent');
  const sumEl = document.getElementById('oralSumContent');

  if (item.ansContent && item.ansContent.trim()) {
    ansEl.innerHTML = item.ansContent;
    ansEl.classList.remove('empty');
  } else {
    ansEl.textContent = 'No answer notes added yet.';
    ansEl.classList.add('empty');
  }

  if (item.sumContent && item.sumContent.trim()) {
    sumEl.innerHTML = item.sumContent;
    sumEl.classList.remove('empty');
  } else {
    sumEl.textContent = 'No summary notes added yet.';
    sumEl.classList.add('empty');
  }

  oralState.totalQAsked++;
  saveOralSession();
}

function getThinkingPhrase() {
  return THINKING_PHRASES[Math.floor(Math.random() * THINKING_PHRASES.length)];
}

// ── AI Question Generation ────────────────────────────────────────

async function generateRephrasedQuestion(item) {
  const apiKey = localStorage.getItem('oralApiKey') || '';
  const hasPersonalKey = apiKey && apiKey.startsWith('sk-');

  const areaMeta = ORAL_AREAS.find(a => a.id === item.areaId);
  const isFlightArea = areaMeta && areaMeta.flightManeuver;

  // Strip leading letter prefix like "a. " or "b. " from title
  const cleanTitle = item.title.replace(/^[a-z]\.\s*/i, '');

  const ansText = item.ansContent ? item.ansContent.replace(/<[^>]+>/g, ' ').trim() : '';
  const sumText = item.sumContent ? item.sumContent.replace(/<[^>]+>/g, ' ').trim() : '';
  const hasNotes = ansText || sumText;

  // Reset sources display
  document.getElementById('oralQSources').classList.remove('visible');
  document.getElementById('oralQSourcesList').innerHTML = '';

  const systemPrompt = hasNotes
    ? `You are a DPE (Designated Pilot Examiner) conducting a CFI checkride oral exam.

STRICT RULES — you MUST follow all of these:
1. Generate ONE concise oral-exam question using ONLY the exact terms, concepts, and facts present in the provided notes.
2. Do NOT introduce, infer, or add ANY aviation terminology, concepts, acronyms, or knowledge that does not explicitly appear in the notes. If a term is not written in the notes, you must not use it.
3. Do NOT rename or substitute concepts. Use the same words the notes use.
4. Craft a question that tests understanding and application — not just recall of definitions.
5. If it is a skill item or flight maneuver area, frame it as a teaching or knowledge question.

Respond with ONLY a JSON object in this exact format (no markdown, no backticks, no preamble):
{"question":"your question here","sources":["exact phrase from notes that this question draws on","another exact phrase from notes"]}

The "sources" array must contain 2-4 SHORT phrases (under 10 words each) copied directly from the notes that your question is based on. These must be real phrases that appear verbatim in the provided notes.`
    : `You are a DPE conducting a CFI checkride oral exam.
The candidate has not added notes for this item yet.
Ask a simple, direct question about the following topic. Keep it under 15 words.
Respond with ONLY a JSON object (no markdown, no backticks):
{"question":"your question here","sources":[]}`;

  const userContent = `ACS Item Code: ${item.code}
ACS Item Title: ${cleanTitle}
${ansText ? `Answer Notes: ${ansText}` : ''}
${sumText ? `Summary Notes: ${sumText}` : ''}
${isFlightArea ? 'Note: This is a flight maneuver area — frame as a teaching or knowledge question.' : ''}
${item.isLessonPlan ? `Note: This is the Area IV lesson plan requirement. The maneuver is: ${item.maneuver}` : ''}`;

  const headers = { 'Content-Type': 'application/json', 'anthropic-version': '2023-06-01' };
  if (hasPersonalKey) headers['x-api-key'] = apiKey;

  // Combine notes text for validation
  const allNotesLower = (ansText + ' ' + sumText).toLowerCase();

  try {
    const response = await fetch('https://anthropic-proxy.jswartzm747.workers.dev', {
      method: 'POST',
      headers,
      body: JSON.stringify({
        model: 'claude-haiku-4-5-20251001',
        max_tokens: 300,
        system: systemPrompt,
        messages: [{ role: 'user', content: userContent }]
      })
    });
    const data = await response.json();
    if (data.content && data.content[0] && data.content[0].text) {
      const raw = data.content[0].text.trim().replace(/^```json\s*/, '').replace(/\s*```$/, '');
      let parsed;
      try {
        parsed = JSON.parse(raw);
      } catch (jsonErr) {
        // Fallback: treat entire response as question text (old behavior)
        return raw;
      }

      const question = parsed.question || raw;
      const sources = Array.isArray(parsed.sources) ? parsed.sources : [];

      // Validate sources — only show ones actually found in the notes
      const verifiedSources = sources.filter(s =>
        s && typeof s === 'string' && s.length > 2 &&
        allNotesLower.includes(s.toLowerCase().trim())
      );

      // Display verified sources
      if (verifiedSources.length > 0) {
        const listEl = document.getElementById('oralQSourcesList');
        listEl.innerHTML = verifiedSources.map(s =>
          `<span class="oral-q-source-tag">${s.replace(/</g, '&lt;')}</span>`
        ).join('');
        document.getElementById('oralQSources').classList.add('visible');
      }

      return question;
    }
    return '[API error: ' + (data.error?.message || JSON.stringify(data).substring(0, 150)) + ']';
  } catch (e) {
    return '[Fetch error: ' + e.message + ']';
  }
}

// ── Reveal ────────────────────────────────────────────────────────

function revealOralBox(which) {
  if (which === 'ans') {
    oralState.revealed.ans = true;
    document.getElementById('oralAnsBox').classList.add('visible');
    document.getElementById('oralRevealAns').classList.add('revealed');
  } else {
    oralState.revealed.sum = true;
    document.getElementById('oralSumBox').classList.add('visible');
    document.getElementById('oralRevealSum').classList.add('revealed');
  }
}

// ── Grading ───────────────────────────────────────────────────────

function gradeOral(correct) {
  const item = oralState.currentItem;
  if (!item) return;

  if (correct) {
    oralState.correctTotal++;
    // If we were in dig mode and got it right, exit dig mode
    if (oralState.digMode && oralState.wrongInArea.filter(w => !w.recovered).length > 0) {
      // mark recovered
    }
    if (oralState.digMode) {
      // 2 correct in dig mode = close the dig, move on
      oralState._digCorrectStreak = (oralState._digCorrectStreak || 0) + 1;
      if (oralState._digCorrectStreak >= 2) {
        oralState.digMode = false;
        oralState._digCorrectStreak = 0;
        advanceOralArea();
        return;
      }
    }
  } else {
    oralState.wrongTotal++;
    oralState.wrongInArea.push({ code: item.code, title: item.title });
    oralState._digCorrectStreak = 0;

    // Check fail threshold
    if (oralState.wrongInArea.length >= ORAL_FAIL_THRESHOLD) {
      triggerOralFail();
      return;
    }

    // Enter dig mode — pull from unhighlighted
    if (!oralState.digMode && oralState.digQueue.length > 0) {
      oralState.digMode = true;
      oralState._digCorrectStreak = 0;
    }
  }

  nextOralQuestion();
}

// ── Area Advance ──────────────────────────────────────────────────

function advanceOralArea() {
  oralState.areaIndex++;
  if (oralState.areaIndex >= oralState.areaQueue.length) {
    // Session complete — PASS
    triggerOralPass();
    return;
  }
  const nextAreaId = oralState.areaQueue[oralState.areaIndex];
  oralState.currentAreaId = nextAreaId;
  oralState.digMode = false;
  oralState._digCorrectStreak = 0;
  updateOralProgress();
  loadOralArea(nextAreaId);
}

// ── Fail ──────────────────────────────────────────────────────────

function triggerOralFail() {
  clearOralSession();
  oralState.active = false;

  const areaMeta = ORAL_AREAS.find(a => a.id === oralState.currentAreaId);
  document.getElementById('oralFailArea').textContent =
    (areaMeta ? areaMeta.label : oralState.currentAreaId) + ' — Too many incorrect answers';

  const itemsList = document.getElementById('oralFailItems');
  itemsList.innerHTML = '';
  oralState.wrongInArea.forEach(w => {
    const div = document.createElement('div');
    div.className = 'oral-fail-item';
    div.innerHTML = `<span class="oral-fail-item-code">${w.code}</span><span>${w.title}</span>`;
    itemsList.appendChild(div);
  });

  var failEl = document.getElementById('oralFailOverlay');
  failEl.classList.remove('m-pop-out');
  failEl.classList.add('open');
}

function restartAfterFail() {
  var fEl = document.getElementById('oralFailOverlay');
  mPopClose(fEl, function() { fEl.classList.remove('open'); });
  document.getElementById('oralSimOverlay').classList.remove('open');
  openOralSimLauncher();
}

function exitAfterFail() {
  var fEl = document.getElementById('oralFailOverlay');
  mPopClose(fEl, function() { fEl.classList.remove('open'); });
  document.getElementById('oralSimOverlay').classList.remove('open');
}

// ── Pass ──────────────────────────────────────────────────────────

function triggerOralPass() {
  clearOralSession();
  oralState.active = false;

  document.getElementById('oralPassStats').textContent =
    `${oralState.totalQAsked} questions — ${oralState.correctTotal} correct`;

  var passEl = document.getElementById('oralPassOverlay');
  passEl.classList.remove('m-pop-out');
  passEl.classList.add('open');
}

function exitAfterPass() {
  var pEl = document.getElementById('oralPassOverlay');
  mPopClose(pEl, function() { pEl.classList.remove('open'); });
  document.getElementById('oralSimOverlay').classList.remove('open');
}

// ── Exit Mid-Session ──────────────────────────────────────────────

function exitOralSim() {
  if (oralState.active) saveOralSession();
  document.getElementById('oralSimOverlay').classList.remove('open');
  oralState.active = false;
}


function closeStudyMode() {
  // Apply all pending unhighlights
  studyPendingRemovals.forEach((_, safeCode) => {
    localStorage.removeItem('cfi_conf_' + safeCode);
    const mainItem = document.querySelector(`.item-code[data-safe="${safeCode}"]`)?.closest('.item');
    if (mainItem) {
      mainItem.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
      mainItem.querySelector('.item-title')?.classList.remove('conf-green','conf-yellow','conf-red');
    }
  });
  studyPendingRemovals.clear();
  studyPendingColorChanges.clear();
  studyPendingContentChanges.clear();
  var smEl = document.getElementById('studyModeOverlay');
  mPopClose(smEl, function() { smEl.classList.remove('open'); });
}

</script>

<!-- ── Oral Simulator Launcher ──────────────────────────────────── -->
<div class="oral-launcher-overlay" id="oralLauncherOverlay">
  <div class="oral-launcher-card">
    <div style="display:flex;flex-direction:column;gap:0.3rem;">
      <div class="oral-launcher-title">Oral Simulator</div>
      <div class="oral-launcher-sub">Initial CFI — Simulates a real checkride oral</div>
    </div>

    <div>
      <div class="oral-section-label">Session Scope</div>
      <div class="oral-option-group">
        <button class="oral-option-btn selected" id="scopeFull" onclick="setOralScope('full')">Full Oral</button>
        <button class="oral-option-btn" id="scopeArea" onclick="setOralScope('area')">Area-Specific</button>
      </div>
    </div>

    <select class="oral-area-select" id="oralAreaSelect">
      <option value="I">Area I — Fundamentals of Instructing</option>
      <option value="II">Area II — Technical Subject Areas</option>
      <option value="III">Area III — Preflight Preparation</option>
      <option value="IV">Area IV — Preflight Lesson on Maneuver</option>
      <option value="V">Area V — Preflight Procedures</option>
      <option value="VI">Area VI — Airport & Seaplane Base Operations</option>
      <option value="VII">Area VII — Takeoffs, Landings, & Go-Arounds</option>
      <option value="VIII">Area VIII — Fundamentals of Flight</option>
      <option value="IX">Area IX — Performance Maneuvers</option>
      <option value="X">Area X — Ground Reference Maneuvers</option>
      <option value="XI">Area XI — Basic Instrument Maneuvers</option>
      <option value="XII">Area XII — Emergency Operations</option>
      <option value="XIV">Area XIV — Postflight Procedures</option>
    </select>

    <div>
      <div class="oral-section-label">Question Mode</div>
      <div class="oral-option-group">
        <button class="oral-option-btn selected" id="modeDirect" onclick="setOralMode('direct')">Direct from ACS <span style="font-size:0.55rem;opacity:0.6;display:block;">Free</span></button>
        <button class="oral-option-btn" id="modeRephrased" onclick="setOralMode('rephrased')">Rephrased <span style="font-size:0.55rem;opacity:0.6;display:block;">AI — Uses API Key</span></button>
      </div>
    </div>

    <div class="oral-api-row" id="oralApiRow">
      <div class="oral-section-label">Anthropic API Key</div>
      <input class="oral-api-input" id="oralApiKeyInput" type="password" placeholder="sk-ant-..." autocomplete="off" oninput="updateApiStatus()">
      <div class="oral-api-status missing" id="oralApiStatus">No API Key — Rephrased mode unavailable</div>
    </div>

    <div class="oral-resume-banner" id="oralResumeBanner">
      <div class="oral-resume-text">Session in Progress</div>
      <div class="oral-resume-detail" id="oralResumeDetail"></div>
      <div class="oral-resume-btns">
        <button class="oral-resume-btn resume" onclick="startOralSim(true)">Resume Session</button>
      </div>
    </div>

    <div class="oral-launcher-btns">
      <button class="oral-launcher-cancel" onclick="closeOralSimLauncher()">Cancel</button>
      <button class="oral-launcher-go" id="oralLauncherGo" onclick="startOralSim(false)">Begin Oral</button>
    </div>
  </div>
</div>

<!-- ── Oral Simulator Main Overlay ─────────────────────────────── -->
<div class="oral-sim-overlay" id="oralSimOverlay">
  <div class="oral-sim-header">
    <div class="oral-sim-title">
      Oral Simulator
      <span class="oral-sim-mode-badge direct" id="oralSimModeBadge">Direct</span>
    </div>
    <div class="oral-sim-progress" id="oralSimProgress"></div>
    <button class="oral-sim-exit-btn" onclick="exitOralSim()">Exit</button>
  </div>
  <div class="oral-sim-body">
    <div class="oral-q-card">
      <div class="oral-q-task-header" id="oralQTaskHeader"></div>
      <div class="oral-q-question" id="oralQQuestion"></div>
      <div class="oral-q-sources" id="oralQSources">
        <div class="oral-q-sources-label">Sourced from your notes</div>
        <div class="oral-q-sources-list" id="oralQSourcesList"></div>
      </div>
      <div class="oral-q-thinking" id="oralQThinking"></div>
      <div class="oral-q-reveal-row">
        <button class="oral-q-reveal-btn" id="oralRevealSum" onclick="revealOralBox('sum')">Summary</button>
        <button class="oral-q-reveal-btn" id="oralRevealAns" onclick="revealOralBox('ans')">Answer</button>
      </div>
    <div class="oral-q-answer-box" id="oralAnsBox">
        <div class="oral-q-answer-label">Answer</div>
        <div class="oral-q-answer-content" id="oralAnsContent"></div>
      </div>
      <div class="oral-q-answer-box" id="oralSumBox">
        <div class="oral-q-answer-label">Summary / Notes</div>
        <div class="oral-q-answer-content" id="oralSumContent"></div>
      </div>
      <div class="oral-grade-row" id="oralGradeRow">
        <div style="display:flex;flex-direction:column;align-items:center;gap:0.4rem;">
          <button class="oral-grade-btn wrong" onclick="gradeOral(false)" title="Got it wrong">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <line x1="4" y1="4" x2="18" y2="18" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"/>
              <line x1="18" y1="4" x2="4" y2="18" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"/>
            </svg>
          </button>
          <div class="oral-grade-hint visible">Wrong</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:0.4rem;">
          <button class="oral-grade-btn correct" onclick="gradeOral(true)" title="Got it right">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polyline points="3,11 9,17 19,5" stroke="currentColor" stroke-width="2.5" stroke-linecap="square" stroke-linejoin="miter"/>
            </svg>
          </button>
          <div class="oral-grade-hint visible">Correct</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ── Oral Fail Screen ─────────────────────────────────────────── -->
<div class="oral-fail-overlay" id="oralFailOverlay">
  <div class="oral-fail-card">
    <div class="oral-fail-title">Not Quite Ready</div>
    <div class="oral-fail-area" id="oralFailArea"></div>
    <div class="oral-fail-label">Questions missed in this area:</div>
    <div class="oral-fail-items" id="oralFailItems"></div>
    <div class="oral-fail-btns">
      <button class="oral-fail-btn restart" onclick="restartAfterFail()">Try Again</button>
      <button class="oral-fail-btn exit-fail" onclick="exitAfterFail()">Exit to Study</button>
    </div>
  </div>
</div>

<!-- ── Oral Pass Screen ─────────────────────────────────────────── -->
<div class="oral-pass-overlay" id="oralPassOverlay">
  <div class="oral-pass-card">
    <div class="oral-pass-check">
      <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
        <polyline points="7,18 15,26 29,10" stroke="#2e8b57" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="oral-pass-title">Let's Go Flying</div>
    <div class="oral-pass-stats" id="oralPassStats"></div>
    <button class="oral-pass-btn" onclick="exitAfterPass()">Done</button>
  </div>
</div>

<!-- Search Panel -->
<div class="search-panel" id="searchPanel">
  <div class="search-panel-header">
    <h3>Search</h3>
    <button class="search-panel-close" onclick="toggleSearch()" title="Close">✕</button>
  </div>
  <div class="search-panel-body">
    <div class="search-input-row">
      <svg width="14" height="14" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;color:#aaa;"><circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.5"/><line x1="10" y1="10" x2="13.5" y2="13.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      <input class="search-panel-input" id="searchInput" type="text" placeholder="Search topics, codes..." autocomplete="off"
        oninput="runSearch(this.value)" onkeydown="searchKeyNav(event)">
      <button class="search-panel-clear" id="searchClearBtn" onclick="clearSearch()" title="Clear">×</button>
    </div>
    <div class="search-panel-results" id="searchResults"></div>
  </div>
</div>

<button class="search-icon-btn" id="searchBtn" onclick="toggleSearch()" title="Search">
  <svg width="17" height="17" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.5"/>
    <line x1="10" y1="10" x2="13.5" y2="13.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
  </svg>
</button>

<button class="notes-icon-btn" id="notesPanelBtn" onclick="toggleNotesPanel()" title="Plan / Notes">
  <svg width="18" height="18" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 2h7l3 3v9a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M10 2v3h3" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><line x1="5" y1="7" x2="11" y2="7" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><line x1="5" y1="9.5" x2="11" y2="9.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><line x1="5" y1="12" x2="8" y2="12" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg>
</button>

<style>
  @media(hover:hover){
  #editModeToast:hover { border-color:rgba(46,139,87,0.9) !important; color:rgba(46,139,87,1) !important; transform:translateX(-50%) scale(1.1) !important; background:rgba(20,20,20,0.95) !important; box-shadow:0 4px 20px rgba(46,139,87,0.2) !important; }
  }
  #editModeToast:active { transform:translateX(-50%) scale(0.96) !important; }

  /* ═══ Mobile dropdown fix ═══ */
  @media (max-width: 600px) {
    header {
      z-index: 200 !important;
    }
    /* Dropdowns that got moved to body by the fix script below */
    body > .more-options-menu,
  }
</style>
<div id="editModeToast" onclick="toggleEditMode()" style="display:none;position:fixed;bottom:6.5rem;left:50%;transform:translateX(-50%);background:rgba(20,20,20,0.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(46,139,87,0.4);color:rgba(46,139,87,0.7);font-family:'Barlow Condensed',sans-serif;font-size:0.63rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;padding:0.4rem 1.2rem;border-radius:6px;box-shadow:0 2px 12px rgba(0,0,0,0.25);z-index:9999;cursor:pointer;align-items:center;white-space:nowrap;transition:all 0.2s;">
  Exit Edit Mode
</div>


<!-- Export Modal -->
<div class="xfer-modal-overlay" id="exportModalOverlay" onclick="closeXferModalOutside(event,'exportModalOverlay')">
  <div class="xfer-modal-card">
    <button class="xfer-modal-close" onclick="closeXferModal('exportModalOverlay')">✕</button>
    <div class="xfer-modal-title">Export Answers</div>
    <div class="xfer-modal-subtitle">Choose how to export your data</div>
    <div class="xfer-modal-btns">
      <button class="xfer-btn xfer-btn-secondary" onclick="exportAsFile()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 3v13M7 11l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 20h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        Save as File
      </button>
      <button class="xfer-btn xfer-btn-primary" onclick="exportToClipboard()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><rect x="9" y="2" width="13" height="13" rx="2" stroke="currentColor" stroke-width="1.8"/><path d="M5 7H4a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        Copy to Clipboard
      </button>
    </div>
  </div>
</div>

<!-- Import Modal -->
<div class="xfer-modal-overlay" id="importModalOverlay" onclick="closeXferModalOutside(event,'importModalOverlay')">
  <div class="xfer-modal-card">
    <button class="xfer-modal-close" onclick="closeXferModal('importModalOverlay')">✕</button>
    <div class="xfer-modal-title">Import Answers</div>
    <div class="xfer-modal-subtitle">Choose how to import your data</div>
    <div class="xfer-modal-btns">
      <button class="xfer-btn xfer-btn-secondary" onclick="document.getElementById('importFileInput').click(); closeXferModal('importModalOverlay')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 21V8M7 13l5-5 5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 4h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        Import from File
      </button>
      <button class="xfer-btn xfer-btn-primary" onclick="importFromClipboard()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><rect x="9" y="2" width="13" height="13" rx="2" stroke="currentColor" stroke-width="1.8"/><path d="M5 7H4a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
        Paste from Clipboard
      </button>
    </div>
  </div>
</div>

<!-- Paste Modal -->
<div class="paste-modal-overlay" id="pasteModalOverlay" onclick="closePasteModalOutside(event)">
  <div class="paste-modal-card">
    <button class="paste-modal-close" onclick="document.getElementById('pasteModalOverlay').classList.remove('open')">✕</button>
    <div class="paste-modal-title">Paste Import Data</div>
    <div class="paste-modal-subtitle">Paste your copied export data below</div>
    <textarea class="paste-modal-textarea" id="pasteImportTextarea" placeholder="Paste your data here (Ctrl+V or Cmd+V)..."></textarea>
    <div class="paste-modal-btns">
      <button class="lock-confirm-no" style="flex:1;" onclick="document.getElementById('pasteModalOverlay').classList.remove('open')">Cancel</button>
      <button class="lock-confirm-yes" style="flex:1;" onclick="applyPasteImport()">Import</button>
    </div>
  </div>
</div>

<script>
  function openExportModal() {
    var el = document.getElementById('exportModalOverlay');
    el.classList.add('open');
    mPopOpen(el);
  }
  function openImportModal() {
    var el = document.getElementById('importModalOverlay');
    el.classList.add('open');
    mPopOpen(el);
  }
  function closeXferModal(id) {
    var el = document.getElementById(id);
    mPopClose(el, function() { el.classList.remove('open'); });
  }
  function closeXferModalOutside(e, id) {
    if (e.target === document.getElementById(id)) closeXferModal(id);
  }

  // ── Export as File (original behaviour) ──────────────────────────
  function exportAsFile() {
    closeXferModal('exportModalOverlay');
    exportAnswers();
  }

  // ── Export to Clipboard ───────────────────────────────────────────
  function exportToClipboard() {
    const data = buildExportData();
    const str = JSON.stringify(data);
    
    // Try modern clipboard API first, fall back to textarea method
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(str).then(() => {
        closeXferModal('exportModalOverlay');
        const ind = document.getElementById('save-indicator');
        ind.textContent = '✓ Copied to clipboard!'; ind.style.opacity = '1';
        setTimeout(() => { ind.style.opacity = '0'; }, 2500);
      }).catch(() => {
        copyViaTextarea(str);
      });
    } else {
      copyViaTextarea(str);
    }
  }

  function copyViaTextarea(str) {
    const ta = document.createElement('textarea');
    ta.value = str;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    ta.style.top = '-9999px';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try {
      document.execCommand('copy');
      closeXferModal('exportModalOverlay');
      const ind = document.getElementById('save-indicator');
      ind.textContent = '✓ Copied to clipboard!'; ind.style.opacity = '1';
      setTimeout(() => { ind.style.opacity = '0'; }, 2500);
    } catch(e) {
      alert('Copy failed. Please use Save as File instead.');
    }
    document.body.removeChild(ta);
  }

  // ── Import from Clipboard ─────────────────────────────────────────
  function importFromClipboard() {
    closeXferModal('importModalOverlay');
    const ta = document.getElementById('pasteImportTextarea');
    ta.value = '';
    document.getElementById('pasteModalOverlay').classList.add('open');
    setTimeout(() => ta.focus(), 150);
  }

  function applyPasteImport() {
    const text = document.getElementById('pasteImportTextarea').value.trim();
    if (!text) { alert('Nothing pasted — please paste your export data first.'); return; }
    try {
      const data = JSON.parse(text);
      document.getElementById('pasteModalOverlay').classList.remove('open');
      applyImportData(data);
    } catch(err) {
      alert('Could not read pasted data. Make sure you copied a valid export first.');
    }
  }

  function closePasteModalOutside(e) {
    if (e.target === document.getElementById('pasteModalOverlay')) {
      document.getElementById('pasteModalOverlay').classList.remove('open');
    }
  }

  // ── Shared: build export data object ─────────────────────────────
  function buildExportData() {
    const data = { answers: {}, confidence: {}, bookmark: null, links: null, version: 2 };
    Object.keys(localStorage).forEach(k => {
      if (k.startsWith('cfi_') &&
          !k.startsWith('cfi_conf_') &&
          !k.startsWith('cfi_answersRevealed') &&
          !k.startsWith('cfi_tasksExpanded') &&
          !k.startsWith('cfi_bookmark') &&
          !k.startsWith('cfi_links') &&
          !k.startsWith('cfi_notes') &&
          !k.startsWith('cfi_pw_') &&
          !k.startsWith('cfi_lock') &&
          !k.startsWith('cfi_hide') &&
          !k.startsWith('cfi_oral')) {
        const val = localStorage.getItem(k);
        if (val && val.trim()) data.answers[k.replace(/^cfi_/, '')] = val;
      }
    });
    document.querySelectorAll('.rich-editor').forEach(el => {
      if (el.id && el.innerHTML.trim()) {
        data.answers[el.id] = el.innerHTML;
        localStorage.setItem('cfi_' + el.id, el.innerHTML);
      }
    });
    Object.keys(localStorage).forEach(k => {
      if (k.startsWith('cfi_conf_')) data.confidence[k] = localStorage.getItem(k);
    });
    const bookmark = localStorage.getItem('cfi_bookmark');
    if (bookmark) data.bookmark = bookmark;
    const links = localStorage.getItem('cfi_links');
    if (links) data.links = JSON.parse(links);
    const notes = localStorage.getItem('cfi_notes');
    if (notes) data.notes = notes;
    return data;
  }

  // ── Shared: apply imported data object ───────────────────────────
  function applyImportData(data) {
    const answers = data.answers || data;
    const confidence = data.confidence || {};
    const bookmark = data.bookmark || null;
    const links = data.links || null;
    Object.entries(answers).forEach(([id, html]) => {
      localStorage.setItem('cfi_' + id, html);
      const el = document.getElementById(id);
      if (el) el.innerHTML = html;
    });
    Object.entries(confidence).forEach(([k, v]) => { localStorage.setItem(k, v); });
    // Clear all existing active dots and title conf classes first
    document.querySelectorAll('.conf-dot').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.item-title').forEach(t => t.classList.remove('conf-green', 'conf-yellow', 'conf-red'));
    document.querySelectorAll('.conf-dot').forEach(dot => {
      const item = dot.closest('.item');
      if (!item) return;
      const codeEl = item.querySelector('.item-code');
      if (!codeEl) return;
      const safeCode = codeEl.textContent.trim().replace(/\./g, '_');
      const confKey = 'cfi_conf_' + safeCode;
      const saved = localStorage.getItem(confKey);
      const titleDiv = item.querySelector('.item-title');
      if (saved && dot.classList.contains(saved)) {
        dot.classList.add('active');
        if (titleDiv) titleDiv.classList.add('conf-' + saved);
      }
    });
    if (bookmark) {
      localStorage.setItem('cfi_bookmark', bookmark);
      document.getElementById('bookmarkBanner').classList.add('visible');
      applyBookmarkUI(bookmark);
    }
    if (links) { localStorage.setItem('cfi_links', JSON.stringify(links)); }
    if (data.notes) {
      localStorage.setItem('cfi_notes', data.notes);
      const notesEditor = document.getElementById('notesEditor');
      if (notesEditor) notesEditor.innerHTML = data.notes;
    }
    loadAll();
    restoreUIState();
    document.querySelectorAll('.field-row').forEach(row => {
      const editor = row.querySelector('.rich-editor');
      if (!editor) return;
      const hasContent = editor.innerText.trim() !== '';
      const label = row.querySelector('.field-label');
      if (label) label.classList.toggle('populated', hasContent);
      if (hideEmptyActive) row.classList.toggle('is-empty', !hasContent);
    });
    const answerCount = Object.keys(answers).length;
    const ind = document.getElementById('save-indicator');
    ind.textContent = `✓ Imported ${answerCount} fields!`; ind.style.opacity = '1';
    setTimeout(() => { ind.style.opacity = '0'; }, 2500);
  }
</script>

<script>
// ═══ Mobile dropdown fix — moves menus to body when opened so they escape overflow clipping ═══
(function() {
  if (window.innerWidth > 600) return; // Only needed on mobile

  var menuIds = ['moreOptionsMenu', 'planeClassMenu', 'linksMenu'];
  var origParents = {};

  // Store original parents
  menuIds.forEach(function(id) {
    var el = document.getElementById(id);
    if (el) origParents[id] = el.parentElement;
  });

  // Watch for .open class being added
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(m) {
      if (m.type !== 'attributes' || m.attributeName !== 'class') return;
      var el = m.target;
      var id = el.id;
      if (!id || menuIds.indexOf(id) === -1) return;

      if (el.classList.contains('open')) {
        // Find the button that triggered this menu
        var parent = origParents[id];
        if (!parent) return;
        var btn = parent.querySelector('.btn, button');
        if (!btn) btn = parent;
        var r = btn.getBoundingClientRect();

        // Move to body
        document.body.appendChild(el);
        el.style.position = 'fixed';
        el.style.zIndex = '9999';
        el.style.top = (r.bottom + 6) + 'px';

        el.style.left = Math.max(8, Math.min(r.left, window.innerWidth - 320)) + 'px';
        el.style.right = 'auto';
      } else {
        // Move back to original parent
        if (origParents[id] && el.parentElement === document.body) {
          origParents[id].appendChild(el);
          el.style.position = '';
          el.style.zIndex = '';
          el.style.top = '';
          el.style.left = '';
          el.style.right = '';
        }
      }
    });
  });

  // Observe all menus
  menuIds.forEach(function(id) {
    var el = document.getElementById(id);
    if (el) observer.observe(el, { attributes: true, attributeFilter: ['class'] });
  });
})();
</script>

</body>
</html>
